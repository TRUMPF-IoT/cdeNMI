function BigInteger(n,t,i){n!=null&&("number"==typeof n?this.fromNumber(n,t,i):t==null&&"string"!=typeof n?this.fromString(n,256):this.fromString(n,t))}function nbi(){return new BigInteger(null,null,null)}function am1(n,t,i,r,u,f){while(--f>=0){var e=t*this[n++]+i[r]+u;u=Math.floor(e/67108864);i[r++]=e&67108863}return u}function am2(n,t,i,r,u,f){for(var o=t&32767,s=t>>15;--f>=0;){var e=this[n]&32767,h=this[n++]>>15,c=s*e+h*o;e=o*e+((c&32767)<<15)+i[r]+(u&1073741823);u=(e>>>30)+(c>>>15)+s*h+(u>>>30);i[r++]=e&1073741823}return u}function am3(n,t,i,r,u,f){for(var o=t&16383,s=t>>14;--f>=0;){var e=this[n]&16383,h=this[n++]>>14,c=s*e+h*o;e=o*e+((c&16383)<<14)+i[r]+u;u=(e>>28)+(c>>14)+s*h;i[r++]=e&268435455}return u}function int2char(n){return BI_RM.charAt(n)}function intAt(n,t){var i=BI_RC[n.charCodeAt(t)];return i==null?-1:i}function bnpCopyTo(n){for(var t=this.t-1;t>=0;--t)n[t]=this[t];n.t=this.t;n.s=this.s}function bnpFromInt(n){this.t=1;this.s=n<0?-1:0;n>0?this[0]=n:n<-1?this[0]=n+DV:this.t=0}function nbv(n){var t=nbi();return t.fromInt(n),t}function bnpFromString(n,t){var r,u;if(t==16)r=4;else if(t==8)r=3;else if(t==256)r=8;else if(t==2)r=1;else if(t==32)r=5;else if(t==4)r=2;else{this.fromRadix(n,t);return}this.t=0;this.s=0;for(var f=n.length,e=!1,i=0;--f>=0;){if(u=r==8?n[f]&255:intAt(n,f),u<0){n.charAt(f)=="-"&&(e=!0);continue}e=!1;i==0?this[this.t++]=u:i+r>this.DB?(this[this.t-1]|=(u&(1<<this.DB-i)-1)<<i,this[this.t++]=u>>this.DB-i):this[this.t-1]|=u<<i;i+=r;i>=this.DB&&(i-=this.DB)}r==8&&(n[0]&128)!=0&&(this.s=-1,i>0&&(this[this.t-1]|=(1<<this.DB-i)-1<<i));this.clamp();e&&BigInteger.prototype.ZERO.subTo(this,this)}function bnpClamp(){for(var n=this.s&this.DM;this.t>0&&this[this.t-1]==n;)--this.t}function bnToString(n){var t;if(this.s<0)return"-"+this.negate().toString(n);if(n==16)t=4;else if(n==8)t=3;else if(n==2)t=1;else if(n==32)t=5;else if(n==4)t=2;else return this.toRadix(n);var o=(1<<t)-1,u,f=!1,e="",r=this.t,i=this.DB-r*this.DB%t;if(r-->0)for(i<this.DB&&(u=this[r]>>i)>0&&(f=!0,e=int2char(u));r>=0;)i<t?u=(this[r]&(1<<i)-1)<<t-i|this[--r]>>(i+=this.DB-t):(u=this[r]>>(i-=t)&o,i<=0&&(i+=this.DB,--r)),u>0&&(f=!0),f&&(e+=int2char(u));return f?e:"0"}function bnNegate(){var n=nbi();return BigInteger.prototype.ZERO.subTo(this,n),n}function bnAbs(){return this.s<0?this.negate():this}function bnCompareTo(n){var t=this.s-n.s,i;if(t!=0||(i=this.t,t=i-n.t,t!=0))return t;while(--i>=0)if((t=this[i]-n[i])!=0)return t;return 0}function nbits(n){var i=1,t;return(t=n>>>16)!=0&&(n=t,i+=16),(t=n>>8)!=0&&(n=t,i+=8),(t=n>>4)!=0&&(n=t,i+=4),(t=n>>2)!=0&&(n=t,i+=2),(t=n>>1)!=0&&(n=t,i+=1),i}function bnBitLength(){return this.t<=0?0:this.DB*(this.t-1)+nbits(this[this.t-1]^this.s&this.DM)}function bnpDLShiftTo(n,t){for(var i=this.t-1;i>=0;--i)t[i+n]=this[i];for(i=n-1;i>=0;--i)t[i]=0;t.t=this.t+n;t.s=this.s}function bnpDRShiftTo(n,t){for(var i=n;i<this.t;++i)t[i-n]=this[i];t.t=Math.max(this.t-n,0);t.s=this.s}function bnpLShiftTo(n,t){for(var u=n%this.DB,e=this.DB-u,o=(1<<e)-1,r=Math.floor(n/this.DB),f=this.s<<u&this.DM,i=this.t-1;i>=0;--i)t[i+r+1]=this[i]>>e|f,f=(this[i]&o)<<u;for(i=r-1;i>=0;--i)t[i]=0;t[r]=f;t.t=this.t+r+1;t.s=this.s;t.clamp()}function bnpRShiftTo(n,t){var i,r;if(t.s=this.s,i=Math.floor(n/this.DB),i>=this.t){t.t=0;return}var u=n%this.DB,f=this.DB-u,e=(1<<u)-1;for(t[0]=this[i]>>u,r=i+1;r<this.t;++r)t[r-i-1]|=(this[r]&e)<<f,t[r-i]=this[r]>>u;u>0&&(t[this.t-i-1]|=(this.s&e)<<f);t.t=this.t-i;t.clamp()}function bnpSubTo(n,t){for(var r=0,i=0,u=Math.min(n.t,this.t);r<u;)i+=this[r]-n[r],t[r++]=i&this.DM,i>>=this.DB;if(n.t<this.t){for(i-=n.s;r<this.t;)i+=this[r],t[r++]=i&this.DM,i>>=this.DB;i+=this.s}else{for(i+=this.s;r<n.t;)i-=n[r],t[r++]=i&this.DM,i>>=this.DB;i-=n.s}t.s=i<0?-1:0;i<-1?t[r++]=this.DV+i:i>0&&(t[r++]=i);t.t=r;t.clamp()}function bnpMultiplyTo(n,t){var r=this.abs(),u=n.abs(),i=r.t;for(t.t=i+u.t;--i>=0;)t[i]=0;for(i=0;i<u.t;++i)t[i+r.t]=r.am(0,u[i],t,i,0,r.t);t.s=0;t.clamp();this.s!=n.s&&BigInteger.prototype.ZERO.subTo(t,t)}function bnpSquareTo(n){for(var i=this.abs(),t=n.t=2*i.t,r;--t>=0;)n[t]=0;for(t=0;t<i.t-1;++t)r=i.am(t,i[t],n,2*t,0,1),(n[t+i.t]+=i.am(t+1,2*i[t],n,2*t+1,r,i.t-t-1))>=i.DV&&(n[t+i.t]-=i.DV,n[t+i.t+1]=1);n.t>0&&(n[n.t-1]+=i.am(t,i[t],n,2*t,0,1));n.s=0;n.clamp()}function bnpDivRemTo(n,t,i){var e=n.abs(),h,u,c,a;if(!(e.t<=0)){if(h=this.abs(),h.t<e.t){t!=null&&t.fromInt(0);i!=null&&this.copyTo(i);return}i==null&&(i=nbi());var r=nbi(),v=this.s,p=n.s,s=this.DB-nbits(e[e.t-1]);if(s>0?(e.lShiftTo(s,r),h.lShiftTo(s,i)):(e.copyTo(r),h.copyTo(i)),u=r.t,c=r[u-1],c!=0){var y=c*(1<<this.F1)+(u>1?r[u-2]>>this.F2:0),w=this.FV/y,b=(1<<this.F1)/y,k=1<<this.F2,o=i.t,l=o-u,f=t==null?nbi():t;for(r.dlShiftTo(l,f),i.compareTo(f)>=0&&(i[i.t++]=1,i.subTo(f,i)),BigInteger.prototype.ONE.dlShiftTo(u,f),f.subTo(r,r);r.t<u;)r[r.t++]=0;while(--l>=0)if(a=i[--o]==c?this.DM:Math.floor(i[o]*w+(i[o-1]+k)*b),(i[o]+=r.am(0,a,i,l,0,u))<a)for(r.dlShiftTo(l,f),i.subTo(f,i);i[o]<--a;)i.subTo(f,i);t!=null&&(i.drShiftTo(u,t),v!=p&&BigInteger.prototype.ZERO.subTo(t,t));i.t=u;i.clamp();s>0&&i.rShiftTo(s,i);v<0&&BigInteger.prototype.ZERO.subTo(i,i)}}}function bnMod(n){var t=nbi();return this.abs().divRemTo(n,null,t),this.s<0&&t.compareTo(BigInteger.prototype.ZERO)>0&&n.subTo(t,t),t}function Classic(n){this.m=n}function cConvert(n){return n.s<0||n.compareTo(this.m)>=0?n.mod(this.m):n}function cRevert(n){return n}function cReduce(n){n.divRemTo(this.m,null,n)}function cMulTo(n,t,i){n.multiplyTo(t,i);this.reduce(i)}function cSqrTo(n,t){n.squareTo(t);this.reduce(t)}function bnpInvDigit(){var t,n;return this.t<1?0:(t=this[0],(t&1)==0)?0:(n=t&3,n=n*(2-(t&15)*n)&15,n=n*(2-(t&255)*n)&255,n=n*(2-((t&65535)*n&65535))&65535,n=n*(2-t*n%this.DV)%this.DV,n>0?this.DV-n:-n)}function Montgomery(n){this.m=n;this.mp=n.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<n.DB-15)-1;this.mt2=2*n.t}function montConvert(n){var t=nbi();return n.abs().dlShiftTo(this.m.t,t),t.divRemTo(this.m,null,t),n.s<0&&t.compareTo(BigInteger.prototype.ZERO)>0&&this.m.subTo(t,t),t}function montRevert(n){var t=nbi();return n.copyTo(t),this.reduce(t),t}function montReduce(n){for(var i,t,r;n.t<=this.mt2;)n[n.t++]=0;for(i=0;i<this.m.t;++i)for(t=n[i]&32767,r=t*this.mpl+((t*this.mph+(n[i]>>15)*this.mpl&this.um)<<15)&n.DM,t=i+this.m.t,n[t]+=this.m.am(0,r,n,i,0,this.m.t);n[t]>=n.DV;)n[t]-=n.DV,n[++t]++;n.clamp();n.drShiftTo(this.m.t,n);n.compareTo(this.m)>=0&&n.subTo(this.m,n)}function montSqrTo(n,t){n.squareTo(t);this.reduce(t)}function montMulTo(n,t,i){n.multiplyTo(t,i);this.reduce(i)}function bnpIsEven(){return(this.t>0?this[0]&1:this.s)==0}function bnpExp(n,t){var e;if(n>4294967295||n<1)return BigInteger.prototype.ONE;var i=nbi(),r=nbi(),u=t.convert(this),f=nbits(n)-1;for(u.copyTo(i);--f>=0;)t.sqrTo(i,r),(n&1<<f)>0?t.mulTo(r,u,i):(e=i,i=r,r=e);return t.revert(i)}function bnModPowInt(n,t){var i;return i=n<256||t.isEven()?new Classic(t):new Montgomery(t),this.exp(n,i)}function Arcfour(){this.i=0;this.j=0;this.S=[]}function ARC4init(n){for(var i,r,t=0;t<256;++t)this.S[t]=t;for(i=0,t=0;t<256;++t)i=i+this.S[t]+n[t%n.length]&255,r=this.S[t],this.S[t]=this.S[i],this.S[i]=r;this.i=0;this.j=0}function ARC4next(){var n;return this.i=this.i+1&255,this.j=this.j+this.S[this.i]&255,n=this.S[this.i],this.S[this.i]=this.S[this.j],this.S[this.j]=n,this.S[n+this.S[this.i]&255]}function prng_newstate(){return new Arcfour}function rng_seed_int(n){rng_pool[rng_pptr++]^=n&255;rng_pool[rng_pptr++]^=n>>8&255;rng_pool[rng_pptr++]^=n>>16&255;rng_pool[rng_pptr++]^=n>>24&255;rng_pptr>=rng_psize&&(rng_pptr-=rng_psize)}function rng_seed_time(){rng_seed_int((new Date).getTime())}function rng_get_byte(){if(rng_state==null){for(rng_seed_time(),rng_state=prng_newstate(),rng_state.init(rng_pool),rng_pptr=0;rng_pptr<rng_pool.length;++rng_pptr)rng_pool[rng_pptr]=0;rng_pptr=0}return rng_state.next()}function rng_get_bytes(n){for(var t=0;t<n.length;++t)n[t]=rng_get_byte()}function SecureRandom(){}function parseBigInt(n,t){return new BigInteger(n,t,null)}function linebrk(n,t){for(var r="",i=0;i+t<n.length;)r+=n.substring(i,i+t)+"\n",i+=t;return r+n.substring(i,n.length)}function byte2Hex(n){return n<16?"0"+n.toString(16):n.toString(16)}function pkcs1pad2(n,t){var i,f,r,e,u;if(t<n.length+11)return null;for(i=[],f=n.length-1;f>=0&&t>0;)r=n.charCodeAt(f--),r<128?i[--t]=r:r>127&&r<2048?(i[--t]=r&63|128,i[--t]=r>>6|192):(i[--t]=r&63|128,i[--t]=r>>6&63|128,i[--t]=r>>12|224);for(i[--t]=0,e=new SecureRandom,u=[];t>2;){for(u[0]=0;u[0]==0;)e.nextBytes(u);i[--t]=u[0]}return i[--t]=2,i[--t]=0,new BigInteger(i,null,null)}function RSAKey(){this.n=null;this.e=0;this.d=null;this.p=null;this.q=null;this.dmp1=null;this.dmq1=null;this.coeff=null}function RSASetPublic(n,t){n!=null&&t!=null&&n.length>0&&t.length>0&&(this.n=parseBigInt(n,16),this.e=parseInt(t,16))}function RSADoPublic(n){return n.modPowInt(this.e,this.n)}function RSAEncrypt(n){var r=pkcs1pad2(n,this.n.bitLength()+7>>3),i,t;return r==null?null:(i=this.doPublic(r),i==null)?null:(t=i.toString(16),(t.length&1)==0?t:"0"+t)}function Transform(n,t){this.A=n;this.b=t}function Zoom(n,t,i){var r;this.mayBeDoubleTap=null;this.isAnimationRunning=!1;this.curTouch=0;this.elem=n;this.elemParent=n.parentNode;this.activeZoom=identity;this.resultantZoom=identity;this.srcCoords=[0,0];this.destCoords=[0,0];r=this;this.config=defaultConfig(t,{pan:!1,rotate:!0});this.wnd=i||window;n.style["transform-origin"]="0 0";var e=function(t){var i=n.offsetLeft,r=n.offsetTop;return[[t[0].pageX-i,t[0].pageY-r],[t[1].pageX-i,t[1].pageY-r]]},o=function(t){var u=n.offsetLeft,f=n.offsetTop,i=t[0].pageX-u,r=t[0].pageY-f;return[[i,r],[i+1,r+1]]},u=function(n){return n.length>1?e(n):o(n)},s=function(n){r.srcCoords=u(n);r.destCoords=r.srcCoords},h=function(n){r.destCoords=u(n)},f=function(n){return function(t){if(r.isAnimationRunning)return!1;var i=t.touches;if(!i)return!1;n(i);t.preventDefault()}};this._handleZoom=f(function(n){var t=n.length;t!==r.curTouch?(r.curTouch=t,r.finalize(),t!==0&&s(n)):(h(n),r.previewZoom())});this._handleTouchStart=f(function(n){n.length===1&&(r.mayBeDoubleTap!==null?(r.wnd.clearTimeout(r.mayBeDoubleTap),r.reset(),r.mayBeDoubleTap=null):r.mayBeDoubleTap=r.wnd.setTimeout(function(){r.mayBeDoubleTap=null},300))});this.elemParent.addEventListener("touchstart",this._handleTouchStart);this.elemParent.addEventListener("touchstart",this._handleZoom);this.elemParent.addEventListener("touchmove",this._handleZoom);this.elemParent.addEventListener("touchend",this._handleZoom)}var __extends=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),__spreadArrays=this&&this.__spreadArrays||function(){for(var i=0,n=0,r=arguments.length;n<r;n++)i+=arguments[n].length;for(var u=Array(i),f=0,n=0;n<r;n++)for(var e=arguments[n],t=0,o=e.length;t<o;t++,f++)u[f]=e[t];return u},cdeCommCore,cdeWEB,dbits,canary,j_lm,BI_FP,BI_RM,BI_RC,rr,vv,DV,rng_psize,rng_state,rng_pool,rng_pptr,t,cdeSpeech,cde,cdeSortAlphabet,cdeCommonUtils,cdeNMI;for(function(n){function tt(){if(!navigator)return!1;var n=navigator.userAgent;return n.indexOf("MSIE ")>-1||n.indexOf("Trident/")>-1}function e(n){for(var r,i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];return n.substr(0,1)==="["?JSON.parse(n.replace(/'/g,'"')):n.substr(0,2)==="(["||n.substr(0,2)==="({"?(r=n.substr(1,n.length-2),JSON.parse(r.replace(/'/g,'"'))):Function('"use strict";return ('+n+")").apply(void 0,i)}function it(t){if(!t||t.length===1)return"";var i="";return n.MyBaseAssets.MyServiceHostInfo.ResourcePath&&(i=n.MyBaseAssets.MyServiceHostInfo.ResourcePath,t.substr(0,1)!=="/"&&(i+="/")),n.MyBaseAssets.MyCommStatus.MyServiceUrl&&document.location.origin!==n.MyBaseAssets.MyCommStatus.MyServiceUrl&&(i=i.length>0?n.MyBaseAssets.MyCommStatus.MyServiceUrl+"/"+i:n.MyBaseAssets.MyCommStatus.MyServiceUrl),i.length>0&&i.substr(i.length-1,1)!=="/"&&!t.startsWith("/")&&!t.toLowerCase().startsWith("http")&&(i+="/"),i+t}function rt(n){var r=n.getMonth()+1,u=n.getDate(),f=n.getFullYear(),t=n.getHours(),e=n.getMinutes(),i="AM";return t>11&&(i="PM"),r+"/"+u+"/"+f+" "+t+":"+e+" "+i}function ut(n){return n===undefined||n===null||n===""}function ft(n){return n?n.toString():""}function et(n){if(isNaN(n)||!n)return 0;var t=0;try{t=parseInt(n)}catch(i){}return isNaN(t)?0:t}function ot(n){if(this.IsNotSet(n))return!1;if(typeof n=="boolean")return n;switch(n.toString().toLowerCase()){case"true":case"yes":case"1":case"on":return!0;default:return!1}}function st(n){if(isNaN(n)||!n)return 0;var t=0;try{t=parseFloat(n)}catch(i){}return isNaN(t)?0:t}function ht(n,t,i){for(var u=0,r=0;u<i&&r!==-1;)r=n.indexOf(t,r+t.length),u++;return r}function ct(n){if(!n)return"";for(var t=n.replace("{","").replace("}","");t.indexOf("-")>0;)t=t.replace("-","");return t.toUpperCase()}function lt(){for(var n,r,t,u=document.cookie.split("; "),i=0;i<u.length;i++)for(n=window.location.hostname.split(".");n.length>0;){for(r=encodeURIComponent(u[i].split(";")[0].split("=")[0])+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; domain="+n.join(".")+" ;path=",t=location.pathname.split("/"),document.cookie=r+"/";t.length>0;)document.cookie=r+t.join("/"),t.pop();n.shift()}}var t,o,i,s,h,c,l,a,v,y,p,w,r,b,k,d,u,f,g,nt;n.IsIE=tt;n.cdeEval=e;t=function(){function t(){this.MyEvents=[]}return t.prototype.HasEvent=function(n){return this.MyEvents&&this.MyEvents[n]?!0:!1},t.prototype.RegisterEvent=function(n,t){this.MyEvents[n]||(this.MyEvents[n]=[]);this.MyEvents[n].indexOf(t)<0&&this.MyEvents[n].push(t)},t.prototype.UnregisterEvent=function(n,t){if(this.MyEvents[n])if(t){for(var i=this.MyEvents[n].length-1;i>=0;i--)if(this.MyEvents[n][i]===t){this.MyEvents[n].splice(i,1);break}}else this.MyEvents[n]=[]},t.prototype.FireEvent=function(t,i){for(var u,o,s,r=[],f=2;f<arguments.length;f++)r[f-2]=arguments[f];if(this.MyEvents[i])for(u=0;u<this.MyEvents[i].length;u++)if(this.MyEvents[i][u])try{switch(i){default:if(typeof this.MyEvents[i][u]=="string"){var c=i,l=r.length>1?r[1]:null,a=r.length>2?r[2]:null;r.length<3;o=this.MyEvents[c][u];o.substr(0,3)==="JS:"?e(o.substr(3)):n.MyBaseAssets.FireEvent(t,"OnStringEvent",o,this,l,a,r)}else r.length>0&&r[0]instanceof n.TheProcessMessage?this.MyEvents[i][u](this,r[0]):(s=this.MyEvents[i])[u].apply(s,__spreadArrays([this],r))}}catch(h){i!=="CDE_NEW_LOGENTRY"&&n.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeCore:FireEvent","FireEvent:"+h+"<br>"+h.stack)}},t}();n.TheDataBase=t;o=function(n){function t(){var t=n.call(this)||this;return t.IsInitialized=!1,t.IsEngineScoped=!1,t.IsEngineReady=!1,t}return __extends(t,n),t}(t);n.TheEngineState=o;i=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(t);n.TheMetaDataBase=i;s=function(){function t(t){this.ENG=t;this.TIM=new Date;this.FID=n.MyBaseAssets.MyServiceHostInfo.MsgSendCounter++;this.PLB=null;this.QDX=5;this.LVL=4}return t.GetOriginator=function(n){if(!n.ORG)return"";var t=n.ORG.split(";");return t[0]},t}();n.TSM=s;h=function(){function n(){}return n}();n.TheDeviceMessage=h;c=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(n.TheDataBase);n.TheMeshPicker=c;l=function(){function n(){}return n}();n.TheISBConnect=l;a=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(i);n.cdeP=a;v=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(i);n.TheThing=v;y=function(){function n(){}return n}();n.TheSegment=y;p=function(){function n(n,t){this.Topic=n;this.Message=t}return n}();n.TheProcessMessage=p;w=function(){function n(){}return n}();n.TheNV=w;r=function(){function n(){this.HeartBeat=30;this.PickupRate=250;this.InitRate=100;this.HeartBeatMissed=4;this.PickupRateDelay=1;this.WsTimeOut=5e3}return n.prototype.EnterAdrenalin=function(){this.HeartBeat=5;this.HeartBeatMissed=30},n.prototype.NormalHeartRate=function(){this.HeartBeat=30;this.HeartBeatMissed=4},n.prototype.EnterSleepMode=function(){this.HeartBeat=100;this.HeartBeatMissed=3},n}();n.TheTimeouts=r;b=function(){function n(n){this.NoISB=!1;this.RequestPath=null;this.DisableRSA=!1;this.KeepSessionAlive=!1;this.port=80;this.host=null;this.Creds=null;this.useTLS=!1;this.cdeTIM=new Date;this.IsWSHBDisabled=!1;this.TO=new r;n>0&&(this.TO.WsTimeOut=n)}return n}();n.TheCommConfig=b;k=function(){function n(){this.QUID="";this.QPWD="";this.QToken=null}return n}();n.TheCDECredentials=k;d=function(){function n(n,t,i){this.ENG=n;this.JMSG=JSON.stringify(i);this.TOPIC=t}return n}();n.TheCoreQueueContent=d;u=function(){function t(){this.IsEmbedded=!1;this.ResourcePath="";this.WsTimeOut=0;this.DisableRSA=!1;this.UToken="";this.RequestGeoLocation=!1;this.EnablePinLogin=!1;this.DoAllowAnonymous=!1;this.LoginDisallowed=!1;this.DisableWebWorker=!1;this.IsUsingUserMapper=!1;this.AllowSetScopeWithSetAdmin=!1;this.WebPlatform=0;this.RedPill=!1;this.LastSID="";this.KnownRelays="";this.AutoConnectRelay=null;this.NMIVersion=4;this.WasPortalRequested=!1;this.PortalPage="";this.ShowClassic=!1;this.ScreenManagerClass=null;this.ShowLogInConsole=!1;this.ApplicationTitle="";this.MainConfigScreen="";this.TileSize=78;this.TileScale=1;this.InputSize=60;this.ScreenClassName="cdeBrowserTop";this.WasInitialScreenVisible=!1;this.IsLiteTheme=!1;this.DoesRequireConfiguration=!1;this.MyStationID="";this.HasInternetAccess=!1;this.IsAppHosted=!1;this.IsWebHosted=!1;this.MsgSendCounter=0;this.DebugLevel=0;this.MyWSServiceUrl=null;this.PortalReset=null;this.mPortalScreen=null;this.mStartScreen=null;this.mCurrentLCID=null;this.mHideHeader=null;this.mAdminPWMustBeSet=null;this.mAdminRole=null;this.mFirstNodeID=null}return Object.defineProperty(t.prototype,"PortalScreen",{get:function(){return n.MyBaseAssets.MyCommStatus.UserPref&&n.MyBaseAssets.MyCommStatus.UserPref.PortalScreen?n.MyBaseAssets.MyCommStatus.UserPref.PortalScreen:this.mPortalScreen},set:function(n){this.mPortalScreen=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"StartScreen",{get:function(){return n.MyBaseAssets.MyCommStatus.UserPref&&n.MyBaseAssets.MyCommStatus.UserPref.StartScreen?n.MyBaseAssets.MyCommStatus.UserPref.StartScreen:this.mStartScreen},set:function(n){this.mStartScreen=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"CurrentLCID",{get:function(){return n.MyBaseAssets.MyCommStatus.UserPref&&n.CInt(n.MyBaseAssets.MyCommStatus.UserPref.LCID)>0?n.MyBaseAssets.MyCommStatus.UserPref.LCID:this.mCurrentLCID},set:function(n){this.mCurrentLCID=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"HideHeader",{get:function(){return n.MyBaseAssets.MyCommStatus.UserPref&&n.CBool(n.MyBaseAssets.MyCommStatus.UserPref.HideHeader)===!0?n.CBool(n.MyBaseAssets.MyCommStatus.UserPref.HideHeader):this.mHideHeader},set:function(n){this.mHideHeader=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AdminPWMustBeSet",{get:function(){return n.CBool(n.MyBaseAssets.MyCommStatus.AdminPWMustBeSet)?!0:this.mAdminPWMustBeSet},set:function(n){this.mAdminPWMustBeSet=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"AdminRole",{get:function(){return n.MyBaseAssets.MyCommStatus.AdminRole?n.MyBaseAssets.MyCommStatus.AdminRole:this.mAdminRole},set:function(n){this.mAdminRole=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"FirstNodeID",{get:function(){return n.MyBaseAssets.MyCommStatus.FirstNodeID?n.MyBaseAssets.MyCommStatus.FirstNodeID:this.mFirstNodeID},set:function(n){this.mFirstNodeID=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsUserLoggedIn",{get:function(){return n.MyBaseAssets.MyCommStatus?n.MyBaseAssets.MyCommStatus.IsUserLoggedIn:!1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"CurrentUserName",{get:function(){return n.MyBaseAssets.MyCommStatus.UserPref&&n.MyBaseAssets.MyCommStatus.UserPref.CurrentUserName?n.MyBaseAssets.MyCommStatus.UserPref.CurrentUserName:""},enumerable:!1,configurable:!0}),t}();n.TheServiceHostInfo=u;f=function(){function n(){this.CurrentRSA=null;this.IsConnected=!1;this.CallerCount=0;this.InitialNPA=null;this.HasAutoLogin=!1;this.FirstNodeID=null;this.AdminPWMustBeSet=!1;this.AdminRole=null;this.LastPortalScreen=null;this.LastStartScreen=null;this.MyServiceUrl=null;this.UserPref=null}return Object.defineProperty(n.prototype,"IsUserLoggedIn",{get:function(){return this.UserPref?!0:!1},enumerable:!1,configurable:!0}),n}();n.TheWHSI=f;g=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.MyServiceHostInfo=new u,n.MyCommStatus=new f,n.MyEngines=[],n}return __extends(i,t),i.IsConnectionDown=function(){return(!n.MyCommChannel||!n.MyCommChannel.IsConnected).toString()},Object.defineProperty(i.prototype,"HasAutoLogin",{get:function(){return n.MyCommChannel&&n.MyCommChannel.HasAutoLogin===!0},enumerable:!1,configurable:!0}),i}(t);n.TheBaseAssets=g;nt=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.CurrentUserName=null,t.PortalScreen=null,t.StartScreen=null,t.HideHeader=!1,t}return __extends(t,n),t}(n.TheDataBase);n.TheUserPreferences=nt;n.FixupPath=it;n.DateToString=rt;n.IsNotSet=ut;n.CStr=ft;n.CInt=et;n.CBool=ot;n.CDbl=st;n.GetSubstringIndex=ht;n.GuidToString=ct;n.DeleteAllCookies=lt;n.MyBaseAssets=new n.TheBaseAssets;n.MyContentEngine=null;n.MyCommChannel=null;n.MyEventLogger=new i}(cde||(cde={})),function(n){function i(){var t=this;return n.IsHostRunning?!1:(n.IsHostRunning=!0,n.MyContentEngine=n.StartNewEngine(n.eTheContentService),n.MyContentEngine.RegisterEvent("IncomingMessage",function(t,i){var u=i.Message,r,e,f;if(u){r=u.TXT.split(":");switch(r[0]){case"CDE_FILE":r.length>2&&(u.PLB?n.MyContentEngine.SaveFile(u.PLB,r[1],r[2],!0):n.MyContentEngine.SaveFile(u.PLS,r[1],r[2],!1));break;case"CDE_ENGINEJS":if(u.PLS&&r.length>1&&(n.MyContentEngine.RegisterEvent("EngineReady",function(n){n===r[1]&&cdeNMI.MyTCF.FireLazyCreate(n)}),!n.MyBaseAssets.MyEngines[r[1]])){n.CreateScriptInRoot(r[1],u.PLS);n.StartNewEngine(r[1]);try{n.cdeEval(r[1]+".StartEngine()")}catch(o){n.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","StartEngineHost:HandleEvent","CDE_ENGINEJS:"+o+"<br>"+o.stack)}}break;case"CDE_CUSTOM_HTML":u.PLS&&r.length>1&&(e=document.getElementById("content"),e&&(e.innerHTML=u.PLS));break;case"CDE_CUSTOM_CSS":u.PLS&&(f=u.PLS.split(";"),n.AddCSSToHeader(f[0],f.length>1?f[1]:null))}}}),n.MyCommChannel&&(n.MyCommChannel.RegisterEvent("CDE_INCOMING_MSG",function(i,r){if(r&&r.Message&&r.Message.ENG!=="")if(n.MyBaseAssets.MyEngines[r.Message.ENG]){n.MyBaseAssets.MyEngines[r.Message.ENG].EngineState.IsInitialized&&n.MyBaseAssets.MyEngines[r.Message.ENG].EngineState.IsEngineScoped===(r.Message.SID!=="")||(n.MyBaseAssets.MyEngines[r.Message.ENG].EngineState.IsInitialized=!0,n.MyBaseAssets.MyEngines[r.Message.ENG].EngineState.IsEngineScoped=r.Message.SID!=="",n.MyBaseAssets.MyEngines[r.Message.ENG].FireEngineIsReady());try{n.MyBaseAssets.MyEngines[r.Message.ENG].FireEvent(!0,"IncomingMessage",r)}catch(u){n.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","error during process Message:"+u,"cdeEngines:StartEngineHost/eTheContentService")}t.HBCounter=0}else n.MyBaseAssets.MyServiceHostInfo.DebugLevel>0&&n.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","Engine Not found:"+r.Message.ENG+"("+r.Message.TXT+")","cdeEngines:StartEngineHost/eTheContentService"),n.MyCommChannel.SendQueued("",n.eTheContentService,n.eTheContentService,"CDE_GET_ENGINEJS",r.Message.ENG,8,5,3,"")}),n.MyCommChannel.RegisterEvent("CDE_REINIT_ENGINES",function(){for(var t in n.MyBaseAssets.MyEngines)n.MyBaseAssets.MyEngines.hasOwnProperty(t)&&n.MyBaseAssets.MyEngines[t].SendInitialize()}),n.MyCommChannel.RegisterEvent("CDE_HB_INJECT",function(){for(var t in n.MyBaseAssets.MyEngines)n.MyBaseAssets.MyEngines.hasOwnProperty(t)&&n.MyBaseAssets.MyEngines[t].FireEvent(!1,"CDE_HB_INJECT")}),n.MyCommChannel.RegisterEvent("CDE_ENGINE_GONE",function(t,i){n.MyBaseAssets.MyEngines.hasOwnProperty(i)&&(n.MyBaseAssets.MyEngines[i].EngineState.IsInitialized=!1,n.MyBaseAssets.MyEngines[i].FireEngineIsReady(!1))})),!0)}function r(t){return t?(n.MyBaseAssets.MyEngines[t]=new n.TheBaseEngine,n.MyBaseAssets.MyEngines[t].EngineState.ClassName=t,n.MyBaseAssets.MyEngines[t].EngineState.IsInitialized=!1,n.MyBaseAssets.MyEngines[t].EngineState.IsEngineScoped=!1,n.MyBaseAssets.MyEngines[t].SendInitialize(),n.MyBaseAssets.MyEngines[t]):null}function u(t,i){var o=n.FixupPath(t),f,e,r,u;if(n.MyBaseAssets.MyServiceHostInfo.IsLiteTheme&&i&&(o=n.FixupPath(i)),f=document.getElementsByTagName("link"),f.length>0)for(e=0;e<f.length;e++)if(f[e].getAttribute("href").toLowerCase()===o.toLowerCase())return;r=document.createElement("link");r.setAttribute("rel","stylesheet");r.setAttribute("type","text/css");r.setAttribute("cde","colorScheme");r.setAttribute("media","screen");r.setAttribute("dark",n.FixupPath(t));i&&r.setAttribute("lite",n.FixupPath(i));r.setAttribute("cde","colorScheme");u=n.MyBaseAssets.MyCommStatus.InitialNPA;r.setAttribute("href",o+(u?"?SID="+u.substr(4,u.length-(4+(u.indexOf(".ashx")>0?5:0))):""));document.getElementsByTagName("head")[0].appendChild(r)}function f(t,i){var e=document.getElementsByTagName("head")[0],u,o,f,r;if(e){if(n.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","CreateScriptInRoot","Creating "+t+" in doc header"),u=e.getElementsByTagName("script"),o=!0,u.length>0)for(f=0;f<u.length;f++)if(u[f].id===t){o=!1;break}o&&(r=document.createElement("script"),r.type="text/javascript",r.text=i,r.id=t,e.appendChild(r))}}n.eTheContentService="ContentService";n.IsHostRunning=!1;var t=function(t){function i(){var i=t.call(this)||this;return i.eventOverideHeartBeat=null,i.EngineState=new n.TheEngineState,i}return __extends(i,t),i.prototype.GetEngineName=function(){return this.EngineState.ClassName},i.prototype.SendInitialize=function(){if(n.MyCommChannel){var t=new n.TSM(this.EngineState.ClassName);t.TXT="CDE_INITIALIZE";t.PLS=this.EngineState.ClassName;t.LVL=3;n.MyCommChannel.SendToFirstNode(t)}},i.prototype.SendSubscribe=function(){n.MyCommChannel&&n.MyCommChannel.Subscribe(this.EngineState.ClassName)},i.prototype.RegisterIncomingMessage=function(t){n.MyCommChannel&&n.MyCommChannel.RegisterEvent("CDE_INCOMING_MSG",function(n,i){t(i)})},i.prototype.FireEngineIsReady=function(n){this.EngineState.IsEngineReady=n;this.FireEvent(!0,"EngineReady",n)},i.prototype.HandleMessage=function(t,i){this.FireEvent(!0,"IncomingMessage",new n.TheProcessMessage(t,i))},i.prototype.PublishToNode=function(t,i,r,u){n.MyCommChannel&&(r===undefined&&(r=""),n.MyCommChannel.SendQueued("","CDE_SYSTEMWIDE",this.GetEngineName(),i,r,0,5,3,t,u))},i.prototype.PublishToFirstNode=function(t,i){if(n.MyCommChannel){i===undefined&&(i="");var r=new n.TSM(this.GetEngineName());r.TXT=t;r.PLS=i;n.MyCommChannel.SendToFirstNode(r)}},i.prototype.PublishCentral=function(t,i){n.MyCommChannel&&(i===undefined&&(i=""),n.MyCommChannel.SendQueued("",this.GetEngineName(),this.GetEngineName(),t,i,0,5,3,""))},i.prototype.PublishToService=function(t,i){n.MyCommChannel&&(i===undefined&&(i=""),n.MyCommChannel.SendQueued("",this.GetEngineName(),this.GetEngineName(),t,i,8,5,3,""))},i.prototype.PublishToOwner=function(t,i,r,u,f,e){n.MyCommChannel&&(r===undefined&&(r=""),n.MyCommChannel.SendQueued(t,this.GetEngineName(),this.GetEngineName(),i,r,8,5,3,u,f,e))},i.prototype.PublishToOriginator=function(t,i,r,u){n.MyCommChannel&&(r===undefined&&(r=""),n.MyCommChannel.SendQueued(t.OWN,this.GetEngineName(),this.GetEngineName(),i,r,0,t.QDX,t.LVL,n.TSM.GetOriginator(t),t.ORG,u))},i.prototype.RSAEncrypt=function(t,i){return n.MyCommChannel?n.MyCommChannel.RSAEncrypt(t,i):t},i.prototype.SaveFile=function(t,i,r,u){var e,o,s,f,h,c;if(u)for(o=atob(t),e=new ArrayBuffer(o.length),s=new Uint8Array(e),f=0;f<o.length;f++)s[f]=o.charCodeAt(f);else e=t;h=new Blob([e],{type:r});c=new n.cdeFileSaver;c.SaveAs(h,i)},i}(n.TheThing);n.TheBaseEngine=t;n.StartEngineHost=i;n.StartNewEngine=r;n.AddCSSToHeader=u;n.CreateScriptInRoot=f}(cde||(cde={})),function(n){function t(n){return cde.StartNewEngine(n)}function i(n,t,i,r,u,f){cde.MyCommChannel&&(u===undefined&&(u=""),cde.MyCommChannel.SendQueued("","CDE_SYSTEMWIDE",t,r,u,0,5,3,n,i,f))}function r(n,t,i,r){cde.MyCommChannel&&(r===undefined&&(r=""),cde.MyCommChannel.SendQueued("","CDE_SYSTEMWIDE",t,i,r,0,5,3,n))}function u(t){n.PublishToFirstNode("ContentService","CDE_SUBSCRIBE",t)}function f(n,t,i,r,u,f,e,o,s,h,c){cde.MyCommChannel&&(u===undefined&&(u=""),cde.MyCommChannel.SendQueued(n,t,i,r,u,f,e,o,s,h,c))}function e(n,t,i){if(cde.MyCommChannel){i===undefined&&(i="");var r=new cde.TSM(n);r.TXT=t;r.PLS=i;cde.MyCommChannel.SendToFirstNode(r)}}function o(n){cde.MyCommChannel&&cde.MyCommChannel.SendToFirstNode(n)}function s(n,t,i,r,u,f,e){cde.MyCommChannel&&(r===undefined&&(r=""),cde.MyCommChannel.SendQueued(n,t,t,i,r,8,5,3,u,f,e))}function h(n,t,i){cde.MyCommChannel&&(i===undefined&&(i=""),cde.MyCommChannel.SendQueued("",n,n,t,i,8,5,3,""))}function c(n){cde.MyCommChannel&&cde.MyCommChannel.SendTSM(n)}function l(n,t,i){cde.MyCommChannel&&(i===undefined&&(i=""),cde.MyCommChannel.SendQueued("",n,n,t,i,0,5,3,""))}function a(n){cde.MyCommChannel&&cde.MyCommChannel.SendQueued(n.OWN,n.ENG,n.ENG,n.TXT,n.PLS,n.FLG,n.QDX,n.LVL,"")}function v(){return(!cde.MyCommChannel||!cde.MyCommChannel.IsReady).toString()}function y(n,t,i){cde.MyBaseAssets.MyServiceHostInfo.IsAppHosted=!0;cdeNMI.MyEngine&&cdeNMI.MyEngine.Login(null,n,t,i)}function p(){cdeNMI.CleanState()}n.StartNewEngine=t;n.PublishToOriginator=i;n.PublishToNode=r;n.RegisterTopic=u;n.GetNextMessage=f;n.PublishToFirstNode=e;n.PublishTSMToFirstNode=o;n.PublishToOwner=s;n.PublishToService=h;n.PublishTSMToService=c;n.PublishCentral=l;n.PublishTSMCentral=a;n.IsNotReadyForLogin=v;n.DoAppLogin=y;n.CleanState=p}(cdeCommCore||(cdeCommCore={})),function(n){var t=function(n){function t(){var t=n.call(this)||this;return t.MyConfig=null,t.DCreds=null,t.MyStationID="",t.IsPosting=!1,t.IsRetrying=!1,t.MyWebSockets=null,t.MyServiceUrl="",t.UsesWebSockets=!1,t.mLoginSent=!1,t.HasStarted=!1,t.HealthCounter=0,t.HBCounter=0,t.DeadCounter=0,t.MyCoreQueue=[],t.Pre4209SID=null,t.IsWSConnected=!1,t.IsConnectionDown=!1,t.TriesTokenLogin=!1,t.ForceDisconnect=!1,t}return __extends(t,n),Object.defineProperty(t.prototype,"MyHSI",{get:function(){return cde.MyBaseAssets.MyCommStatus},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsConnected",{get:function(){return this.ForceDisconnect===!0?!1:this.MyHSI.IsConnected},set:function(n){this.MyHSI.IsConnected!==n&&(this.MyHSI.IsConnected=n,this.UpdateHSI(),this.FireEvent(!0,"CDE_CONN_CHANGED",n))},enumerable:!1,configurable:!0}),t.prototype.UpdateHSI=function(){this.MyHSI.HasAutoLogin=this.HasAutoLogin;this.WriteToIDB()},t.prototype.UpdateCallerHSI=function(n){this.UpdateHSI();cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","UpdateHSI",n,1)},Object.defineProperty(t.prototype,"IsReady",{get:function(){return this.MyHSI.CurrentRSA!==null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"HasAutoLogin",{get:function(){return this.MyConfig&&this.MyConfig.Creds!==null},enumerable:!1,configurable:!0}),t.prototype.SetTargetRelay=function(n){var i,r,t,u;try{return i=n.split(";:;"),r=null,cde.IsIE()?(r=document.createElement("a"),r.href=i[0]):r=new URL(i[0]),t=this.MyConfig,t===null&&(t=new cde.TheCommConfig(0)),t.host=r.hostname,t.cdeTIM=new Date,t.port=cde.CInt(r.port),r.protocol.indexOf("s:",r.protocol.length-2)!==-1?(t.useTLS=!0,t.port===0&&(t.port=443)):t.port===0&&(t.port=80),i.length>1&&(t.Creds=new cde.TheCDECredentials,t.Creds.QUID=i[1],i.length>2&&(t.Creds.QPWD=i[2])),this.SetConfig(t),!0}catch(f){u=i[0]+" is not a valid Url";cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:SetTargetRelay",u,2);this.FireEvent(!0,"CDE_SETSTATUSMSG",u,2)}return!1},t.prototype.SetConfig=function(n){(this.MyConfig=n,this.MyConfig)&&(this.MyConfig.RequestPath&&!this.MyHSI.InitialNPA&&(this.MyHSI.InitialNPA=this.MyConfig.RequestPath),this.MyConfig.cdeTIM||(this.MyConfig.cdeTIM=new Date),this.MyConfig.TO||(this.MyConfig.TO=new cde.TheTimeouts),!this.MyConfig.host&&this.MyConfig.uri&&this.SetTargetRelay(this.MyConfig.uri))},t.prototype.StartCommunication=function(n){var t=this,i;if(this.IsConnected||this.HasStarted){this.IsConnected&&this.HasStarted&&this.FireEvent(!0,"CDE_CONN_CHANGED",!0);return}if(this.IsConnectionDown=!1,this.MyDB)this.StartCommPhase2(n);else{if(!("indexedDB"in window)){this.StartCommPhase2(n);return}i=indexedDB.open("cdeDB",1);i.onupgradeneeded=function(i){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:message","In Upgrade Needed",1);t.MyDB=i.target.result;t.MyDB.objectStoreNames.contains("CDEJS")||t.MyDB.createObjectStore("CDEJS",{keyPath:"id"});t.StartCommPhase2(n)};i.onsuccess=function(i){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:message","Open Success",1);t.MyDB=i.target.result;var u=t.MyDB.transaction(["CDEJS"]),f=u.objectStore("CDEJS"),r=f.get(1);r.onerror=function(){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:message","Read of Idx1 failed",3);t.StartCommPhase2(n)};r.onsuccess=function(){if(cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:message","Read Success",1),r.result){var i=r.result.config;i.Creds&&i.Creds.QToken&&i.Creds.QToken!==""?(n&&n.RequestPath&&(i.RequestPath=n.RequestPath,t.MyHSI.InitialNPA||(t.MyHSI.InitialNPA=n.RequestPath)),n=i,t.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:message","State Restored",1)):(t.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:message","State ignored",1),t.DeleteFromIDB());cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:message","Starting CommPhase2...",1);t.StartCommPhase2(n)}else cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:message","No data record",2),t.StartCommPhase2(n)}};i.onerror=function(i){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:error","Error:"+i,3);t.StartCommPhase2(n)}}},t.prototype.StartCommPhase2=function(n){var t=this,i,r;n&&this.SetConfig(n);this.MyConfig&&cde.CBool(this.MyConfig.NoISB)===!1&&(this.HasStarted=!0,i="http",this.MyConfig.useTLS===!0&&(i+="s"),this.MyHSI.MyServiceUrl=i+"://"+this.MyConfig.host+":"+this.MyConfig.port,r=this.MyHSI.MyServiceUrl+"/MYISBCONNECT",this.GetJSON(r,function(n){var i;n.ERR?(cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:StartCommunication","MyISBConnect returned: "+n.ERR,3),t.FireEvent(!0,"CDE_NO_CONNECT","ISBConnect returned "+n.ERR+". Verify ISBConnect is allow on relay")):(n.WSP>0&&(i="ws",n.TLS===!0&&(i+="s"),t.MyConfig.wsuri=i+"://"+t.MyConfig.host+":"+n.WSP),i="http",n.TLS===!0&&(i+="s"),t.MyServiceUrl=i+"://"+t.MyConfig.host+":"+t.MyConfig.port,t.MyConfig.RequestPath=n.NPA,t.MyHSI.InitialNPA=n.NPA,t.MyHSI.FirstNodeID=n.FNI,n.ADR&&(t.MyHSI.AdminPWMustBeSet=!0,t.MyHSI.AdminRole=n.ADR),cde.MyBaseAssets.MyServiceHostInfo.NMIVersion=cde.CDbl(n.VER)>4?cde.CDbl(n.VER):4,t.DoStartComm())},function(n){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:StartCommunication","MyISBConnect failed! :"+n,3);t.FireEvent(!0,"CDE_NO_CONNECT","ISBConnect failed. Verify ISBConnect is allow on relay")}));this.HasStarted||(this.HasStarted=!0,this.DoStartComm())},t.prototype.DoStartComm=function(){var n=this,t=!1;this.MyConfig.TO||(this.MyConfig.TO=new cde.TheTimeouts);this.StartupWS();this.MyHeartBeatMonitor=setInterval(function(){if(!t&&!n.IsConnectionDown){if(t=!0,n.HealthCounter++,(!n.UsesWebSockets||!n.MyConfig.IsWSHBDisabled)&&n.HealthCounter%n.MyConfig.TO.HeartBeat==0&&(n.MyCoreQueue.length===0&&n.PickupNextMessage(),!n.UsesWebSockets))if(n.IsConnected)n.HBCounter++>n.MyConfig.TO.HeartBeatMissed&&(n.IsConnected=!1,n.IsPosting=!1,n.HBCounter=0);else if(n.DeadCounter++>n.MyConfig.TO.HeartBeatMissed*3){var i=cde.DateToString(new Date)+": Connection Lost because Service is down or unreachable. Click ok to reload this page";cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNode:StartCommunication",i,3);n.EndSession(i)}(n.UsesWebSockets||n.HealthCounter%n.MyConfig.TO.PickupRateDelay==0||n.MyCoreQueue.length>0)&&n.SendNextMessage(null);t=!1}},this.MyConfig.TO.PickupRate);this.FireEvent(!0,"CDE_COMM_STARTED")},t.prototype.GetConnectionType=function(){var n="(REST)";return this.UsesWebSockets&&(n="(WS)"),n},t.prototype.PickupNextMessage=function(){var n=new cde.TheDeviceMessage;n.TOP="";n.MSG=null;this.MyCoreQueue.push(n)},t.prototype.SendQueued=function(n,t,i,r,u,f,e,o,s,h,c){var l,a;i&&(this.MyCoreQueue.length>0&&(t==="CDE_PICKUP"||!t)||(l=new cde.TSM(i),s&&s!==""?(t="CDE_SYSTEMWIDE",this.Pre4209SID&&this.Pre4209SID!==""&&(t+="@"+this.Pre4209SID),t+=";"+s):t!==""&&this.Pre4209SID&&this.Pre4209SID!==""&&(t+="@"+this.Pre4209SID),l.SID=this.Pre4209SID,l.OWN=n,l.FLG=f,l.LVL=o,l.TXT=r,h&&(l.GRO=h),l.PLS=(f&4096)!=0?this.RSAEncrypt(u):u,l.QDX=e,l.ORG=cde.MyBaseAssets.MyServiceHostInfo.MyStationID+(c?":"+c:""),a=new cde.TheDeviceMessage,a.TOP=t,a.MSG=l,this.MyCoreQueue.push(a)))},t.prototype.SendTSM=function(n,t,i,r){if(!(this.MyCoreQueue.length>0)||t!=="CDE_PICKUP"){i&&i!==""?(t="CDE_SYSTEMWIDE",this.Pre4209SID&&this.Pre4209SID!==""&&(t+="@"+this.Pre4209SID),t+=";"+i):t!==""&&this.Pre4209SID&&this.Pre4209SID!==""&&(t+="@"+this.Pre4209SID);n.SID=this.Pre4209SID;(n.FLG&4096)!=0&&(n.PLS=this.RSAEncrypt(n.PLS));n.ORG=cde.MyBaseAssets.MyServiceHostInfo.MyStationID+(r?":"+r:"");var u=new cde.TheDeviceMessage;u.TOP=t?t:n.ENG;u.MSG=n;this.MyCoreQueue.push(u)}},t.prototype.Subscribe=function(n){var t=new cde.TSM("ContentService");t.TXT="CDE_SUBSCRIBE";t.PLS=n;this.Pre4209SID&&this.Pre4209SID!==""&&(t.PLS+="@"+this.Pre4209SID);this.SendToFirstNode(t)},t.prototype.Unsubscribe=function(n){var t=new cde.TSM("ContentService");t.TXT="CDE_UNSUBSCRIBE";t.PLS=n;this.Pre4209SID&&this.Pre4209SID!==""&&(t.PLS+="@"+this.Pre4209SID);this.SendToFirstNode(t)},t.prototype.SendToNode=function(n,t,i){this.SendTSM(t,null,n);i&&this.FireEvent(!0,"CDE_INCOMING_MSG",new cde.TheProcessMessage(t.ENG,t))},t.prototype.SendToOriginator=function(n,t,i){n&&(this.SendTSM(t,null,n.ORG),i&&this.FireEvent(!0,"CDE_INCOMING_MSG",new cde.TheProcessMessage(t.ENG,t)))},t.prototype.SendToFirstNode=function(n){this.SendTSM(n,null,this.MyHSI.FirstNodeID)},t.prototype.Logout=function(){this.EndSession("logout")},t.prototype.EndSession=function(n){cde.CBool(this.IsConnectionDown)||(clearInterval(this.MyHeartBeatMonitor),this.HasStarted=!1,this.IsConnectionDown=!0,this.IsConnected=!1,this.IsRetrying=!1,this.DeleteFromIDB(),this.FireEvent(!0,"CDE_SESSION_ENDED",n))},t.prototype.PostError=function(n,t,i){if(this.IsPosting=!1,this.IsRetrying||t!=="timeout"){n.ENG!==""&&this.FireEvent(!0,"CDE_ENGINE_GONE",n.ENG);var r=cde.DateToString(new Date)+" Communication was lost.You will need to login again";this.FireEvent(!0,"CDE_SETSTATUSMSG",r,3);cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","PostError",r);this.EndSession(r)}else this.IsRetrying=!0,this.SendNextMessage(n,i)},t.prototype.SendNextMessage=function(n,t){var r=this,u,i,f;if((n||!this.IsPosting&&this.MyCoreQueue.length!==0)&&(this.UsesWebSockets||this.MyConfig.RequestPath&&this.MyConfig.RequestPath!==""||t)&&(!this.UsesWebSockets||this.IsWSConnected!==!1)){u=function(){var f,e,o,s,u;if(i.IsPosting=!0,f=void 0,n)f=n.RQP;else{e=0;o=[];do o[e]=i.MyCoreQueue.shift(),e++;while(i.MyCoreQueue.length>0&&e<10);n=new cde.TheCoreQueueContent("","",o);s=t?t:i.MyConfig.RequestPath;f=i.MyServiceUrl+encodeURI(s);i.UsesWebSockets===!1&&f.substr(f.length-5,5)===".ashx"&&(f=f.substr(0,f.length-5));n.TOPIC!==""&&(f+="?"+encodeURI(n.TOPIC));n.RQP=f;t=i.MyConfig.RequestPath;i.MyConfig.RequestPath=""}if(i.WriteToIDB(),i.UsesWebSockets)i.MyWebSockets.send(n.JMSG),i.IsPosting=!1,n=null;else return window.fetch?fetch(f,{method:"post",body:n.JMSG,mode:"cors",cache:"no-cache",redirect:"follow",referrer:"no-referrer",headers:{"Content-Type":"application/json; charset=utf-8"}}).then(function(n){n.json().then(function(n){var i=n,u,t;if(r.IsPosting=!1,u=!1,i.length>0)for(t=0;t<i.length;t++)i[t].CNT>0&&(u=!0),r.IsPosting=!r.ProcessDeviceMessage(i[t],!1);u&&r.SendNextMessage(null)})}).catch(function(i){r.PostError(n,i,t)}):(u=new XMLHttpRequest,u.open("POST",f),u.setRequestHeader("Content-Type","application/json"),u.onload=function(){var i,e,f,o;if(u.status===200)try{if(i=JSON.parse(u.responseText),r.IsPosting=!1,e=!1,i.length>0)for(f=0;f<i.length;f++)i[f].CNT>0&&(e=!0),r.IsPosting=!r.ProcessDeviceMessage(i[f],!1);e&&r.SendNextMessage(null)}catch(s){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:SendNextMessage","Message Parse Error:"+s);r.PostError(n,"parse failed",t)}else u.status!==200&&(o="Message returned: "+u.status+" msg:"+u.statusText,cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:SendNextMessage",o),r.PostError(n,o,t))},u.onerror=function(){var n="Message returned: "+u.status+" msg:"+u.statusText;cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:xhrError",n);r.EndSession(n)},u.send(n.JMSG)),"break"};i=this;do if(f=u(),f==="break")break;while(this.MyCoreQueue.length>0)}},t.prototype.StartupWS=function(){var n=this,t;if(!this.MyConfig.wsuri)return!1;t=this.MyConfig.wsuri;t.indexOf(".ashx")<0&&(t+=encodeURI(this.MyConfig.RequestPath));try{this.MyWebSockets=new WebSocket(t);this.MyConfig.TO.WsTimeOut>0&&setInterval(function(){!n.IsWSConnected&&n.UsesWebSockets&&(n.UsesWebSockets=!1)},this.MyConfig.TO.WsTimeOut)}catch(i){return this.MyWebSockets=null,!1}return this.MyWebSockets?(this.UsesWebSockets=!0,this.MyWebSockets.onopen=function(){n.FireEvent(!0,"CDE_SETSTATUSMSG","Connecting to WS...",2);n.MyWebSockets.send('[{"MET":0,"TOP":"CDE_INITWS","CNT":0}]')},this.MyWebSockets.onmessage=function(t){var u,i,r,f;if(n.UsesWebSockets){n.IsWSConnected=!0;try{if(t.data.substring(0,1)!=="[")cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:OnMessage","Strange Response from WServer:"+t.data);else if(u=!1,t.data.length>5e5&&(cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:OnMessage","Very large Telegram received:"+t.data.length),u=!0),i=JSON.parse(t.data),i&&i.length>0)for(r=0;r<i.length;r++){if(i[r].MSG||i[r].TOP===""){if(f=i[r].TOP.split(";:;"),f[0]==="CDE_CONNECT"&&n.MyConfig&&n.MyConfig.Creds){n.MyHSI.CurrentRSA=i[r].RSA;n.Login(n.MyConfig.Creds);continue}}else{cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","StartUpWS:onMessage",i[r].TOP);return}u&&cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:OnMessage","ORG:"+cde.TSM.GetOriginator(i[r].MSG)+"TXT: "+i[r].MSG.TXT);n.ProcessDeviceMessage(i[r],!0)}}catch(e){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:StartWS","Error during OnMessage:"+e)}}},this.MyWebSockets.onclose=function(){var t;n.UsesWebSockets&&(n.UsesWebSockets=!1,n.IsWSConnected?(t=cde.DateToString(new Date)+(n.mLoginSent?" Relay refused login and closed connection":" WS Communication was closed. You will need to login again"),n.FireEvent(!0,"CDE_SETSTATUSMSG",t,3),cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","StartUpWS:onclose",t),n.EndSession(t)):(t=cde.DateToString(new Date)+(n.mLoginSent?" a connection could not be established":" WS Communication was closed. You will need to login again"),n.FireEvent(!0,"CDE_SETSTATUSMSG",t,3),cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","StartUpWS:onclose",t),n.EndSession(t)))},this.MyWebSockets.onerror=function(t){if(cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeWebComm:onError","Error during OnMessage:"+t),n.UsesWebSockets&&(n.UsesWebSockets=!1,n.IsWSConnected)){var i=cde.DateToString(new Date)+" WS Communication was interrupted. You will need to login again";n.FireEvent(!0,"CDE_SETSTATUSMSG",i,3);cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","StartUpWS:onerror",i);n.EndSession(i)}},!0):!1},t.prototype.ProcessDeviceMessage=function(n,t){var u,f,e,r,i,s,o,h,c;if(n.MSG&&this.FireEvent(!0,"CDE_INCOMING_MSG",new cde.TheProcessMessage(n.TOP.split(":,:")[0],n.MSG)),t||n.NPA){if(u=!1,this.MyConfig.RequestPath=n.NPA,this.MyHSI.InitialNPA||(this.MyHSI.InitialNPA=n.NPA),n.RSA&&n.RSA!==""&&!this.MyHSI.CurrentRSA&&(this.MyHSI.CurrentRSA=n.RSA,!this.MyHSI.FirstNodeID&&n.MSG&&(this.MyHSI.FirstNodeID=cde.TSM.GetOriginator(n.MSG),u=!0),this.DCreds&&(this.Login(this.DCreds),this.DCreds=null)),this.DeadCounter=0,n.DID&&n.DID!==""&&this.MyStationID!==n.DID&&(this.MyStationID=n.DID,u=!0),f=this.IsConnected,e=!1,n.TOP==="ERR:CDE_LOGIN_FAILURE")this.MyHSI.UserPref=null,this.mLoginSent=!1,this.MyConfig.Creds=null,this.FireEvent(!0,"CDE_LOGIN_EVENT",!1,"Relay rejected credentials",null),e=!0,u=!0,this.EndSession("Relay rejected credentials - Login failed");else if(n.TOP==="ERR:CDE_MESHSELECT_FAILURE")this.MyHSI.UserPref=null,this.mLoginSent=!1,this.MyConfig.Creds=null,this.FireEvent(!0,"CDE_LOGIN_EVENT",!1,"Mesh Picker failed",null),e=!0,u=!0,this.EndSession("Mesh Selection failed, please reload this page");else if(n.TOP.length>12&&(r=n.TOP.split(":"),!this.MyHSI.IsUserLoggedIn))if(r[0]==="LOGIN_SUCCESS"){if(this.MyHSI.UserPref=new cde.TheUserPreferences,i=null,r.length>1&&(i=r[1].split(";"),i.length>1&&(this.MyHSI.LastPortalScreen=i[1],i.length>2&&(this.MyHSI.UserPref.HideHeader=cde.CBool(i[2]))),cde.IsNotSet(i[0])||(this.MyHSI.LastStartScreen=i[0]),r.length>2&&(this.MyHSI.UserPref.CurrentUserName=r[2],r.length>3)))try{s=cde.GetSubstringIndex(n.TOP,":",3);o=n.TOP.substr(s+1);o.length>2&&o.substr(0,1)==="{"?this.MyHSI.UserPref=JSON.parse(o):this.MyHSI.UserPref.LCID=cde.CInt(o)}catch(l){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","Login:Illegal User Preferences received")}this.MyConfig.LPS&&(this.MyHSI.LastPortalScreen=this.MyConfig.LPS);this.MyConfig.LSSC&&(this.MyHSI.LastStartScreen=this.MyConfig.LSSC);this.MyHSI.UserPref.ScreenParts=i;this.Pre4209SID=n.SID;n.SID&&n.SID.substr(0,2)==="UT"&&(this.Pre4209SID=null,this.MyConfig.Creds=new cde.TheCDECredentials,this.MyConfig.Creds.QToken=n.SID);this.FireEvent(!0,"CDE_LOGIN_EVENT",!0,"Login Successful!",this.MyHSI.UserPref);e=!0;u=!0;this.mLoginSent=!1}else r[0]==="SELECT_MESH"&&(h=n.TOP.substr(12),c=JSON.parse(h),this.FireEvent(!0,"CDE_SELECT_MESH",c));if(!t&&n.CNT>0&&this.MyCoreQueue.length===0&&this.PickupNextMessage(),f=!0,f!==this.IsConnected?(f&&!e&&this.FireEvent(!0,"CDE_SETSTATUSMSG","Connected to "+this.MyHSI.MyServiceUrl+" using "+(this.UsesWebSockets?"WS":"REST"),1),this.IsConnected=f):u===!0&&this.UpdateCallerHSI("ProcessMsgDirty"),!this.UsesWebSockets)return!0}return!1},t.prototype.Login=function(n){var t;this.mLoginSent!==!0&&n&&(this.MyConfig||(this.MyConfig=new cde.TheCommConfig(0)),this.MyHSI.CurrentRSA||this.MyConfig.DisableRSA?(this.DCreds&&(this.DCreds.QUID&&this.DCreds.QPWD||this.DCreds.QToken)&&(n.QToken=this.DCreds.QToken,n.QUID=this.DCreds.QUID,n.QPWD=this.DCreds.QPWD),this.DCreds=null,this.FireEvent(!0,"CDE_SETSTATUSMSG","Sending credentials to Relay...",1),n.QToken&&n.QToken!==""?(this.TriesTokenLogin=!0,this.SendQueued(null,"CDE_TLOGIN"+n.QToken,"ContentService",null,null,1,1,1,null,null)):n.QUID&&n.QUID!==""?(t=this.RSAEncrypt(n.QUID+":;:"+n.QPWD,this.MyHSI.CurrentRSA),this.SendQueued(null,"CDE_LOGIN"+t,"ContentService",null,null,1,1,1,null,null)):(t=this.RSAEncrypt(n.QPWD,this.MyHSI.CurrentRSA),this.SendQueued(null,"CDE_SETESID"+t,"ContentService",null,null,1,1,1,null,null)),this.mLoginSent=!0,this.MyConfig.Creds=new cde.TheCDECredentials):(this.DCreds=new cde.TheCDECredentials,this.DCreds.QUID=n.QUID,this.DCreds.QPWD=n.QPWD,this.DCreds.QToken=n.QToken,this.FireEvent(!0,"CDE_SETSTATUSMSG","RSA not initialized, yet. Waiting for relay to provide...",2)))},t.prototype.SelectMesh=function(n){this.SendQueued(null,"CDE_MESHSELECT:"+n,"ContentService",null,null,1,1,1,null,null)},t.prototype.RSAEncrypt=function(n,t){if(this.MyConfig.DisableRSA||(t&&t.length!==0||(t=this.MyHSI.CurrentRSA),!t||t.length===0))return n;var i=t.split(","),r=new RSAKey;return r.setPublic(i[1],i[0]),r.encrypt(n)},t.prototype.GetResourceString=function(n,t,i){this.GetGlobalResource("/ClientBin/"+n,null,t,i)},t.prototype.GetJSON=function(n,t,i){this.GetGlobalResource(n,null,function(n,r){try{var u=JSON.parse(r);t(u)}catch(f){i&&i(n,f)}},function(n,t){i&&i(n,t)})},t.prototype.GetGlobalResource=function(n,t,i,r){var s,u,o,h,e,f;if(window.fetch){if(s=new Headers,t)for(o=t.split(";:;"),e=0;e<o.length;e++)f=o[e].split("="),f.length>1&&s.append(f[0],f[1]);fetch(n,{headers:s,cache:"no-store"}).then(function(t){t.ok?t.text().then(function(t){i(n,t)}):r&&r(n,t.statusText)}).catch(function(t){r&&r(n,t)})}else{if(u=new XMLHttpRequest,u.open("GET",n),u.responseType="text",t){for(o=t.split(";:;"),h=!1,e=0;e<o.length;e++)f=o[e].split("="),f[0]==="Accept"&&(h=!0),f.length>1&&u.setRequestHeader(f[0],f[1]);h||u.setRequestHeader("Accept","*/*")}u.onload=function(){u.status>=200&&u.status<400?i&&i(n,u.responseText):r&&r(n,u.status+":"+u.statusText)};u.onerror=function(){r&&r(n,u.status+":"+u.statusText)};u.send()}},t.prototype.UpdateCustomSettings=function(n){if(this.MyConfig){for(var t in n)this.MyConfig[t]=n[t];this.WriteToIDB()}},t.prototype.WriteToIDB=function(){if(!this.MyDB){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:WriteToIDB","IDB is not ready, yet",3);return}this.MyConfig.cdeTIM=new Date;var n=this.MyDB.transaction(["CDEJS"],"readwrite").objectStore("CDEJS").put({id:1,config:this.MyConfig});n.onsuccess=function(){};n.onerror=function(){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:WriteToIDB","The data has been written failed",3)}},t.prototype.DeleteFromIDB=function(){if(!this.MyDB){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:DeleteFromIDB","IDB is not ready, yet",3);return}var n=this.MyDB.transaction(["CDEJS"],"readwrite").objectStore("CDEJS").delete(1);n.onsuccess=function(){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","IndexedDB:DeleteFromIDB","The data has been deleted",1)}},t}(cde.TheThing);n.cdeWebComm=t}(cdeWEB||(cdeWEB={})),function(n){var t=function(n){function t(){var t=n.call(this)||this;return t.MyHSI=new cde.TheWHSI,t.ForceDisconnect=!1,t.MyConfig=null,t.MyWorker=new SharedWorker("ClientBin/CDE/cdeWorker.min.js?"+document.URL),t.MyWorker.port.onmessage=function(n){var r,i;try{if(i=n.data,i.length>1)switch(i[0]){case"CDE_NEW_LOGENTRY":(r=cde.MyEventLogger).FireEvent.apply(r,__spreadArrays([!0,i[0]],i.slice(2)));break;default:t.MyHSI=i[1];cde.MyBaseAssets.MyCommStatus=t.MyHSI;t.FireEvent.apply(t,__spreadArrays([!0,i[0]],i.slice(2)))}}catch(u){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","WebWorker:OnMessage",u,3)}},t.MyWorker.port.start(),t}return __extends(t,n),t.prototype.PostToWorker=function(n){return this.MyWorker?(this.MyWorker.port.postMessage(n),!0):!1},Object.defineProperty(t.prototype,"IsConnected",{get:function(){return this.ForceDisconnect===!0?!1:this.MyHSI.IsConnected},set:function(n){this.MyHSI.IsConnected=n},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"IsReady",{get:function(){return this.MyHSI.CurrentRSA!==null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"HasAutoLogin",{get:function(){return this.MyHSI.HasAutoLogin},enumerable:!1,configurable:!0}),t.prototype.RSAEncrypt=function(n,t){if(!this.MyHSI||!this.MyHSI.CurrentRSA||this.MyConfig&&this.MyConfig.DisableRSA||(t&&t.length!==0||(t=this.MyHSI.CurrentRSA),!t||t.length===0))return n;var i=t.split(","),r=new RSAKey;return r.setPublic(i[1],i[0]),r.encrypt(n)},t.prototype.SetTargetRelay=function(n){return this.PostToWorker(["SetTargetRelay",n])},t.prototype.SetConfig=function(n){n&&(this.MyConfig=n,this.PostToWorker(["SetConfig",n]))},t.prototype.StartCommunication=function(n){this.MyConfig=n;this.PostToWorker(["StartCommunication",n])},t.prototype.SendQueued=function(n,t,i,r,u,f,e,o,s,h,c){this.PostToWorker(["SendQueued",n,t,i,r,u,f,e,o,s,h,c])},t.prototype.Subscribe=function(n){this.PostToWorker(["Subscribe",n])},t.prototype.Unsubscribe=function(n){this.PostToWorker(["Unsubscribe",n])},t.prototype.SendToNode=function(n,t,i){this.PostToWorker(["SendToNode",n,t,i])},t.prototype.SendToOriginator=function(n,t,i){n&&this.PostToWorker(["SendToOriginator",n,t,i])},t.prototype.SendTSM=function(n,t,i,r){this.PostToWorker(["SendTSM",n,t,i,r])},t.prototype.SendToFirstNode=function(n){this.PostToWorker(["SendToFirstNode",n])},t.prototype.Logout=function(){this.PostToWorker(["Logout","User logged out"])},t.prototype.Login=function(n){n&&this.PostToWorker(["Login",n])},t.prototype.SelectMesh=function(n){n&&this.PostToWorker(["SelectMesh",n])},t.prototype.UpdateCustomSettings=function(n){n&&this.PostToWorker(["UpdateCustomSettings",n])},t.prototype.GetResourceString=function(n,t,i){var r=this;n&&t&&(this.RegisterEvent("GRS_/ClientBin/"+n,function(){for(var u=[],i=1;i<arguments.length;i++)u[i-1]=arguments[i];t.apply(void 0,__spreadArrays([n],u));r.UnregisterEvent("GRS_/ClientBin/"+n)}),i&&this.RegisterEvent("GRS_ERROR_/ClientBin/"+n,function(){for(var u=[],t=1;t<arguments.length;t++)u[t-1]=arguments[t];i.apply(void 0,__spreadArrays([n],u));r.UnregisterEvent("GRS_/ClientBin/"+n);r.UnregisterEvent("GRS_ERROR_/ClientBin/"+n)}),this.PostToWorker(["GetResourceString",n]))},t.prototype.GetGlobalResource=function(n,t,i,r){var u=this;n&&i&&(this.RegisterEvent("GGR_"+n,function(){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];i.apply(void 0,__spreadArrays([n],r));u.UnregisterEvent("GGR_"+n)}),r&&this.RegisterEvent("GGR_ERROR_"+n,function(){for(var r=[],t=1;t<arguments.length;t++)r[t-1]=arguments[t];i.apply(void 0,__spreadArrays([n],r));u.UnregisterEvent("GGR_ERROR_"+n)}),this.PostToWorker(["GetGlobalResource",n,t]))},t.prototype.GetJSON=function(n,t,i){var r=this;n&&t&&(this.RegisterEvent("GJ_"+n,function(){for(var f=[],u=1;u<arguments.length;u++)f[u-1]=arguments[u];t.apply(void 0,__spreadArrays([n],f));r.UnregisterEvent("GJ_"+n);i&&r.UnregisterEvent("GJ_ERROR_"+n)}),i&&this.RegisterEvent("GJ_ERROR_"+n,function(){for(var u=[],t=1;t<arguments.length;t++)u[t-1]=arguments[t];i.apply(void 0,__spreadArrays([n],u));r.UnregisterEvent("GJ_"+n);r.UnregisterEvent("GJ_ERROR_"+n)}),this.PostToWorker(["GetJSONAsync",n]))},t}(cde.TheThing);n.cdeWebWorkerComm=t}(cdeWEB||(cdeWEB={})),canary=0xdeadbeefcafe,j_lm=(canary&16777215)==15715070,BigInteger.prototype.am=am3,dbits=28,BigInteger.prototype.DB=dbits,BigInteger.prototype.DM=(1<<dbits)-1,BigInteger.prototype.DV=1<<dbits,BI_FP=52,BigInteger.prototype.FV=Math.pow(2,BI_FP),BigInteger.prototype.F1=BI_FP-dbits,BigInteger.prototype.F2=2*dbits-BI_FP,BI_RM="0123456789abcdefghijklmnopqrstuvwxyz",BI_RC=[],rr="0".charCodeAt(0),vv=0;vv<=9;++vv)BI_RC[rr++]=vv;for(rr="a".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;for(rr="A".charCodeAt(0),vv=10;vv<36;++vv)BI_RC[rr++]=vv;if(Classic.prototype.convert=cConvert,Classic.prototype.revert=cRevert,Classic.prototype.reduce=cReduce,Classic.prototype.mulTo=cMulTo,Classic.prototype.sqrTo=cSqrTo,Montgomery.prototype.convert=montConvert,Montgomery.prototype.revert=montRevert,Montgomery.prototype.reduce=montReduce,Montgomery.prototype.mulTo=montMulTo,Montgomery.prototype.sqrTo=montSqrTo,BigInteger.prototype.copyTo=bnpCopyTo,BigInteger.prototype.fromInt=bnpFromInt,BigInteger.prototype.fromString=bnpFromString,BigInteger.prototype.clamp=bnpClamp,BigInteger.prototype.dlShiftTo=bnpDLShiftTo,BigInteger.prototype.drShiftTo=bnpDRShiftTo,BigInteger.prototype.lShiftTo=bnpLShiftTo,BigInteger.prototype.rShiftTo=bnpRShiftTo,BigInteger.prototype.subTo=bnpSubTo,BigInteger.prototype.multiplyTo=bnpMultiplyTo,BigInteger.prototype.squareTo=bnpSquareTo,BigInteger.prototype.divRemTo=bnpDivRemTo,BigInteger.prototype.invDigit=bnpInvDigit,BigInteger.prototype.isEven=bnpIsEven,BigInteger.prototype.exp=bnpExp,BigInteger.prototype.toString=bnToString,BigInteger.prototype.negate=bnNegate,BigInteger.prototype.abs=bnAbs,BigInteger.prototype.compareTo=bnCompareTo,BigInteger.prototype.bitLength=bnBitLength,BigInteger.prototype.mod=bnMod,BigInteger.prototype.modPowInt=bnModPowInt,BigInteger.prototype.ZERO=nbv(0),BigInteger.prototype.ONE=nbv(1),Arcfour.prototype.init=ARC4init,Arcfour.prototype.next=ARC4next,rng_psize=256,rng_pool==null){for(rng_pool=[],rng_pptr=0;rng_pptr<rng_psize;)t=Math.floor(65536*Math.random()),rng_pool[rng_pptr++]=t>>>8,rng_pool[rng_pptr++]=t&255;rng_pptr=0;rng_seed_time()}SecureRandom.prototype.nextBytes=rng_get_bytes;RSAKey.prototype.doPublic=RSADoPublic;RSAKey.prototype.setPublic=RSASetPublic;RSAKey.prototype.encrypt=RSAEncrypt,function(n){function t(t,i,r){var f;if(i===void 0&&(i="en"),r===void 0&&(r=0),t)try{if(n.synth.speaking)return;var e=new SpeechSynthesisUtterance(t),u=n.synth.getVoices(),o=u[r];for(f in u)if(u[f].lang.toLowerCase().startsWith(i.toLowerCase())){o=u[f];break}e.voice=o;n.synth.speak(e)}catch(s){}}n.synth=window.speechSynthesis;n.talk=t}(cdeSpeech||(cdeSpeech={})),function(n){var t=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.blob=null,n.force=!1,n.readyState="INIT",n.isSafari=!1,n.isChromeIos=!1,n.save_link=document.createElementNS("http://www.w3.org/1999/xhtml","a"),n.can_use_save_link="download"in n.save_link,n.force_saveable_type="application/octet-stream",n.arbitrary_revoke_timeout=4e4,n}return __extends(i,t),i.prototype.SaveAs=function(t,i,r){var u=this,f;if(window.navigator&&window.navigator.msSaveOrOpenBlob){window.navigator.msSaveOrOpenBlob(t,i);return}if(n.IsIE()){cdeNMI.MyToast&&cdeNMI.MyToast.ShowToastMessage("Sorry...but IE does not support saving files!");return}this.blob=r?t:this.AutoBom(t);f=window;this.isSafari=/constructor/i.test(f.HTMLElement)||f.safari;this.isChromeIos=/CriOS\/[\d]+/.test(navigator.userAgent);this.force=t.type===this.force_saveable_type;try{if(this.can_use_save_link){this.ObjectUrl=this.GetURL().createObjectURL(t);window.setTimeout(function(){u.save_link.href=u.ObjectUrl;u.save_link.download=i;u.click(u.save_link);u.DispatchAll();u.revoke(u.ObjectUrl);u.readyState="DONE"},0);return}}catch(e){}this.FsError()},i.prototype.GetURL=function(){return window.URL||window.webkitURL||window},i.prototype.click=function(n){var t=new MouseEvent("click");n.dispatchEvent(t)},i.prototype.revoker=function(n){typeof n=="string"?this.GetURL().revokeObjectURL(n):n.remove()},i.prototype.revoke=function(n){var t=this;setTimeout(function(){return t.revoker(n)},this.arbitrary_revoke_timeout)},i.prototype.AutoBom=function(n){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(n.type)?new Blob([String.fromCharCode(65279),n],{type:n.type}):n},i.prototype.dispatch=function(t,i,r){var u,f;for(i=[].concat(i),u=i.length;u--;)if(f=t["on"+i[u]],typeof f=="function")try{f.call(t,r||t)}catch(e){n.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","FileSaver","dispatch failed: "+e+":"+e.stack)}},i.prototype.DispatchAll=function(){this.dispatch(this,"writestart progress write writeend".split(" "),null)},i.prototype.FsError=function(){var t=this,n,i;if((this.isChromeIos||this.force&&this.isSafari)&&window.FileReader){n=new FileReader;n.onloadend=function(){var i=t.isChromeIos?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;"),r=window.open(i,"_blank");r||(window.location.href=i);i=undefined;t.readyState="DONE";t.DispatchAll()};n.readAsDataURL(this.blob);this.readyState="INIT";return}if(this.ObjectUrl||(this.ObjectUrl=this.GetURL().createObjectURL(this.blob)),this.force)window.location.href=this.ObjectUrl;else{i=void 0;try{i=window.open(this.ObjectUrl,"_blank")}catch(r){}i||(window.location.href=this.ObjectUrl)}this.readyState="DONE";this.DispatchAll();this.revoke(this.ObjectUrl)},i}(n.TheDataBase);n.cdeFileSaver=t}(cde||(cde={})),function(n){var i,lt,o,s,h,c,l,a,v,y,t,p,w,b,k,u,d,g,nt,tt,it,f,rt,ut,ft,et,ot,st,ht,ct,r,e;n.MyNMIModels=[];n.MyNMINUITags=[];n.MyNMIThingEvents=[];n.MyTouchOverlay=null;n.IsMouseDown=!1;n.Key13Event=null;n.Key27Event=null;n.DisableKey36Event=!1;n.IsInEdit=!1;n.eTheNMIEngine="NMIService",function(n){n[n.BaseControl=0]="BaseControl";n[n.SingleEnded=1]="SingleEnded";n[n.ComboBox=2]="ComboBox";n[n.Radio=3]="Radio";n[n.SingleCheck=4]="SingleCheck";n[n.TextArea=5]="TextArea";n[n.YesNo=6]="YesNo";n[n.Time=8]="Time";n[n.TimeSpan=9]="TimeSpan";n[n.Password=10]="Password";n[n.Number=12]="Number";n[n.Region=13]="Region";n[n.Country=14]="Country";n[n.TrueFalse=15]="TrueFalse";n[n.eMail=16]="eMail";n[n.ComboOption=17]="ComboOption";n[n.Month=18]="Month";n[n.FormButton=19]="FormButton";n[n.SmartLabel=20]="SmartLabel";n[n.DateTime=21]="DateTime";n[n.TileButton=22]="TileButton";n[n.Table=23]="Table";n[n.CheckField=24]="CheckField";n[n.RadioGrid=25]="RadioGrid";n[n.Screen=26]="Screen";n[n.TableCell=27]="TableCell";n[n.TileEntry=28]="TileEntry";n[n.Picture=29]="Picture";n[n.CanvasDraw=30]="CanvasDraw";n[n.URL=31]="URL";n[n.Curreny=32]="Curreny";n[n.Slider=33]="Slider";n[n.BarChart=34]="BarChart";n[n.Toast=35]="Toast";n[n.TouchDraw=36]="TouchDraw";n[n.Popup=37]="Popup";n[n.DrawOverlay=38]="DrawOverlay";n[n.DropUploader=40]="DropUploader";n[n.RevealButton=41]="RevealButton";n[n.PinButton=42]="PinButton";n[n.Dashboard=44]="Dashboard";n[n.FormView=45]="FormView";n[n.TouchOverlay=46]="TouchOverlay";n[n.MuTLock=47]="MuTLock";n[n.ProgressBar=48]="ProgressBar";n[n.TileGroup=49]="TileGroup";n[n.VideoViewer=50]="VideoViewer";n[n.UserControl=51]="UserControl";n[n.TableRow=52]="TableRow";n[n.IPAddress=53]="IPAddress";n[n.Shape=54]="Shape";n[n.CollapsibleGroup=55]="CollapsibleGroup";n[n.AboutButton=56]="AboutButton";n[n.StatusLight=57]="StatusLight";n[n.FacePlate=58]="FacePlate";n[n.LoginScreen=59]="LoginScreen";n[n.ShapeRecognizer=60]="ShapeRecognizer";n[n.ScreenManager=61]="ScreenManager";n[n.LogoButton=62]="LogoButton";n[n.ThingPicker=63]="ThingPicker";n[n.ImageSlider=64]="ImageSlider";n[n.CircularGauge=65]="CircularGauge";n[n.SmartGauge=66]="SmartGauge";n[n.IFrameView=67]="IFrameView";n[n.PropertyPicker=68]="PropertyPicker";n[n.PropertyPickerCtrl=69]="PropertyPickerCtrl";n[n.ToolTip=70]="ToolTip";n[n.ComboLookup=71]="ComboLookup";n[n.UserMenu=72]="UserMenu";n[n.MeshPicker=73]="MeshPicker";n[n.HashIcon=74]="HashIcon";n[n.CertPicker=75]="CertPicker";n[n.DeviceTypePicker=76]="DeviceTypePicker"}(i=n.cdeControlType||(n.cdeControlType={})),function(n){n[n.UNKOWN=0]="UNKOWN";n[n.MOUSE=1]="MOUSE";n[n.TOUCH=2]="TOUCH";n[n.PEN=3]="PEN";n[n.ERASER=4]="ERASER";n[n.LEAP=5]="LEAP";n[n.KEYBOARD=6]="KEYBOARD";n[n.KINECT=7]="KINECT"}(lt=n.cdeInputEventType||(n.cdeInputEventType={})),function(n){n[n.IDLE=0]="IDLE";n[n.START=1]="START";n[n.MOVE=2]="MOVE";n[n.END=3]="END"}(o=n.cdeInputEvent||(n.cdeInputEvent={}));n.TheEscapeMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39"};s=function(){function n(){}return n}();n.ThePlanarImage=s;h=function(){function n(){}return n}();n.TheScreenTrans=h;c=function(){function n(){}return n}();n.TheFLDOR=c;l=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(cde.TheMetaDataBase);n.TheFOR=l;a=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(cde.TheMetaDataBase);n.TheNMIScene=a;v=function(){function n(){}return n}();n.TheNMIResource=v;y=function(){function n(n){n&&(this.altKey=n.altKey,this.Cchar=n.char,this.charCode=n.charCode,this.ctrlKey=n.ctrlKey,this.key=n.key,this.keyCode=n.keyCode,this.location=n.location,this.metaKey=n.metaKey,this.repeat=n.repeat,this.shiftKey=n.shiftKey,this.which=n.which,this.LEFT=n.DOM_KEY_LOCATION_LEFT,this.NUMPAD=n.DOM_KEY_LOCATION_NUMPAD,this.STANDARD=n.DOM_KEY_LOCATION_STANDARD,this.RIGHT=n.DOM_KEY_LOCATION_RIGHT,this.eventPhase=n.eventPhase,this.isTrusted=n.isTrusted,this.returnValue=n.returnValue,this.timeStamp=n.timeStamp,this.type=n.type)}return n}();n.TheKey=y;t=function(){function n(n,t){this.x=n?n:0;this.y=t?t:0;this.z=0;this.t=0}return n.prototype.toString=function(){return"X,Y,Z,T:"+this.x+","+this.y+","+this.z+":t="+this.t},n}();n.TheDrawingPoint=t;p=function(){function i(n,r,u,f,e,s,h,c,l){this.Identifier=r;this.Position=new t;this.Position.x=u;this.Position.y=f;this.Position.z=e;this.Position.t=s;this.Shift=new t;this.AdjPosition=new t;this.StartPosition=new t;this.StartPosition.x=u;this.StartPosition.y=f;this.StartPosition.z=e;this.StartPosition.t=s;this.pointerType=h;this.pointerEvent=c?c:o.IDLE;this.Pressure=s;this.Buttons=l;this.Ele2DocPosition=i.ComputeDocumentToElementDelta(n);this.Update(n,this.Position)}return i.prototype.Update=function(n,t){this.Shift.x=t.x-this.Position.x;this.Shift.y=t.y-this.Position.y;this.Shift.z=t.z-this.Position.z;this.Shift.t=t.t-this.Position.t;this.Position.x=t.x;this.Position.y=t.y;this.Position.z=t.z;this.Position.t=t.t;this.AdjPosition=i.targetRelativeX(n,this.Position,this.Ele2DocPosition);this.AdjPosition.t=t.t;this.Pressure=t.t;this.IsOnObject=!0},i.IsOnObject=function(n,t){var i=document.elementFromPoint(t.x,t.y);return i===n},i.targetRelativeX=function(n,i,r){var u=new t;return u.x=Math.max(0,Math.min(i.x-r.x,n.offsetWidth)),u.y=Math.max(0,Math.min(i.y-r.y,n.offsetHeight)),u},i.ComputeDocumentToElementDelta=function(n){for(var r=new t,u=!1,i=n;i;i=i.offsetParent)r.x+=i.offsetLeft,r.y+=i.offsetTop,i.className&&cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===0&&i.className==="cdeHeader"&&(u=!0);return u&&(r.x+=window.pageXOffset,r.y+=window.pageYOffset),r},i.prototype.PathLength=function(){return n.Vector2Distance(this.StartPosition,this.Position)},i.prototype.PathAngle=function(){return n.Vector2GetAngle(this.StartPosition,this.Position)},i.prototype.toString=function(){return"ID: "+this.Identifier+"CP:"+this.Position.toString()+" IP:"+this.StartPosition.toString()+" AP:"+this.AdjPosition.toString()+" Type:"+this.pointerType+" Event:"+this.pointerEvent},i}();n.ThePointer=p;w=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.MyStorageInfo=[],t.MyStorageMirror=[],t.MyStorageMeta=[],t}return __extends(t,n),t}(cde.TheMetaDataBase);n.TheScreenInfo=w;b=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(cde.TheThing);n.TheDashPanelInfo=b;k=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(cde.TheThing);n.TheDashboardInfo=k;u=function(n){function t(t,i,r,u,f,e){var o=n.call(this)||this;return o.Type=t,o.PropertyBag=e?e:[],r&&o.PropertyBag.push("Title="+r),i&&o.PropertyBag.push("FldWidth="+i),u&&(o.Flags=u),f&&(o.FormID=cde.GuidToString(f)),o}return __extends(t,n),t.NewTFI=function(n,i,r,u,f){var e=new t(n,null,r,u,null,f);return i>0&&(e.FldOrder=i),e},t}(cde.TheThing);n.TheFieldInfo=u;d=function(n){function t(){var t=n!==null&&n.apply(this,arguments)||this;return t.DefaultView=0,t.IsReadOnly=!1,t.IsLiveData=!1,t.IsAlwaysEmpty=!1,t.IsPostingOnSubmit=!1,t.IsUsingAbsolute=!1,t.GetFromFirstNodeOnly=!1,t.GetFromServiceOnly=!1,t.IsGenerated=!1,t.CurrentRow=0,t}return __extends(t,n),t}(cde.TheThing);n.TheFormInfo=d;g=function(){function n(n,t){this.Left=n?n:0;this.Top=t?t:0}return n}();n.TheDrawingObject=g;nt=function(){function n(){}return n}();n.TheComboLookup=nt;tt=function(){function n(){}return n}();n.TheStrokePoint=tt;it=function(){function t(n,t,i){this.RowFilter=null;this.FldName=null;this.ModelID=null;this.RowID=null;this.TableName=n;this.RowNo=t;this.FldInfo=i}return t.prototype.GetHash=function(){var n=this.TableName+this.RowNo;return this.FldInfo&&(n+=this.FldInfo.FldOrder),n},t.prototype.GetDataRow=function(){try{if(n.MyNMIModels[this.ModelID]&&n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName])return n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName][this.RowNo]}catch(t){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TheTRF:GetDataRow",t)}return null},t.prototype.GetMID=function(){var t=null;try{n.MyNMIModels[this.ModelID]&&n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName]&&n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName][this.RowNo]&&(t=n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName][this.RowNo].cdeMID)}catch(i){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TheTRF:GetMID",i)}return!t&&this.FldInfo&&(t=this.FldInfo.cdeMID),t},t.prototype.GetOwner=function(){var t=null;try{n.MyNMIModels[this.ModelID]&&n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName]&&n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName][this.RowNo]&&(t=n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName][this.RowNo].cdeO)}catch(i){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TheTRF:GetMID",i)}return!t&&this.FldInfo&&(t=this.FldInfo.cdeO),t},t.prototype.GetNodeID=function(){var t=null;try{n.MyNMIModels[this.ModelID]&&n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName]&&n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName][this.RowNo]&&(t=n.MyNMIModels[this.ModelID].MyStorageMirror[this.TableName][this.RowNo].cdeN,t||(t=n.MyNMIModels[this.ModelID].cdeN))}catch(i){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TheTRF:GetNodeID",i)}return!t&&this.FldInfo&&(t=this.FldInfo.cdeN),t},t.SetFlagsOnly=function(t){return new n.TheTRF("",0,new n.TheFieldInfo(n.cdeControlType.BaseControl,0,"",t))},t.FromScreenForm=function(t,r){var f=t&&t.MyStorageMeta&&t.MyStorageMeta[r]?t.MyStorageMeta[r]:null,e=new n.TheTRF(r,f&&f.CurrentRow?f.CurrentRow:0,null);if(e.FldInfo=new u(i.BaseControl),f){switch(f.DefaultView){case 0:e.FldInfo.Type=i.Table;break;case 1:e.FldInfo.Type=i.FormView;break;case 2:e.FldInfo.Type=i.IFrameView}e.FldInfo.cdeO=f.cdeO;e.FldInfo.cdeN=f.cdeN;e.FldInfo.cdeMID=f.cdeMID}return e},t.GetTRF=function(t,i){var r,u;return!i||!i.TableName?null:(t||(t=cde.MyBaseAssets.MyServiceHostInfo.PortalScreen),t=cde.GuidToString(t),r=n.MyNMIModels[t],!r||r.MyStorageMirror[i.TableName])?null:(u=i.RowNo,i.RowFilter,r.MyStorageMirror[i.TableName][u][i.FldName])},t}();n.TheTRF=it;f=function(){function n(){if(this.TileMargin=1,this.IsInEdit=!1,this.IDCounter=1,this.StrokeSize=.3,this.DeadPathLength=40,this.SupportsMouse=!1,this.SupportsTouch=!1,this.SupportsPointer=!1,this.SupportsTouchForce=!1,this.SupportsTouchForceChange=!1,this.mIsScrolling=!1,typeof Touch!="undefined")try{(Touch.prototype.hasOwnProperty("force")||"force"in new Touch(null))&&(this.SupportsTouchForce=!0)}catch(n){}this.SupportsTouch="ontouchstart"in window.document&&this.SupportsTouchForce;this.SupportsMouse="onmousemove"in window.document&&!this.SupportsTouch;this.SupportsPointer="onpointermove"in window.document;this.SupportsTouchForceChange="ontouchforcechange"in window.document}return Object.defineProperty(n.prototype,"IsScrolling",{get:function(){var n=this.mLastScrollTime&&(new Date).getTime()<this.mLastScrollTime+500;return this.mIsScrolling=cde.CBool(n),n},set:function(n){this.mIsScrolling=n;n===!0&&(this.mLastScrollTime=(new Date).getTime())},enumerable:!1,configurable:!0}),n}();n.TheNMISettings=f;n.MyNMISettings=new f;rt=function(){function n(){}return n}();n.TheNavHistory=rt;ut=function(){function t(){}return t.AddCache=function(t,i,r){if(n.MyFlashCache[t]){n.MyFlashCache[t].Value=i;n.MyFlashCache[t].Stamp=Math.ceil((new Date).getTime()-new Date(2014,4,1).getTime());return}var u=new n.TheFlashCache;u.Value=i;u.Stamp=Math.ceil((new Date).getTime()-new Date(2014,4,1).getTime());u.Exp=r?r:3e3;n.MyFlashCache[t]=u},t.GetCache=function(t){return n.MyFlashCache[t]?Math.ceil((new Date).getTime()-new Date(2014,4,1).getTime())-n.MyFlashCache[t].Stamp>n.MyFlashCache[t].Exp?null:n.MyFlashCache[t].Value:null},t.FlushCache=function(){n.MyFlashCache=[]},t}();n.TheFlashCache=ut;n.MyFlashCache=[];ft=function(n){function t(){return n!==null&&n.apply(this,arguments)||this}return __extends(t,n),t}(cde.TheMetaDataBase);n.TheNodeInfo=ft;et=function(){function n(){}return n}();n.TheControlBlock=et;n.MyTCBs=[];ot=function(){function n(){}return n}();n.TheFaceWait=ot;st=function(){function n(){}return n}();n.TheNMIC=st;ht=function(){function n(){}return n}();n.TheComboOption=ht;ct=function(){function t(){}return t.GetPropNameFromBag=function(n,t){var i=n.indexOf("=");return(i<0&&(i=n.length),cde.CBool(t))?n.substring(0,i):n.substring(0,i).trim()},t.RemoveProperty=function(n,t){var i,r,u;if(n&&n.length>0)for(i=0;i<n.length;i++)if(r=n[i].indexOf("="),r>=0&&(u=n[i].substring(0,r).trim(),u===t)){n.splice(i,1);return}},t.UpdateProperty=function(n,t,i){var r,u,f;if(n&&n&&n.length>0)for(r=0;r<n.length;r++)if(u=n[r].indexOf("="),u>=0&&(f=n[r].substring(0,u).trim(),f===t)){n[r]=t+"="+i;return}},t.GetValueFromBagByName=function(n,t,i){var r,u,f,e;if(n&&n.length>0)for(r=0;r<n.length;r++)if(u=n[r].indexOf("="),u>=0&&(f=n[r].substring(0,u).trim(),e=i===!0?n[r].substring(u+1):n[r].substring(u+1).trim(),f===t))return e;return null},t.ConvertPropertiesFromBag=function(n,t){var i,r;if(n){for(n.PropertyBag||(n.PropertyBag=[]),i=0;i<n.PropertyBag.length;i++)this.ConvertBagToSettings(n,n.PropertyBag[i]);if(t)for(r=0;r<t.length;r++)this.ConvertBagToSettings(n,t[r])}},t.ConvertBagToSettings=function(n,t){var r,u,i,f;n&&t&&(r=t.indexOf("="),u=!0,r<0&&(r=t.length,u=!1),i=t.substring(0,r).trim(),i==="Value"&&(i="iValue"),u?(f=t.substring(r+1).trim(),n[i]=i==="Flags"||i==="FldOrder"||i==="ACL"?cde.CInt(f):f):n[i]=!0)},t.SetPropertiesFromBag=function(t,r,u,f,e){var s,h,l,o,c;if(r&&t)for(s=0;s<r.length;s++)if((h=r[s].indexOf("="),l=!0,h<0&&(h=r[s].length,l=!1),o=r[s].substring(0,h).trim(),o==="Value"&&(o="iValue"),!cde.CBool(e)||o!=="TileWidth"&&o!=="TileLeft"&&o!=="TileTop"&&o!=="IsAbsolute")&&(t.MyBaseType!==i.TileEntry||o.toLowerCase()!=="onthingevent")){c="";try{l?(c=r[s].substring(h+1).trim(),n.ThePB.SetRawProperty(t,o,c,u,f)):t.SetProperty(o,!0)}catch(a){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","ThePB:SetPropertyFromBag","SetPropertyFromBag failed to SetP on "+o+" to "+c)}}},t.SetRawProperty=function(t,i,r,u,f){var e,o;if(i){e=r;e||(e="");switch(i.toLowerCase()){case"onthingevent":try{o=void 0;o=f?e.split(";"):n.GenerateFinalString(e,u).split(";");t.RegisterThingSetP(o[0],o[1])}catch(s){}break;default:i!=="HTML"&&i!=="OnClick"&&e.indexOf("<%")>=0&&e.indexOf("%>")>=0?(e=n.GenerateFinalString(e,u),t.SetDataItem(i,e)):(e&&e.indexOf("%")>=0&&(e=n.GenerateFinalString(e,u,null,!0)),t.SetProperty(i,e))}}},t.GetSetting=function(t,i){var r=null;return t&&(r=t[i],!r&&t.PropertyBag&&(r=n.ThePB.GetValueFromBagByName(t.PropertyBag,i))),r},t}();n.ThePB=ct;r=function(){function n(){this.LCID=0;this.MyResources={}}return n}();n.TheLanguageResource=r;e=function(t){function i(){var n=t!==null&&t.apply(this,arguments)||this;return n.LocalResources=new r,n.mRequestedLCID=0,n}return __extends(i,t),i.prototype.SetLCID=function(n){if(n!==this.LocalResources.LCID)if(this.mRequestedLCID=n,n===1033)this.LocalResources=new r,this.LocalResources.LCID=n;else{this.GetResources();return}this.FireEvent(!0,"OnLCIDChanged",this.LocalResources.LCID)},i.prototype.GetCurrentLCID=function(){return this.LocalResources.LCID},i.prototype.GetResources=function(){var t=this;if(this.mRequestedLCID>0&&this.mRequestedLCID!==1033&&n.MyEngine){n.MyEngine.cdeGetResource("Lang/NMIlang"+cde.CStr(this.mRequestedLCID)+".json",function(n,i){t.SetResources(i)},null,3e3);return}this.FireEvent(!0,"OnLCIDChanged",this.LocalResources.LCID)},i.prototype.SetResources=function(n){var t,i;if(n&&n!=="TIMEOUT"&&n!=="Not Found")try{if(t=JSON.parse(n),this.mRequestedLCID===t.LCID){for(i in t.MyResources)this.LocalResources.MyResources[i]=t.MyResources[i];this.LocalResources.LCID=t.LCID}}catch(r){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:SetResource","failed with "+r+":"+r.stack)}this.FireEvent(!0,"OnLCIDChanged",this.LocalResources.LCID)},i.prototype.SaveResources=function(){var n=JSON.stringify(this.LocalResources);cde.MyContentEngine&&cde.MyContentEngine.SaveFile(n,"NMIlang"+this.LocalResources.LCID+".json","application/json",!1)},i.prototype.T=function(t){return typeof t!="string"||!t||t===""?"":(t=t.replace("&nbsp;"," "),this.LocalResources.MyResources[t]?n.IconFAShim(this.LocalResources.MyResources[t]):(cde.MyBaseAssets.MyServiceHostInfo.RedPill&&!t.startsWith("(Waiting for control #")&&(this.LocalResources.MyResources[t]=t),n.IconFAShim(t)))},i}(cde.TheDataBase);n.TheLocalizer=e;n.TL=new e}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(){var n=t.call(this)||this;return n.cdeControlTypeNames=[],n.MyNMIControls=[],n.MyKnownControls=[],n.MyLazyCallbacks=[],n.stringToFunction=function(n){for(var r=n.split("."),u=window,t=u,i=0,f=r.length;i<f;i++)t=t[r[i]];if(typeof t!="function")throw new Error("function not found");return t},n.cdeControlTypeNames[0]="cdeNMI.TheNMIBaseControl",n.cdeControlTypeNames[1]="cdeNMI.ctrlEditBox",n.cdeControlTypeNames[2]="cdeNMI.ctrlComboBox",n.cdeControlTypeNames[4]="cdeNMI.ctrlCheckBox",n.cdeControlTypeNames[5]="cdeNMI.ctrlEditBox",n.cdeControlTypeNames[6]="cdeNMI.ctrlComboBox",n.cdeControlTypeNames[7]="cdeNMI.ctrlComboBox",n.cdeControlTypeNames[8]="cdeNMI.ctrlDateTimePicker",n.cdeControlTypeNames[9]="cdeNMI.ctrlDateTimePicker",n.cdeControlTypeNames[10]="cdeNMI.ctrlEditBox",n.cdeControlTypeNames[11]="cdeNMI.ctrlTileButton",n.cdeControlTypeNames[12]="cdeNMI.ctrlEditBox",n.cdeControlTypeNames[13]="cdeNMI.ctrlComboBox",n.cdeControlTypeNames[14]="cdeNMI.ctrlComboBox",n.cdeControlTypeNames[15]="cdeNMI.ctrlComboBox",n.cdeControlTypeNames[16]="cdeNMI.ctrlEditBox",n.cdeControlTypeNames[17]="cdeNMI.ctrlComboBox",n.cdeControlTypeNames[18]="cdeNMI.ctrlDateTimePicker",n.cdeControlTypeNames[20]="cdeNMI.ctrlSmartLabel",n.cdeControlTypeNames[21]="cdeNMI.ctrlDateTimePicker",n.cdeControlTypeNames[22]="cdeNMI.ctrlTileButton",n.cdeControlTypeNames[23]="cdeNMI.ctrlTableView",n.cdeControlTypeNames[24]="cdeNMI.ctrlCheckField",n.cdeControlTypeNames[26]="cdeNMI.TheNMIScreen",n.cdeControlTypeNames[28]="cdeNMI.ctrlTileEntry",n.cdeControlTypeNames[29]="cdeNMI.ctrlZoomImage",n.cdeControlTypeNames[30]="cdeNMI.ctrlCanvasDraw",n.cdeControlTypeNames[31]="cdeNMI.ctrlEditBox",n.cdeControlTypeNames[32]="cdeNMI.ctrlEditBox",n.cdeControlTypeNames[33]="cdeNMI.ctrlEndlessSlider",n.cdeControlTypeNames[34]="cdeNMI.ctrlBarChart",n.cdeControlTypeNames[35]="cdeNMI.TheToast",n.cdeControlTypeNames[36]="cdeNMI.ctrlTouchDraw",n.cdeControlTypeNames[37]="cdeNMI.ThePopup",n.cdeControlTypeNames[38]="cdeNMI.ctrlDrawOverlay",n.cdeControlTypeNames[40]="cdeNMI.ctrlDropUploader",n.cdeControlTypeNames[41]="cdeNMI.ctrlRevealButton",n.cdeControlTypeNames[42]="cdeNMI.ctrlPinButton",n.cdeControlTypeNames[44]="cdeNMI.TheDashboard",n.cdeControlTypeNames[45]="cdeNMI.ctrlFormView",n.cdeControlTypeNames[46]="cdeNMI.ctrlTouchOverlay",n.cdeControlTypeNames[47]="cdeNMI.ctrlMoTLock",n.cdeControlTypeNames[48]="cdeNMI.ctrlProgressBar",n.cdeControlTypeNames[49]="cdeNMI.ctrlTileGroup",n.cdeControlTypeNames[50]="cdeNMI.ctrlVideoViewer",n.cdeControlTypeNames[53]="cdeNMI.ctrlEditBox",n.cdeControlTypeNames[54]="cdeNMI.ctrlShape",n.cdeControlTypeNames[55]="cdeNMI.ctrlCollapsibleGroup",n.cdeControlTypeNames[56]="cdeNMI.ctrlAboutButton",n.cdeControlTypeNames[57]="cdeNMI.ctrlStatusLight",n.cdeControlTypeNames[58]="cdeNMI.ctrlFacePlate",n.cdeControlTypeNames[59]="cdeNMI.TheLoginScreen",n.cdeControlTypeNames[60]="cdeNMI.TheShapeRecognizer",n.cdeControlTypeNames[61]="cdeNMI.TheScreenManager",n.cdeControlTypeNames[62]="cdeNMI.ctrlLogoButton",n.cdeControlTypeNames[63]="cdeNMI.ctrlThingPicker",n.cdeControlTypeNames[64]="cdeNMI.ctrlImageSlider2",n.cdeControlTypeNames[65]="cdeNMI.ctrlCircularGauge2",n.cdeControlTypeNames[66]="cdeNMI.ctrlSmartGauge2",n.cdeControlTypeNames[67]="cdeNMI.ctrlIFrameView",n.cdeControlTypeNames[68]="cdeNMI.ctrlPropertyPicker",n.cdeControlTypeNames[69]="cdeNMI.ctrlPropertyPicker",n.cdeControlTypeNames[70]="cdeNMI.ctrlToolTip",n.cdeControlTypeNames[71]="cdeNMI.ctrlComboLookup",n.cdeControlTypeNames[72]="cdeNMI.ctrlUserMenu",n.cdeControlTypeNames[73]="cdeNMI.ctrlMeshPicker",n.cdeControlTypeNames[74]="cdeNMI.ctrlHashIcon",n.cdeControlTypeNames[75]="cdeNMI.ctrlCertPicker",n.cdeControlTypeNames[76]="cdeNMI.ctrlDeviceTypePicker",n.MyKnownControls[0]="CMyDashboard",n.MyKnownControls[1]="CMyChart",n.MyKnownControls[2]="CMyTable",n.MyKnownControls[3]="CMyForm",n.MyKnownControls[4]="CMyData",n.MyKnownControls[5]="CMyHTML",n.MyKnownControls[6]="CMySCRIPT",n.MyKnownControls[7]="CMyInfo",n.MyKnownControls[8]="CMyNavigator",n.MyKnownControls[9]="CMyLiveScreen",n.MyKnownControls[10]="CMyIFrame",n.MyNMIControls.TABLES=[],n}return __extends(i,t),i.prototype.InitTCF=function(){this.FireEvent(!0,"ControlTypeFactory_Ready")},i.prototype.RegisterKnownControl=function(n,t){this.MyKnownControls[n]=t},i.prototype.IsControlNameKnown=function(t){return n.DoesArrayContain(this.MyKnownControls,t)},i.prototype.RegisterControl=function(n,t,i){this.MyNMIControls[n]||(this.MyNMIControls[n]=[]);t&&i&&(this.MyNMIControls[n][t]=i)},i.prototype.DeleteRegisteredControl=function(n,t){this.MyNMIControls[n]&&this.MyNMIControls[n][t]&&delete this.MyNMIControls[n][t]},i.prototype.GetRegisteredControl=function(n,t){return this.MyNMIControls[n]&&this.MyNMIControls[n][t]?this.MyNMIControls[n][t]:null},i.prototype.GetRegisteredControlGroup=function(n){return this.MyNMIControls[n]?this.MyNMIControls[n]:null},i.prototype.UnregisterControl=function(t,i){var u,r;t=cde.GuidToString(t);i=cde.GuidToString(i);u=this.GetRegisteredControl(t,i);u&&(n.MyEngine&&(r=cde.GuidToString(u.GetProperty("MyThing")),n.MyNMIThingEvents[r]&&n.MyNMIThingEvents[r][i]&&delete n.MyNMIThingEvents[r][i]),this.DeleteRegisteredControl(t,i))},i.prototype.IsComboBased=function(n){switch(n){case 2:case 6:case 7:case 8:case 9:case 13:case 14:case 15:case 17:case 18:case 21:return!0}return!1},i.prototype.IsTypeNumeric=function(n){switch(n){case 12:return!0}return!1},i.prototype.RegisterControlType=function(n,t){this.cdeControlTypeNames[n]=t},i.prototype.GetControlByName=function(n){return this.cdeControlTypeNames[n]?this.cdeControlTypeNames[n]:null},i.prototype.RegisterControlName=function(n,t){this.cdeControlTypeNames[n]=t},i.prototype.GetControlType=function(n){return this.cdeControlTypeNames[n]?this.cdeControlTypeNames[n]:this.cdeControlTypeNames[0]},i.prototype.FireLazyCreate=function(n,t,i){if(t===void 0&&(t=null),i===void 0&&(i=!1),n&&this.MyLazyCallbacks[n]){for(var r=this.MyLazyCallbacks[n].length-1;r>=0;r--)this.MyLazyCallbacks[n][r].CallBack&&this.CreateControlLazy(this.MyLazyCallbacks[n][r].TargetControl,n,this.MyLazyCallbacks[n][r].ControlType,this.MyLazyCallbacks[n][r].CallBack,this.MyLazyCallbacks[n][r].Cookie)&&this.MyLazyCallbacks[n].splice(r,1);!i&&this.MyLazyCallbacks[n].length>0&&this.FireLazyCreate(n,t,!0)}},i.prototype.CreateNMIControl=function(t,i){if(i===void 0&&(i=!1),!this.cdeControlTypeNames[t]||this.cdeControlTypeNames[t]==="")return(cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:CreateNMIControl","Unkown Control Type specified: "+t),i)?null:this.CreateBaseControl();var r=this.CreateControlLazy(null,n.eTheNMIEngine,this.cdeControlTypeNames[t],this.CreateNMICallback,null);if(!r){if(i)return null;cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:CreateNMIControlAsync","Control Type specified not found: "+t);r=this.CreateBaseControl()}return r},i.prototype.CreateBaseControl=function(){try{return new n[this.cdeControlTypeNames[0].split(".")[1]]}catch(t){}return null},i.prototype.CreateNMICallback=function(){},i.prototype.CreateNMIControlAsync=function(t,i,r){return this.cdeControlTypeNames[i]?this.CreateControlLazy(t,n.eTheNMIEngine,this.cdeControlTypeNames[i],r,null):(cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:CreateNMIControlAsync","Unkown Control Type specified: "+i),null)},i.prototype.CreateControlLazy=function(t,i,r,u,f){var e=null,h=!1,c,s,o;if(r&&r.length>0)try{c=this.stringToFunction(r);e=new c;h=!0;e.MyParentCtrl=t;u&&u(t,e,f)}catch(l){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:CreateControlLazy","LazyLoad failed:("+r+") "+l+":"+l.stack)}else return null;if(!h&&i&&u){for(this.MyLazyCallbacks[i]||(this.MyLazyCallbacks[i]=[],!cde.MyBaseAssets.MyEngines[i]&&n.MyEngine&&n.MyEngine.PublishToNMI("NMI_GET_ENGINEJS",i)),s=!1,o=0;o<this.MyLazyCallbacks[i].length;o++)if(this.MyLazyCallbacks[i][o].Cookie===f){s=!0;break}s||this.MyLazyCallbacks[i].push({ControlType:r,TargetControl:t,CallBack:u,Cookie:f})}return e},i.prototype.SetControlEssentials=function(t,i,r){var u,f,s,a,e,o,h,v,c;if(t&&(r||(r=t.MyTRF),r))try{if(u=r.FldInfo,f=null,n.MyEngine&&(f=n.MyNMIModels[r.ModelID]),!u&&t&&(u=t.MyFieldInfo),t!==i){if(t.MyNMIControl=i,t.MyTEContent.AppendChild(t.MyNMIControl),i.MyBaseType===n.cdeControlType.Table)return;s=t.GetProperty("ID");a=i.GetProperty("ID");i.SetProperty("ID",s);n.MyTCF.UnregisterControl(s,a);i.MyTRF||(i.MyTRF=r);i.MyFieldInfo||(i.MyFieldInfo=t.MyFieldInfo);cde.IsNotSet(i.GetProperty("NoTE"))||t.SetProperty("NoTE",i.GetProperty("NoTE"));cde.IsNotSet(i.GetProperty("UseTE"))||t.SetProperty("UseTE",i.GetProperty("UseTE"));cde.IsNotSet(i.GetProperty("TileFactorX"))||t.SetProperty("TileFactorX",i.GetProperty("TileFactorX"));cde.IsNotSet(i.GetProperty("TileFactorY"))||t.SetProperty("TileFactorY",i.GetProperty("TileFactorY"));cde.CBool(t.GetProperty("IsInTable"))||(t.SetProperty("MinTileWidth",i.GetProperty("MinTileWidth")),t.SetProperty("MinTileHeight",i.GetProperty("MinTileHeight")),cde.CInt(i.GetProperty("TileWidth"))>0&&t.SetProperty("TileWidth",i.GetProperty("TileWidth")),cde.CInt(i.GetProperty("TileHeight"))>0&&t.SetProperty("TileHeight",i.GetProperty("TileHeight")),cde.CBool(i.GetProperty("ShowOverflow"))&&(t.MyTEContainer.GetElement().style.overflow="initial"),i.SetProperty("ControlTW",cde.CInt(t.GetProperty("ControlTW"))),i.SetProperty("ControlTH",cde.CInt(t.GetProperty("ControlTH"))))}i.RegisterNMIControl();u&&u.DataItem&&i.SetProperty("DataItem",u.DataItem);e=null;f&&f.MyStorageMirror[r.TableName]?(e=f.MyStorageMirror[r.TableName][i.MyTRF?i.MyTRF.RowNo:0],o=n.GetFldContent(e,i.MyFieldInfo,f.IsGenerated,!1),cde.IsNotSet(o)||(i.MyFieldInfo&&i.MyFieldInfo&&i.MyFieldInfo.Type===n.cdeControlType.Picture&&o&&o.length>255&&(o="data:image/jpeg;base64,"+o),i.SetProperty("iValue",o)),u.OnClick=n.GenerateFinalString(u.OnClick,e),n.ThePB.SetRawProperty(i,"OnThingEvent",u.OnThingEvent,e,f.IsLiveForm)):(u.OnThingEvent&&f.IsLiveForm===!0&&n.ThePB.SetRawProperty(i,"OnThingEvent",u.OnThingEvent,null,f.IsLiveForm),u.DefaultValue&&!i.GetProperty("Value")&&i.SetProperty("iValue",u.DefaultValue));u.Title=n.GenerateFinalString(u.Title,e);cde.CBool(t.GetProperty("IsInTable"))||cde.CBool(u.IsInTable)||(u.Options&&(u.OptionsLive=n.GenerateFinalString(u.Options,e)),u&&u.PropertyBag&&u.PropertyBag.length>0&&n.ThePB.SetPropertiesFromBag(t,u.PropertyBag,f&&f.MyStorageMirror[r.TableName]?f.MyStorageMirror[r.TableName][i.MyTRF?i.MyTRF.RowNo:0]:null,f?f.IsLiveForm:!1,cde.CBool(t.GetProperty("IsInTable"))),f&&r.FldInfo&&(h=f.MyStorageMeta[cde.GuidToString(r.FldInfo.FormID)],h&&h.IsUsingAbsolute&&cde.CInt(u.ParentFld)===0&&t.SetProperty("IsAbsolute",!0)),t.GetProperty("RenderTarget")&&(v=n.GenerateFinalString(t.GetProperty("RenderTarget"),!1,t.MyTRF),t.FindRenderTarget(v)));i.SetProperty("TabIndex",!i.MyTarget||cde.CBool(i.MyTarget.GetProperty("IsUnloaded"))?-1:u.FldOrder);c=i.MyTarget.MyChildren.indexOf(i);c>=0&&i.MyTarget.MyChildren.splice(c,1);i.MyTarget.MyChildren.push(i);i.ApplySkin()}catch(l){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TileEntry:SetControlEssentials",l.message+":"+l.stack);t&&t.SetProperty("PlaceHolder",l.message)}},i.prototype.ToggleGroup=function(t,i){var u,e,f,s;if(t&&i&&(u=n.MyTCF.GetRegisteredControl("TABLES",cde.GuidToString(t)),u)){var r=i.split(":"),h=r[0],o=r.length>1?r[1]:null;if(r.length>3&&u.MyBaseType===n.cdeControlType.FormView){e=u;f="";try{f=e.ReplaceMarcos(r[3],e.MyFormControls);s=cde.cdeEval(f);s&&(o=r[2])}catch(c){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","Validating Group-Condition Error:"+c,"in: ("+r[3]+") resolved to<br/>"+f)}}u.SetProperty("StartGroup",i);this.ToggleChildren(u,h,o)}},i.prototype.ToggleChildren=function(t,i,r){var f,u,e;for(f in t.MyChildren)t.MyChildren.hasOwnProperty(f)&&(u=t.MyChildren[f],u.GetProperty("Group")?u.GetProperty("Group").toString().startsWith(i)&&(r===null||u.GetProperty("Group")!==i+":"+r?u.MyBaseType===n.cdeControlType.CollapsibleGroup?u.ToggleDrop(!1,!0):(u.SetProperty("Visibility",!1),u.GetTE()&&u.GetTE().SetProperty("Visibility",!1)):u.MyBaseType===n.cdeControlType.CollapsibleGroup?u.ToggleDrop(!0,!0):(u.SetProperty("Visibility",!0),u.GetTE()&&u.GetTE().SetProperty("Visibility",!0))):u.MyBaseType===n.cdeControlType.TileButton&&typeof u.GetProperty("OnClick")=="string"&&(e=u.GetProperty("OnClick"),e==="GRP:"+i+":"+r?(u.GetElement().classList.contains("cdeTabSelected")||u.GetElement().classList.add("cdeTabSelected"),u.GetElement().classList.contains("cdeTabNotSelected")&&u.GetElement().classList.remove("cdeTabNotSelected")):e.startsWith("GRP:"+i)&&(u.GetElement().classList.contains("cdeTabNotSelected")||u.GetElement().classList.add("cdeTabNotSelected"),u.GetElement().classList.contains("cdeTabSelected")&&u.GetElement().classList.remove("cdeTabSelected"))),this.ToggleChildren(u,i,r))},i.prototype.FireControls=function(t){var l,a,u,f,w,o,v;if(!t||!t.Message)return!1;var b=(t.Message.TXT.substr(0,5)==="SETNP"||t.Message.TXT.substr(0,6)==="SETFNP")&&!!t.Message.PLS,s=t.Message&&t.Message.OWN?cde.GuidToString(t.Message.OWN):null,r=null,e,i;if(b){if(r=t.Message.PLS.split(":;:"),s&&r){var h=null,y=n.cdeControlType.BaseControl,p=-1,c=t.Message.TXT.split(":");t.Message.TXT.substr(0,6)==="SETFNP"&&c.length>1&&(h=cde.GuidToString(c[1]));c.length>2&&(l=c[2].split(";"),y=cde.CInt(l[0]),l.length>1&&(p=cde.CInt(l[1])));a=n.MyTCF.GetRegisteredControlGroup(s);for(e in a)if(a.hasOwnProperty(e)){if(i=a[e],h&&h!=="NULL"&&i&&e!==h)continue;for(u=0;u<r.length;u++)if(f=r[u].indexOf("="),w=f<0?r[u]:r[u].substr(0,f),f<0)i.SetProperty(r[u],!0);else if(f>0&&f<r[u].length&&(o="",f<r[u].length-1&&(o=r[u].substr(f+1)),o.substr(0,11)!=="&^CDESP1^&:")){if(y>0&&i.MyBaseType>0&&i.MyBaseType!==y)continue;if(p>=0&&i.MyTRF&&i.MyTRF.FldInfo&&i.MyTRF.FldInfo.FldOrder!==p)continue;i.GetTE()?n.ThePB.SetRawProperty(i.GetTE(),w.trim(),o.trim()):n.ThePB.SetRawProperty(i,w.trim(),o.trim())}}}}else if(s){v=n.MyNMIThingEvents[s];for(e in v)v.hasOwnProperty(e)&&(i=v[e],i.FireEvent(!1,"SETP",t))}else return!1;return!0},i.AddAdHocSmartControl=function(t,i,r,u,f,e){var s=new n.TheTRF("NOTABLE",0,n.TheFieldInfo.NewTFI(r,0,u,f,e)),o=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(t,{TRF:s});return o.CreateControl(i),o},i}(cde.TheMetaDataBase);n.TheControlFactory=t;n.MyTCF=new t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(i,r){var u=t.call(this)||this;return u.MyTarget=null,u.MyParentCtrl=null,u.MyDataView=null,u.MyNMIControl=null,u.MyTE=null,u.MyBaseType=n.cdeControlType.BaseControl,u.MyScreenID=null,u.MyFormID=null,u.MyEngineName=null,u.MyTRF=null,u.MyFieldInfo=null,u.TouchPoints=0,u.PreventManipulation=!1,u.PreventDefault=!1,u.Visibility=!0,u.IsDisabled=!1,u.Is3DObject=!1,u.IsDirty=!1,u.HasFacePlate=!1,u.MyWidth=0,u.MyHeight=0,u.lastXYById=[],u.MyChildren=[],u.MySubControls=[],u.WasClicked=!1,u.MyRenderTarget=null,u.MyDataItems=[],u.PropertyBag=[],i&&(u.MyTarget=i,u.MyFormID=i.MyFormID),u.MyTRF=r,r?(u.MyFieldInfo=r.FldInfo,u.PropertyBag.ID=r.FldInfo?cde.GuidToString(r.FldInfo.cdeMID):"CNMIC"+n.MyNMISettings.IDCounter++,r.FldInfo&&!u.MyFormID&&(u.MyFormID=r.FldInfo.FormID)):u.PropertyBag.ID="CNMIC"+n.MyNMISettings.IDCounter++,u.PropertyBag.Disabled=!1,u.PropertyBag.TouchPoints=0,u.PreventManipulation=!1,u.PropertyBag.AreEventsHooked=!1,u}return __extends(i,t),i.prototype.SetTRF=function(t,i){t?(this.MyTRF=t,t.FldInfo&&(this.MyFieldInfo=t.FldInfo,this.MyFieldInfo.FormID&&(this.MyFormID=this.MyFieldInfo.FormID),n.ThePB.ConvertPropertiesFromBag(this.MyFieldInfo,i))):!this.MyFieldInfo&&i&&(this.MyFieldInfo=new n.TheFieldInfo(this.MyBaseType),this.MyTRF=new n.TheTRF("",0,this.MyFieldInfo),n.ThePB.ConvertPropertiesFromBag(this.MyFieldInfo,i))},i.prototype.InitControl=function(n,t,i,r){var u=this;return n&&(this.MyTarget=n,this.MyTarget.MyChildren.push(this)),this.SetTRF(t,i),r&&(this.MyScreenID=cde.GuidToString(r)),!this.MyFormID&&n&&(this.MyFormID=n.MyFormID),this.RegisterEvent("NMI_SHAPE_RECOGNIZED",function(n,t,i){u.eventShapeRecognized(n,t,i)}),!0},i.prototype.eventShapeRecognized=function(t,i,r){if(cde.MyBaseAssets.MyServiceHostInfo.RedPill)if(r>1){n.ShowToastMessage("Name: "+i+" Score:"+r.toFixed(2));cde.MyEventLogger&&cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","ShapeRecognizer","Name: "+i+" Score:"+r.toFixed(2));switch(i){case"circle":case"rightmouse":this.SetProperty("Background","pink");var u=document.getElementById("cdeSideBarRight");u&&!u.classList.contains("cde-animate-right")&&(u.classList.add("cde-animate-right"),u.style.display="")}}else n.ShowToastMessage("Guess is : "+i+" but Score too low:"+r.toFixed(2))},i.prototype.SetProperty=function(t,i){var v=this,r,f,a,u,o,s,h,e,c,l;if(t==="PreventManipulation"){(typeof i=="undefined"||cde.CBool(i))&&(i=!0);this.PreventManipulation=i;return}if(t==="PreventDefault"||t==="EnableMT"){(typeof i=="undefined"||cde.CBool(i))&&(i=!0);this.PreventDefault=i;return}if(r=this.PropertyBag[t],t==="iValue"){r=this.PropertyBag.Value;this.PropertyBag.Value=i;i!==r&&this.FireEvent(!1,"OniValueChanged","SetProperty",i,t);return}if(this.PropertyBag[t]=i,t==="OnThingEvent"&&this.RegisterSetP(function(t,i){var f,r,h,u,c;if(i.Message.TXT.substr(0,4)==="SETP"||i.Message.TXT.substr(0,5)==="SETFP")for(f=i.Message.PLS.split(":;:"),r=0;r<f.length;r++){var e=f[r].indexOf("="),s="",o=!0;if(e<0)s=f[r],o=!0;else if(e>0&&e<f[r].length&&(s=f[r].substr(0,e),e<f[r].length+1&&(o=f[r].substr(e+1)),s.substr(0,11)==="&^CDESP1^&:"))continue;s.length>0&&s===t.GetProperty("OnThingEvent")&&(t.SetProperty("iValue",o),t.MyTRF&&(t.MyTRF.ModelID||t.MyScreenID)?(h=n.MyNMIModels[t.MyTRF.ModelID?t.MyTRF.ModelID:t.MyScreenID],h&&h.MyStorageMirror[t.MyTRF.TableName]&&n.UpdFldContent(h.MyStorageMirror[t.MyTRF.TableName][t.MyTRF.RowNo],t.MyFieldInfo,o,null)):(u=t.MyNMIControl,u&&u.MyTRF&&u.MyScreenID&&(c=n.MyNMIModels[u.MyScreenID],c&&c.MyStorageMirror[u.MyTRF.TableName]&&n.UpdFldContent(c.MyStorageMirror[u.MyTRF.TableName][u.MyTRF.RowNo],u.MyFieldInfo,o,null))),v.FireEvent(!0,"OnPropertyChanged","SetProperty",o,"iValue"))}}),t==="OniValueChanged")this.RegisterEvent("OniValueChanged",i),this.FireEvent(!0,"OniValueChanged","SetProperty",this.PropertyBag.Value,"Value");else{if(t==="OnValueChanged"){this.RegisterEvent("OnValueChanged",i);return}if(t==="OnPropertyChanged"){this.RegisterEvent("OnPropertyChanged",i);return}if(t==="OnPropertySet"){this.RegisterEvent("OnPropertySet",i);return}if(t==="RegisterEvent")f=i.split(":;:"),f.length>1&&this.RegisterEvent(f[0],f[1]);else if(t==="Value")i!==r&&(this.IsDirty=!0,this.FireEvent(!0,"OnValueChanged","SetProperty",i,this.MyTRF),this.FireEvent(!0,"OniValueChanged","SetProperty",i,t));else if(t==="Visibility"&&this.MyRootElement)i=cde.CBool(i),this.Visibility=i,typeof i=="undefined"||i?(this.MyRootElement.style.display="",this.OnLoad(this.Visibility)):(this.MyRootElement.style.display="none",this.OnUnload());else if(t==="IsOwnerDown")if(i===!0){if(this.GetProperty(t)===!0)return;this.mOldClassName=this.MyRootElement.className;this.MyRootElement.className+=" cdeNodeGone"}else{if(this.GetProperty(t)!==!0)return;this.MyRootElement.className=this.mOldClassName}else if(t==="Disabled"&&this.MyRootElement)this.IsDisabled=cde.CBool(i),this.MyRootElement.style.opacity=this.IsDisabled?"0.5":"1.0";else if(t==="Draggable")this.MyRootElement.draggable=cde.CBool(i);else if(t==="TID")this.PropertyBag.ID=i;else if((t==="ID"||t==="MID")&&i&&this.MyRootElement)this.MyRootElement.id=cde.GuidToString(i),this.PropertyBag.ID=i;else if(t==="ClassName"&&(i||i==="")&&this.MyRootElement)this.MyRootElement.className=i;else if(t==="AddClassName"&&(i||i==="")&&this.MyRootElement)this.MyRootElement.classList.contains(i)||this.MyRootElement.classList.add(i);else if(t==="RemoveClassName"&&(i||i==="")&&this.MyRootElement)this.MyRootElement.classList.contains(i)&&this.MyRootElement.classList.remove(i);else if(t==="TEClassName"&&(i||i===""))this.MyTE&&this.MyTE.MyNMIControl&&this.MyTE.MyNMIControl.SetProperty("ClassName",i);else if(t==="Display"&&i&&this.MyRootElement)this.MyRootElement.style.display=i;else if(t==="Style"&&i&&this.MyRootElement)this.MyRootElement.style.cssText+=i;else if(t==="Opacity"&&this.MyRootElement)this.MyRootElement.style.opacity=i;else if(t==="HorizontalAlignment"&&this.MyRootElement)this.MyRootElement.style.textAlign=i.toLowerCase();else if(t==="VerticalAlignment"&&this.MyRootElement)this.MyRootElement.style.verticalAlign=i.toLowerCase();else if(t==="Float"&&this.MyRootElement)this.MyRootElement.style.cssFloat=i;else if(t==="FontSize"&&this.MyRootElement)this.MyRootElement.style.fontSize=i+"px";else if(t==="Margin"&&this.MyRootElement)this.MyRootElement.style.margin=i+"px";else if(t==="Z-Index"&&this.MyRootElement)this.MyRootElement.style.zIndex=i.toString();else if(t==="PixelWidth"&&this.MyRootElement)i&&(this.MyRootElement.style.width=i.toString().endsWith("px")||i.toString().endsWith("%")||i==="auto"?i:i+"px");else if(t==="PixelHeight"&&this.MyRootElement)i&&(this.MyRootElement.style.height=i.toString().endsWith("px")||i.toString().endsWith("%")||i==="auto"?i:i+"px");else if(t==="TileFactorX"&&this.MyRootElement)this.SetInitialWidth(1);else if(t==="TileFactorY"&&this.MyRootElement)this.SetInitialHeight(1);else if(t==="TileWidth"&&this.MyRootElement)i=cde.CInt(i),i===0&&(i=1),a=0,this.SetWidth(this.MyRootElement,i,this.MyBaseType===n.cdeControlType.Screen?a:this.MyBaseType===n.cdeControlType.TileEntry?0:1);else if(t==="TileHeight"&&this.MyRootElement)i=cde.CInt(i),i<0?this.MyRootElement.style.height="inherit":(i<1&&(i=1),this.SetHeight(this.MyRootElement,i,this.MyBaseType===n.cdeControlType.Screen?0:this.MyBaseType===n.cdeControlType.TileEntry?0:1));else if(t==="MaxTileWidth"&&this.MyRootElement)i=cde.CInt(i),u=n.GetSizeFromTile(i),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1&&this.MyBaseType===n.cdeControlType.CollapsibleGroup&&this.MyFieldInfo&&this.MyFieldInfo.FldOrder===1&&cde.CBool(this.GetProperty("UseMargin"))===!0&&(o=Math.floor(i/6),o>0&&(u+=n.GetSizeFromTile(o)/2)),n.MyScreenManager&&n.MyScreenManager.DocumentWidth>0&&u>n.MyScreenManager.DocumentWidth&&(u=n.MyScreenManager.DocumentWidth-n.GetSizeFromTile(1)),this.MyRootElement.style.maxWidth=u+"px";else if(t==="BackgroundImage"&&this.MyRootElement)i.substr(0,1)==="{"?(s=null,s=JSON.parse(i),this.MyRootElement.style.backgroundImage="url('data:image/jpeg;base64,"+s.Bits+"')"):this.MyRootElement.style.backgroundImage="url('"+i+"')";else if(t==="TileLeft"&&this.MyRootElement)i=cde.CInt(i),this.MyRootElement.style.left=(n.GetSizeFromTile(1)*i+n.MyNMISettings.TileMargin*(i*2+1)).toString()+"px";else if(t==="TileTop"&&this.MyRootElement)i=cde.CInt(i),this.MyRootElement.style.top=(n.GetSizeFromTile(1)*i+n.MyNMISettings.TileMargin*(i*2+1)).toString()+"px";else if(t==="Top"&&this.MyRootElement)i=cde.CInt(i),this.MyRootElement.style.top=i.toString()+"px";else if(t==="Left"&&this.MyRootElement)i=cde.CInt(i),this.MyRootElement.style.left=i.toString()+"px";else if(t==="Right"&&this.MyRootElement)i=cde.CInt(i),this.MyRootElement.style.right=i.toString()+"px";else if(t==="IsAbsolute"&&this.MyRootElement)this.MyRootElement.style.position=cde.CBool(i)?"absolute":"relative";else if(t==="IsHitTestDisabled"&&this.MyRootElement)this.MyRootElement.style.pointerEvents=cde.CBool(i)?"none":"";else if(t==="NUITags"&&i&&n.MyEngine)for(h=i.toString().split(";"),e=0;e<h.length;e++)n.MyNMINUITags[h[e]]=this;else t==="EngineName"&&i&&i!==""&&(this.MyEngineName=i)}i!==r&&(this.FireEvent(!0,"OnPropertyChanged","SetProperty",i,t),c=this.GetProperty(t+"_TCB"),c&&(l=document.getElementById(c.TargetID),l&&(l.innerHTML=i)));this.FireEvent(!0,"OnPropertySet","SetProperty",i,t)},i.prototype.SetToDefault=function(n){return n&&!cde.IsNotSet(this.GetProperty("Value"))?null:this.MyFieldInfo&&this.MyFieldInfo.DefaultValue?(this.SetProperty("iValue",this.MyFieldInfo.DefaultValue),this.MyFieldInfo.DefaultValue):(this.SetProperty("iValue",null),null)},i.prototype.toJSON=function(){var i=[],t=this.PropertyBag,n,r;for(n in t)t.hasOwnProperty(n)&&(r={N:n,V:t[n]},i.push(r));return{PropertyBag:i,ScreenID:this.MyScreenID,TRF:this.MyTRF,EngineName:this.MyEngineName,BaseType:this.MyBaseType,FieldInfo:this.MyFieldInfo}},i.prototype.RegisterIncomingMessage=function(t,i){var r=this.RegisterNMIControl();this.MyEngineName=t;n.MyEngine&&n.MyEngine.RegisterIncomingMsg(this,r,t);this.RegisterEvent("IncomingMessage",i)},i.prototype.RegisterNMIControl=function(){var t=this.GetProperty("UXID"),i;if(!t)if(this.MyFieldInfo&&this.MyFieldInfo.cdeMID)t=this.MyFieldInfo.cdeMID;else return null;return t=cde.GuidToString(t),i=cde.GuidToString(this.GetProperty("ID")),n.MyTCF&&n.MyTCF.RegisterControl(t,i,this),i},i.prototype.RegisterThingSetP=function(t,i){var r=cde.GuidToString(t),u=cde.GuidToString(this.GetProperty("ID"));this.SetProperty("MyThing",r);n.MyNMIThingEvents[r]||(n.MyNMIThingEvents[r]=[]);n.MyNMIThingEvents[r][u]=this;this.SetProperty("OnThingEvent",i)},i.prototype.RegisterSetP=function(n){this.RegisterNMIControl();this.RegisterEvent("SETP",n)},i.prototype.Create=function(t,i){try{i?(i.Cookie&&this.SetProperty("Cookie",i.Cookie),this.InitControl(t,i.TRF,i.PreInitBag,i.ScreenID),i.PostInitBag&&n.ThePB.SetPropertiesFromBag(this,i.PostInitBag)):this.InitControl(t)}catch(r){return cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","BaseControl:Create","Failed with Exception:"+r),null}return this},i.prototype.SetTE=function(n){this.MyTE=n},i.prototype.GetTE=function(){return this.MyTE},i.prototype.ReloadData=function(){return!1},i.prototype.ToggleDrop=function(){},i.prototype.SetElement=function(t,i,r,u){t?this.MyRootElement=t:this.MyTarget&&(this.MyRootElement=this.MyTarget.GetContainerElement());r&&(this.MyContainerElement=r);this.MyTarget&&this.MyTarget.GetContainerElement()&&this.MyTarget.GetContainerElement()!==this.MyRootElement&&this.MyTarget.AppendElement(t);i&&this.GetSetting("Disabled")!==!0&&this.HookEvents(!1);this.MyFieldInfo&&cde.CBool(u)!==!0&&this.GetSetting("OnLoaded")&&n.MyEngine&&n.MyEngine.PublishToNMI("NMI_FLD_LOADED:"+this.MyFieldInfo.cdeMID,this.GetSetting("OnLoaded"),this.cdeN)},i.prototype.DeleteControl=function(n){n&&this.GetContainerElement()&&n.GetContainerElement().parentElement===this.MyRootElement&&this.GetContainerElement().removeChild(n.GetElement())},i.prototype.AppendChild=function(n){n&&this.GetContainerElement()&&this.GetContainerElement().appendChild(n.GetElement())},i.prototype.RemoveChild=function(n){n&&this.GetContainerElement().removeChild(n.GetElement())},i.prototype.AppendElement=function(n){this.GetContainerElement().appendChild(n)},i.prototype.HookEvents=function(t){var i=this;this.PropertyBag.AreEventsHooked!==!0&&(this.PropertyBag.AreEventsHooked=!0,this.MyRootElement.addEventListener("selectstart",function(t){n.StopPointerEvents(t)},t),this.MyRootElement.addEventListener("contextmenu",function(t){n.StopPointerEvents(t)},t),this.MyRootElement.addEventListener("MSHoldVisual",function(t){n.StopPointerEvents(t)},t),this.MyRootElement.addEventListener("keyup",function(n){return i.sinkDoKey(n)},t),this.MyRootElement.addEventListener("keydown",function(n){return i.sinkDoKey(n)},t),n.MyNMISettings.SupportsPointer?(this.MyRootElement.addEventListener("pointerdown",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("pointermove",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("pointerup",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("pointercancel",function(n){return i.sinkDoEvent(n)},t),this.PropertyBag.IsPointerOutAllowed!==!0&&this.MyRootElement.addEventListener("pointerout",function(n){return i.sinkDoEvent(n)},t)):window.navigator.msPointerEnabled?(this.MyRootElement.addEventListener("MSPointerDown",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("MSPointerMove",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("MSPointerUp",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("MSPointerCancel",function(n){return i.sinkDoEvent(n)},t),this.PropertyBag.IsPointerOutAllowed!==!0&&this.MyRootElement.addEventListener("MSPointerOut",function(n){return i.sinkDoEvent(n)},t)):this.MyRootElement.addEventListener&&(this.MyRootElement.addEventListener("touchstart",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("touchmove",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("touchend",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("touchcancel",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("mousedown",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("mousemove",function(n){return i.sinkDoEvent(n)},t),this.MyRootElement.addEventListener("mouseup",function(n){return i.sinkDoEvent(n)},t),this.PropertyBag.IsPointerOutAllowed!==!0&&this.MyRootElement.addEventListener("mouseleave",function(n){return i.sinkDoEvent(n)},t)))},i.prototype.PreventDefaultManipulationAndMouseEvent=function(t){var i;this.PreventDefault?(n.StopPointerEvents(t),i=this.MyRootElement.style,i.touchAction="none"):(i=this.MyRootElement.style,i.touchAction="auto");t&&this.PreventManipulation&&(t.preventManipulation&&t.preventManipulation(),t.preventMouseEvent&&t.preventMouseEvent())},i.GetControlXY=function(n){for(var t=n,r=0,u=0,i,f;t&&!isNaN(t.offsetLeft)&&!isNaN(t.offsetTop);)f=window,i=f.globalStorage?null:window.getComputedStyle(t,null),r+=t.offsetLeft-t.scrollLeft+(i?parseInt(i.getPropertyValue("border-left-width"),10):0),u+=t.offsetTop-t.scrollTop+(i?parseInt(i.getPropertyValue("border-top-width"),10):0),t=t.offsetParent;return{x:n.X=r,y:n.Y=u}},i.findPos=function(n,t,r){var f=0,e=0,o,u;return n.offsetLeft&&(f+=parseInt(n.offsetLeft)),n.offsetTop&&(e+=parseInt(n.offsetTop)),n.scrollTop&&n.scrollTop>0&&(e-=parseInt(n.scrollTop),r=!0),n.scrollLeft&&n.scrollLeft>0&&(f-=parseInt(n.scrollLeft),t=!0),n.offsetParent?(o=i.findPos(n.offsetParent,t,r),f+=o.x,e+=o.y):n.ownerDocument&&(u=n.ownerDocument.defaultView,!u&&n.ownerDocument.parentWindow&&(u=n.ownerDocument.parentWindow),u&&(!r&&u.scrollY&&u.scrollY>0&&(e-=parseInt(u.scrollY)),!t&&u.scrollX&&u.scrollX>0&&(f-=parseInt(u.scrollX)),u.frameElement&&(o=i.findPos(u.frameElement,0,0),f+=o.x,e+=o.y))),{x:f,y:e}},i.prototype.EnsurePageXY=function(t){if(typeof t.pageX=="undefined"){var i=n.ThePointer.ComputeDocumentToElementDelta(this.MyRootElement);t.pageX=t.offsetX+i.x;t.pageY=t.offsetY+i.y}},i.prototype.GetTouchPointer=function(n){var t=this.lastXYById;for(var i in t)if(t.hasOwnProperty(i)&&t[i]&&t[i].Identifier===n)return t[i];return null},i.prototype.GetTouchPointerIdx=function(n){var t=this.lastXYById;for(var i in t)if(t.hasOwnProperty(i)&&t[i]&&t[i].Identifier===n)return parseInt(i);return-1},i.prototype.sinkDoKey=function(n){switch(n.type){case"keyup":this.FireEvent(!0,"KeyUp",n);break;case"keydown":this.FireEvent(!0,"KeyDown",n)}},i.prototype.sinkDoEvent=function(t){var o,s,l,h,u,c,r,i,f;if(!cde.CBool(this.GetProperty("IsHitTestDisabled"))&&!cde.CBool(this.GetProperty("IsUnhooked"))&&(t.type!=="mousemove"||this.lastXYById.length!==0||cde.CBool(this.GetProperty("AllowMoveWithoutDown")))){var e=t.type.match(/(start|down)$/i)!==null,a=t.type.match(/move$/i)!==null,v=t.type.match(/(up|end|cancel|out|leave)$/i)!==null,y=t.type.match(/(cancel|out|leave)$/i)!==null;for(e&&t.buttons===1&&(n.IsMouseDown=!0),v&&t.buttons===0&&(n.IsMouseDown=!1),o=n.cdeInputEvent.IDLE,o=e?n.cdeInputEvent.START:a?n.cdeInputEvent.MOVE:n.cdeInputEvent.END,(this.PreventManipulation||this.PreventDefault)&&this.PreventDefaultManipulationAndMouseEvent(t),s=t.changedTouches?t.changedTouches:[t],l=this.lastXYById.length,e&&(l+=s.length),this.TouchPoints=l,h=0;h<s.length;++h)if(u=s[h],c=typeof u.identifier!="undefined"?u.identifier:typeof u.pointerId!="undefined"?u.pointerId:1,this.EnsurePageXY(u),r=null,r=this.GetProperty("IsOverlay")===!0?new n.ThePointer(this.MyRootElement,c,u.clientX,u.clientY,0,this.GetStrokeWidth(t),this.GetEventType(t),o,t.buttons):new n.ThePointer(this.MyRootElement,c,u.pageX,u.pageY,0,this.GetStrokeWidth(t),this.GetEventType(t),o,t.buttons),i=this.GetTouchPointer(c),f=void 0,e)i?(f=this.GetTouchPointerIdx(i.Identifier),this.lastXYById.splice(f,1),this.HasEvent("PointerUp")&&t.currentTarget!==document&&(i.Update(this.MyRootElement,r.Position),i.pointerEvent=n.cdeInputEvent.END,n.MyNMISettings.IsScrolling||this.FireEvent(!0,"PointerUp",t,i))):i=r,this.lastXYById.push(i),this.HasEvent("PointerDown")&&(t.type==="mousedown"||t.currentTarget!==document)&&(i.Update(this.MyRootElement,r.Position),i.pointerEvent=r.pointerEvent,n.MyNMISettings.IsScrolling||this.FireEvent(!0,"PointerDown",t,i),this.PreventDefault&&n.StopPointerEvents(t));else if(a)!i||i.Position.x===r.Position.x&&i.Position.y===r.Position.y?!i&&cde.CBool(this.GetProperty("AllowMoveWithoutDown"))&&(i=r,this.lastXYById.push(i),this.HasEvent("PointerMove")&&(t.type==="mousemove"||t.currentTarget!==document)&&(n.MyNMISettings.IsScrolling||this.FireEvent(!0,"PointerMove",t,r),this.PreventDefault&&n.StopPointerEvents(t))):(i.Update(this.MyRootElement,r.Position),i.pointerEvent=r.pointerEvent,this.HasEvent("PointerMove")&&(t.type==="mousemove"||t.currentTarget!==document)&&(n.MyNMISettings.IsScrolling||this.FireEvent(!0,"PointerMove",t,i),this.PreventDefault&&n.StopPointerEvents(t)));else if(v&&i){if(n.MyTouchOverlay&&(!n.MyTouchOverlay.CurrentControl||!(n.MyTouchOverlay.CurrentControl===this||n.MyTouchOverlay.CurrentControl.MyNMIControl===this))&&(n.MyTouchOverlay.MyBaseType===this.MyBaseType||cde.CInt(this.GetElement().style.zIndex)<1e3)){this.PreventDefault&&n.StopPointerEvents(t);n.MyNMISettings.IsScrolling||n.MyTouchOverlay.FireEvent(!1,"Touched");f=this.GetTouchPointerIdx(i.Identifier);this.lastXYById.splice(f,1);break}this.HasEvent("PointerUp")&&!y&&(t.type==="mouseup"||t.currentTarget!==document)?(i.Update(this.MyRootElement,r.Position),i.pointerEvent=r.pointerEvent,n.MyNMISettings.IsScrolling||this.FireEvent(!0,"PointerUp",t,i),n.StopPointerEvents(t)):this.HasEvent("PointerCancel")&&y&&(t.type==="mouseup"||t.currentTarget!==document)&&(i.Update(this.MyRootElement,r.Position),i.pointerEvent=r.pointerEvent,n.MyNMISettings.IsScrolling||this.FireEvent(!0,"PointerCancel",t,i),this.PreventDefault&&n.StopPointerEvents(t));f=this.GetTouchPointerIdx(i.Identifier);this.lastXYById.splice(f,1)}this.TouchPoints=this.lastXYById.length}},i.prototype.GetEventType=function(t){var i=t;if(i.mozInputSource)switch(i.mozInputSource){case 6:return n.cdeInputEventType.KEYBOARD;case 3:return n.cdeInputEventType.ERASER;case 2:return n.cdeInputEventType.PEN;case 5:return n.cdeInputEventType.TOUCH;case 1:return n.cdeInputEventType.MOUSE;default:return n.cdeInputEventType.UNKOWN}else if(i.pointerType){if(i.buttons&&(i.buttons&32)!=0)return n.cdeInputEventType.ERASER;if(typeof i.pointerType=="string")switch(i.pointerType){case"touch":return n.cdeInputEventType.TOUCH;case"pen":return n.cdeInputEventType.PEN;case"mouse":return n.cdeInputEventType.MOUSE;default:return n.cdeInputEventType.UNKOWN}else switch(i.pointerType){case i.MSPOINTER_TYPE_TOUCH:return n.cdeInputEventType.TOUCH;case i.MSPOINTER_TYPE_PEN:return n.cdeInputEventType.PEN;case i.MSPOINTER_TYPE_MOUSE:return n.cdeInputEventType.MOUSE;default:return n.cdeInputEventType.UNKOWN}}return n.cdeInputEventType.MOUSE},i.prototype.GetStrokeWidth=function(n){var t=20,i=n,r;if(i.mozInputSource){r=.5;i.mozPressure&&(r=i.mozPressure);switch(i.mozInputSource){case 3:t=r*50;break;case 2:t=r*20;break;case 5:t=20*r;break;case 1:t=5}}else if(i.pointerType)if(typeof i.pointerType=="string")switch(i.pointerType){case"touch":t=20*i.pressure;t<1&&(t=20);break;case"pen":t=i.pressure*20;t<1&&(t=1);break;case"mouse":t=5}else switch(i.pointerType){case i.MSPOINTER_TYPE_TOUCH:t=20*i.pressure;t<1&&(t=20);break;case i.MSPOINTER_TYPE_PEN:t=i.pressure*20;t<1&&(t=1);break;case i.MSPOINTER_TYPE_MOUSE:t=5}return i.touches&&i.touches.length>0&&i.touches[0].force&&(t=20*i.touches[0].force,t<1&&(t=1)),t},i.prototype.DoFireClick=function(t,i,r){if(t&&t.HasEvent("OnClick")){var u=t.GetProperty("TouchPoints");(!r||(r.IsOnObject||cde.CBool(t.GetProperty("IgnoreHitTarget")))&&r.PathLength()<n.MyNMISettings.DeadPathLength)&&(t.WasClicked=!0,window.setTimeout(function(){t.FireEvent(!0,"OnClick",i,u,t.GetProperty("Cookie"),t.GetProperty("Parent"))},100))}},i.prototype.SetDataItem=function(n,t){this.MyDataItems[n]=t},i.prototype.OnLoad=function(n){this.SetProperty("IsUnloaded",!1);for(var t in this.MyChildren)this.MyChildren[t].SetProperty("TabIndex",this.MyChildren[t].MyFieldInfo?this.MyChildren[t].MyFieldInfo.FldOrder+101:100),this.MyChildren[t].OnLoad(n)},i.prototype.OnUnload=function(){this.SetProperty("IsUnloaded",!0);for(var n in this.MyChildren)this.MyChildren[n].SetProperty("TabIndex",-1),this.MyChildren[n].OnUnload()},i.prototype.GetSetting=function(t,i,r){var u=null;if(this.MyFieldInfo){if(u=this.MyFieldInfo[t],u&&r===!0)try{u=JSON.parse(u)}catch(f){u=null}if(!u&&this.MyFieldInfo.PropertyBag&&(u=n.ThePB.GetValueFromBagByName(this.MyFieldInfo.PropertyBag,t),u&&r===!0))try{u=JSON.parse(u)}catch(e){u=null}}return!u&&i&&(u=i),u},i.prototype.GetProperty=function(n){return n==="PreventManipulation"?this.PreventManipulation:n==="PreventDefault"||n==="EnableMT"?this.PreventDefault:n==="TouchPoints"?this.TouchPoints:this.PropertyBag[n]!==undefined?this.PropertyBag[n]:this.MyFieldInfo&&this.MyFieldInfo[n]?this.MyFieldInfo[n]:null},i.prototype.GetElement=function(){return this.MyRootElement},i.prototype.GetContainerElement=function(){return this.MyContainerElement?this.MyContainerElement:this.MyRootElement},i.prototype.ApplySkin=function(){},i.prototype.PostCreate=function(){},i.prototype.OnNUITag=function(){},i.prototype.FindRenderTarget=function(n){var t=this;this.MyRootElement&&(this.MyRenderTarget=document.getElementById(n),this.MyRenderTarget?(this.MyRootElement.parentNode.removeChild(this.MyRootElement),this.MyRenderTarget.children.length===0&&(this.MyRenderTarget.appendChild(this.MyRootElement),this.SetProperty("Visibility",!0))):setTimeout(function(){t.MyRenderTarget||t.FindRenderTarget(n)},1e3))},i.prototype.ShowFieldContent=function(t,i,r){var u,f,v,k,s,a,p,e,g,nt,tt,o,c,l,w,b,h,d,it,y;if(i||(i=this.MyFieldInfo),r||(r=this.MyScreenID),i&&(i.Flags&1)!=0)return t&&t.length!==0?"*****":"";if(!cde.IsNotSet(t)){if(i){u=void 0;f=void 0;switch(i.Type){case n.cdeControlType.Curreny:t=t?"$"+parseFloat(t).toFixed(2):"Zero";break;case n.cdeControlType.DateTime:if(t){if(v=n.cdeJsonDate2JSDate(t),v.toString()!=="Invalid Date")if(v.getFullYear()<2)t="";else try{t=i.Format?n.FormatDate(v,i.Format):n.FormatDate(v,"YYYY-MM-DD HH:mm:ss")}catch(rt){t=v.toLocaleDateString()+" "+v.toLocaleTimeString()}}else t="&nbsp;";break;case n.cdeControlType.Number:t?(f=i.Format,cde.IsNotSet(f)||(t=parseFloat(t).toFixed(parseInt(f)))):t="0";break;case n.cdeControlType.SingleCheck:u=null;u=i.Options;u||(u="true;false");k=u.split(";");t=cde.CBool(t)?k[0]:k.length>1?k[1]:"";break;case n.cdeControlType.ComboLookup:if(a=cde.GuidToString(this.GetSetting("StorageTarget")),p=r,this.GetSetting("ModelID")&&(p=this.GetSetting("ModelID")),e=n.MyNMIModels[cde.GuidToString(p)],e&&e.MyStorageMirror[a]){for(o=0;o<e.MyStorageMirror[a].length;o++)if(c=e.MyStorageMirror[a][o],l=n.GetFldContentByName(c,this.GetSetting("ValueFld"),!1),l&&cde.GuidToString(l)===cde.GuidToString(t))return n.GetFldContentByName(c,this.GetSetting("NameFld"),!1)}else return t;break;case n.cdeControlType.ComboBox:if(u=this.GetProperty("OptionsLive"),u||(u=this.GetSetting("OptionsLive")),u||(u=this.GetProperty("Options")),u||(u=this.GetSetting("Options")),u)if(u.substr(0,6)==="LOOKUP"){if(s=u.split(":"),s.length===2)switch(s[1]){case"THINGPICKER":s="LOOKUP:b510837f-3b75-4cf2-a900-d36c19113a13:MyPropertyBag.FriendlyName.Value:cdeMID:MyPropertyBag.DeviceType.Value:FAFA22FF-96AC-42CF-B1DB-7C073053FC39".split(":")}if(s.length<3)break;else if(a=cde.GuidToString(s[1]),p=r,s.length>5&&(p=s[5]),e=n.MyNMIModels[cde.GuidToString(p)],e&&e.MyStorageMirror[a]){for(o=0;o<e.MyStorageMirror[a].length;o++)if(c=e.MyStorageMirror[a][o],l=n.GetFldContentByName(c,s[3],!1),l&&cde.GuidToString(l)===cde.GuidToString(t))return n.GetFldContentByName(c,s[2],!1)}else{if(g=i.DisplayField,g&&e.MyStorageMirror[cde.GuidToString(i.FormID)])for(nt=e.MyStorageMirror[cde.GuidToString(i.FormID)],o=0;o<nt.length;o++)if(c=nt[o],l=n.GetFldContentByName(c,s[3],!1),l&&cde.GuidToString(l)===cde.GuidToString(t)&&(tt=n.GetFldContentByName(c,g,!1),tt))return tt;return t}}else for(this.GetProperty("LiveOptions")&&(u=this.GetProperty("LiveOptions")),!u&&this.GetProperty("OptionsLive")&&(u=this.GetProperty("OptionsLive")),w=u.split(";:;"),b=0;b<w.length;b++)if(h=void 0,w[b].substr(0,1)==="["){for(d=JSON.parse(w[b]),h=0;h<d.length;h++)if(d[h].V===t)return d[h].N}else{for(it=w[b].split(";"),h=0;h<it.length;h++)if(!(w.length>1)||h!==0)if(y=it[h].split(":"),y.length>1){if(t===y[1]||(!t||t==="")&&y[1]==="0")return y[0]}else if(t===y[0])return y[0];u.substr(0,12)==="SCREENPICKER"&&n.MyEngine&&n.MyEngine.PublishToNMI("NMI_GET_DATA:SCREENRESOLVE:"+this.GetProperty("ID")+":"+this.GetProperty("UXID")+":"+t,"",this.MyFieldInfo?this.MyFieldInfo.cdeN:null)}break;case n.cdeControlType.ThingPicker:return this.GetNameFromValue(t);default:t&&(i.Flags&256)==0&&(t=n.cdeEscapeHtml(t));f=i.Format;f||(f=this.GetProperty("Format"));cde.IsNotSet(f)||(cde.CInt(f)>0?t&&t.length>parseInt(f)&&(t=isNaN(Number(t))===!0?t.substr(0,parseInt(f)):cde.CDbl(t).toFixed(parseInt(f))):(t=f.format(t),this.GetProperty("Cookie")&&(t=n.GenerateFinalString(t,this.GetProperty("Cookie"))),t=n.GenerateFinalString(t,null,this.MyTRF)))}}return t}return""},i.prototype.GetNameFromValue=function(n){return n.length===0?n:this.GetProperty("ThingFriendlyName")?this.GetProperty("ThingFriendlyName"):n},i.prototype.SetInitialSize=function(n){n===void 0&&(n=1);this.SetInitialWidth(n);this.SetInitialHeight(n)},i.prototype.SetInitialWidth=function(n){n===void 0&&(n=1);var t=cde.CInt(this.GetSetting("ControlTW"));return t===0&&this.GetProperty("ControlTW")&&(t=cde.CInt(this.GetProperty("ControlTW"))),this.GetSetting("TileWidth")&&(t=cde.CInt(this.GetSetting("TileWidth"))),t===0&&this.GetProperty("TileWidth")&&(t=cde.CInt(this.GetProperty("TileWidth"))),this.SetWidth(this.GetElement(),t,n)},i.prototype.SetInitialHeight=function(n){n===void 0&&(n=1);var t=cde.CInt(this.GetSetting("ControlTH"));return t===0&&this.GetProperty("ControlTH")&&(t=cde.CInt(this.GetProperty("ControlTH"))),this.GetSetting("TileHeight")&&(t=cde.CInt(this.GetSetting("TileHeight"))),t===0&&this.GetProperty("TileHeight")&&(t=cde.CInt(this.GetProperty("TileHeight"))),this.SetHeight(this.GetElement(),t,n)},i.prototype.IsAChildBigger=function(t){for(var i in this.MyChildren)if(this.MyChildren[i].MyBaseType!==n.cdeControlType.Table&&((this.MyChildren[i].MyBaseType!==n.cdeControlType.CollapsibleGroup||cde.CBool(this.MyChildren[i].GetProperty("AllowHorizontalExpand"))===!1)&&cde.CInt(this.MyChildren[i].GetSegmentWidth())>t||this.MyChildren[i].IsAChildBigger(t)===!0))return!0;return!1},i.prototype.IsAParentSmaller=function(t){return this.MyTarget&&(this.MyTarget.MyBaseType!==n.cdeControlType.CollapsibleGroup||cde.CBool(this.MyTarget.GetProperty("AllowHorizontalExpand"))===!1)&&(cde.CInt(this.MyTarget.GetSegmentWidth())<t||this.MyTarget.IsAParentSmaller(t)===!0)?!0:!1},i.prototype.GetSegmentWidth=function(){var t=n.GetSizeFromTile(this.GetProperty("TileWidth"));return cde.CInt(this.GetProperty("TileFactorX"))>1?t/=cde.CInt(this.GetProperty("TileFactorX")):cde.CInt(this.GetSetting("TileFactorX"))>1&&(t/=cde.CInt(this.GetSetting("TileFactorX"))),Math.floor(t/n.GetSizeFromTile(6))},i.prototype.SetWidth=function(t,i,r,u){var f,e;return(r===void 0&&(r=1),u===void 0&&(u=!1),i>0)?(this.GetProperty("MaxTileWidth")&&i>cde.CInt(this.GetProperty("MaxTileWidth"))&&(i=cde.CInt(this.GetProperty("MaxTileWidth"))),this.GetProperty("MinTileWidth")&&i<cde.CInt(this.GetProperty("MinTileWidth"))&&(i=cde.CInt(this.GetProperty("MinTileWidth"))),f=n.GetSizeFromTile(i),cde.CInt(this.GetProperty("TileFactorX"))>1?f/=cde.CInt(this.GetProperty("TileFactorX")):cde.CInt(this.GetSetting("TileFactorX"))>1&&(f/=cde.CInt(this.GetSetting("TileFactorX"))),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1&&this.MyBaseType===n.cdeControlType.CollapsibleGroup&&this.MyFieldInfo&&this.MyFieldInfo.FldOrder===1&&cde.CBool(this.GetProperty("UseMargin"))===!0&&(e=Math.floor(i/6),e>0&&(f+=n.GetSizeFromTile(e)/2)),!u&&n.MyScreenManager&&n.MyScreenManager.DocumentWidth>0&&f>n.MyScreenManager.DocumentWidth&&(f=n.MyScreenManager.DocumentWidth-n.GetSizeFromTile(1)),t&&(t.style.width=f+"px",this.MyWidth=f),f):-1},i.prototype.SetHeight=function(t,i,r){if(r===void 0&&(r=1),i>0){this.GetProperty("MaxTileHeight")&&i>cde.CInt(this.GetProperty("MaxTileHeight"))&&(i=cde.CInt(this.GetProperty("MaxTileHeight")));this.GetProperty("MinTileHeight")&&i<cde.CInt(this.GetProperty("MinTileHeight"))&&(i=cde.CInt(this.GetProperty("MinTileHeight")));var u=n.GetSizeFromTile(i)-r;return cde.CInt(this.GetProperty("TileFactorY"))>1?u/=cde.CInt(this.GetProperty("TileFactorY")):cde.CInt(this.GetSetting("TileFactorY"))>1&&(u/=cde.CInt(this.GetSetting("TileFactorY"))),t&&(t.style.height=u+"px"),this.MyHeight=u,u}return t&&(t.style.height="inherit"),-1},i.GetTileEntry=function(n){for(var i,r=n.getElementsByTagName("*"),t=0,u=r.length;t<u;t++)if(i=r[t],i.className==="cdeTileEntryText")return i;return null},i.SetPropertiesFromBag=function(t,i,r,u,f){return n.ThePB.SetPropertiesFromBag(t,i,r,u,f)},i}(cde.TheThing);n.TheNMIBaseControl=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.divDragContent=null,i.mDragButton=null,i.pos1=0,i.pos2=0,i.pos3=0,i.pos4=0,i.oldz="",i.oldBC="",i.IsDragging=!1,i.MyScreenDIV=null,i.MyScreen=null,i.mDivDashboardContent=null,i.DisallowHeaderToggle=!1,i.mIsInitialized=!1,i.IsIFrame=!1,i.MyHostNode="",i.MyRefreshButton=null,i.MySavePin=null,i.MyRefreshPin=null,i.MyCloseButton=null,i.MyPinButton=null,i.MyDrawPin=null,i.MyOverlay=null,i.MyPinArea=null,i.MyScreenTitle=null,i.HasRenderTarget=!1,i.oldTop=0,i.oldLeft=0,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,a,l,s,b,h,p,o,w,c,v,y;return this.MyBaseType=n.cdeControlType.Screen,t.prototype.InitControl.call(this,i,r,u,f),a=this.GetSetting("RenderTarget"),this.divDragContent=document.getElementById("Screen_"+this.MyScreenID),this.divDragContent?(this.divDragContent.style.position="relative",this.MyScreenDIV=this.divDragContent,this.SetElement(this.MyScreenDIV)):(this.divDragContent=document.createElement("div"),this.divDragContent.id="Screen_"+this.MyScreenID,this.divDragContent.style.position="relative",l=this.GetSetting("DashBoardID"),document.getElementById(a)?this.HasRenderTarget=!0:a="MyDashboard"+(l?l:""),s=document.getElementById(a),s||(s=document.createElement("div"),s.className="cdeMyDashboard",s.id="MyDashboard"+(l?l:""),b=document.getElementsByTagName("body"),b?document.body.insertBefore(s,document.body.firstChild):document.appendChild(document.createElement("body")).appendChild(s)),cde.CBool(this.GetSetting("AllowDrag"))?(this.MyScreenDIV=document.createElement("div"),this.MyScreenDIV.style.position="absolute",this.MyScreenDIV.style.overflow="hidden",this.MyScreenDIV.style.zIndex="400",this.divDragContent.appendChild(this.MyScreenDIV),s.appendChild(this.divDragContent),this.SetElement(this.divDragContent,!1,this.MyScreenDIV)):(this.MyScreenDIV=this.divDragContent,s.appendChild(this.MyScreenDIV),this.SetElement(this.MyScreenDIV))),this.MyScreen=this.MyScreenDIV,this.MyScreenDIV.className=cde.MyBaseAssets.MyServiceHostInfo.ScreenClassName,this.GetSetting("ScreenClassName")&&(this.MyScreenDIV.className=this.GetSetting("ScreenClassName")),cde.CBool(this.GetSetting("ShowFullScreen"))===!0&&(this.MyScreenDIV.style.width="100%"),this.divDragContent.classList.add("cde-animate-opacity"),cde.CBool(this.GetSetting("NeverHide"))||cde.CBool(this.GetSetting("HidePins"))||cde.MyBaseAssets.MyServiceHostInfo.HideHeader||cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===2||cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===4||(h=cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===5,this.MyPinArea=n.MyTCF.CreateBaseControl().Create(this),p=document.createElement("div"),p.className=h?"cdePinAreaTesla":"cdePinArea",this.MyPinArea.SetElement(p),this.MyScreenTitle=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.MyPinArea,{ScreenID:this.MyScreenID,PreInitBag:["Element=h1"],PostInitBag:[this.GetSetting("ScreenTitle")?"iValue="+this.GetSetting("ScreenTitle"):"","ClassName=cdeScreenTitle"]}),o=n.MyTCF.CreateBaseControl().Create(this.MyPinArea),w=document.createElement("div"),w.className="cdeAllPinArea",o.SetElement(w),this.HasRenderTarget||(cde.CBool(this.GetSetting("HidePinPins"))?cde.CBool(this.GetSetting("IsPopup"))===!0&&(this.MyCloseButton=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(o,{ScreenID:this.MyScreenID,PostInitBag:["Right=0","Top=6","ClassName=cdeDivSave"]}),this.MyCloseButton.SetProperty("OnClick",function(){n.MyScreenManager&&n.MyScreenManager.TransitToScreen(e.GetProperty("OldScreen"))}),this.MyCloseButton.SetProperty("Content","<i class='fa'>&#xf410;<\/i>")):(this.MyPinButton=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(o,{ScreenID:this.MyScreenID,PostInitBag:["iValue="+(this.GetSetting("IsPinned")===!0),"Right=0","Top=6"]}),this.MyPinButton.SetProperty("OnClick",function(t,i){var r,u;if(i.button===2){if(!n.MyScreenManager)return;r=n.MyScreenManager.GetScreenByID(e.MyScreenID);r&&(n.MyPopUp?n.MyPopUp.Show("Are you sure you want to make this screen your home screen? ",!1,null,1,function(n,t,i){e.SaveHomeScreen(i)},null,r):e.SaveHomeScreen(r))}else cde.CBool(e.GetProperty("IsPinned"))?(n.MyScreenManager&&(e!==n.MyScreenManager.GetCurrentScreen()||n.MyScreenManager.AreScreensPinned(e)>0)&&(e.SetProperty("Visibility",!1),e===n.MyScreenManager.GetCurrentScreen()&&(u=n.MyScreenManager.FindPinnedScreen(),u&&n.MyScreenManager.SetCurrentScreen(u))),e.SetProperty("IsPinned",!1)):e.SetProperty("IsPinned",!0),e.ShowPin()}),c=35,h?(this.MyPinButton.SetProperty("Content","<i class='fa fa-2x'>&#xf08d;<\/i>"),c=60):this.MyPinButton.SetProperty("Content","<i class='fa'>&#xf08d;<\/i>"),this.ShowPin(),v=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(o,{ScreenID:this.MyScreenID,PostInitBag:["iValue=true","Right="+c,"Top=6","ClassName=cdeDivUp"]}),v.SetProperty("OnClick",function(){for(var u,t=e.GetElement(),f=t.parentElement,r=-1,i=0;i<t.parentElement.children.length;i++){if(t.parentElement.children[i]===t){r>=0&&(u=t.parentElement.children[r],t.parentElement.removeChild(t),f.insertBefore(t,u));break}t.parentElement.children[i].style.display!=="none"&&(r=i)}n.MyScreenManager&&n.MyScreenManager.RenumberScreens()}),h?(v.SetProperty("Content","<i class='fa fa-2x'>&#xf062;<\/i>"),c=120):(v.SetProperty("Content","<i class='fa'>&#xf062;<\/i>"),c=70),y=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(o,{ScreenID:this.MyScreenID,PostInitBag:["iValue=true","Right="+c,"Top=6","ClassName=cdeDivDown"]}),y.SetProperty("OnClick",function(){for(var u,t=e.GetElement(),f=t.parentElement,r=-1,i=t.parentElement.children.length-1;i>=0;i--){if(t.parentElement.children[i]===t){if(r<t.parentElement.children.length-1){if(u=t.parentElement.children[r+1],u===t)break;t.parentElement.removeChild(t);f.insertBefore(t,u)}else t.parentElement.removeChild(t),f.appendChild(t);break}t.parentElement.children[i].style.display!=="none"&&(r=i)}n.MyScreenManager&&n.MyScreenManager.RenumberScreens()}),h?y.SetProperty("Content","<i class='fa fa-2x'>&#xf063;<\/i>"):y.SetProperty("Content","<i class='fa'>&#xf063;<\/i>"))),h||(this.MySavePin=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(o,{ScreenID:this.MyScreenID,PostInitBag:["iValue=true","Right=140","Top=6","ClassName=cdeDivSave"]}),this.MySavePin.SetProperty("OnClick",function(t,i){var f=n.MyTCF.GetRegisteredControl("TABLES",e.MyScreenID),r,s,u,o,h;if(f)if(i.button===2)n.MyEngine?(n.MyEngine.PublishToNMI("NMI_CLEAR_SCREEN:"+e.MyScreenID,f.MyDataRow.cdeN),n.ShowToastMessage("Screen options cleared")):n.ShowToastMessage("No NMI Engine found - Screen options not cleared!");else if(n.MyEngine){r=new n.TheFOR;r.ID=e.MyScreenID;r.TileWidth=f.GetProperty("TileWidth");f.GetProperty("StartGroup")&&(r.StartGroup=f.GetProperty("StartGroup"));r.Flds=[];for(s in f.MyFormControls)u=f.MyFormControls[s],u.MyBaseType===n.cdeControlType.CollapsibleGroup&&(r.TileWidth===null&&(r.TileWidth=cde.CBool(u.GetProperty("AllowHorizontalExpand"))===!0?u.GetProperty("ControlTW"):0),o=new n.TheFLDOR,o.PO=[],u.MyFieldInfo&&(o.FldOrder=u.MyFieldInfo.FldOrder),o.PO.push("DoClose="+!cde.CBool(u.GetProperty("IsOpen"))),cde.CInt(u.GetProperty("TileWidth"))>0&&o.PO.push("TileWidth="+u.GetProperty("TileWidth")),r.Flds.push(o));h=JSON.stringify(r);n.MyEngine.PublishToNMI("NMI_SAVE_SCREEN:"+e.MyScreenID,h,f.MyDataRow.cdeN);n.ShowToastMessage("Screen options saved")}else n.ShowToastMessage("No NMI Engine found - Screen options not saved")}),this.MySavePin.SetProperty("Content","<i class='fa'>&#xf0c7;<\/i>"),this.MySavePin.SetProperty("Visibility",!1)),this.MyRefreshPin=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(o,{ScreenID:this.MyScreenID,PostInitBag:["iValue=true","Left=0","Top=6","ClassName=cdeDivRefresh"]}),this.MyRefreshPin.SetProperty("OnClick",function(t,i){var r,u,f;if(n.MyEngine&&n.MyScreenManager&&(r=n.MyScreenManager.GetScreenByID(e.MyScreenID),r)){if(e.MyNMIControl&&e.MyNMIControl.ReloadData()===!0)return;u=!1;i.button!==2&&(u=!0);f="NMI_GET_DATA:"+e.MyScreenID+":"+r.GetProperty("ControlClass")+":"+r.GetProperty("DashID")+":true:"+u;n.MyEngine.PublishToNMI(f,"",e.MyFieldInfo?e.MyFieldInfo.cdeN:null)}}),h?this.MyRefreshPin.SetProperty("Content","<i class='fa fa-3x'>&#xf021;<\/i>"):this.MyRefreshPin.SetProperty("Content","<i class='fa'>&#xf021;<\/i>"),this.MyRefreshPin.SetProperty("Visibility",!1),cde.MyBaseAssets.MyServiceHostInfo.RedPill===!0&&(this.MyDrawPin=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(o,{ScreenID:this.MyScreenID,PostInitBag:["iValue=true","Right=105","Top=6","ClassName=cdeDivDraw"]}),this.MyDrawPin.SetProperty("OnClick",function(){e.MyOverlay?(e.RemoveChild(e.MyOverlay),e.MyOverlay=null):e.MyOverlay=n.MyTCF.CreateNMIControl(n.cdeControlType.DrawOverlay).Create(e,{PreInitBag:["HideClear=true","EnableRecognizer=true"]})}),this.MyDrawPin.SetProperty("Content","<i class='fa'>&#xf044;<\/i>"),this.MyDrawPin.SetProperty("Visibility",!cde.CBool(this.GetSetting("UseIFrame")))),cde.CBool(this.GetSetting("AllowDrag"))&&(this.mDragButton=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(o,{ScreenID:this.MyScreenID,PostInitBag:["iValue=true","Right=175","Top=6","ClassName=cdeDivDraw"]}),this.mDragButton.SetProperty("Content","<i class='fa'>&#xF0b2;<\/i>"),this.mDragButton.SetProperty("HoverClassName","cdeDragButton"),this.mDragButton.SetProperty("OnPointerDown",function(n,t){if(e.IsDragging){e.closeDragElement(t);return}t=t||window.event;t.preventDefault();e.pos3=t.clientX;e.pos4=t.clientY;e.mDragButton.SetProperty("Foreground","green");e.IsDragging=!0;e.oldz=e.MyScreenDIV.style.zIndex;e.MyScreenDIV.style.zIndex="450";document.onpointerup=function(n){e.closeDragElement(n)};document.onpointermove=function(n){e.elementDrag(n)}}))),cde.CBool(this.GetSetting("UseIFrame"))?(this.mDivDashboardContent=document.createElement("iframe"),this.mDivDashboardContent.className="cdeDashboardIFrame",this.mDivDashboardContent.style.width="inherit",this.mDivDashboardContent.style.height="inherit",this.IsIFrame=!0,this.mDivDashboardContent.onload=function(n){e.FireEvent(!0,"OnIFrameLoaded",n)}):this.mDivDashboardContent=document.createElement("div"),this.mDivDashboardContent.id="Content_"+this.MyScreenID,this.mDivDashboardContent.className="CMyDashboard",cde.CBool(this.GetSetting("ShowFullScreen"))===!0&&(this.mDivDashboardContent.style.width="100%",this.mDivDashboardContent.style.display="flex",this.mDivDashboardContent.style.verticalAlign="middle",this.mDivDashboardContent.style.height=window.innerHeight-n.GetSizeFromTile(1)+"px"),this.MyScreenDIV.appendChild(this.mDivDashboardContent),this.MyContainerElement=this.mDivDashboardContent,n.MyScreenManager&&(this.SetProperty("FldOrder",n.MyScreenManager.GetScreenIndex()),cde.CBool(this.GetProperty("IsPopup"))&&(n.MyScreenManager.RegisterEvent("OnWindowResize",function(){e.ResizePopup()}),n.MyScreenManager.RegisterEvent("OnWindowScroll",function(){e.ResizePopup()}))),!0},i.prototype.closeDragElement=function(n){n.stopPropagation();n.preventDefault();this.IsDragging=!1;document.onpointermove=null;document.onpointerup=null;this.mDragButton.SetProperty("Foreground",null);this.MyScreenDIV.style.zIndex=this.oldz;this.ApplySkin()},i.prototype.elementDrag=function(n){if(n=n||window.event,n.preventDefault(),this.pos1=this.pos3-n.clientX,this.pos2=this.pos4-n.clientY,this.pos3=n.clientX,this.pos4=n.clientY,this.pos1===0&&this.pos2===0){this.closeDragElement(n);return}this.IsDragging=!0;this.oldTop=this.oldTop-this.pos2;this.oldLeft=this.oldLeft-this.pos1;this.MyScreenDIV.style.top=this.oldTop+"px";this.MyScreenDIV.style.left=this.oldLeft+"px"},i.prototype.SaveHomeScreen=function(t){var r=new n.TheNMIScene,i,u;r.FriendlyName="MyHome";r.IsPublic=!1;r.Screens=[];i=new n.TheScreenTrans;i.ID=this.MyScreenID;i.DashID=t.GetProperty("DashID");u="RESET";i.DashID&&(i.IsVisible=!0,i.IsPinned=!1,i.FldOrder=-1,r.Screens.push(i),u=JSON.stringify(r));n.MyEngine&&n.MyEngine.PublishToNMI("NMI_SAVE_HOMESCENE",u);n.ShowToastMessage("Home Scene saved!")},i.prototype.SetInitialized=function(t){this.mIsInitialized=!0;n.MyScreenManager&&!cde.CBool(this.GetSetting("NeverHide"))&&n.MyScreenManager.RegisterScreen(this.MyScreenID,this,t);this.ResizePopup()},i.prototype.ResizePopup=function(){if(cde.CBool(this.GetProperty("IsPopup"))){this.GetElement().style.left=window.innerWidth/2-this.GetElement().clientWidth/2+"px";var t=this.GetElement().clientHeight;t===0&&(t=n.GetSizeFromTile(this.GetProperty("TileHeight")));this.GetElement().style.top=window.innerHeight/2-t/2+window.scrollY+"px"}},i.prototype.GetInitialized=function(){return this.mIsInitialized},i.prototype.ApplySkin=function(){!this.IsIFrame&&cde.CBool(this.GetProperty("AllowScrolling"))&&this.GetContainerElement()&&(this.GetContainerElement().style.width=this.MyScreenDIV.clientWidth+20+"px")},i.prototype.SetProperty=function(n,i){var u,f,r,e;if(n.startsWith("IsOwnerDown")){if(u=n.split(":"),u.length<2)return;if(i===!0){if(this.GetProperty(n)===!0)return;if(this.GetProperty("IsDashboard")===!0)for(f in this.MyChildren)r=this.MyChildren[f],r&&r.MyFieldInfo&&r.MyFieldInfo.cdeN===u[1]&&r.SetProperty("IsOwnerDown",!0);else this.MyScreenDIV.classList.contains("cdeNodeGone")||this.MyScreenDIV.classList.add("cdeNodeGone")}else{if(this.GetProperty(n)!==!0)return;if(this.GetProperty("IsDashboard")===!0)for(f in this.MyChildren)r=this.MyChildren[f],r&&r.MyFieldInfo&&r.MyFieldInfo.cdeN===u[1]&&r.SetProperty("IsOwnerDown",!1);else this.MyScreenDIV.classList.remove("cdeNodeGone")}}n==="Visibility"&&cde.CBool(i)===!1;n==="ClassName"&&this.GetContainerElement()?this.GetContainerElement().className=i:n==="ScreenClassName"?t.prototype.SetProperty.call(this,"ClassName",i+" cde-animate-opacity"):t.prototype.SetProperty.call(this,n,i);(n==="Value"||n==="iValue"||n==="Text"||n==="Label"||n==="Caption"||n==="Title")&&this.MyScreenTitle?(e=this.GetProperty("LabelFormat"),e&&(i=e.format(i)),this.MyScreenTitle.SetProperty("Text",i)):(n==="LabelFormat"||n==="ScreenTitle")&&this.MyScreenTitle&&i?(i.indexOf("{0}")>=0&&(i=i.format(this.GetProperty("iValue"))),this.MyScreenTitle.SetProperty("Text",i)):n==="IsPinned"?this.ShowPin():n==="Source"&&this.IsIFrame?this.MyContainerElement.src=i:n==="OnIFRameLoaded"&&this.IsIFrame?this.RegisterEvent("OnIFrameLoaded",i):n==="TileHeight"&&this.GetContainerElement()?this.GetContainerElement().style.height=cde.CBool(this.GetSetting("HidePins"))?"inherit":this.GetElement().clientHeight-44+"px":n==="TileWidth"?this.ApplySkin():n==="AllowScrolling"&&this.GetContainerElement()?(this.GetContainerElement().style.overflow="auto",this.ApplySkin()):n==="HidePins"&&this.MyPinArea&&this.MyPinArea.SetProperty("Visibility",!cde.CBool(i))},i.prototype.OnLoad=function(n){this.MyNMIControl&&this.MyNMIControl.OnLoad(n);t.prototype.OnLoad.call(this);this.SetProperty("LastShow",new Date);this.FireEvent(!0,"OnLoaded");cde.CBool(this.GetProperty("IsPopup"))&&this.ResizePopup()},i.prototype.ShowPin=function(){this.MyPinButton&&(cde.CBool(this.GetProperty("IsPinned"))===!0?(this.MyPinButton.SetProperty("iValue",!0),this.MyPinButton.SetProperty("ClassName","cdePinDiv")):(this.MyPinButton.SetProperty("ClassName","cdePinDiv fa-rotate-45"),this.MyPinButton.SetProperty("iValue",!1)))},i.prototype.ShowFullscreen=function(n){this.MyScreenDIV&&(this.SetProperty("IsFullScreen",n),this.MyScreenDIV.style.maxWidth=n?"100%":"")},i.prototype.Clear=function(n){n&&this.ClearChildren(n);this.divDragContent&&this.divDragContent.classList.remove("cde-animate-opacity");this.GetContainerElement().innerHTML=""},i.prototype.ClearChildren=function(t){if(n.MyScreenManager)for(var i in this.MyChildren)n.MyScreenManager.DeleteScreenByID(i,t)},i.prototype.AppendChild=function(n){this.GetContainerElement().appendChild(n.GetElement())},i.prototype.AppendContent=function(n){this.GetContainerElement().innerHTML=n},i.prototype.CreateHTMLView=function(n){this.GetContainerElement()&&(this.GetContainerElement().innerHTML=n)},i.prototype.CreateScriptInView=function(n){var i,t;if(this.GetContainerElement()&&(i=this.GetContainerElement().getElementsByTagName("script"),i.length===0)){if(this.mIsInitialized)return;this.GetContainerElement().innerHTML="";t=document.createElement("script");t.type="text/javascript";t.text=n;this.GetContainerElement().appendChild(t)}},i.prototype.CreateCSSInView=function(n){var i,t;this.GetContainerElement()&&(i=this.GetContainerElement().getElementsByTagName("style"),i.length>0?i[0].innerText=n:(t=document.createElement("style"),t.type="text/css",t.innerText=n,this.GetContainerElement().insertBefore(t,this.GetContainerElement().firstChild)))},i.prototype.UpdateCSSInView=function(n){if(this.GetContainerElement()){var t=this.GetContainerElement().getElementsByTagName("style");t.length>0&&(t[0].innerText=n)}},i.prototype.RemoveCSSInView=function(){if(this.GetContainerElement()){var n=this.GetContainerElement().getElementsByTagName("style");n.length>0&&n[0].parentElement.removeChild(n[0])}},i.prototype.OnNUITag=function(){n.MyScreenManager&&n.MyScreenManager.TransitToScreen(this.MyScreenID)},i.GetScreenByID=function(t){return n.MyScreenManager?n.MyScreenManager.GetScreenByID(t):null},i}(n.TheNMIBaseControl);n.TheNMIScreen=t}(cdeNMI||(cdeNMI={})),function(n){var r=function(t){function i(){var i=t.call(this,null)||this;return i.divSideBarRight=null,i.MyNMIScreens=[],i.MyNavHistory=[],i.MyDrawOverlay=null,i.MyMainBackButton=null,i.MyPopupOverlay=null,i.CurrentScreen=null,i.CurrentView=null,i.StartView=null,i.IsHeaderVisible=!0,i.IsBrowserFullscreen=!1,i.WasLoginHandled=!1,i.ScreenOrder=0,i.WaitingForScreen=null,i.DocumentWidth=0,i.IsLoaded=!1,i.MyBaseType=n.cdeControlType.ScreenManager,i}return __extends(i,t),i.prototype.InitControl=function(){var o=this,t,s,i,r,u,f,e;return n.MyNMIPortal=new n.TheNMIScreen(null),n.MyNMIPortal.MyFormID="NMIPORTAL",n.MyNMIPortal.MyScreenID="MYNMIPORTAL",n.MyNMIPortal.SetProperty("IsAlwaysVisible",!0),t=document.getElementById("MyNMIPortal"),t||(t=document.createElement("div"),t.className="cdeNMIPortal",t.id="MyNMIPortal",s=document.getElementsByTagName("body"),s?document.body.insertBefore(t,document.body.firstChild):document.appendChild(document.createElement("body")).appendChild(t)),document.body.oncontextmenu=function(){return!1},n.MyNMIPortal.SetElement(t),this.RegisterScreen(n.MyNMIPortal.MyScreenID,n.MyNMIPortal,!0),this.IsBrowserFS(),i=document.getElementById("MyDashboard"),i||(i=document.createElement("div"),i.className="cdeMyDashboard",i.id="MyDashboard",t.appendChild(i)),this.divSideBarRight=document.getElementById("cdeSideBarRight"),this.divSideBarRight||(this.divSideBarRight=document.createElement("div"),this.divSideBarRight.id="cdeSideBarRight",this.divSideBarRight.className="cdeSideBarRight cdeBlurBack",this.divSideBarRight.style.display="none",r=document.createElement("div"),r.id="cdeInSideBarRightHeader",r.className="cdeSideRightHeader",this.divSideBarRight.appendChild(r),u=new n.TheNMIBaseControl,u.SetElement(r),f=n.MyTCF.CreateNMIControl(n.cdeControlType.PinButton).Create(u,{ScreenID:this.MyScreenID,PostInitBag:["Left=6","Top=6","ClassName=cdeDivDraw"]}),f.SetProperty("OnClick",function(){o.divSideBarRight.style.display="none";o.divSideBarRight.classList.remove("cde-animate-right")}),f.SetProperty("Content","<i class='fa fa-2x'>&#xf061;<\/i>"),e=document.createElement("div"),e.id="cdeInSideBarRight",this.divSideBarRight.appendChild(e),document.body.appendChild(this.divSideBarRight)),this.DocumentWidth=document.body.clientWidth+n.GetSizeFromTile(1),this.SetElement(t,!1,i),this.IsLoaded=!0,this.FireEvent(!1,"OnIsLoaded",this.IsLoaded),!0},i.prototype.RegisterEvents=function(){var t=this;window.addEventListener&&(window.addEventListener("resize",function(){t.ResizeEventHandler()},!1),window.addEventListener("scroll",function(){t.ScollEventHandler()},!1));document.onkeydown=function(i){var r=i?i.which?i.which:i.keyCode:i.keyCode;r===13?(n.Key13Event!==null&&n.Key13Event(i),n.Key13Event=null):r===27?(n.Key27Event!==null&&n.Key27Event(i),n.Key27Event=null):r===36&&cde.MyBaseAssets.MyServiceHostInfo.WasPortalRequested&&n.Key13Event===null?n.DisableKey36Event||t.GotoStationHome(!1):r===10009?n.MyScreenManager&&n.MyScreenManager.NavigateBack(!1):r===39?n.focusNextElement(!1):r===37&&n.focusNextElement(!0);r>47&&r<58&&n.Key13Event===null&&t.TransitToScreenIDX(r-48)};window.onpopstate=function(){t.NavigateBack(!1)};cde.MyBaseAssets.MyServiceHostInfo.DoAllowAnonymous||(cde.MyBaseAssets.MyCommStatus.IsUserLoggedIn?this.HandleLogin(!0):(n.MyLoginScreen=n.MyTCF.CreateNMIControl(n.cdeControlType.LoginScreen,!0),n.MyLoginScreen?(n.MyLoginScreen.RegisterEvent("OnLogin",function(n,i,r){t.HandleLogin(i,r)}),n.MyLoginScreen.Create(null),this.CreateLoginButtonOnly()):n.MyPopUp&&n.MyPopUp.Show("NMI Requires Login but no login provider found. Access is denied",!0,null,null,function(){n.ResetBrowserToPortal()})));n.MyEngine?(n.MyEngine.RegisterEvent("CDE_SETSTATUSMSG",function(n,i,r){t.SetStatusMsg(i,r)}),n.MyEngine.RegisterEvent("CDE_SETPLATFORM",function(n,i){t.SetPlatform(i)}),n.MyEngine.IsConnectedAndReady?this.sinkEngineReady(n.MyEngine,!0):n.MyEngine.RegisterEvent("EngineReady",function(n,i){t.sinkEngineReady(n,i)})):this.sinkEngineReady(null,!0)},i.prototype.RemoveAllScreens=function(){this.MyNMIScreens=[];this.MyNavHistory=[];var n=document.getElementById("MyDashboard");n&&(n.innerHTML="");n=document.getElementById("MyDashboardLOGIN");n&&(n.innerHTML="")},i.prototype.ResizeEventHandler=function(){this.DocumentWidth=document.body.clientWidth+n.GetSizeFromTile(1);this.IsBrowserFS();this.FireEvent(!0,"OnWindowResize")},i.prototype.ScollEventHandler=function(){this.FireEvent(!0,"OnWindowScroll")},i.prototype.IsBrowserFS=function(){window.innerWidth===screen.width&&window.innerHeight===screen.height?this.IsBrowserFullscreen||(this.IsBrowserFullscreen=!0,this.FireEvent(!0,"OnBrowserFullscreen",!0)):this.IsBrowserFullscreen&&(this.IsBrowserFullscreen=!1,this.FireEvent(!0,"OnBrowserFullscreen",!1))},i.prototype.CreateLoginButtonOnly=function(){var f=this,r,t,i,u;cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==0?(r=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa fa-5x' style='font-size:40px'>&#xf011;<\/span>","ClassName=MyHeaderButton"]}),r.SetProperty("OnClick",function(t,i){i.button===2&&cde.MyBaseAssets.MyServiceHostInfo.WasPortalRequested===!0?f.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen):n.ResetBrowserToPortal()})):r=n.MyTCF.CreateNMIControl(n.cdeControlType.UserMenu).Create(null);r.SetProperty("TabIndex",15);t=document.getElementById("HeaderButtonContentRight");t||(t=document.createElement("div"),t.className="cdeHeaderButtonContentRight",t.id="HeaderButtonContentRight",i=document.getElementById("MyHeader"),i||(i=document.createElement("div"),i.className="cdeLogoffTopRight",i.id="MyLogoffButton",this.GetElement().parentNode.insertBefore(i,this.GetElement().nextSibling)),i.appendChild(t));cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1&&(u=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=2","ControlTH=1"],PostInitBag:["Title="+n.UpdateClock(),"ClassName=MyHeaderButton"]}),u.SetProperty("Disabled",!0),t.appendChild(u.GetElement()),n.StartClock(u));t.appendChild(r.GetElement());cde.MyBaseAssets.MyCommStatus.UserPref&&cde.MyBaseAssets.MyCommStatus.UserPref.CurrentUserName&&r.SetProperty("Caption","<span class='fa fa-5x' style='font-size:40px'>&#xf2bd;<\/span><\/br>"+cde.MyBaseAssets.MyCommStatus.UserPref.CurrentUserName)},i.prototype.SetApplicationBar=function(){},i.prototype.ShowCreateViewPopup=function(){var t=this,i=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(null),u,e,f,r;i.SetProperty("ClassName","cdeTextCrop");u=new n.TheFieldInfo(n.cdeControlType.SingleEnded,-1,"Name:",2);u.FormID="SAVEVIEW";e=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleEnded).Create(i,{TRF:new n.TheTRF("SceneName",1,u),PostInitBag:["ClassName=cdeInput cdeInputCenter","iValue=My Scene"]});n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(i,{PostInitBag:["iValue=Make Scene available to all user:"]});f=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleCheck).Create(i,{TRF:new n.TheTRF("IsPublic",2,new n.TheFieldInfo(n.cdeControlType.SingleCheck,3,"Is Public:",2)),PostInitBag:["Title=yes"]});f.SetProperty("Style","float:none;");n.MyPopUp&&(r=n.MyPopUp.Show("Name this Scene:",!1,i,0,function(i){var s=i.GetProperty("tEdit"),h=i.GetProperty("tCheck"),e=s.GetProperty("Value"),f,u,r,o;if(e&&e.length>0){f=new n.TheNMIScene;f.FriendlyName=e;f.IsPublic=h.GetProperty("Value");f.Screens=[];for(u in t.MyNMIScreens)t.MyNMIScreens.hasOwnProperty(u)&&(r=new n.TheScreenTrans,r.ID=t.MyNMIScreens[u].MyScreenID,r.DashID=t.MyNMIScreens[u].GetProperty("DashID"),r.IsVisible=t.MyNMIScreens[u].GetProperty("Visibility"),r.IsPinned=t.MyNMIScreens[u].GetProperty("IsPinned"),r.FldOrder=t.MyNMIScreens[u].GetProperty("FldOrder"),(r.IsVisible||r.IsPinned)&&f.Screens.push(r));o=JSON.stringify(f);n.MyEngine&&(n.MyEngine.PublishToNMI("NMI_SAVE_SCENE:"+e,o),n.ShowToastMessage("Scene "+e+" saved!"))}}),r.SetProperty("tEdit",e),r.SetProperty("tCheck",f),r.SetProperty("YesLabel","Save"),r.SetProperty("NoLabel","Cancel"))},i.prototype.SetView=function(n,t){(t===void 0&&(t=!1),n)&&(t===!0&&this.ClearScenes(),this.CurrentView=n,cde.MyBaseAssets.MyServiceHostInfo.StartScreen&&(this.StartView=this.CurrentView))},i.prototype.ShowView=function(){var r,u,t,i,f;if(this.CurrentView){for(r in this.MyNMIScreens)this.MyNMIScreens.hasOwnProperty(r)&&(this.MyNMIScreens[r].SetProperty("IsPinned",!1),this.ShowHideScreen(this.MyNMIScreens[r]));for(u=0,t=0;t<this.CurrentView.Screens.length;t++)i=this.GetScreenByID(this.CurrentView.Screens[t].ID),i?(n.MyEngine&&n.MyEngine.CheckDataToFetch(this.CurrentView.Screens[t].ID),i.SetProperty("IsPinned",this.CurrentView.Screens[t].IsPinned),this.ShowHideScreen(i,this.CurrentView.Screens[t].IsVisible),i.SetProperty("FldOrder",this.CurrentView.Screens[t].FldOrder),this.CurrentView.Screens[t].IsVisible&&u++):n.MyEngine&&n.MyEngine.GetScreenMeta(this.CurrentView.Screens[t].DashID,!1);for(f=n.SortArray(this.CurrentView.Screens,"FldOrder",!1,!0),t=0;t<f.length;t++)i=this.GetScreenByID(f[t].ID),this.MoveScreenToTop(i);u===this.CurrentView.Screens.length&&(this.CurrentView=null)}},i.prototype.RenderHeader=function(){return},i.prototype.RequestPortalScreen=function(t){n.MyEngine&&n.MyEngine.GetScreenMeta(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen,t)},i.prototype.SetPlatform=function(n){n===2&&this.SetHoloLens()},i.prototype.GetDeepLink=function(){var t=this.CurrentScreen.MyScreenID+";"+this.CurrentScreen.GetProperty("DashID")+";-;"+this.CurrentScreen.GetProperty("ScreenTitle");return n.ShowToastMessage("Deep Link created!",t),t},i.prototype.SetHoloLens=function(){document.body.style.background="black";var t=document.getElementById("MyNMIPortal");return t&&(t.style.marginTop="0"),n.ShowToastMessage("Welcome to HoloLens Mode!"),""},i.prototype.ShowHideDrawOverlay=function(){this.MyDrawOverlay?(n.MyNMIPortal&&n.MyNMIPortal.DeleteControl(this.MyDrawOverlay),this.MyDrawOverlay=null):(n.ShowToastMessage("Welcome to your Scratch Board","You draw on the screen and save your drawings to your Relay"),this.MyDrawOverlay=n.MyTCF.CreateNMIControl(n.cdeControlType.DrawOverlay).Create(n.MyNMIPortal,{TRF:new n.TheTRF("ScratchBoard",0,null),PostInitBag:["ClassName=cdeDrawOverlay"]}),this.MyDrawOverlay.SetProperty("IsSynced",!0),this.MyDrawOverlay.SetProperty("ShowPlay",!0),this.MyDrawOverlay.SetProperty("IsOverlay",!0),this.MyDrawOverlay.SetProperty("ShowColors",!0),this.MyDrawOverlay.SetProperty("AutoAdjust",!0),this.MyDrawOverlay.RegisterEvent("OnSavePicture",function(t,i){n.ShowToastMessage("Drawing Saved",i[1])}))},i.prototype.sinkEngineReady=function(n,t){(cde.MyBaseAssets.MyServiceHostInfo.DoAllowAnonymous||cde.MyBaseAssets.MyCommStatus.IsUserLoggedIn)&&(n===null||t)&&this.HandleLogin(!0)},i.prototype.HandleLogin=function(t){this.WasLoginHandled||t===!0&&(this.WasLoginHandled=!0,this.SetApplicationBar(),cde.MyBaseAssets.MyServiceHostInfo.WasPortalRequested=!1,this.FireEvent(!1,"OnHandleLogin",!0),cde.MyBaseAssets.MyCommStatus.LastPortalScreen?n.MyEngine&&n.MyEngine.GetScreenMeta(cde.MyBaseAssets.MyCommStatus.LastPortalScreen,!1):this.RequestPortalScreen(!1),n.MyEngine?(n.MyEngine.IsConnectedAndReady=!0,cde.MyBaseAssets.MyCommStatus.LastStartScreen?n.MyEngine.GetScene(cde.MyBaseAssets.MyCommStatus.LastStartScreen):cde.MyBaseAssets.MyServiceHostInfo.StartScreen&&n.MyEngine.GetScene(cde.MyBaseAssets.MyServiceHostInfo.StartScreen)):this.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.StartScreen))},i.prototype.SetStatusMsg=function(t,i){n.MyLoginScreen&&n.MyLoginScreen.SetStatusMsg(t,i);i===3&&(n.MyPopUp?n.MyPopUp.Show(t,!0,null,null,function(){n.ResetBrowserToPortal()}):n.ResetBrowserToPortal())},i.prototype.FindDashpanel=function(t,i){var r,u;if(i=cde.GuidToString(i),r=n.MyNMIModels[t],!r)return null;for(u=0;u<r.MyDashPanels.length;u++)if(cde.GuidToString(r.MyDashPanels[u].cdeMID)===i)return r.MyDashPanels[u];return null},i.prototype.SetScreenState=function(t,i){cde.IsNotSet(t)&&(t=cde.GuidToString(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen));var r=this.FindDashpanel(t,i);return r?(r.IsFullSceen?this.RenderHeader(!1):this.RenderHeader(!0),n.ThePB.GetValueFromBagByName(r.PropertyBag,"Title")):cde.MyBaseAssets.MyServiceHostInfo.ApplicationTitle},i.prototype.ClearScenes=function(){this.CurrentScreen=null;for(var n in this.MyNMIScreens)this.MyNMIScreens.hasOwnProperty(n)&&(this.MyNMIScreens[n].SetProperty("IsPinned",!1),this.ShowHideScreen(this.MyNMIScreens[n]))},i.prototype.ClearAndGoHome=function(){this.ClearScenes();this.GotoStationHome(!1)},i.prototype.AreScreensPinned=function(n){var i=0;for(var t in this.MyNMIScreens)this.MyNMIScreens.hasOwnProperty(t)&&this.MyNMIScreens[t]!==n&&this.MyNMIScreens[t].GetProperty("IsPinned")===!0&&i++;return i},i.prototype.FindPinnedScreen=function(){for(var n in this.MyNMIScreens)if(this.MyNMIScreens.hasOwnProperty(n)&&this.MyNMIScreens[n].GetProperty("IsPinned")===!0)return this.MyNMIScreens[n];return null},i.prototype.SetCurrentScreen=function(t,i,r){(this.CurrentScreen=t,t)&&(i?this.CurrentScreen.SetProperty("TTSCookie",i):this.CurrentScreen.SetProperty("TTSCookie",null),this.CurrentScreen.MyNMIControl&&(i?this.CurrentScreen.MyNMIControl.SetProperty("TTSCookie",i):this.CurrentScreen.MyNMIControl.SetProperty("TTSCookie",null)),r&&(this.CurrentScreen.SetProperty("MyOwnerTable",r),this.CurrentScreen.MyNMIControl&&this.CurrentScreen.MyNMIControl.SetProperty("MyOwnerTable",r)),n.MyEngine&&n.MyEngine.PublishToNMI("NMI_SHOW_SCREEN"+(i?":"+i:""),this.CurrentScreen.MyScreenID,this.CurrentScreen.MyFieldInfo?this.CurrentScreen.MyFieldInfo.cdeN:null))},i.prototype.GetCurrentScreen=function(){return this.CurrentScreen},i.prototype.GetScreenByID=function(n){return n=cde.GuidToString(n),this.MyNMIScreens[n]},i.prototype.DeleteScreenByID=function(n,t){var i=this.GetScreenByID(n);return i?(t&&(i.Clear(t),this.MyNMIScreens.hasOwnProperty(n)&&delete this.MyNMIScreens[n]),!0):!1},i.prototype.RegisterScreen=function(n,t,i){t&&((n=cde.GuidToString(n),this.MyNMIScreens[n]=t,t.SetProperty("LastShow",new Date),i)||this.CurrentScreen&&this.CurrentScreen.MyScreenID===n||this.ShowHideScreen(t))},i.prototype.ShowHeader=function(){},i.prototype.ShowAllScreens=function(){for(var t in this.MyNMIScreens)this.MyNMIScreens.hasOwnProperty(t)&&this.MyNMIScreens[t].MyScreenID!=="CDELOGINSCREEN"&&(n.MyEngine&&n.MyEngine.CheckDataToFetch(this.MyNMIScreens[t].MyScreenID),this.ShowHideScreen(this.MyNMIScreens[t],!0))},i.prototype.TransitToWaitingScreen=function(n){this.WaitingForScreen&&cde.GuidToString(this.WaitingForScreen)===n&&(this.TransitToScreen(this.WaitingForScreen,!1,!1),this.WaitingForScreen=null)},i.prototype.TransitToScreenIDX=function(n){var i,t;if(this.CurrentScreen&&this.CurrentScreen.GetProperty("IsDashboard"))for(i in this.CurrentScreen.MyChildren)if(t=this.CurrentScreen.MyChildren[i],t&&t.MyRC>=0&&t.MyRC===n){this.TransitToScreen(i);break}},i.prototype.TransitToScreen=function(t,i,r,u,f){var o,s,h,a;if(i===void 0&&(i=!1),r===void 0&&(r=!1),cde.CBool(cde.TheBaseAssets.IsConnectionDown())===!0){n.ResetBrowserToPortal();return}t||(t=cde.MyBaseAssets.MyServiceHostInfo.PortalScreen);cde.MyBaseAssets.MyServiceHostInfo.WasInitialScreenVisible||cde.MyBaseAssets.MyServiceHostInfo.DoesRequireConfiguration&&!cde.MyBaseAssets.MyServiceHostInfo.DoAllowAnonymous&&cde.MyBaseAssets.MyServiceHostInfo.MainConfigScreen&&n.MyPopUp&&n.MyPopUp.Show("Your Relay is not completely configured, yet. Do you want to do this now?",!1,null,1,function(){n.MyScreenManager.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.MainConfigScreen)},null,this,parent);this.MyPopupOverlay&&(this.RemoveChild(this.MyPopupOverlay),this.MyPopupOverlay=null);var c=document.body.scrollTop,l=cde.GuidToString(t),e=this.GetCurrentScreen();this.SetCurrentScreen(null);for(o in this.MyNMIScreens)if(this.MyNMIScreens.hasOwnProperty(o))if(o===l){if(e&&e.MyScreenID===o){this.SetCurrentScreen(e,u,f);break}if(this.SetCurrentScreen(this.MyNMIScreens[o],u,f),s=null,n.MyEngine){if(s=n.MyNMIModels[this.CurrentScreen.MyScreenID],s&&s.MyDashboard&&s.MyDashboard.InitialState&&(!e||cde.GuidToString(s.MyDashboard.InitialState)!==e.MyScreenID)){this.TransitToScreen(s.MyDashboard.InitialState);return}r||n.MyEngine.CheckDataToFetch(t)}this.SetScreenState("",t);this.ShowHideScreen(this.CurrentScreen,!0);this.MoveScreenToTop(this.CurrentScreen);cde.CBool(this.CurrentScreen.GetProperty("IsPopup"))?(this.MyPopupOverlay=n.MyTCF.CreateNMIControl(n.cdeControlType.TouchOverlay).Create(this),this.MyPopupOverlay.SetProperty("ClassName","cdePopupOverlay"),this.CurrentScreen.GetElement().style.position="absolute",this.CurrentScreen.GetElement().style.zIndex="1100",this.CurrentScreen.GetElement().style.left=window.innerWidth/2-this.CurrentScreen.GetElement().clientWidth/2+"px",this.CurrentScreen.GetElement().className="cdePopupTemplate cde-animate-opacity",this.CurrentScreen.SetProperty("ClassName","cdePopupContent"),this.CurrentScreen.SetProperty("OldScreen",e.MyScreenID)):(e&&!this.CurrentScreen.HasRenderTarget&&this.ShowHideScreen(e),cde.MyCommChannel&&(h=[],h.LSSC=t,this.CurrentScreen.GetProperty("DashID")&&(h.LPS=this.CurrentScreen.GetProperty("DashID")),cde.MyCommChannel.UpdateCustomSettings(h)));this.CurrentScreen.ShowFullscreen(!1);this.CurrentScreen.GetProperty("IsFullScreen")?n.TogglePortalFull(!0):n.TogglePortalFull(!1);try{this.CurrentScreen.MyFieldInfo&&cde.CBool(this.CurrentScreen.MyFieldInfo.IsTemplate)===!0||cde.CBool(this.CurrentScreen.GetProperty("IsPopup"))||(a={ScreenID:t,ScrolPos:c},this.MyNavHistory.push(a),window.history.pushState(t,l),document.body.scrollTop=document.documentElement.scrollTop=0,this.MyMainBackButton&&(this.MyNavHistory.length<2?this.MyMainBackButton.SetProperty("Disabled",!0):this.MyMainBackButton.SetProperty("Disabled",!1)))}catch(v){}}else this.MyNMIScreens[o]!==e&&this.ShowHideScreen(this.MyNMIScreens[o]);if(!this.CurrentScreen){if(this.SetCurrentScreen(this.GetScreenByID(t),u,f),!this.CurrentScreen){if(i){n.MyEngine&&n.MyEngine.PublishToNMI("NMI_GET_SCREEN",t);this.WaitingForScreen=t;return}if(t===cde.MyBaseAssets.MyServiceHostInfo.StartScreen){if(this.CurrentView||(this.CurrentView=this.StartView),this.CurrentView){this.ShowView();return}this.WaitingForScreen=t;return}t=cde.MyBaseAssets.MyServiceHostInfo.StartScreen?cde.MyBaseAssets.MyServiceHostInfo.StartScreen:cde.MyBaseAssets.MyServiceHostInfo.PortalScreen;this.MyNavHistory.push({ScreenID:t,ScrolPos:c});this.MyMainBackButton&&this.MyMainBackButton.SetProperty("Disabled",!1);this.SetCurrentScreen(this.GetScreenByID(t),u,f)}if(!this.CurrentScreen){n.MyLoginScreen&&this.ShowHideScreen(n.MyLoginScreen,!0);return}!r&&n.MyEngine&&n.MyEngine.CheckDataToFetch(t);this.ShowHideScreen(this.CurrentScreen,!0)}cde.MyBaseAssets.MyServiceHostInfo.WasInitialScreenVisible||n.ResetKeyCorder();cde.MyBaseAssets.MyServiceHostInfo.WasInitialScreenVisible=!0;t===cde.MyBaseAssets.MyServiceHostInfo.PortalScreen?(n.cdeBlendInTiles(".cdeLiveTile"),this.RenderHeader(!0)):n.cdeBlendInTiles(".cdeLiveTile");this.CurrentView=null},i.prototype.ShowHideScreen=function(n,t){(t===void 0&&(t=!1),n)&&(t?(n.Visibility||n.OnLoad(!0),n.SetProperty("Visibility",!0)):n.GetProperty("IsPinned")||cde.CBool(n.GetProperty("IsAlwaysVisible"))===!0||(n.Visibility&&n.OnUnload(),n.SetProperty("Visibility",!1)))},i.prototype.SwitchTheme=function(){},i.prototype.GotoStationHome=function(){cde.MyBaseAssets.MyServiceHostInfo.StartScreen!==""?this.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.StartScreen,!0):this.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen,!0)},i.prototype.NavigateBack=function(){if(cde.CBool(cde.TheBaseAssets.IsConnectionDown())===!0){n.ResetBrowserToPortal();return}if(n.MyPopUp&&n.MyPopUp.Hide(!1),this.FireEvent(!1,"NavigateBackClicked"),this.MyNavHistory.length>1){var t=this.MyNavHistory.pop(),i=t.ScrolPos;t=this.MyNavHistory.pop();this.TransitToScreen(t.ScreenID);document.body.scrollTop=document.documentElement.scrollTop=i}else this.GotoStationHome(!0);this.MyMainBackButton&&(this.MyNavHistory.length<2?this.MyMainBackButton.SetProperty("Disabled",!0):this.MyMainBackButton.SetProperty("Disabled",!1))},i.prototype.CntScreenPinned=function(){var n=0;for(var t in this.MyNMIScreens)this.MyNMIScreens.hasOwnProperty(t)&&this.MyNMIScreens[t].GetProperty("IsPinned")===!0&&n++;return n},i.prototype.MoveScreenToTop=function(n){var t,i,r;n&&(t=n.GetElement(),i=t.parentElement,i)&&(r=i.children[0],r!==t)&&(t.parentElement.removeChild(t),i.insertBefore(t,r),this.RenumberScreens())},i.prototype.RenumberScreens=function(){var i=document.getElementById("MyDashboard"),n,u,t,r;if(i)for(n=0;n<i.children.length;n++)u=i.children[n],t=u.id.split("_"),t.length>1&&t[0].toLowerCase()==="screen"&&(r=this.GetScreenByID(t[1]),r&&r.SetProperty("FldOrder",n))},i.prototype.UpdateScreenStatus=function(n,t){for(var i in this.MyNMIScreens)if(this.MyNMIScreens[i].MyHostNode===n||this.MyNMIScreens[i].GetProperty("IsDashboard")===!0){if(i===cde.GuidToString(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen))continue;this.MyNMIScreens[i].SetProperty("IsOwnerDown:"+n,t)}},i.prototype.GetScreenIndex=function(){return this.ScreenOrder++},i.prototype.GetScreenList=function(){var r="",i,t;for(i in this.MyNMIScreens)(t=this.MyNMIScreens[i],t&&t.GetProperty("Description")&&i!=="CDELOGINSCREEN"&&t.MyHostNode===cde.MyBaseAssets.MyCommStatus.FirstNodeID)&&(r+=";"+n.StripHTML(t.GetProperty("Description"))+":"+i);return r},i.prototype.IsScreenInView=function(n,t){var i,r;if(!n)return!0;for(i=0;i<n.Screens.length;i++)if(n.Screens[i].ID===t)return r=this.GetScreenByID(n.Screens[i].ID),r&&(r.SetProperty("IsPinned",n.Screens[i].IsPinned),this.ShowHideScreen(r,n.Screens[i].IsVisible),r.SetProperty("FldOrder",n.Screens[i].FldOrder)),n.Screens[i].IsVisible;return!1},i.prototype.CreateHTMLScreen=function(t,i){var r=n.MyScreenManager.GetScreenByID(t);return r&&(r.CreateHTMLView(i),r.SetInitialized(!0)),r},i.prototype.CreateScriptScreen=function(n,t){var i=this.GetScreenByID(n);return i&&(i.CreateScriptInView(t),i.SetInitialized(!0)),i},i.prototype.CreateIFrameScreen=function(n,t){var i=this.GetScreenByID(n);return i&&(i.SetProperty("Source",t),i.SetInitialized(!0)),i},i.prototype.CreateDataViewScreen=function(t,i,r,u,f,e,o){var ut=cde.GuidToString(t.cdeMID),d,v,w,p,nt,it,k,l,g,h,s,a,y,b,c,tt,rt;if(i&&(typeof i.PLS=="object"||i.PLS!==""&&i.PLS!=="[]")){if(d=i.PLS.split(":-MODELUPDATE-:"),v=d[0],t.MyStorageMirror[r]&&cde.CBool(e)!==!0)for(w=typeof v=="object"?v:JSON.parse(v),p=0;p<w.length;p++){for(b=t.MyStorageMirror[r].length,nt=!1,c=0;c<b;c++)if(t.MyStorageMirror[r][c].cdeMID===w[p].cdeMID){t.MyStorageMirror[r][c]=w[p];nt=!0;break}nt||(t.MyStorageMirror[r][b]=w[p])}else t.MyStorageMirror[r]=typeof v=="object"?v:JSON.parse(v);if(d.length>1&&t.MyStorageMeta&&(t.MyStorageMeta[r]||cde.CBool(e)===!0)&&(it=JSON.parse(d[1]),t.MyStorageMeta[r]=it),n.MyEngine&&n.MyEngine.FireLazyLoaded(ut,r,t.MyStorageMirror[r]),f==="noview")return null}if(k=t&&t.MyStorageMeta&&t.MyStorageMeta[r]?t.MyStorageMeta[r]:null,l=null,f&&(l=n.MyTCF.CreateNMIControl(n.cdeControlType.BaseControl),l.MyScreenID=cde.GuidToString(f),g=document.getElementById("Content_"+l.MyScreenID),g||(g=document.getElementById(l.MyScreenID)),l.SetElement(g)),h=null,s=n.MyScreenManager&&f?n.MyScreenManager.GetScreenByID(f):null,k){if(a=n.TheTRF.FromScreenForm(t,r),k.IsAlwaysEmpty===!0&&(a.RowNo=-1),y=cde.GuidToString(n.ThePB.GetValueFromBagByName(k.PropertyBag,"TableReference")),!o&&s&&s.GetProperty("TTSCookie")&&(o=s.GetProperty("TTSCookie")),o)if(a.RowID=o,a.RowNo=-1,y&&(r=y),t.MyStorageMirror[r]){for(b=t.MyStorageMirror[r].length,c=0;c<b;c++)if(t.MyStorageMirror[r][c].cdeMID===a.RowID){a.RowNo=c;break}}else n.MyPopUp&&n.MyPopUp.Show("Template in use but has no Table Reference");h=n.MyTCF.CreateNMIControl(a.FldInfo.Type).Create(l,{ScreenID:cde.GuidToString(t.MyDashboard.cdeMID),TRF:a,PreInitBag:["ExtraInfo="+u,y?"TableReference="+y:""],PostInitBag:k.PropertyBag});h&&n.MyTCF&&l&&(tt=n.MyTCF.GetRegisteredControl(l.MyScreenID,"TE"),tt&&h.SetTE(tt));s&&(h.OnLoaded(),h&&h.MyFieldInfo&&n.ThePB.SetPropertiesFromBag(s,h.MyFieldInfo.PropertyBag,null,!1,!1),s.SetInitialized(!0),s.MySavePin&&s.MySavePin.SetProperty("Visibility",!0),s.MyRefreshPin&&(!y||y.length===0)&&s.MyRefreshPin.SetProperty("Visibility",!0),h&&(s.MyNMIControl=h))}else if(s)return rt=r+":CMyForm:"+r+":"+cde.GuidToString(s.GetProperty("DashID"))+":true:false",n.MyEngine||this.FireEvent(!0,"FetchData",rt),null;return f?n.MyTCF.RegisterControl("TABLES",l.MyScreenID,h):n.MyTCF.RegisterControl("TABLES",r,h),h},i.prototype.CreateLiveScreen=function(t){var i=cde.GuidToString(t.cdeMID),f,e,o,s,u,r;if(!n.MyNMIModels[i]||t.ForceReload?n.MyNMIModels[i]=t:n.MyNMIModels[i].MyStorageMirror||(n.MyNMIModels[i].MyStorageMirror=[]),t&&t.MyStorageInfo)for(n.MyNMIModels[i].MyStorageMeta||(n.MyNMIModels[i].MyStorageMeta=[]),f=0;f<t.MyStorageInfo.length;f++)n.MyNMIModels[i].MyStorageMeta[i]=t.MyStorageInfo[f];return(e=n.MyTCF.CreateNMIControl(n.cdeControlType.BaseControl),e.MyScreenID=i,o=document.getElementById("Content_"+cde.GuidToString(i)),o)?(s=n.TheTRF.FromScreenForm(t,i),e.SetElement(o),u=n.MyTCF.CreateNMIControl(n.cdeControlType.FormView).Create(e,{ScreenID:i,TRF:s,PreInitBag:["ILF=true"]}),n.MyTCF.RegisterControl("TABLES",i,u),r=n.MyScreenManager&&i?n.MyScreenManager.GetScreenByID(i):null,r&&(r.SetInitialized(!0),r.MySavePin&&r.MySavePin.SetProperty("Visibility",!0),r.MyRefreshPin&&r.MyRefreshPin.SetProperty("Visibility",!0),u&&(r.MyNMIControl=u)),u):null},i.prototype.CreateDashboard=function(t,i){var r=cde.GuidToString(t.cdeMID),s=!1,e,u,h,f,o;if(t.MyDashboard&&(r=cde.GuidToString(t.MyDashboard.cdeMID),!n.MyNMIModels[r]||t.ForceReload?n.MyNMIModels[r]=t:(n.MyNMIModels[r]&&!n.MyNMIModels[r].MyDashboard&&(n.MyNMIModels[r].MyDashboard=t.MyDashboard),n.MyNMIModels[r].MyStorageMirror||(n.MyNMIModels[r].MyStorageMirror=[])),s=!0,cde.MyBaseAssets.MyServiceHostInfo.WasPortalRequested=!0),!n.MyNMIModels[r]||s&&t.ForceReload)n.MyNMIModels[r]=t;else if(t&&t.MyDashPanels&&t.MyDashPanels.length>0){for(e={},u=void 0,u=0;u<n.MyNMIModels[r].MyDashPanels.length;u++)n.MyNMIModels[r].MyDashPanels[u].cdeN===t.cdeN&&(e[n.MyNMIModels[r].MyDashPanels[u].cdeMID]=!1);for(f=0;f<t.MyDashPanels.length;f++){for(h=!1,u=0;u<n.MyNMIModels[r].MyDashPanels.length;u++)if(t.MyDashPanels[f].cdeMID===n.MyNMIModels[r].MyDashPanels[u].cdeMID){n.MyNMIModels[r].MyDashPanels[u]=t.MyDashPanels[f];h=!0;e[n.MyNMIModels[r].MyDashPanels[u].cdeMID]=!0;break}h||(n.MyNMIModels[r].MyDashPanels.push(t.MyDashPanels[f]),e[t.MyDashPanels[f].cdeMID]=!0)}for(u=n.MyNMIModels[r].MyDashPanels.length-1;u>=0;u--)n.MyNMIModels[r].MyDashPanels[u].cdeN!==t.cdeN||e[n.MyNMIModels[r].MyDashPanels[u].cdeMID]&&e[n.MyNMIModels[r].MyDashPanels[u].cdeMID]!==!1||(n.MyScreenManager&&n.MyScreenManager.DeleteScreenByID(n.MyNMIModels[r].MyDashPanels[u].cdeMID,!1),n.MyNMIModels[r].MyDashPanels.splice(u,1))}if(t&&t.MyStorageInfo)for(n.MyNMIModels[r].MyStorageMeta||(n.MyNMIModels[r].MyStorageMeta=[]),f=0;f<t.MyStorageInfo.length;f++)n.MyNMIModels[r].MyStorageMeta[cde.GuidToString(t.MyStorageInfo[f].AssociatedClassName)]=t.MyStorageInfo[f];return s?(o=n.MyTCF.CreateNMIControl(n.cdeControlType.Dashboard,!0),o&&o.Create(n.MyScreenManager,{ScreenID:r,PreInitBag:[i]}),o):null},i}(n.TheNMIBaseControl),t,i;n.TheScreenManager=r;t=function(t){function i(){var i=t.call(this,null)||this;return i.MyHeaderTitle=null,i.MyThemeSwitch=null,i.mLogoButton=null,i.mHeaderTileSize=0,i.MyBaseType=n.cdeControlType.ScreenManager,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e,s,o,h;return t.prototype.InitControl.call(this,i,r,u,f),this.MyHeader=document.getElementById("MyHeader"),this.MyHeader||(this.MyHeader=document.createElement("div"),this.MyHeader.className="cdeHeader",this.MyHeader.id="MyHeader",this.GetElement().parentNode.insertBefore(this.MyHeader,this.GetElement().nextSibling)),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===5&&(e=document.createElement("div"),e.className="cdeBottomSpacer",s=document.createElement("div"),e.style.height="100px",e.style.width="10px",e.appendChild(s),this.GetElement().parentNode.insertBefore(e,this.GetElement().nextSibling)),this.mDivHeaderButtons=document.getElementById("HeaderButtonContent"),this.mDivHeaderButtons||(this.mDivHeaderButtons=document.createElement("div"),this.mDivHeaderButtons.id="HeaderButtonContent",this.MyHeader.appendChild(this.mDivHeaderButtons)),o=cde.MyBaseAssets.MyServiceHostInfo.ApplicationTitle,this.mDivHeaderTitle=document.getElementById("cdeHeaderTitle"),this.mDivHeaderTitle?o=this.mDivHeaderTitle.innerHTML:(this.mDivHeaderTitle=document.createElement("div"),this.mDivHeaderTitle.className="cdeMyHeaderTitle",this.mDivHeaderTitle.id="cdeHeaderTitle",this.MyHeader.appendChild(this.mDivHeaderTitle)),this.MyHeaderTitle=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(null,{PreInitBag:["Element=span"],PostInitBag:["iValue="+o,"ClassName=cdeMyHeaderTitle"]}),this.mDivHeaderTitle.innerHTML="",this.mDivHeaderTitle.appendChild(this.MyHeaderTitle.GetElement()),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1&&cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==5&&(h=document.getElementById("MyNMIPortal"),h.style.marginTop="78px"),this.RegisterEvents(),!0},i.prototype.SetApplicationBar=function(){var t=this,f,e,u,i,r;this.mDivHeadButtonContent||(this.mDivHeadButtonContent=document.getElementById("HeaderButtonContent"),this.mDivHeadButtonContent)&&(this.MyMainBackButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa' style='font-size:40px'>&#xf359;<\/span>","ClassName=MyHeaderButton"]}),this.MyMainBackButton.SetProperty("OnClick",function(){t.NavigateBack(!1)}),this.MyMainBackButton.SetProperty("TabIndex",5),this.MyMainBackButton.SetProperty("Disabled",!0),this.MyMainBackButton.SetProperty("Visibility",this.IsBrowserFullscreen||cde.MyBaseAssets.MyServiceHostInfo.WebPlatform>2||cde.MyBaseAssets.MyServiceHostInfo.IsAppHosted===!0),this.MyThemeSwitch=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa' style='font-size:40px'>&#xf185;<\/span>","ClassName=cdeVertCenter"]}),this.MyThemeSwitch.SetProperty("OnClick",function(){return n.ToggleTheme()}),f=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa' style='font-size:40px'>&#xf0c7;<\/span>","ClassName=cdeVertCenter"]}),f.SetProperty("OnClick",function(i,r){var e,f,u,o;if(r.button===2){if(t.CurrentScreen)n.MyPopUp&&n.MyPopUp.Show(cde.MyBaseAssets.MyCommStatus.MyServiceUrl+"/nmi?CDEDL="+t.CurrentScreen.MyScreenID+";"+t.CurrentScreen.GetProperty("DashID"),!0);else if(t.StartView&&t.StartView.FriendlyName==="MyHome"){e=t.StartView;e.Screens=[];for(f in t.MyNMIScreens)t.MyNMIScreens.hasOwnProperty(f)&&(u=new n.TheScreenTrans,u.ID=t.MyNMIScreens[f].MyScreenID,u.DashID=t.MyNMIScreens[f].GetProperty("DashID"),u.IsVisible=t.MyNMIScreens[f].GetProperty("Visibility"),u.IsPinned=t.MyNMIScreens[f].GetProperty("IsPinned"),u.FldOrder=t.MyNMIScreens[f].GetProperty("FldOrder"),(u.IsVisible||u.IsPinned)&&e.Screens.push(u));o=JSON.stringify(e);n.MyEngine&&(n.MyEngine.PublishToNMI("NMI_SAVE_HOMESCENE",o),n.ShowToastMessage("My Home Scene updated!"))}return}t.ShowCreateViewPopup()}),e=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa' style='font-size:40px'>&#xf1fc;<\/span>","ClassName=cdeVertCenter"]}),e.SetProperty("OnClick",function(){n.MyPopUp&&n.MyPopUp.Hide(!1);t.ShowHideDrawOverlay()}),u=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa' style='font-size:40px'>&#xf021;<\/span>","ClassName=cdeVertCenter"]}),u.SetProperty("OnClick",function(i,r){var u,f;if(n.MyPopUp&&n.MyPopUp.Hide(!1),u=!1,r.button===2&&(u=!0),t.CurrentScreen&&t.CurrentScreen!==t.GetScreenByID(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen)){if(t.CurrentScreen.MyRefreshButton){t.CurrentScreen.MyRefreshButton.DoFireClick(null);return}n.MyEngine&&(f="NMI_GET_DATA:"+t.CurrentScreen.MyScreenID+":"+t.CurrentScreen.GetProperty("ControlClass")+":"+t.CurrentScreen.GetProperty("DashID")+":true:"+u,n.MyEngine.PublishToNMI(f,"",t.CurrentScreen.MyFieldInfo?t.CurrentScreen.MyFieldInfo.cdeN:null));return}cde.MyBaseAssets.MyServiceHostInfo.StartScreen===""&&(n.MyNMIModels[cde.GuidToString(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen)]=null);n.MyToast&&n.MyToast.ShowToastMessage("Portal Refresh sent!","Touch the home icon to see the changes",1e4);n.MyEngine&&n.MyEngine.RequestReloadModel(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen);t.RequestPortalScreen(cde.MyBaseAssets.MyServiceHostInfo.StartScreen?!0:u)}),i=[],cde.MyBaseAssets.MyServiceHostInfo.WebPlatform<2&&(i[0]=this.MyThemeSwitch),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===0&&(i[1]=f,i[2]=e,i[3]=u),this.mLogoButton=n.MyTCF.CreateNMIControl(n.cdeControlType.LogoButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1"]}),this.mLogoButton.SetProperty("OnClick",function(i,r){n.MyPopUp&&n.MyPopUp.Hide(!1);r.button===2?t.ClearAndGoHome():t.GotoStationHome(!1)}),r=n.MyTCF.CreateNMIControl(n.cdeControlType.RevealButton).Create(null),r.SetProperty("Image",this.mLogoButton),r.SetProperty("TabIndex",6),r.SetProperty("ControlArray",i),this.mDivHeadButtonContent&&this.mDivHeadButtonContent.appendChild(r.GetElement()),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform>1&&cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==4&&this.mDivHeadButtonContent&&(this.mDivHeadButtonContent.appendChild(this.MyThemeSwitch.GetElement()),this.mDivHeadButtonContent.appendChild(u.GetElement())),this.mDivHeadButtonContent&&((cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1||cde.MyBaseAssets.MyServiceHostInfo.IsAppHosted===!0)&&(cde.MyBaseAssets.MyServiceHostInfo.IsAppHosted&&this.MyMainBackButton.SetProperty("Visibility",!0),this.mDivHeadButtonContent.insertBefore(this.MyMainBackButton.GetElement(),this.mDivHeadButtonContent.children[0]),this.RegisterEvent("OnBrowserFullscreen",function(n,i){cde.MyBaseAssets.MyServiceHostInfo.WebPlatform<2&&t.MyMainBackButton.SetProperty("Visibility",i)})),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===2&&this.SetHoloLens()),n.ApplyTheme())},i.prototype.SetStatusMsg=function(n,i){this.mLogoButton&&this.mLogoButton.SetProperty("LogoState",i);t.prototype.SetStatusMsg.call(this,n,i)},i.prototype.CreateLoginButtonOnly=function(){t.prototype.CreateLoginButtonOnly.call(this)},i.prototype.ResizeEventHandler=function(){t.prototype.ResizeEventHandler.call(this);this.MyHeaderTitle&&(this.mHeaderTileSize===0&&(this.mHeaderTileSize=this.MyHeaderTitle.GetElement().parentElement.offsetWidth+n.GetSizeFromTile(5)),window.outerWidth<this.mHeaderTileSize?this.MyHeaderTitle.SetProperty("Visibility",!1):this.MyHeaderTitle.SetProperty("Visibility",!0))},i.prototype.RenderHeader=function(){return},i.prototype.ShowHeader=function(n){cde.CBool(n)?this.MyHeader&&cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==2&&(this.MyHeader.style.display=""):this.MyHeader&&(this.MyHeader.style.display="none")},i.prototype.SwitchTheme=function(n){this.MyThemeSwitch&&(n?this.MyThemeSwitch.SetProperty("Title","<span class='fa' style='font-size:40px'>&#xf185;<\/span>"):this.MyThemeSwitch.SetProperty("Title","<span class='fa' style='font-size:40px'>&#xf186;<\/span>"))},i.prototype.SetHoloLens=function(){return t.prototype.SetHoloLens.call(this),document.getElementById("MyHeader").style.display="none",""},i}(n.TheScreenManager);n.TheScreenManagerClassic=t;i=function(t){function i(){var i=t.call(this,null)||this;return i.MyHeaderTitle=null,i.MyThemeSwitch=null,i.MyLogoButton=null,i.mHeaderTileSize=0,i.mSideBarState=0,i.MyBaseType=n.cdeControlType.ScreenManager,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e,o;return t.prototype.InitControl.call(this,i,r,u,f),this.MyHeader=document.getElementById("MyHeader"),this.MyHeader||(this.MyHeader=document.createElement("div"),this.MyHeader.className="cdeHeader",this.MyHeader.id="MyHeader",this.GetElement().parentNode.insertBefore(this.MyHeader,this.GetElement().nextSibling)),this.mDivHeaderButtons=document.getElementById("HeaderButtonContent"),this.mDivHeaderButtons||(this.mDivHeaderButtons=document.createElement("div"),this.mDivHeaderButtons.id="HeaderButtonContent",this.MyHeader.appendChild(this.mDivHeaderButtons)),this.mDivSideBar=document.getElementById("cdeSideBar"),this.mDivSideBar||(this.mDivSideBar=document.createElement("div"),this.mDivSideBar.id="cdeSideBar",this.mDivSideBar.className="cdeSideBar",cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===5?this.mDivSideBar.style.marginBottom="48px":this.mDivSideBar.style.marginTop="48px",this.MyHeader.parentNode.insertBefore(this.mDivSideBar,this.MyHeader.nextSibling)),this.mDivHeaderTitle=document.getElementById("cdeHeaderTitle"),e=cde.MyBaseAssets.MyServiceHostInfo.ApplicationTitle,this.mDivHeaderTitle?e=this.mDivHeaderTitle.innerHTML:(this.mDivHeaderTitle=document.createElement("div"),this.mDivHeaderTitle.className="cdeMyHeaderTitleModern",this.mDivHeaderTitle.id="cdeHeaderTitle",this.MyHeader.appendChild(this.mDivHeaderTitle)),this.MyHeaderTitle=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(null,{PreInitBag:["Element=span"],PostInitBag:["iValue="+e,"ClassName=cdeMyHeaderTitleModern"]}),this.mDivHeaderTitle.innerHTML="",this.mDivHeaderTitle.appendChild(this.MyHeaderTitle.GetElement()),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1&&(o=document.getElementById("MyNMIPortal"),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==5&&(o.style.marginTop="50px")),this.RegisterEvents(),!0},i.prototype.SetApplicationBar=function(){var t=this,i,r,u,f,e,o,s;this.mDivHeadButtonContent||(this.mDivHeadButtonContent=document.getElementById("HeaderButtonContent"),this.mDivHeadButtonContent)&&(this.MyMainBackButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["Title=<span class='fa' style='font-size:24px'>&#xf359;<\/span>","ClassName=MyHeaderButton","PixelHeight=48"]}),this.MyMainBackButton.SetProperty("OnClick",function(){t.NavigateBack(!1)}),this.MyMainBackButton.SetProperty("TabIndex",5),this.MyMainBackButton.SetProperty("Disabled",!0),this.MyMainBackButton.SetProperty("Visibility",!1),i=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(null,{PreInitBag:["ControlTW=4","ControlTH=1","TileFactorY=2"]}),i.SetProperty("ClassName","cdeSideTiles"),this.mDivSideBar.appendChild(i.GetElement()),r=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(i,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["Title=<span class='fa' style='font-size:24px'>&#xf015;<\/span>","ClassName=cdeVertCenter"]}),r.SetProperty("OnClick",function(i,r){n.MyPopUp&&n.MyPopUp.Hide(!1);r.button===2?t.ClearAndGoHome():t.GotoStationHome(!1);t.ToggleSideBar(2)}),this.MyThemeSwitch=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(i,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["Title=<span class='fa' style='font-size:24px'>&#xf185;<\/span>","ClassName=cdeVertCenter"]}),this.MyThemeSwitch.SetProperty("OnClick",function(){return n.ToggleTheme()}),u=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(i,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["Title=<span class='fa' style='font-size:24px'>&#xf0c7;<\/span>","ClassName=cdeVertCenter"]}),u.SetProperty("OnClick",function(i,r){var e,f,u,o;if(r.button===2){if(t.CurrentScreen)n.MyPopUp&&n.MyPopUp.Show(cde.MyBaseAssets.MyCommStatus.MyServiceUrl+"/nmi?CDEDL="+t.CurrentScreen.MyScreenID+";"+t.CurrentScreen.GetProperty("DashID"),!0);else if(t.StartView&&t.StartView.FriendlyName==="MyHome"){e=t.StartView;e.Screens=[];for(f in t.MyNMIScreens)t.MyNMIScreens.hasOwnProperty(f)&&(u=new n.TheScreenTrans,u.ID=t.MyNMIScreens[f].MyScreenID,u.DashID=t.MyNMIScreens[f].GetProperty("DashID"),u.IsVisible=t.MyNMIScreens[f].GetProperty("Visibility"),u.IsPinned=t.MyNMIScreens[f].GetProperty("IsPinned"),u.FldOrder=t.MyNMIScreens[f].GetProperty("FldOrder"),(u.IsVisible||u.IsPinned)&&e.Screens.push(u));o=JSON.stringify(e);n.MyEngine&&(n.MyEngine.PublishToNMI("NMI_SAVE_HOMESCENE",o),n.ShowToastMessage("My Home Scene updated!"))}return}t.ShowCreateViewPopup();t.ToggleSideBar(2)}),f=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(i,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["Title=<span class='fa' style='font-size:24px'>&#xf1fc;<\/span>","ClassName=cdeVertCenter"]}),f.SetProperty("OnClick",function(){n.MyPopUp&&n.MyPopUp.Hide(!1);t.ToggleSideBar(2);t.ShowHideDrawOverlay()}),e=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(i,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["Title=<span class='fa' style='font-size:24px'>&#xf021;<\/span>","ClassName=cdeVertCenter"]}),e.SetProperty("OnClick",function(i,r){var u,f;if(n.MyPopUp&&n.MyPopUp.Hide(!1),t.ToggleSideBar(2),u=!1,r.button===2&&(u=!0),t.CurrentScreen&&t.CurrentScreen!==t.GetScreenByID(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen)){if(t.CurrentScreen.MyRefreshButton){t.CurrentScreen.MyRefreshButton.DoFireClick(null);return}n.MyEngine&&(f="NMI_GET_DATA:"+t.CurrentScreen.MyScreenID+":"+t.CurrentScreen.GetProperty("ControlClass")+":"+t.CurrentScreen.GetProperty("DashID")+":true:"+u,n.MyEngine.PublishToNMI(f,"",t.CurrentScreen.MyFieldInfo?t.CurrentScreen.MyFieldInfo.cdeN:null));return}cde.MyBaseAssets.MyServiceHostInfo.StartScreen===""&&(n.MyNMIModels[cde.GuidToString(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen)]=null);n.MyToast&&n.MyToast.ShowToastMessage("Portal Refresh sent!","Touch the home icon to see the changes",1e4);n.MyEngine&&n.MyEngine.RequestReloadModel(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen);t.RequestPortalScreen(cde.MyBaseAssets.MyServiceHostInfo.StartScreen?!0:u)}),cde.MyBaseAssets.MyServiceHostInfo.RedPill&&(o=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(i,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["Title=<span class='fa' style='font-size:24px; color:red;'>&#xf0c7;<\/span>","ClassName=cdeVertCenter"]}),o.SetProperty("OnClick",function(){n.MyPopUp&&n.MyPopUp.Hide(!1);t.ToggleSideBar(2);n.TL.SaveResources()})),this.MyLogoButton=n.MyTCF.CreateNMIControl(n.cdeControlType.LogoButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["ClassName=MyHeaderButton","PixelHeight=48","PixelWidth=48","FontSize=48"]}),this.MyLogoButton.SetProperty("OnClick",function(i,r){n.MyPopUp&&n.MyPopUp.Hide(!1);t.MyDrawOverlay&&t.ShowHideDrawOverlay();r.button===2?t.ClearAndGoHome():t.ToggleSideBar(-1)}),this.mDivHeadButtonContent&&(this.mDivHeadButtonContent.appendChild(this.MyLogoButton.GetElement()),(cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1||cde.MyBaseAssets.MyServiceHostInfo.IsAppHosted)&&(cde.MyBaseAssets.MyServiceHostInfo.IsAppHosted&&this.MyMainBackButton.SetProperty("Visibility",!0),this.mDivHeadButtonContent.insertBefore(this.MyMainBackButton.GetElement(),this.mDivHeadButtonContent.children[0]),this.RegisterEvent("OnBrowserFullscreen",function(n,i){t.MyMainBackButton.SetProperty("Visibility",i)})),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===2&&this.SetHoloLens()),cde.MyBaseAssets.MyServiceHostInfo.HideHeader&&(this.MyHeader.style.display="none",s=document.getElementById("MyNMIPortal"),s.style.marginTop="0px"),this.mDivScreenList=document.createElement("div"),this.mDivScreenList.className="cdeScreenList",this.mDivScreenList.id="cdeScreenList",this.mDivSideBar.appendChild(this.mDivScreenList),n.ApplyTheme())},i.prototype.SetStatusMsg=function(n,i){this.MyLogoButton&&(i===1?this.MyLogoButton.SetProperty("Reset",1):this.MyLogoButton.SetProperty("LogoState",i));t.prototype.SetStatusMsg.call(this,n,i)},i.prototype.CreateScreenList=function(){var h=this,c,e,i,t,u,r,f,o,s;if(this.mDivScreenList){this.mDivScreenList.innerHTML="";c=n.SortNamedArray(this.MyNMIScreens,"LastShow",!1,!0);for(e in c)(i=this.GetScreenByID(e),i&&i.GetInitialized()&&(!i.MyFieldInfo||cde.CBool(i.MyFieldInfo.HideFromSideBar)!==!0)&&cde.CBool(i.GetProperty("HideFromSideBar"))!==!0)&&((t="",t=i.GetProperty("ScreenTitle"),t||(t=i.GetProperty("Title")),t||(t=i.GetProperty("Caption")),t&&t.endsWith("-HIDE"))||(u="<span class='fa fa-2x' style='vertical-align:middle;'>&#xf03e;<\/span>",i.GetProperty("SideBarTitle")&&(t=i.GetProperty("SideBarTitle")),t)&&((r=n.StripHTML(t),r!==t&&(t.indexOf("'fa")>=0||t.indexOf('"fa')>=0?t.indexOf("fa fa")>0&&t.length>32?(f=t.indexOf("<\/i>"),f>=0&&(u=t.substr(0,f+4).replace("fa-5x","fa-2x"),t=n.StripHTML(t.substr(f+4)))):t=r:t=r),i.GetProperty("SideBarIconFA")&&(u="<span class='fa fa-2x' style='vertical-align:middle;'>"+i.GetProperty("SideBarIconFA")+"<\/span>"),r.startsWith("Loading..."))||(r===""&&(t="No Title - due to html strip"),o=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(null,{PreInitBag:["ControlTH=1","TileFactorY=2"],PostInitBag:["TileWidth=4"]}),this.mDivScreenList.appendChild(o.GetElement()),s=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(o,{PreInitBag:["ControlTH=1","TileFactorY=2"],PostInitBag:["TileWidth=4","Title="+u+"&nbsp;&nbsp;"+t,"ClassName=cdeScreenListButton"]}),s.SetProperty("Cookie",e),s.SetProperty("OnClick",function(t){n.MyPopUp&&n.MyPopUp.Hide(!1);h.ToggleSideBar(2);var i=t.GetProperty("Cookie");h.TransitToScreen(i)}))))}},i.prototype.ToggleSideBar=function(t){t>=0&&(this.mSideBarState=t);switch(this.mSideBarState){case 0:this.mDivSideBar.style.width=n.GetSizeFromTile(1)/2+"px";this.mSideBarState=1;this.mDivSideBar.classList.remove("cde-animate-left");this.mDivScreenList.style.bottom=n.GetSizeFromTile(1)*3+"px";this.CreateScreenList();break;case 1:this.mDivSideBar.style.width=n.GetSizeFromTile(4)+"px";this.mDivSideBar.classList.contains("cde-animate-left")||this.mDivSideBar.classList.add("cde-animate-left");this.mSideBarState=2;this.mDivScreenList.style.bottom=n.GetSizeFromTile(1)*1+"px";this.CreateScreenList();break;case 2:this.mDivSideBar.style.width="0px";this.mDivSideBar.classList.remove("cde-animate-left");this.mSideBarState=0}},i.prototype.CreateLoginButtonOnly=function(){var f=this,r,t,i,u;cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==0?(r=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX=2","TileFactorY=2"],PostInitBag:["Title=<span class='fa' style='font-size:24px'>&#xf2bd;<\/span>","ClassName=MyHeaderButton","PixelHeight=48"]}),r.SetProperty("OnClick",function(t,i){i.button===2&&cde.MyBaseAssets.MyServiceHostInfo.WasPortalRequested===!0?f.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen):n.ResetBrowserToPortal()})):r=n.MyTCF.CreateNMIControl(n.cdeControlType.UserMenu).Create(null,{PreInitBag:["TileFactorY=2"]});r.SetProperty("TabIndex",15);t=document.getElementById("HeaderButtonContentRight");t||(t=document.createElement("div"),t.className="cdeHeaderButtonContentRight",t.id="HeaderButtonContentRight",i=document.getElementById("MyHeader"),i||(i=document.createElement("div"),i.className="cdeLogoffTopRight",i.id="MyLogoffButton",this.GetElement().parentNode.insertBefore(i,this.GetElement().nextSibling)),i.appendChild(t));cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1&&(u=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorY=2"],PostInitBag:["Title="+n.UpdateClock(2),"ClassName=cdeClock","PixelHeight=48"]}),u.SetProperty("Disabled",!0),t.appendChild(u.GetElement()),n.StartClock(u,2));t.appendChild(r.GetElement())},i.prototype.ResizeEventHandler=function(){t.prototype.ResizeEventHandler.call(this);this.MyHeaderTitle&&(this.mHeaderTileSize===0&&(this.mHeaderTileSize=this.MyHeaderTitle.GetElement().parentElement.offsetWidth+n.GetSizeFromTile(5)),window.outerWidth<this.mHeaderTileSize?this.MyHeaderTitle.SetProperty("Visibility",!1):this.MyHeaderTitle.SetProperty("Visibility",!0))},i.prototype.RenderHeader=function(){return},i.prototype.ShowHeader=function(n){cde.CBool(n)?this.MyHeader&&cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==2&&(this.MyHeader.style.display=""):this.MyHeader&&(this.MyHeader.style.display="none")},i.prototype.SwitchTheme=function(n){this.MyThemeSwitch&&(n?this.MyThemeSwitch.SetProperty("Title","<span class='fa' style='font-size:23px'>&#xf185;<\/span>"):this.MyThemeSwitch.SetProperty("Title","<span class='fa' style='font-size:23px'>&#xf186;<\/span>"))},i.prototype.SetHoloLens=function(){return t.prototype.SetHoloLens.call(this),document.getElementById("MyHeader").style.display="none",""},i.prototype.TransitToScreen=function(n,i,r,u,f){i===void 0&&(i=!1);r===void 0&&(r=!1);this.ToggleSideBar(2);t.prototype.TransitToScreen.call(this,n,i,r,u,f)},i}(n.TheScreenManager);n.TheScreenManagerModern=i}(cdeNMI||(cdeNMI={}));String.prototype.endsWith||(String.prototype.endsWith=function(n){return this.indexOf(n,this.length-n.length)!==-1});String.prototype.startsWith||(String.prototype.startsWith=function(n){return this.indexOf(n)!==-1});String.prototype.format||(String.prototype.format=function(){for(var i,n,u,r=[],t=0;t<arguments.length;t++)r[t]=arguments[t];for(i=this,n=0;n<r.length;n++)u=new RegExp("\\{"+n+"\\}","gi"),i=i.replace(u,r[n]);return i}),function(n){function o(n){(n||(n=window.event),n)&&(n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation(),n.preventDefault&&n.preventDefault())}function s(n,t){n&&(n.style.position="relative",n.style.zIndex=t.toString())}function h(t){return String(t).replace(/[&<>"']/g,function(t){return n.TheEscapeMap[t]})}function c(n){var t=n.GetSetting("TileWidth");return t||(t=4),cde.CBool(n.GetSetting("NoTE"))===!0&&(t-=2),t<0&&(t=1),t}function l(){var n=document.createElement("div");return n.setAttribute("ongesturestart","return;"),typeof n.ontouchmove=="object"?!0:!1}function a(){cde.MyBaseAssets.MyServiceHostInfo.PortalPage!==""?n.ResetBrowserToPortal():window.location.reload()}function v(){n.Key13Event=null;n.Key27Event=null;n.IsInEdit=!1;n.DisableKey36Event=!1}function y(){return}function p(){cde.MyContentEngine&&cde.MyContentEngine.PublishToService("CDE_INIT_SYNC","");n.MyEngine&&n.MyEngine.FireEvent(!0,"NMI_TOAST","Sync request sent to Relay")}function w(t,i,r){n.MyToast&&n.MyToast.ShowToastMessage(t,i,r)}function b(){cde.MyContentEngine&&cde.MyContentEngine.PublishToFirstNode("CDE_REQ_UPDATE","");n.MyPopUp&&n.MyPopUp.Show("Relay is restarting in several seconds. Click ok to logout",!0,null,1,n.CleanState)}function k(){n.MyPopUp&&n.MyPopUp.Show("Are you sure you want to install this update? Your relay will restart and you need to login again.",!1,null,1,b)}function u(n){return n===void 0&&(n=1),n<1&&(n=1),moment().format("[<span style='font-size:"+32/n+"px; font-weight: bold;'>]HH:mm[<\/span><\/BR><span style='font-size:"+24/n+"px'>]YYYY-MM-DD")}function d(n,t){return moment(n).format(t)}function g(n){return moment(Date.now()).format(n)}function nt(n,t){(t===void 0&&(t=1),n)&&setInterval(function(){n.SetProperty("iValue",u(t))},6e4)}function tt(n){var t=document.createElement("a");return t.href=n,t}function it(){var t=n.MyTCF.CreateNMIControl(n.cdeControlType.Password).Create(null,{TRF:new n.TheTRF("SecID",1,new n.TheFieldInfo(n.cdeControlType.SingleEnded,-1,"SecID:",2,"SCOPEREQ")),PostInitBag:["InnerClassName=cdeInput cdeInputCenter"]}),i;n.MyPopUp&&(i=n.MyPopUp.Show("Are you sure you want to request a new Security ID?<\/br>All agents and nodes connected to this relay will have to update their corresponding IDs as well. If this is a secondary Relay, enter the ID of your primary relay here, otherwise leave this field blank",!1,t,1,function(n){var t=n.GetProperty("tEdit"),i="";t&&(i=t.GetProperty("Value"));cde.MyContentEngine&&cde.MyContentEngine.PublishToFirstNode("CDE_REQ_SCOPEID",cde.MyContentEngine.RSAEncrypt(i))}),i.SetProperty("tEdit",t))}function rt(n){var t=document.getElementById("MyNMIPortal");t&&(t.style.width=n?"100%":null)}function ut(t,i){var r=n.MyNMINUITags[t];t==="go home"?n.MyScreenManager&&n.MyScreenManager.GotoStationHome(!1):t==="go back"?n.MyScreenManager&&n.MyScreenManager.NavigateBack(!1):r&&r.OnNUITag(t,i)}function ft(){var t="go home;go back";for(var i in n.MyNMINUITags)Object.prototype.hasOwnProperty.call(n.MyNMINUITags,i)&&(t.length>0&&(t+=";"),t+=i);return t}function et(){return n.MyScreenManager?n.MyScreenManager.GetCurrentScreen():""}function f(){var i,t,u,r;if(cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme){for(i=document.getElementsByTagName("link"),t=0;t<i.length;t++)i[t].hasAttribute("lite")&&(u=i[t].attributes.lite,u&&(r=cde.MyBaseAssets.MyCommStatus.InitialNPA,i[t].setAttribute("href",u.nodeValue+(r?"?SID="+r.substr(4,r.length-(4+(r.indexOf(".ashx")>0?5:0))):""))));n.MyScreenManager&&n.MyScreenManager.SwitchTheme(!1)}else{for(i=document.getElementsByTagName("link"),t=0;t<i.length;t++)i[t].hasAttribute("dark")&&(u=i[t].attributes.dark,u&&(r=cde.MyBaseAssets.MyCommStatus.InitialNPA,i[t].setAttribute("href",u.nodeValue+(r?"?SID="+r.substr(4,r.length-(4+(r.indexOf(".ashx")>0?5:0))):""))));n.MyScreenManager&&n.MyScreenManager.SwitchTheme(!0)}cde.MyBaseAssets.FireEvent(!0,"ThemeSwitched",cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme)}function ot(){cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme=!cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme;f()}function st(n,t){var e=cde.FixupPath(n).toLowerCase(),u,f,i,r,o;if(cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme&&t&&(e=cde.FixupPath(t).toLowerCase()),u=document.getElementsByTagName("link"),u.length>0)for(f=0;f<u.length;f++)if(u[f].getAttribute("href").toLowerCase()===e)return;i=document.createElement("link");i.setAttribute("rel","stylesheet");i.setAttribute("type","text/css");i.setAttribute("cde","colorScheme");i.setAttribute("media","screen");i.setAttribute("dark",cde.FixupPath(n));t&&i.setAttribute("lite",cde.FixupPath(t));i.setAttribute("cde","colorScheme");r=cde.MyBaseAssets.MyCommStatus.InitialNPA;i.setAttribute("href",e+(r?"?SID="+r.substr(4,r.length-(4+(r.indexOf(".ashx")>0?5:0))):""));o=document.getElementsByTagName("head")[0];o.insertBefore(i,o.childNodes[0])}function ht(n){var i=document.getElementsByTagName("head")[0],t=document.createElement("link");t.type="text/css";t.rel="stylesheet";t.href=n+".css";t.media="screen";i.appendChild(t)}function ct(t){var i=n.TheFlashCache.GetCache(t),f,r,u,e,h,o,s;if(i)return i;if(i="",f=cde.GuidToString("B510837F-3B75-4CF2-A900-D36C19113A13"),r=t.split(":"),r.length>2){if(u=n.MyNMIModels[cde.GuidToString("FAFA22FF-96AC-42CF-B1DB-7C073053FC39")],!u||!u.MyStorageMirror[f])return"";for(e=0;e<u.MyStorageMirror[f].length;e++)(h=u.MyStorageMirror[f][e],o=n.GetFldContentByName(h,"MyPropertyBag."+r[0]+".Value",!1),o&&o.length!==0)&&cde.GuidToString(o)===cde.GuidToString(r[1])&&(s=n.GetFldContentByName(h,"MyPropertyBag."+r[2]+".Value",!1),s&&s!==""&&(i=s),n.TheFlashCache.AddCache(t,i,3e3))}return i}function lt(t,i,r){if(t!==null&&t.HasFacePlate!==!0)if(t.HasFacePlate=!0,n.MyEngine&&i&&i.ModelID&&i.TableName){var u=new n.TheFaceWait;u.TRF=i;u.TargetControl=t;u.HTML=r;n.MyEngine.LoadTableLazy(i.ModelID,i.TableName,n.DoParseHTML,u)}else t.GetContainerElement().innerHTML=r}function at(n,t,i){var r,f,u;return!n||!t||!i?null:(r=n.indexOf(t),r<0)?null:(f=n.indexOf(i,r+t.length),f<0)?null:(u=n.substr(r,f-r+i.length),u.length<t.length+i.length+1)?null:u.substr(t.length,u.length-(t.length+i.length))}function vt(n,t,i){var r,u,f;return!n||!t||!i?null:(r=new cde.TheSegment,u=n.indexOf(t),u<0)?null:(f=n.indexOf(i,u+t.length),f<0)?null:(r.Outer=n.substr(u,f-u+i.length),r.Outer.length<t.length+i.length+1)?null:(r.Inner=r.Outer.substr(t.length,r.Outer.length-(t.length+i.length)),r)}function t(t,i,r){var e,s,f,o,u;return r===void 0&&(r=n.cdeControlType.SingleEnded),e=new n.TheControlBlock,e.TargetID="CNMIC"+n.MyNMISettings.IDCounter++,e.MyControl=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel),s="",f=new n.TheFieldInfo(n.cdeControlType.SmartLabel,0,null),f.DataItem="MyPropertyBag."+i+".Value",t&&t.FldInfo&&(f.cdeO=t.FldInfo.cdeO,f.FormID=cde.GuidToString(t.TableName),f.cdeN=t.FldInfo.cdeN,f.Type=r,f.Element="span",o=n.MyNMIModels[t.ModelID],o&&o.MyStorageMirror[t.TableName]&&(s=n.GetFldContent(o.MyStorageMirror[t.TableName][t.RowNo],f,!1,!1))),u=new n.TheTRF(t?t.TableName:"",t?t.RowNo:0,f),u.ModelID=t?t.ModelID:null,e.MyControl.InitControl(null,u),e.MyControl.SetProperty("iValue",s),n.MyTCBs[u.TableName+"_"+t.RowNo]||(n.MyTCBs[u.TableName+"_"+t.RowNo]=[]),n.MyTCBs[u.TableName+"_"+t.RowNo].push(e),n.ThePB.SetRawProperty(e.MyControl,"OnThingEvent",u.TableName+";"+i),n.MyEngine.RegisterEvent("RecordUpdated_"+u.TableName+"_"+t.RowNo,function(i,r,f,e){var s,c,o,h;if(r&&r!==""){s=n.MyNMIModels[r];for(c in n.MyTCBs[u.TableName+"_"+t.RowNo])o=n.MyTCBs[u.TableName+"_"+t.RowNo][c],o&&(s.MyStorageMirror[f][e].hasOwnProperty("SecToken")||(h=n.GetFldContent(s.MyStorageMirror[f][e],o.MyControl.MyFieldInfo,!1,!1),o.MyControl.GetProperty("Value")!==h&&o.MyControl.SetProperty("iValue",h)))}}),e}function yt(i,r){var f,u,e,o,s;if(i){for(;;){if(f=n.ReturnStringSegment(r.HTML,"<%P:","%>"),f===null)break;u=new n.TheControlBlock;u.TargetID="CNMIC"+n.MyNMISettings.IDCounter++;r.TargetControl.SetProperty(f.Inner+"_TCB",u);r.HTML=r.HTML.replace(f.Outer,"<span ID="+u.TargetID+"><\/span>")}for(;;){if(f=n.ReturnStringSegment(r.HTML,"<%C21:","%>"),f===null)break;u=t(r.TRF,f.Inner,n.cdeControlType.DateTime);r.TargetControl.MySubControls.push(u);r.HTML=r.HTML.replace(f.Outer,"<span ID="+u.TargetID+"><\/span>")}for(;;){if(f=n.ReturnStringSegment(r.HTML,"<%C20:","%>"),f===null)break;u=t(r.TRF,f.Inner);r.TargetControl.MySubControls.push(u);r.HTML=r.HTML.replace(f.Outer,"<span ID="+u.TargetID+"><\/span>")}for(;;){if(f=n.ReturnStringSegment(r.HTML,"<%I:","%>"),f===null)break;u=t(r.TRF,f.Inner);r.TargetControl.MySubControls.push(u);r.HTML=r.HTML.replace(f.Outer,u.MyControl.GetProperty("Value")+'" ID="'+u.TargetID+"_TGT");u.MyControl.SetProperty("Visibility",!1);u.MyControl.SetProperty("MyTCB",u);u.OnIValueChanged=function(n,t,i){var r=n.GetProperty("MyTCB");i&&document.getElementById(r.TargetID+"_TGT")&&(document.getElementById(r.TargetID+"_TGT").src=cde.FixupPath(i))};r.HTML+="<span ID="+u.TargetID+"><\/span>"}for(;;){if(f=n.ReturnStringSegment(r.HTML,"<%V:","%>"),f===null)break;u=t(r.TRF,f.Inner);r.TargetControl.MySubControls.push(u);r.HTML=r.HTML.replace(f.Outer,u.MyControl.GetProperty("Value")+'" ID="'+u.TargetID+"_TGT");u.MyControl.SetProperty("Visibility",!1);u.MyControl.SetProperty("MyTCB",u);u.OnIValueChanged=function(n,t,i){var r=n.GetProperty("MyTCB");i&&document.getElementById(r.TargetID+"_TGT")&&(document.getElementById(r.TargetID+"_TGT").value=i)};r.HTML+="<span ID="+u.TargetID+"><\/span>"}for(;;){if(f=n.ReturnStringSegment(r.HTML,'cdeTAG="<%S:',"%>"),f===null)break;u=t(r.TRF,f.Inner);r.TargetControl.MySubControls.push(u);r.HTML=r.HTML.replace(f.Outer,"style='"+u.MyControl.GetProperty("Value")+";' ID='"+u.TargetID+"_TGT'");u.MyControl.SetProperty("Visibility",!1);u.MyControl.SetProperty("MyTCB",u);u.OnIValueChanged=function(n,t,i){var r=n.GetProperty("MyTCB");i&&document.getElementById(r.TargetID+"_TGT")&&(document.getElementById(r.TargetID+"_TGT").style.cssText=i)};r.HTML+="<span ID="+u.TargetID+"><\/span>"}for(r.HTML=n.GenerateFinalString(r.HTML,!1,r.TRF),r.TargetControl.GetContainerElement().innerHTML=r.HTML,e=0;e<r.TargetControl.MySubControls.length;e++)o=document.getElementById(r.TargetControl.MySubControls[e].TargetID),o&&(s=o.parentElement,s.replaceChild(r.TargetControl.MySubControls[e].MyControl.GetElement(),o),r.TargetControl.MySubControls[e].OnIValueChanged&&r.TargetControl.MySubControls[e].MyControl.SetProperty("OniValueChanged",r.TargetControl.MySubControls[e].OnIValueChanged))}}function i(t,r,u,f){var e,v,o,a,s,c,l,p,h,y,w,g;if(!t)return null;if(typeof t!="string"&&(t=t.toString()),e=t,e.indexOf("<%UN%>")>=0&&(e=cde.MyBaseAssets.MyCommStatus.UserPref&&cde.MyBaseAssets.MyCommStatus.UserPref.CurrentUserName?e.replace("<%UN%>",cde.MyBaseAssets.MyCommStatus.UserPref.CurrentUserName):e.replace("<%UN%>","")),e.indexOf("<%NOW%>")>=0&&(e=e.replace("<%NOW%>",moment(Date.now()).format("YYYY-MM-DD HH:mm:ss"))),u&&!r&&(v=n.MyNMIModels[u.ModelID],v&&u&&v.MyStorageMirror&&v.MyStorageMirror[u.TableName]&&(r=v.MyStorageMirror[u.TableName][u.RowNo])),r&&r!==!0){if(e.indexOf("<%NN%>")>=0)try{e=e.replace("<%NN%>",r.cdeN&&n.MyEngine?n.MyEngine.GetKnownNodeName(r.cdeN):"")}catch(it){e=e.replace("<%NN%>","")}for(o in r)if(Object.prototype.hasOwnProperty.call(r,o)){if(o==="MyPropertyBag"&&e.indexOf("%")>=0){a=r.MyPropertyBag;for(s in a)Object.prototype.hasOwnProperty.call(a,s)&&(e.indexOf("%MyPropertyBag."+s+".Value%")>=0?e=e.replace("%MyPropertyBag."+s+".Value%",a[s].Value):e.indexOf("<%"+s+"%>")>=0?e=e.replace("<%"+s+"%>",a[s].Value):e.indexOf("%"+s+"%")>=0&&(e=e.replace("%"+s+"%",a[s].Value)))}if(c=void 0,l=void 0,e.indexOf("<%"+o+"%>")>=0){c="";r[o]&&(c=typeof r[o]!="string"?r[o].toString():r[o]);l="";do l=e,e=e.replace("<%"+o+"%>",i(c,r,u));while(l!==e)}else if(r[o]&&r[o].MyFieldInfo&&r[o].MyFieldInfo.FldOrder&&e.indexOf("<%"+r[o].MyFieldInfo.FldOrder+".")>=0){var b=r[o].MyFieldInfo.FldOrder.toString(),k=e.indexOf("<%"+b+".")+b.length+3,nt=e.indexOf("%>",k),tt=e.substring(k,nt),d=r[o].GetProperty(tt);d&&(e=d.toString())}else if(e.indexOf("%"+o+"%")>=0){c="";r[o]&&(c=typeof r[o]!="string"?r[o].toString():r[o]);l="";do l=e,e=e.replace("%"+o+"%",i(c,r,u));while(l!==e)}}}if(u&&u.FldInfo)for(p=1,h=void 0;p===1;){if(h=e,h.indexOf("%")<0)break;y=n.ReturnStringSegment(h,"%","%");y&&(w=u.FldInfo[y.Inner],w&&(h=h.replace(y.Outer,w)));h!==e?e=h:p=0}if(!f)while(e.indexOf("<%")>=0)if(e.indexOf("%>")>0)g=e.substr(0,e.indexOf("<%")),e=g+e.substr(e.indexOf("%>")+2);else break;return e}function pt(n){if(n.indexOf("&#x")<0)return n;var t=n.replace("&#xf20e;","&#xf61f;");return t=t.replace("&#xf05D;","&#xf058;"),t.replace("&#xf0f6;","&#xf46d;")}function wt(n){return n.indexOf("<$Loading$>")>=0&&(n=n.replace("<$Loading$>","Loading... <i class='fa fa-spinner fa-pulse'><\/i>")),n.indexOf("<$IsIso$>")>=0&&(n=n.replace("<$IsIso$>","<i class='fa fa-3x' style='color:green'>&#xf045;<\/i>")),n.indexOf("<$IsoNot$>")>=0&&(n=n.replace("<$IsoNot$>","<i class='fa fa-3x'>&#xf096;<\/i>")),n.indexOf("<$IsEnabled$>")>=0&&(n=n.replace("<$IsEnabled$>","<i class='fa fa-3x' style='color:green'>&#xf05D;<\/i>")),n.indexOf("<$IsDisabled$>")>=0&&(n=n.replace("<$IsDisabled$>","<i class='fa fa-3x' style='color:red'>&#xf05E;<\/i>")),n.indexOf("<$IsUnloaded>")>=0&&(n=n.replace("<$IsUnloaded>","<i class='fa fa-4x' style='color:green'>&#xf04B;<\/i>")),n.indexOf("<$IsLoaded$>")>=0&&(n=n.replace("<$IsLoaded$>","<i class='fa fa-4x' style='color:red'>&#xf04D;<\/i>")),n.indexOf("<$NoBreak$>")>=0&&(n=n.replace("<$NoBreak$>","&nbsp;")),n}function bt(n,t){if(!t)return null;var r=t.HelpText,i=null;return r&&r!==""&&(i=document.createElement("div"),i.className="cdeFormEntryComment",i.innerHTML=r,n.appendChild(i)),i}function kt(n,t,i,r){var u,e,s,f,o,h;if(!n||!t||!t.DataItem)return!1;if(u=t.DataItem.split("."),e=u[1],u.length>3)for(s=2;s<u.length-1;s++)e+="."+u[s];if(f=n[u[0]],o=!1,u.length>1){for(h=1;h<u.length-1;h++)if(f===undefined)break;else f=f[u[h]];f?(t&&cde.CBool(t.ForceSet)||f[u[u.length-1]]!==i&&(!r||r[u[u.length-1]]!==i))&&(r&&!r[u[u.length-1]]&&(r[u[u.length-1]]=f[u[u.length-1]]),f[u[u.length-1]]=i,o=!0):u[0]!=="MyPropertyBag"||cde.IsNotSet(i)||(n[u[0]]||(n[u[0]]={}),n[u[0]][e]=new cde.cdeP,n[u[0]][e].Name=e,n[u[0]][e].Value=i,o=!0)}else(n.hasOwnProperty("SecToken")||f!==i&&(!r||r[u[0]]!==i))&&(r&&!r[u[0]]&&(r[u[0]]=f),n.hasOwnProperty("SecToken")&&(t.Flags&1)!=0?(n.SecToken===""&&(n.SecToken="CDE!"),n.SecToken+=";:;"+t.FldOrder+"="+i,n[u[0]]=null):n[u[0]]=i,o=!0);return o}function dt(t,i,r,u){if(!t)return[];var f=t.slice(0);return f.sort(function(t,f){var e,o;return(i.indexOf(".")>0?(e=n.GetFldContentByName(t,i,!1),o=n.GetFldContentByName(f,i,!1)):(e=r?parseFloat(t[i]):t[i].toString(),o=r?parseFloat(f[i]):f[i].toString()),e===o)?0:u?o>e?1:-1:o<e?1:-1})}function gt(t,i,r,u){var e,f,h,o,s;if(!i||!i.DataItem||!i.DataItem||!t)return null;if(e=i.DataItem.split("."),u&&e.length>1){if(h=e[1],e.length>3)for(o=2;o<e.length-1;o++)h+="."+e[o];f=t[h]}else{if(e[0]==="cdeN")return n.MyEngine&&!n.MyEngine.IsNodeDown(t.cdeN)&&(f=n.MyEngine.GetKnownNodeName(t.cdeN)),f||(f=t.cdeN),f;if(f=t[e[0]],e.length>1)for(s=1;s<e.length;s++)if(f===undefined){f="";break}else f=f[e[s]],r&&f!==undefined&&f.length>5&&f.substring(0,5)==="/Date"&&(i.Type=21,i.FldWidth=5)}return f}function ni(n,t,i){var u,r,o,f,e;if(!t)return null;u=null;try{if(r=t.split("."),i){if(o=r[1],r.length>3)for(f=2;f<r.length-1;f++)o+="."+r[f];u=n[o]}else if(u=n[r[0]],r.length>1)for(e=1;e<r.length;e++)if(u===undefined){u="";break}else u=u[r[e]]}catch(s){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","nmiUtils:GetFldContentByName:error",s)}return u}function ti(){for(var i,r=document.cookie,t=r.split(";"),n=0;n<t.length;n++)i=t[n].split("="),document.cookie=i[0]+" =; expires = Thu, 01 Jan 1970 00:00:00 UTC"}function ii(n){if(n instanceof Date)return n;if(n=cde.CStr(n),n.substr(0,2)==="/"){var i=(new Date).getTimezoneOffset()*6e4,t=/\/Date\((-?\d+)([+-]\d{2})?(\d{2})?.*/.exec(n);return t[2]===undefined&&(t[2]="0"),t[3]===undefined&&(t[3]="0"),new Date(+t[1]+i+parseInt(t[2])*36e5+parseInt(t[3])*6e4)}return n.substr(0,1)==="/"?new Date(parseInt(n.substr(6))):new Date(n)}function ri(n,t){for(var i=0;i<n.length;i++)if(n[i]===t)return!0;return!1}function ui(n,t,i,r){if(!n)return[];var u=n.slice(0);return u.sort(function(n,u){n[t]||(n[t]="");u[t]||(u[t]="");var f=i?parseFloat(n[t]):n[t].toString(),e=i?parseFloat(u[t]):u[t].toString();return f===e?0:r?e>f?1:-1:e<f?1:-1})}function fi(n,t,i,r){var u=[],o=[],e,f,s,h;try{for(e in n)u.push([e,n[e]]);for(u.sort(function(n,u){var e=n[1].GetProperty(t),f,o,s;return(e||(e=""),f=u[1].GetProperty(t),f||(f=""),o=i?parseFloat(e):e.toString(),s=i?parseFloat(f):f.toString(),o===s)?0:r?s>o?1:-1:s<o?1:-1}),f=0;f<u.length;f++)s=u[f][0],h=u[f][1],o[s]=h}catch(c){return cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","nmiUtils:SortNamedArray:error:"+c,c.stack),n}return o}function ei(n){if(document.getElementById(n)){var t=document.documentElement.clientHeight,i=document.documentElement.clientWidth-5;t-=document.getElementById(n).parentElement.offsetTop+10;document.getElementById(n).style.height=t+"px";document.getElementById(n).style.width=i+"px"}}function oi(n){var t=new Date;for(t.setTime(t.getTime()+n);(new Date).getTime()<t.getTime(););}function si(n){var t=document.createElement("div");return t.innerHTML=n,t.textContent||t.innerText||""}function hi(n,t){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];t&&t!==0?setTimeout(n,t,r):n(r)}function ci(n){var r=n.getMonth()+1,u=n.getDate(),f=n.getFullYear(),t=n.getHours(),e=n.getMinutes(),o=n.getSeconds(),i="AM";return t>11&&(i="PM"),r+u+f+"_"+t+"_"+e+"_"+o+"_"+i}function li(n){return cde.DateToString(n)}function ai(n,t){var i=75,r,u,f=30,e;return n<i&&t<i?(r=(n-i)/i,u=-(t-i)/i,e=Math.max(f*r,f*u)):n>i&&t<i?(r=-(n-i)/i,u=(t-i)/i,e=Math.max(f*r,f*u)):n<i&&t>i?(r=-(n-i)/i,u=(t-i)/i,e=-Math.max(f*r,f*u)):(r=(n-i)/i,u=-(t-i)/i,e=-Math.max(f*r,f*u)),"rotate3d("+u+","+r+", 0,"+e+"deg)"}function vi(n){return!n||n.length===0?!0:n.length<8?!1:!0}function yi(n){if(!n||n.length===0)return!0;var t=new RegExp("[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?");return!n||!t.test(n.toLowerCase())||n.substring(0,1)==="."||n.substring(n.length-1,1)==="."?!1:!0}function pi(n,t,i){var u,o,f;if((!n||n.length===0)&&(!t||t.length===0))return!0;if(!n&&t||n&&!t)return!1;if(i&&n.indexOf(";")>0){if(!t)return!1;for(var e=n.split(";"),s=t.split(";"),h=!0,r=void 0,r=0;r<e.length;r++)if(e[r].length===0){h=!1;break}if(h){for(r=0;r<e.length;r++){if(s[r].length===0||(u=e[r].split(""),o=s[r].split(""),u.length!==o.length))return!1;for(u.sort(),o.sort(),f=0;f<u.length;f++)if(u[f]!==o[f])return!1}return!0}}return n===t?!0:!1}function wi(n){if(n.substr(0,1)==="#")return n;var t=/(.*?)rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)/.exec(n),i=parseInt(t[2]),r=parseInt(t[3]),u=parseInt(t[4]),f=u|r<<8|i<<16;return t[1]+"#"+f.toString(16)}function bi(){var n=document.createElement("input");return"placeholder"in n}function ki(n,t,i,r,u){return(n-i)*(r-u)/(t-i)+u}function di(n,t){var r,i;t==="js"?(r=document.createElement("script"),r.setAttribute("type","text/javascript"),r.setAttribute("src",n),document.getElementsByTagName("head")[0].appendChild(r)):t==="css"&&(i=document.createElement("link"),i.setAttribute("rel","stylesheet"),i.setAttribute("type","text/css"),i.setAttribute("href",n),document.getElementsByTagName("head")[0].appendChild(i))}function gi(n,t,i,r){if(!n)return[];var u=n.slice(0);return u.sort(function(n,u){var o,s,f,e,c,h;if(i)f=n[t],f||(f=""),e=u[t],e||(e=""),o=i?parseFloat(f):f.toString(),s=i?parseFloat(e):e.toString();else for(c=t.split(","),h=0;h<c.length;h++)f=n[c[h]],f||(f=""),e=u[c[h]],e||(e=""),o&&o.length>0&&(o+="."),o+=f.toString(),s&&s.length>0&&(s+="."),s+=e.toString();return o===s?0:r?s>o?1:-1:s<o?1:-1})}function nr(n){for(var e=n.indexOf(r)+r.length,o=n.substring(e),i=window.atob(o),u=i.length,f=new Uint8Array(new ArrayBuffer(u)),t=0;t<u;t++)f[t]=i.charCodeAt(t);return f}function tr(n){return n*Math.PI/180}function ir(n){return n*180/Math.PI}function rr(n){if(!n||n.length===0)return!0;return n.match(/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/)?!0:!1}function ur(){cde.MyCommChannel&&cde.MyCommChannel.Logout();window.location.href=cde.MyBaseAssets.MyServiceHostInfo.PortalPage}function fr(n,t){return Math.sqrt(Math.pow(n.x-t.x,2)+Math.pow(n.y-t.y,2))}function er(n,t){return 180*(1+Math.atan2(n.y-t.y,n.x-t.x)/Math.PI)}function or(n){return(n=Math.floor(n),!n||n===0)?0:cde.MyBaseAssets.MyServiceHostInfo.TileSize*n}function sr(t){if(window.external)try{var i=window;i.external.notify&&i.external.notify(t)}catch(r){n.MyPopUp&&n.MyPopUp.Show("Error: "+r,!0)}}function hr(t,i){for(var r,e=[],o=null,h=[],f,s,u;;){if(r=document.elementFromPoint(t,i),!r||r===document.documentElement)break;if(r.getAttribute("cdemid")&&!o){f=n.MyTCF.GetRegisteredControlGroup(r.getAttribute("cdemid"));for(s in f)if(f.hasOwnProperty(s)){o=f[s];break}}e.push(r);h.push(r.style.visibility);r.style.visibility="hidden"}for(u=0;u<e.length;u++)e[u].style.visibility=h[u];return o}function cr(n,t){for(var i,r=[],f=[],u;;){if(i=document.elementFromPoint(n,t),!i||i===document.documentElement)break;r.push(i);f.push(i.style.visibility);i.style.visibility="hidden"}for(u=0;u<r.length;u++)r[u].style.visibility=f[u];return r.reverse(),r}function lr(n){var t=Array.prototype.filter.call(document.querySelectorAll('a:not([disabled]), button:not([disabled]), input[type=text]:not([disabled]), [tabindex]:not([disabled]):not([tabindex="-1"])'),function(n){return n.offsetWidth>0||n.offsetHeight>0||n===document.activeElement}),r=t.indexOf(document.activeElement),i;r>-1?n===!0?(i=t[r-1]||t[0],i.focus()):(i=t[r+1]||t[0],i.focus()):t[0].focus()}var e,r;n.StopPointerEvents=o;n.SetZIndex=s;n.cdeEscapeHtml=h;n.GetControlWidth=c;n.IsTouchDevice=l;n.CleanState=a;n.ResetKeyCorder=v;n.cdeBlendInTiles=y;n.RequestSync=p;n.ShowToastMessage=w;n.RequestUpdate=k;n.UpdateClock=u;n.FormatDate=d;n.FormatDateNow=g;n.StartClock=nt;n.GetLocation=tt;n.RequestScopeID=it;n.TogglePortalFull=rt;n.NUITagAction=ut;n.GetAllNUITags=ft;n.GetCurrentScreen=et;n.ApplyTheme=f;n.ToggleTheme=ot;n.AddCSSB4Header=st;n.InsertCSS=ht;n.ThingLookup=ct;n.cdeParseHTML=lt;n.GetStringSegment=at;n.ReturnStringSegment=vt;n.CreateTCB=t;n.DoParseHTML=yt;n.GenerateFinalString=i;n.IconFAShim=pt;n.IconShim=wt;n.AddFieldComment=bt;n.UpdFldContent=kt;n.SortArrayByProperty=dt;n.GetFldContent=gt;n.GetFldContentByName=ni;n.RemoveCookies=ti;e=function(){function n(n){this.options_default={classes:{rippleContainer:"md-ripple-wrapper",ripple:"md-ripple-effect"},transition:{delay:0,duration:300},opacity:.3,size:100,center:!1};this.options=null;this.data={transition:!1};this.mItem=null;var t=this.options_default;this.options=n?this.MergeObject(t,n):t}return n.prototype.MergeObject=function(){for(var f,i,u,t,n,e,o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];f=this;i={};for(u in arguments)if(arguments.hasOwnProperty(u)){t=arguments[u];for(n in t)t.hasOwnProperty(n)&&t.hasOwnProperty(n)&&(e=typeof t[n]=="object"&&i[n]&&typeof i[n]=="object"?f.MergeObject(i[n],t[n]):t[n],i[n]=e)}return i},n.prototype.ShowWave=function(n,t){var o=this,i,f,e;this.mItem=n;var s=t.x,h=t.y,c=n.offsetWidth,l=n.offsetHeight,r=this.options.size,u=null;n.querySelector!==undefined&&(u=n.querySelector("."+this.options.classes.rippleContainer));u||(u=document.createElement("div"),u.setAttribute("class",this.options.classes.rippleContainer),n.appendChild(u));i=document.createElement("div");i.setAttribute("class",this.options.classes.ripple);i.style.opacity=this.options.opacity;i.style.top=h+"px";i.style.left=s+"px";i.style.width="0";i.style.height="0";u.appendChild(i);f=s-r/2;e=h-r/2;this.options.center&&(f=c/2-r/2,e=l/2-r/2);this.DoRender(i,{top:e+"px",left:f+"px",width:r+"px",height:r+"px"});setTimeout(function(){o.EndWave(o.mItem)},100)},n.prototype.EndWave=function(n){var i=this,t=n.querySelector("."+this.options.classes.rippleContainer),r;t&&t.children&&(r=t.children,[].forEach.call(r,function(n){i.DoRender(n,{opacity:0});setTimeout(function(){n.parentElement&&n.parentElement.removeChild(n)},i.options.transition.duration)}))},n.prototype.EasyMeOut=function(n,t,i,r){return i*(-Math.pow(2,-10*n/r)+1)+t},n.prototype.DoRender=function(n,t,i){var u=this,f={},o=(new Date).getTime(),r,e;i||i===0||(i=this.options.transition.duration);for(r in t)t.hasOwnProperty(r)&&(f[r]=n.style[r]);this.data.transition=!0;e=setInterval(function(){var a=(new Date).getTime()-o,r,c,v;a>=i&&(a=i);for(c in t)if(t.hasOwnProperty(c)){r=t[c];var s=f[c],h=null,y=null,l=0;typeof s=="string"&&(y=s.replace(/^\-?[0-9\.]+(.*)$/,"$1"));s=parseFloat(s);r=parseFloat(r);r<0||s<0?(l=r<s?r:s,s=s-l,r=r-l):(l=r<s?r:s,s=s-l,r=r-l);s>r?(h=s-u.EasyMeOut(a,r,s,i),h<r&&(h=r)):s!==r?(h=u.EasyMeOut(a,s,r,i),h>r&&(h=r)):h=r;l!==0&&(h=h+l);h=h+"";h=h.replace(/([0-9]+(\.[0-9]{0,3})?).*/,"$1");h=parseFloat(h);y&&(h=h+y);n.style[c]=h}if(a>=i){clearInterval(e);for(c in t)t.hasOwnProperty(c)&&(r=t[c],v=null,typeof r=="string"&&(v=r.replace(/^\-?[0-9\.]+(.*)$/,"$1")),r=parseFloat(r),n.style[c]=v?r+v:r,u.data.transition=!1)}},24)},n}();n.TheMaterialTouch=e;n.cdeJsonDate2JSDate=ii;n.DoesArrayContain=ri;n.SortArray=ui;n.SortNamedArray=fi;n.ResizeIframe=ei;n.cdeSleep=oi;n.StripHTML=si;n.cdeRunAsync=hi;n.DateToMini=ci;n.DateToString=li;n.CalculateTransform=ai;n.Check4ValidPassword=vi;n.Check4ValidEmail=yi;n.IsSamePassword=pi;n.CColorToHex=wi;n.HasPlaceholderSupport=bi;n.cdeMinMax=ki;n.LoadJsCssFile=di;n.SortArrayEx=gi;r=";base64,";n.convertBase64ToBinary=nr;n.toRadians=tr;n.toDegrees=ir;n.ValidateIPaddress=rr;n.ResetBrowserToPortal=ur;n.Vector2Distance=fr;n.Vector2GetAngle=er;n.GetSizeFromTile=or;n.NotifyHost=sr;n.GetControlFromPoint=hr;n.GetAllElementsFromPoint=cr;n.focusNextElement=lr}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(){var i=t.call(this)||this;return i.MyBaseEngine=null,i.IsConnectedAndReady=!1,i.MyNMIIncomingEvents=[],i.MetaRequested=[],i.DataToFetch=[],i.DataFetching=[],i.MyLazyTableCallbacks=[],i.MyBaseEngine=cde.StartNewEngine(n.eTheNMIEngine),cde.MyBaseAssets.RegisterEvent("OnStringEvent",function(n,t,r,u,f,e){i.OnStringEvent(t,r,u,f,e)}),i}return __extends(i,t),i.prototype.GetBaseEngine=function(){return this.MyBaseEngine},i.prototype.RegisterIncomingMsg=function(t,i,r){var f,u;if(t)for(r||(r=n.eTheNMIEngine),f=r.split(";"),u=0;u<f.length;u++)this.MyNMIIncomingEvents[f[u]]||(this.MyNMIIncomingEvents[f[u]]=[]),this.MyNMIIncomingEvents[f[u]][i]=t},i.prototype.RequestEngineStatus=function(){this.FireEvent(!0,"CDE_SETSTATUSMSG","BaseEngine is ready",1)},i.prototype.OnStringEvent=function(t,i,r,u){var e,l,c,a,v,f,o,s,h;if(t.startsWith("jsAction:")){if(e=t.split(":"),e.length<2)return;switch(e[1]){case"PTS":if(e.length<4)return;l="";e.length>4&&(l=e[4]);cde.MyCommChannel&&cde.MyCommChannel.SendQueued("",e[2],e[2],e[3],l,0,5,3,"");e.length>5&&n.ShowToastMessage(e[5]);return;case"GS":if(e.length<3)return;n.MyEngine&&n.MyEngine.GetScene(e[2]);return;case"POP":if(e.length<3)return;n.MyPopUp&&n.MyPopUp.Show(e[2],!0);return;case"TOAST":if(e.length<3)return;n.MyToast&&n.MyToast.ShowToastMessage(e[2]);return;case"TTS":if(e.length<3)return;n.MyScreenManager&&n.MyScreenManager.TransitToScreen(e[2],!0);return;case"CFU":n.MyEngine&&n.MyEngine.CheckForUpdates();return;default:t=e[1]}}if(t.startsWith("TTS:")){n.MyScreenManager&&(c=t.split(":"),c[1]==="CLOSE"?(a=n.MyScreenManager.GetCurrentScreen(),a&&(v=a.GetProperty("OldScreen"),v&&n.MyScreenManager.TransitToScreen(v))):n.MyScreenManager.TransitToScreen(cde.GuidToString(c[1]),!0,!1,c.length>2?c[2]:null));return}if(t.startsWith("GRP:")){n.MyTCF.ToggleGroup(i.MyFormID,t.substr(4));return}if(t.startsWith("PTOT:")){if(!cde.MyCommChannel)return;if(f=t.substr(5).split(";:;"),f.length<6)return;(f[0].length===0||u===f[0])&&(o=i.GetProperty("MID"),o||(o=i.GetProperty("ID")),cde.MyCommChannel.SendQueued(f[1],f[2],f[2],f[3]+":"+o+":"+f[4],r+":"+f[4]+":"+(i.MyTRF&&i.MyTRF.RowID?i.MyTRF.RowID:0),8,5,3,i.MyTRF?i.MyTRF.GetNodeID():f[5]));return}if(t.startsWith("PTOR:")){if(!cde.MyCommChannel)return;if(f=t.substr(5).split(";:;"),f.length<6)return;(f[0].length===0||u===f[0])&&(o=i.GetProperty("MID"),o||(o=i.GetProperty("ID")),cde.MyCommChannel.SendQueued(i.MyTRF?i.MyTRF.GetMID():f[1],f[2],f[2],f[3]+":"+o+":"+f[4],r,8,5,3,i.MyTRF?i.MyTRF.GetNodeID():f[5]));return}if(t.startsWith("SEV:")){s=t.substr(4);h="";s==="Value"&&(h="i");u===s&&i.SetProperty(h+"Value",r);return}if(t.startsWith("if (PropertyName==")&&t.indexOf("PublishToOwner")<0){s=n.GetStringSegment(t,"'","'");h="";s==="Value"&&(h="i");u===s&&i.SetProperty(h+"Value",r);return}cde.MyBaseAssets.MyServiceHostInfo.DebugLevel>0&&cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","FireEvent:EVAL","UPDATE Plugin! eval() will be dropped in the future! Code: "+t);eval(t)},i.prototype.AddDataToFetch=function(n){this.HasDataToFetch(n)||this.DataToFetch.push(n)},i.prototype.HasDataToFetch=function(t){return n.DoesArrayContain(this.DataToFetch,t)},i.prototype.CheckDataToFetch=function(t){var f,r,u,i,e;if(t){if(t=cde.GuidToString(t),f=n.MyScreenManager?n.MyScreenManager.GetScreenByID(t):null,r=f&&f.GetInitialized(),!r&&this.DataToFetch.length>0)for(i=0;i<this.DataToFetch.length;i++)if((u=this.DataToFetch[i].split(":"),!n.DoesArrayContain(this.DataFetching,cde.GuidToString(u[0])))&&cde.GuidToString(u[0])===t){n.MyTCF.IsControlNameKnown(u[1])||cde.MyBaseAssets.MyEngines[u[1]]||cde.StartNewEngine(u[1]);this.PublishToNodeGET_NMI_DATA(this.DataToFetch[i]);this.DataFetching.push(t);this.DataToFetch.splice(i,1);r=!0;break}if(!r){if(this.DataFetching.length>0)for(i=0;i<this.DataFetching.length;i++)if(this.DataFetching[i]===t){r=!0;break}r||(e=t+":auto:"+t,this.DataToFetch.push(e),this.CheckDataToFetch(t))}}},i.prototype.PublishToNodeGET_NMI_DATA=function(){},i.prototype.FireLazyLoaded=function(n,t,i){if(n&&t&&this.MyLazyTableCallbacks[n+","+t])for(var r=0;r<this.MyLazyTableCallbacks[n+","+t].length;r++)this.MyLazyTableCallbacks[n+","+t][r].CallBack&&this.MyLazyTableCallbacks[n+","+t][r].CallBack(i,this.MyLazyTableCallbacks[n+","+t][r].Cookie)},i.prototype.UnregisterLazyLoader=function(n,t,i){if(this.MyLazyTableCallbacks[n+","+t])for(var r=0;r<this.MyLazyTableCallbacks[n+","+t].length;r++)if(this.MyLazyTableCallbacks[n+","+t][r].CallBack===i){this.MyLazyTableCallbacks[n+","+t].splice(r,1);return}},i.prototype.LoadTableLazy=function(t,i,r,u){r&&t&&i&&(n.MyNMIModels[t]&&n.MyNMIModels[t].MyStorageMirror[i]?r(n.MyNMIModels[t].MyStorageMirror[i],u):r(null,u),this.MyLazyTableCallbacks[t+","+i]||(this.MyLazyTableCallbacks[t+","+i]=[]),this.MyLazyTableCallbacks[t+","+i].push({ScreenID:t,TableName:i,CallBack:r,Cookie:u}))},i.prototype.cdeGetScript=function(n,t,i,r){t===void 0&&(t=null);i===void 0&&(i=null);r===void 0&&(r=0)},i.prototype.cdeGetStyle=function(n,t,i){t===void 0&&(t=null);i===void 0&&(i=null)},i.prototype.cdeGetResource=function(n,t,i){i===void 0&&(i=null)},i.prototype.cdeGetImage=function(n,t,i){i===void 0&&(i=null)},i.prototype.PublishToNMI=function(){},i.prototype.CheckForUpdates=function(){},i.prototype.GetScreenMeta=function(){return!1},i.prototype.GetScene=function(){},i.prototype.IsNodeDown=function(){return!1},i.prototype.GetKnownNodeName=function(){return""},i.prototype.RegisterKnownNode=function(){},i.prototype.RequestReloadModel=function(n){this.MetaRequested[cde.GuidToString(n)]=!1},i.prototype.ValidateUID=function(t){return n.Check4ValidEmail(t)?null:"eMail invalid! Please enter a valid eMail address"},i.prototype.Login=function(n,t,i,r){if(cde.MyCommChannel){if(n)if(cde.MyCommChannel.SetTargetRelay(n))cde.MyCommChannel.StartCommunication();else return;r&&(cde.MyBaseAssets.MyServiceHostInfo.WebPlatform=r,this.FireEvent(!1,"CDE_SETPLATFORM",r));cde.MyBaseAssets.MyServiceHostInfo.IsUsingUserMapper&&!cde.MyBaseAssets.MyServiceHostInfo.EnablePinLogin?cde.MyCommChannel.Login({QPWD:i,QUID:t,QToken:null}):cde.MyCommChannel.Login({QPWD:t,QUID:null,QToken:null})}},i.prototype.SelectMesh=function(n){cde.MyCommChannel.SelectMesh(n)},i.prototype.BaseOnHandleMessage=function(t){var i=t.Message,l,r,u,a,o,s,h,f,c,e,y;if(!i)return!0;if(t.Topic==="NMI_ERROR")return n.MyPopUp&&n.MyPopUp.Show(i.PLS,!0,null,1,function(){document.location.reload(!0)}),!0;if(t.Topic==="NMI_INFO")return n.MyPopUp&&n.MyPopUp.Show(i.PLS,!0),!0;if(t.Topic==="NMI_TOAST"||i.TXT.endsWith(":ERR"))return n.MyToast&&n.MyToast.ShowToastMessage(i.TXT,i.PLS),!0;if(t.Topic==="NMI_ALERT")return l=i.TXT.split(":;:"),n.MyToast&&n.MyToast.ShowToastMessage("ALERT",i.PLS,l.length>1?cde.CInt(l[1]):0),!0;r=i.TXT.split(":");switch(r[0]){case"NMI_ERROR":return n.MyPopUp&&n.MyPopUp.Show(i.PLS,!0,null,1),!0;case"NMI_INFO":return n.MyPopUp&&n.MyPopUp.Show(i.PLS,!0),!0;case"NMI_TOAST":return n.MyToast&&n.MyToast.ShowToastMessage(i.PLS),!0;case"NMI_ALERT":return n.MyToast&&n.MyToast.ShowToastMessage("Alert!",i.PLS,r.length>1?cde.CInt(r[1]):15e3),!0;case"NMI_AUDIO":return a=new Audio(cde.MyBaseAssets.MyCommStatus.MyServiceUrl+"/"+i.PLS),a.play(),!0;case"NMI_TALK":return o=r,cdeSpeech.talk(i.PLS,o.length>1?o[1]:"en",o.length>2?cde.CInt(o[2]):0),!0;case"NMI_RESET":return r.length>1?n.MyPopUp&&n.MyPopUp.Show(i.PLS,!0):window.location.reload(!0),!0;case"NMI_REFRESH_META":return n.MyScreenManager&&(n.MyEngine&&n.MyEngine.RequestReloadModel(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen),n.MyScreenManager.RequestPortalScreen(!0)),!0;case"NMI_GS":return n.MyEngine&&n.MyEngine.GetScene(i.PLS),!0;case"NMI_TTS":return n.MyScreenManager&&(n.MyScreenManager.ClearScenes(),n.MyScreenManager.TransitToScreen(i.PLS,!0)),!0;case"NMI_LIVESCREENMETA":if(i.PLS){if(u=JSON.parse(i.PLS),!u)break;n.MyScreenManager&&n.MyScreenManager.CreateLiveScreen(u)}break;case"NMI_REQ_DASH":return i.PLS&&this.PublishToNodeGET_NMI_DATA(i.PLS),!0;case"NMI_NODEPONG":return!0;case"NMI_SCREENMETA":if(i.PLS){if(u=typeof i.PLS=="string"?JSON.parse(i.PLS):i.PLS,!u)break;this.RegisterKnownNode(u.cdeN,u.NodeName);n.MyScreenManager&&n.MyScreenManager.CreateDashboard(u,r.length>1?"ScreenGuid="+r[1]:null)}break;case"NMI_CUSTOM_SCRIPT":i.PLS&&r.length>1&&n.MyScreenManager&&n.MyScreenManager.CreateScriptScreen(r[1],i.PLS);break;case"NMI_ENGINEJS":if(i.PLS&&r.length>1&&(n.RegisterEvent("EngineReady",function(t){t===r[1]&&n.MyTCF.FireLazyCreate(t)}),!cde.MyBaseAssets.MyEngines[r[1]])){cde.CreateScriptInRoot(r[1],i.PLS);cde.StartNewEngine(r[1]);try{cde.cdeEval(r[1]+".StartEngine()")}catch(v){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","NMIServiceBase:HandleEvent","NMI_ENGINEJS:"+v+"<br>"+v.stack)}}break;case"NMI_CUSTOM_HTML":i.PLS&&r.length>1&&n.MyScreenManager&&n.MyScreenManager.CreateHTMLScreen(r[1],i.PLS);break;case"NMI_CUSTOM_CSS":i.PLS&&(s=i.PLS.split(";"),cde.AddCSSToHeader(s[0],s.length>1?s[1]:null));break;case"NMI_UPD_DATA_RET":if(r.length<2||r[2]==="ERR")if(n.MyPopUp)n.MyPopUp.Show("There was an error processing your request: "+i.PLS,!0);else{if(h="",h=r.length>2&&r[2]!==""?cde.GuidToString(r[2]):cde.GuidToString(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen),u=n.MyNMIModels[h],!u)return!0;if(u.MyStorageMirror||(u.MyStorageMirror=[]),f=cde.GuidToString(r[1]),c=JSON.parse(i.PLS),u.MyStorageMirror[f]&&u.MyStorageMirror[f].length>0){for(e=0;e<u.MyStorageMirror[f].length;e++)if(u.MyStorageMeta[f].IsAlwaysEmpty||u.MyStorageMirror[f][e].cdeMID===c.cdeMID){u.MyStorageMirror[f][e]=c;this.FireEvent(!1,"RecordUpdated_"+f+"_"+e,h,f,e);break}}else u.MyStorageMirror[f]&&(u.MyStorageMirror[f][0]=c)}break;case"NMI_SET_SCENE":n.MyScreenManager&&n.MyScreenManager.SetView(JSON.parse(i.PLS),!0);break;case"NMI_SET_DATA":if(r.length<2||r[2]==="ERR")n.MyPopUp&&n.MyPopUp.Show("There was an error processing your request: "+i.PLS,!0);else{if(r.length>2&&r[2]!==""){if(u=n.MyNMIModels[cde.GuidToString(r[2])],!u)return cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TheNMIService:OnHandleMessage","Model not found for "+r[2]),!0;u.MyStorageMirror||(u.MyStorageMirror=[])}else u=n.MyNMIModels[cde.GuidToString(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen)];u&&(y=cde.GuidToString(r[1]),n.MyScreenManager&&n.MyScreenManager.CreateDataViewScreen(u,i,y,i.TXT,r.length>3?r[3]:null,r.length>6&&r[6]==="true"||r.length===5&&r[4]==="true"))}break;case"NMI_SCOPID":return cde.MyBaseAssets.MyServiceHostInfo.DoesRequireConfiguration=!1,n.MyPopUp&&n.MyPopUp.Show("Your new Security ID is: "+i.PLS+"<\/br>Please write it down in a secure place.<\/br>You will need this ID for any secondary relays or agents that want to talk to this relay",!0,null,0,this.sinkScopeIDSet),!0;default:this.FireEvent(!0,r[0],i)}return!1},i.prototype.sinkScopeIDSet=function(){n.MyScreenManager&&n.MyScreenManager.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen)},i.cdeGetScript=function(t,i,r){n.MyEngine.cdeGetScript(t,i,r)},i.cdeGetStyle=function(t,i,r){i===void 0&&(i=null);r===void 0&&(r=null);n.MyEngine.cdeGetStyle(t,i,r)},i.MyNMISettings=n.MyNMISettings,i}(cde.TheThing);n.TheNMIServiceBase=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(){return t.call(this)||this}return __extends(i,t),i.StartEngine=function(){n.MyEngine=new i;n.MyEngine.IsConnectedAndReady=!0;n.MyEngine.GetBaseEngine().EngineState.IsInitialized=!0;n.MyEngine.GetBaseEngine().FireEngineIsReady(!0)},i.prototype.ValidateUID=function(n){return n&&n.length>2?null:"Wrong Username!"},i.prototype.Login=function(n,t){t==="nmi"?(cde.MyBaseAssets.MyCommStatus.UserPref=new cde.TheUserPreferences,this.FireEvent(!0,"CDE_LOGIN_EVENT",!0)):this.FireEvent(!0,"CDE_LOGIN_EVENT",!1,"Login failed! unknown credentials")},i.prototype.RequestEngineStatus=function(){this.FireEvent(!0,"CDE_SETSTATUSMSG","Local-Engine Provider ready",1)},i.prototype.cdeGetScript=function(n,t,i,r){(t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=0),n)&&fetch("/ClientBin/Scripts/"+n).then(function(n){n.ok&&n.text().then(function(n){var r=document.createElement("script"),u=document.getElementsByTagName("script")[0];r.type="text/javascript";r.text=n.replace(String.fromCharCode(65279),"");u.parentNode.insertBefore(r,u);t(i,n)})})},i.prototype.cdeGetStyle=function(n,t,i,r){(t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=0),n)&&fetch("/ClientBin/CSS/"+n).then(function(n){n.ok&&n.text().then(function(n){var r=document.createElement("style");r.type="text/css";r.styleSheet?r.styleSheet.cssText=n.replace(String.fromCharCode(65279),""):r.appendChild(document.createTextNode(n.replace(String.fromCharCode(65279),"")));document.getElementsByTagName("head")[0].appendChild(r);t(i,n)})})},i.prototype.PublishToNodeGET_NMI_DATA=function(n){var t=this,i=n.split(":");fetch("/ClientBin/JSON/"+i[0]+".JSON").then(function(n){n.ok&&n.json().then(function(n){t.OnHandleMessage(n)})})},i.prototype.cdeGetResource=function(n,t,i,r){(i===void 0&&(i=null),r===void 0&&(r=0),n)&&fetch("/ClientBin/"+n).then(function(n){n.ok?n.text().then(function(n){t(i,n)}):t(i,"ERR:"+n.statusText)})},i.prototype.cdeGetImage=function(n,t,i,r){(i===void 0&&(i=null),r===void 0&&(r=0),n)&&fetch("/ClientBin/"+n).then(function(n){n.ok?n.text().then(function(n){t(i,n)}):t(i,"ERR:"+n.statusText)})},i.prototype.GetScreenMeta=function(n){return this.PublishToNodeGET_NMI_DATA(n),!1},i.prototype.OnHandleMessage=function(i){var r=i.Message;r&&(t.prototype.BaseOnHandleMessage.call(this,i)||n.MyScreenManager&&n.MyScreenManager.ShowView())},i}(n.TheNMIServiceBase);n.TheNMIServiceLocal=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(){var n=t.call(this)||this;return n.mLastStatus="NMI-Engine is starting...",n.mLastState=0,n.AreEnginesRequested=!1,n.MyKnownNodes=[],n.MyPingTimer=null,n.MyGlobalResources=[],n.MyBaseEngine.RegisterEvent("IncomingMessage",function(t,i){n.OnHandleMessage(i)}),n}return __extends(i,t),i.StartEngine=function(){var t=new i;n.MyEngine=t;t.MyPingTimer=setInterval(function(){var r,i;if(Object.keys(t.MyKnownNodes).length!==0){r=(new Date).getTime();for(i in t.MyKnownNodes)n.MyEngine.PublishToNMI("NMI_NODEPING","",i),t.MyKnownNodes[i].IsDown!==!0&&r-t.MyKnownNodes[i].LastPing>6e4&&(t.MyKnownNodes[i].IsDown=!0,n.MyScreenManager.UpdateScreenStatus(i,!0))}},1e4);window.addEventListener("message",function(t){try{if(!t.data)return;var i=t.data.split(";:;");switch(i[0]){case"APPLOG":i.length>2&&n.MyEngine.Login(i[1],i[2])}if(t.data.startsWith("OK:"))return}catch(r){}},!1);cde.MyCommChannel?(cde.MyCommChannel.RegisterEvent("CDE_SETSTATUSMSG",function(n,i,r){t.sinkStatus(i,r)}),cde.MyCommChannel.RegisterEvent("CDE_LOGIN_EVENT",function(n,i,r,u){t.sinkLogin(i,r,u)}),cde.MyCommChannel.RegisterEvent("CDE_INCOMING_MSG",function(n,i){t.FireIncoming(i)}),cde.MyCommChannel.RegisterEvent("CDE_SELECT_MESH",function(n,i){t.RequestSelectMesh(i)}),cde.MyBaseAssets.MyEngines[n.eTheNMIEngine].SendInitialize()):t.GetBaseEngine().FireEngineIsReady(!0)},i.prototype.sinkStatus=function(n,t){this.mLastStatus=n;this.mLastState=t;this.FireEvent(!0,"CDE_SETSTATUSMSG",n,t)},i.prototype.sinkLogin=function(n,t,i){this.FireEvent(!0,"CDE_LOGIN_EVENT",n,t,i)},i.prototype.RequestEngineStatus=function(){this.FireEvent(!0,"CDE_SETSTATUSMSG",this.mLastStatus,this.mLastState)},i.prototype.RequestSelectMesh=function(n){this.FireEvent(!0,"CDE_SELECT_MESH",n)},i.prototype.AddToGlobalScripts=function(n){n&&(this.MyGlobalResources.push(n),n.Timeout&&n.Timeout>0&&(n.TimeoutHandler=setTimeout(function(){n.Resource="TIMEOUT";i.FireCallbacks(n)},n.Timeout)))},i.prototype.PublishToNodeGET_NMI_DATA=function(n){this.PublishToNMI("NMI_GET_DATA:"+n)},i.prototype.PublishToNMI=function(n,t,i,r){i?r===!0?this.GetBaseEngine().PublishToOwner(i,n,t):this.GetBaseEngine().PublishToNode(i,n,t):this.GetBaseEngine().PublishToService(n,t)},i.prototype.cdeGetScript=function(n,t,i,r){var u,f;if(t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=0),n){for(u=0;u<this.MyGlobalResources.length;u++)if(this.MyGlobalResources[u].ResourceName===n){this.MyGlobalResources[u].IsCreated===!0&&t&&t(this.MyGlobalResources[u].Cookie,this.MyGlobalResources[u].Resource);return}t&&(f={ResourceName:n,CallBacks:[],Cookie:i,IsCreated:!1,Resource:null,Timeout:r},f.CallBacks.push(t),this.AddToGlobalScripts(f));this.GetBaseEngine().PublishToService("NMI_GET_GLOBAL_SCRIPT",n)}},i.prototype.CreateGlobalScript=function(n,t){for(var r=0,u,f,r=0;r<this.MyGlobalResources.length;r++)if(this.MyGlobalResources[r].ResourceName===n){if(this.MyGlobalResources[r].IsCreated===!0)return!1;this.MyGlobalResources[r].IsCreated=!0;break}try{u=document.createElement("script");f=document.getElementsByTagName("script")[0];u.type="text/javascript";u.text=t.replace(String.fromCharCode(65279),"");f.parentNode.insertBefore(u,f);i.FireCallbacks(this.MyGlobalResources[r])}catch(e){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:CreateGlobalScripts","Script Execution ("+n+") failed with "+e+":"+e.stack)}},i.FireCallbacks=function(n){if(n){n.TimeoutHandler&&n.TimeoutHandler>0&&clearTimeout(n.TimeoutHandler);for(var t=0;t<n.CallBacks.length;t++)n.CallBacks[t]&&n.CallBacks[t](n.Cookie,n.Resource)}},i.prototype.cdeGetStyle=function(n,t,i,r){var u,f;if(t===void 0&&(t=null),i===void 0&&(i=null),r===void 0&&(r=0),n){for(u=0;u<this.MyGlobalResources.length;u++)if(this.MyGlobalResources[u].ResourceName===n){this.MyGlobalResources[u].IsCreated===!0&&t&&t(this.MyGlobalResources[u].Cookie,this.MyGlobalResources[u].Resource);return}t&&(f={ResourceName:n,CallBacks:[],Cookie:i,IsCreated:!1,Resource:null,Timeout:r},f.CallBacks.push(t),this.AddToGlobalScripts(f));this.GetBaseEngine().PublishToService("NMI_GET_GLOBAL_STYLE",n)}},i.prototype.CreateInlineCSS=function(n,t){for(var r=0,u,r=0;r<this.MyGlobalResources.length;r++)if(this.MyGlobalResources[r].ResourceName===n){if(this.MyGlobalResources[r].IsCreated===!0)return!1;this.MyGlobalResources[r].IsCreated=!0;break}try{u=document.createElement("style");u.type="text/css";u.styleSheet?u.styleSheet.cssText=t.replace(String.fromCharCode(65279),""):u.appendChild(document.createTextNode(t.replace(String.fromCharCode(65279),"")));document.getElementsByTagName("head")[0].appendChild(u);i.FireCallbacks(this.MyGlobalResources[r])}catch(f){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TheNMIService:CreateInlineCSS","Style Inlining ("+n+") failed with "+f)}},i.prototype.cdeGetImage=function(n,t,i,r){var u,f;if(i===void 0&&(i=null),r===void 0&&(r=0),n){for(u=0;u<this.MyGlobalResources.length;u++)if(this.MyGlobalResources[u].ResourceName===n){t&&(this.MyGlobalResources[u].IsCreated===!0?t(this.MyGlobalResources[u].Cookie,this.MyGlobalResources[u].Resource):this.MyGlobalResources[u].Cookie!==i&&this.MyGlobalResources[u].CallBacks.push(t));return}t&&(f={ResourceName:n,CallBacks:[],Cookie:i,IsCreated:!1,Resource:null,Timeout:r},f.CallBacks.push(t),this.AddToGlobalScripts(f));this.GetBaseEngine().PublishToService("NMI_GET_GLOBAL_IMAGE",n)}},i.prototype.cdeGetResource=function(n,t,i,r){var o=this,u,f,e;if(i===void 0&&(i=null),r===void 0&&(r=0),n){for(u=0;u<this.MyGlobalResources.length;u++)if(this.MyGlobalResources[u].ResourceName===n&&(f=!1,t&&(this.MyGlobalResources[u].IsCreated===!0?t(this.MyGlobalResources[u].Cookie,this.MyGlobalResources[u].Resource):(this.MyGlobalResources[u].CallBacks.push(t),this.MyGlobalResources[u].Resource==="TIMEOUT"&&(this.MyGlobalResources[u].Resource=null,f=!0))),!f))return;t&&(e={ResourceName:n,CallBacks:[],Cookie:i,IsCreated:!1,Resource:null,Timeout:r},e.CallBacks.push(t),this.AddToGlobalScripts(e));cde.MyCommChannel?cde.MyBaseAssets.MyServiceHostInfo.IsWebHosted!==!0&&cde.MyCommChannel.IsReady?this.GetBaseEngine().PublishToService("NMI_GET_GLOBAL_RESOURCE",n):cde.MyCommChannel.GetResourceString(n,function(n,t){o.ReturnGlobalResource(n,t)}):this.ReturnGlobalResource(n,null)}},i.prototype.ReturnGlobalResource=function(n,t){for(var r=0,u=!1,r=0;r<this.MyGlobalResources.length;r++)if(this.MyGlobalResources[r].ResourceName===n){this.MyGlobalResources[r].IsCreated||(t&&(this.MyGlobalResources[r].Resource=t.replace(String.fromCharCode(65279),"")),this.MyGlobalResources[r].IsCreated=!0);u=!0;break}try{u?i.FireCallbacks(this.MyGlobalResources[r]):cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TheNMIService:ReturnGlobalResource","Resource sent but not found in request table ("+n+")")}catch(f){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TheNMIService:ReturnGlobalResource","Resource return ("+n+") failed with "+f)}},i.prototype.CheckForUpdates=function(){n.MyToast&&n.MyToast.ShowToastMessage("Checking for update...","Updates will be visible in the main portal. Touch the home icon to see if you have updates",1e4);this.PublishToNMI("NMI_CHECK4_UPDATE")},i.prototype.GetScreenMeta=function(t,i){return!n.MyNMIModels[cde.GuidToString(t)]&&!this.MetaRequested[cde.GuidToString(t)]||i?(i&&(n.MyNMIModels[cde.GuidToString(t)]=null),this.PublishToNMI("NMI_GET_SCREENMETA"+(i?"F":""),t),this.MetaRequested[cde.GuidToString(t)]=!0,!0):!1},i.prototype.GetScene=function(n){this.PublishToNMI("NMI_GET_SCENE",n)},i.prototype.IsNodeDown=function(n){return this.MyKnownNodes[n]&&this.MyKnownNodes[n].IsDown===!0},i.prototype.GetKnownNodeName=function(n){return this.MyKnownNodes[n]?this.MyKnownNodes[n].NodeName:""},i.prototype.RegisterKnownNode=function(t,i){var r=null;r=this.MyKnownNodes[t]?this.MyKnownNodes[t]:new n.TheNodeInfo;r.cdeN=t;r.IsDown===!0&&(r.IsDown=!1,n.MyScreenManager&&n.MyScreenManager.UpdateScreenStatus(t,!1));r.IsDown=!1;r.NodeName||(r.NodeName=i?i:t);r.NodeName===t&&i&&(r.NodeName=i);r.LastPing=(new Date).getTime();this.MyKnownNodes[t]=r},i.prototype.FireIncoming=function(t){var i,u,r;if(t&&t.Message){t.Message.ENG===n.eTheNMIEngine&&(n.MyTCF.FireControls(t)||this.FireEvent(!0,"IncomingMessage",t));i=this.MyNMIIncomingEvents[t.Message.ENG];for(u in i)r=i[u],r&&r.FireEvent(!1,"IncomingMessage",new cde.TheProcessMessage(t.Topic,t.Message))}},i.prototype.OnHandleMessage=function(i){var r=i.Message,u;if(r){if(!this.AreEnginesRequested&&cde.MyBaseAssets.MyCommStatus.IsUserLoggedIn&&(this.AreEnginesRequested=!0,this.PublishToNMI("NMI_GET_ENGINEJS")),this.RegisterKnownNode(cde.TSM.GetOriginator(r)),t.prototype.BaseOnHandleMessage.call(this,i)){n.MyScreenManager&&n.MyScreenManager.ShowView();return}u=r.TXT.split(":");switch(u[0]){case"NMI_GLOBAL_IMAGE":r.PLS&&u.length>1&&this.ReturnGlobalResource(u[1],r.PLS);break;case"NMI_GLOBAL_RESOURCE":r.PLS&&u.length>1&&this.ReturnGlobalResource(u[1],r.PLS);break;case"NMI_GLOBAL_SCRIPT":r.PLS&&u.length>1&&this.CreateGlobalScript(u[1],r.PLS);break;case"NMI_GLOBAL_STYLE":r.PLS&&u.length>1&&this.CreateInlineCSS(u[1],r.PLS);break;default:return}n.MyScreenManager&&n.MyScreenManager.ShowView()}},i.prototype.sinkScopeIDSet=function(){n.MyScreenManager&&n.MyScreenManager.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen)},i}(n.TheNMIServiceBase);n.TheNMIService=t}(cdeNMI||(cdeNMI={})),function(n){var r=function(){function n(n,t,i,r){this.X=n;this.Y=t;this.Width=i;this.Height=r}return n}(),t,i,u;n.TheRectangle=r;t=function(){function n(n,t,i){this.Name=t;this.Points=n.Resample(i,n.NumPoints);var r=n.IndicativeAngle(this.Points);this.Points=n.RotateBy(this.Points,-r);this.Points=n.ScaleTo(this.Points,n.SquareSize);this.Points=n.TranslateTo(this.Points,n.Origin);this.Vector=n.Vectorize(this.Points)}return n}();n.Unistroke=t;i=function(){function n(n,t,i){this.Name=n;this.Score=t;this.Time=i}return n}();n.TheRecognizerResult=i;u=function(u){function f(){var i=u.call(this)||this;return i.NumUnistrokes=16,i.NumPoints=64,i.SquareSize=250,i.Origin=new n.TheDrawingPoint(0,0),i.Diagonal=Math.sqrt(i.SquareSize*i.SquareSize+i.SquareSize*i.SquareSize),i.HalfDiagonal=.5*i.Diagonal,i.AngleRange=i.Deg2Rad(45),i.AnglePrecision=i.Deg2Rad(2),i.Phi=.5*(-1+Math.sqrt(5)),i.MyBaseType=n.cdeControlType.ShapeRecognizer,i.Unistrokes=new Array(i.NumUnistrokes),i.Unistrokes[0]=new t(i,"triangle",[new n.TheDrawingPoint(137,139),new n.TheDrawingPoint(135,141),new n.TheDrawingPoint(133,144),new n.TheDrawingPoint(132,146),new n.TheDrawingPoint(130,149),new n.TheDrawingPoint(128,151),new n.TheDrawingPoint(126,155),new n.TheDrawingPoint(123,160),new n.TheDrawingPoint(120,166),new n.TheDrawingPoint(116,171),new n.TheDrawingPoint(112,177),new n.TheDrawingPoint(107,183),new n.TheDrawingPoint(102,188),new n.TheDrawingPoint(100,191),new n.TheDrawingPoint(95,195),new n.TheDrawingPoint(90,199),new n.TheDrawingPoint(86,203),new n.TheDrawingPoint(82,206),new n.TheDrawingPoint(80,209),new n.TheDrawingPoint(75,213),new n.TheDrawingPoint(73,213),new n.TheDrawingPoint(70,216),new n.TheDrawingPoint(67,219),new n.TheDrawingPoint(64,221),new n.TheDrawingPoint(61,223),new n.TheDrawingPoint(60,225),new n.TheDrawingPoint(62,226),new n.TheDrawingPoint(65,225),new n.TheDrawingPoint(67,226),new n.TheDrawingPoint(74,226),new n.TheDrawingPoint(77,227),new n.TheDrawingPoint(85,229),new n.TheDrawingPoint(91,230),new n.TheDrawingPoint(99,231),new n.TheDrawingPoint(108,232),new n.TheDrawingPoint(116,233),new n.TheDrawingPoint(125,233),new n.TheDrawingPoint(134,234),new n.TheDrawingPoint(145,233),new n.TheDrawingPoint(153,232),new n.TheDrawingPoint(160,233),new n.TheDrawingPoint(170,234),new n.TheDrawingPoint(177,235),new n.TheDrawingPoint(179,236),new n.TheDrawingPoint(186,237),new n.TheDrawingPoint(193,238),new n.TheDrawingPoint(198,239),new n.TheDrawingPoint(200,237),new n.TheDrawingPoint(202,239),new n.TheDrawingPoint(204,238),new n.TheDrawingPoint(206,234),new n.TheDrawingPoint(205,230),new n.TheDrawingPoint(202,222),new n.TheDrawingPoint(197,216),new n.TheDrawingPoint(192,207),new n.TheDrawingPoint(186,198),new n.TheDrawingPoint(179,189),new n.TheDrawingPoint(174,183),new n.TheDrawingPoint(170,178),new n.TheDrawingPoint(164,171),new n.TheDrawingPoint(161,168),new n.TheDrawingPoint(154,160),new n.TheDrawingPoint(148,155),new n.TheDrawingPoint(143,150),new n.TheDrawingPoint(138,148),new n.TheDrawingPoint(136,148)]),i.Unistrokes[1]=new t(i,"x",[new n.TheDrawingPoint(87,142),new n.TheDrawingPoint(89,145),new n.TheDrawingPoint(91,148),new n.TheDrawingPoint(93,151),new n.TheDrawingPoint(96,155),new n.TheDrawingPoint(98,157),new n.TheDrawingPoint(100,160),new n.TheDrawingPoint(102,162),new n.TheDrawingPoint(106,167),new n.TheDrawingPoint(108,169),new n.TheDrawingPoint(110,171),new n.TheDrawingPoint(115,177),new n.TheDrawingPoint(119,183),new n.TheDrawingPoint(123,189),new n.TheDrawingPoint(127,193),new n.TheDrawingPoint(129,196),new n.TheDrawingPoint(133,200),new n.TheDrawingPoint(137,206),new n.TheDrawingPoint(140,209),new n.TheDrawingPoint(143,212),new n.TheDrawingPoint(146,215),new n.TheDrawingPoint(151,220),new n.TheDrawingPoint(153,222),new n.TheDrawingPoint(155,223),new n.TheDrawingPoint(157,225),new n.TheDrawingPoint(158,223),new n.TheDrawingPoint(157,218),new n.TheDrawingPoint(155,211),new n.TheDrawingPoint(154,208),new n.TheDrawingPoint(152,200),new n.TheDrawingPoint(150,189),new n.TheDrawingPoint(148,179),new n.TheDrawingPoint(147,170),new n.TheDrawingPoint(147,158),new n.TheDrawingPoint(147,148),new n.TheDrawingPoint(147,141),new n.TheDrawingPoint(147,136),new n.TheDrawingPoint(144,135),new n.TheDrawingPoint(142,137),new n.TheDrawingPoint(140,139),new n.TheDrawingPoint(135,145),new n.TheDrawingPoint(131,152),new n.TheDrawingPoint(124,163),new n.TheDrawingPoint(116,177),new n.TheDrawingPoint(108,191),new n.TheDrawingPoint(100,206),new n.TheDrawingPoint(94,217),new n.TheDrawingPoint(91,222),new n.TheDrawingPoint(89,225),new n.TheDrawingPoint(87,226),new n.TheDrawingPoint(87,224)]),i.Unistrokes[2]=new t(i,"rectangle",[new n.TheDrawingPoint(78,149),new n.TheDrawingPoint(78,153),new n.TheDrawingPoint(78,157),new n.TheDrawingPoint(78,160),new n.TheDrawingPoint(79,162),new n.TheDrawingPoint(79,164),new n.TheDrawingPoint(79,167),new n.TheDrawingPoint(79,169),new n.TheDrawingPoint(79,173),new n.TheDrawingPoint(79,178),new n.TheDrawingPoint(79,183),new n.TheDrawingPoint(80,189),new n.TheDrawingPoint(80,193),new n.TheDrawingPoint(80,198),new n.TheDrawingPoint(80,202),new n.TheDrawingPoint(81,208),new n.TheDrawingPoint(81,210),new n.TheDrawingPoint(81,216),new n.TheDrawingPoint(82,222),new n.TheDrawingPoint(82,224),new n.TheDrawingPoint(82,227),new n.TheDrawingPoint(83,229),new n.TheDrawingPoint(83,231),new n.TheDrawingPoint(85,230),new n.TheDrawingPoint(88,232),new n.TheDrawingPoint(90,233),new n.TheDrawingPoint(92,232),new n.TheDrawingPoint(94,233),new n.TheDrawingPoint(99,232),new n.TheDrawingPoint(102,233),new n.TheDrawingPoint(106,233),new n.TheDrawingPoint(109,234),new n.TheDrawingPoint(117,235),new n.TheDrawingPoint(123,236),new n.TheDrawingPoint(126,236),new n.TheDrawingPoint(135,237),new n.TheDrawingPoint(142,238),new n.TheDrawingPoint(145,238),new n.TheDrawingPoint(152,238),new n.TheDrawingPoint(154,239),new n.TheDrawingPoint(165,238),new n.TheDrawingPoint(174,237),new n.TheDrawingPoint(179,236),new n.TheDrawingPoint(186,235),new n.TheDrawingPoint(191,235),new n.TheDrawingPoint(195,233),new n.TheDrawingPoint(197,233),new n.TheDrawingPoint(200,233),new n.TheDrawingPoint(201,235),new n.TheDrawingPoint(201,233),new n.TheDrawingPoint(199,231),new n.TheDrawingPoint(198,226),new n.TheDrawingPoint(198,220),new n.TheDrawingPoint(196,207),new n.TheDrawingPoint(195,195),new n.TheDrawingPoint(195,181),new n.TheDrawingPoint(195,173),new n.TheDrawingPoint(195,163),new n.TheDrawingPoint(194,155),new n.TheDrawingPoint(192,145),new n.TheDrawingPoint(192,143),new n.TheDrawingPoint(192,138),new n.TheDrawingPoint(191,135),new n.TheDrawingPoint(191,133),new n.TheDrawingPoint(191,130),new n.TheDrawingPoint(190,128),new n.TheDrawingPoint(188,129),new n.TheDrawingPoint(186,129),new n.TheDrawingPoint(181,132),new n.TheDrawingPoint(173,131),new n.TheDrawingPoint(162,131),new n.TheDrawingPoint(151,132),new n.TheDrawingPoint(149,132),new n.TheDrawingPoint(138,132),new n.TheDrawingPoint(136,132),new n.TheDrawingPoint(122,131),new n.TheDrawingPoint(120,131),new n.TheDrawingPoint(109,130),new n.TheDrawingPoint(107,130),new n.TheDrawingPoint(90,132),new n.TheDrawingPoint(81,133),new n.TheDrawingPoint(76,133)]),i.Unistrokes[3]=new t(i,"circle",[new n.TheDrawingPoint(127,141),new n.TheDrawingPoint(124,140),new n.TheDrawingPoint(120,139),new n.TheDrawingPoint(118,139),new n.TheDrawingPoint(116,139),new n.TheDrawingPoint(111,140),new n.TheDrawingPoint(109,141),new n.TheDrawingPoint(104,144),new n.TheDrawingPoint(100,147),new n.TheDrawingPoint(96,152),new n.TheDrawingPoint(93,157),new n.TheDrawingPoint(90,163),new n.TheDrawingPoint(87,169),new n.TheDrawingPoint(85,175),new n.TheDrawingPoint(83,181),new n.TheDrawingPoint(82,190),new n.TheDrawingPoint(82,195),new n.TheDrawingPoint(83,200),new n.TheDrawingPoint(84,205),new n.TheDrawingPoint(88,213),new n.TheDrawingPoint(91,216),new n.TheDrawingPoint(96,219),new n.TheDrawingPoint(103,222),new n.TheDrawingPoint(108,224),new n.TheDrawingPoint(111,224),new n.TheDrawingPoint(120,224),new n.TheDrawingPoint(133,223),new n.TheDrawingPoint(142,222),new n.TheDrawingPoint(152,218),new n.TheDrawingPoint(160,214),new n.TheDrawingPoint(167,210),new n.TheDrawingPoint(173,204),new n.TheDrawingPoint(178,198),new n.TheDrawingPoint(179,196),new n.TheDrawingPoint(182,188),new n.TheDrawingPoint(182,177),new n.TheDrawingPoint(178,167),new n.TheDrawingPoint(170,150),new n.TheDrawingPoint(163,138),new n.TheDrawingPoint(152,130),new n.TheDrawingPoint(143,129),new n.TheDrawingPoint(140,131),new n.TheDrawingPoint(129,136),new n.TheDrawingPoint(126,139)]),i.Unistrokes[4]=new t(i,"check",[new n.TheDrawingPoint(91,185),new n.TheDrawingPoint(93,185),new n.TheDrawingPoint(95,185),new n.TheDrawingPoint(97,185),new n.TheDrawingPoint(100,188),new n.TheDrawingPoint(102,189),new n.TheDrawingPoint(104,190),new n.TheDrawingPoint(106,193),new n.TheDrawingPoint(108,195),new n.TheDrawingPoint(110,198),new n.TheDrawingPoint(112,201),new n.TheDrawingPoint(114,204),new n.TheDrawingPoint(115,207),new n.TheDrawingPoint(117,210),new n.TheDrawingPoint(118,212),new n.TheDrawingPoint(120,214),new n.TheDrawingPoint(121,217),new n.TheDrawingPoint(122,219),new n.TheDrawingPoint(123,222),new n.TheDrawingPoint(124,224),new n.TheDrawingPoint(126,226),new n.TheDrawingPoint(127,229),new n.TheDrawingPoint(129,231),new n.TheDrawingPoint(130,233),new n.TheDrawingPoint(129,231),new n.TheDrawingPoint(129,228),new n.TheDrawingPoint(129,226),new n.TheDrawingPoint(129,224),new n.TheDrawingPoint(129,221),new n.TheDrawingPoint(129,218),new n.TheDrawingPoint(129,212),new n.TheDrawingPoint(129,208),new n.TheDrawingPoint(130,198),new n.TheDrawingPoint(132,189),new n.TheDrawingPoint(134,182),new n.TheDrawingPoint(137,173),new n.TheDrawingPoint(143,164),new n.TheDrawingPoint(147,157),new n.TheDrawingPoint(151,151),new n.TheDrawingPoint(155,144),new n.TheDrawingPoint(161,137),new n.TheDrawingPoint(165,131),new n.TheDrawingPoint(171,122),new n.TheDrawingPoint(174,118),new n.TheDrawingPoint(176,114),new n.TheDrawingPoint(177,112),new n.TheDrawingPoint(177,114),new n.TheDrawingPoint(175,116),new n.TheDrawingPoint(173,118)]),i.Unistrokes[5]=new t(i,"caret",[new n.TheDrawingPoint(79,245),new n.TheDrawingPoint(79,242),new n.TheDrawingPoint(79,239),new n.TheDrawingPoint(80,237),new n.TheDrawingPoint(80,234),new n.TheDrawingPoint(81,232),new n.TheDrawingPoint(82,230),new n.TheDrawingPoint(84,224),new n.TheDrawingPoint(86,220),new n.TheDrawingPoint(86,218),new n.TheDrawingPoint(87,216),new n.TheDrawingPoint(88,213),new n.TheDrawingPoint(90,207),new n.TheDrawingPoint(91,202),new n.TheDrawingPoint(92,200),new n.TheDrawingPoint(93,194),new n.TheDrawingPoint(94,192),new n.TheDrawingPoint(96,189),new n.TheDrawingPoint(97,186),new n.TheDrawingPoint(100,179),new n.TheDrawingPoint(102,173),new n.TheDrawingPoint(105,165),new n.TheDrawingPoint(107,160),new n.TheDrawingPoint(109,158),new n.TheDrawingPoint(112,151),new n.TheDrawingPoint(115,144),new n.TheDrawingPoint(117,139),new n.TheDrawingPoint(119,136),new n.TheDrawingPoint(119,134),new n.TheDrawingPoint(120,132),new n.TheDrawingPoint(121,129),new n.TheDrawingPoint(122,127),new n.TheDrawingPoint(124,125),new n.TheDrawingPoint(126,124),new n.TheDrawingPoint(129,125),new n.TheDrawingPoint(131,127),new n.TheDrawingPoint(132,130),new n.TheDrawingPoint(136,139),new n.TheDrawingPoint(141,154),new n.TheDrawingPoint(145,166),new n.TheDrawingPoint(151,182),new n.TheDrawingPoint(156,193),new n.TheDrawingPoint(157,196),new n.TheDrawingPoint(161,209),new n.TheDrawingPoint(162,211),new n.TheDrawingPoint(167,223),new n.TheDrawingPoint(169,229),new n.TheDrawingPoint(170,231),new n.TheDrawingPoint(173,237),new n.TheDrawingPoint(176,242),new n.TheDrawingPoint(177,244),new n.TheDrawingPoint(179,250),new n.TheDrawingPoint(181,255),new n.TheDrawingPoint(182,257)]),i.Unistrokes[6]=new t(i,"zig-zag",[new n.TheDrawingPoint(307,216),new n.TheDrawingPoint(333,186),new n.TheDrawingPoint(356,215),new n.TheDrawingPoint(375,186),new n.TheDrawingPoint(399,216),new n.TheDrawingPoint(418,186)]),i.Unistrokes[7]=new t(i,"arrow",[new n.TheDrawingPoint(68,222),new n.TheDrawingPoint(70,220),new n.TheDrawingPoint(73,218),new n.TheDrawingPoint(75,217),new n.TheDrawingPoint(77,215),new n.TheDrawingPoint(80,213),new n.TheDrawingPoint(82,212),new n.TheDrawingPoint(84,210),new n.TheDrawingPoint(87,209),new n.TheDrawingPoint(89,208),new n.TheDrawingPoint(92,206),new n.TheDrawingPoint(95,204),new n.TheDrawingPoint(101,201),new n.TheDrawingPoint(106,198),new n.TheDrawingPoint(112,194),new n.TheDrawingPoint(118,191),new n.TheDrawingPoint(124,187),new n.TheDrawingPoint(127,186),new n.TheDrawingPoint(132,183),new n.TheDrawingPoint(138,181),new n.TheDrawingPoint(141,180),new n.TheDrawingPoint(146,178),new n.TheDrawingPoint(154,173),new n.TheDrawingPoint(159,171),new n.TheDrawingPoint(161,170),new n.TheDrawingPoint(166,167),new n.TheDrawingPoint(168,167),new n.TheDrawingPoint(171,166),new n.TheDrawingPoint(174,164),new n.TheDrawingPoint(177,162),new n.TheDrawingPoint(180,160),new n.TheDrawingPoint(182,158),new n.TheDrawingPoint(183,156),new n.TheDrawingPoint(181,154),new n.TheDrawingPoint(178,153),new n.TheDrawingPoint(171,153),new n.TheDrawingPoint(164,153),new n.TheDrawingPoint(160,153),new n.TheDrawingPoint(150,154),new n.TheDrawingPoint(147,155),new n.TheDrawingPoint(141,157),new n.TheDrawingPoint(137,158),new n.TheDrawingPoint(135,158),new n.TheDrawingPoint(137,158),new n.TheDrawingPoint(140,157),new n.TheDrawingPoint(143,156),new n.TheDrawingPoint(151,154),new n.TheDrawingPoint(160,152),new n.TheDrawingPoint(170,149),new n.TheDrawingPoint(179,147),new n.TheDrawingPoint(185,145),new n.TheDrawingPoint(192,144),new n.TheDrawingPoint(196,144),new n.TheDrawingPoint(198,144),new n.TheDrawingPoint(200,144),new n.TheDrawingPoint(201,147),new n.TheDrawingPoint(199,149),new n.TheDrawingPoint(194,157),new n.TheDrawingPoint(191,160),new n.TheDrawingPoint(186,167),new n.TheDrawingPoint(180,176),new n.TheDrawingPoint(177,179),new n.TheDrawingPoint(171,187),new n.TheDrawingPoint(169,189),new n.TheDrawingPoint(165,194),new n.TheDrawingPoint(164,196)]),i.Unistrokes[8]=new t(i,"left square bracket",[new n.TheDrawingPoint(140,124),new n.TheDrawingPoint(138,123),new n.TheDrawingPoint(135,122),new n.TheDrawingPoint(133,123),new n.TheDrawingPoint(130,123),new n.TheDrawingPoint(128,124),new n.TheDrawingPoint(125,125),new n.TheDrawingPoint(122,124),new n.TheDrawingPoint(120,124),new n.TheDrawingPoint(118,124),new n.TheDrawingPoint(116,125),new n.TheDrawingPoint(113,125),new n.TheDrawingPoint(111,125),new n.TheDrawingPoint(108,124),new n.TheDrawingPoint(106,125),new n.TheDrawingPoint(104,125),new n.TheDrawingPoint(102,124),new n.TheDrawingPoint(100,123),new n.TheDrawingPoint(98,123),new n.TheDrawingPoint(95,124),new n.TheDrawingPoint(93,123),new n.TheDrawingPoint(90,124),new n.TheDrawingPoint(88,124),new n.TheDrawingPoint(85,125),new n.TheDrawingPoint(83,126),new n.TheDrawingPoint(81,127),new n.TheDrawingPoint(81,129),new n.TheDrawingPoint(82,131),new n.TheDrawingPoint(82,134),new n.TheDrawingPoint(83,138),new n.TheDrawingPoint(84,141),new n.TheDrawingPoint(84,144),new n.TheDrawingPoint(85,148),new n.TheDrawingPoint(85,151),new n.TheDrawingPoint(86,156),new n.TheDrawingPoint(86,160),new n.TheDrawingPoint(86,164),new n.TheDrawingPoint(86,168),new n.TheDrawingPoint(87,171),new n.TheDrawingPoint(87,175),new n.TheDrawingPoint(87,179),new n.TheDrawingPoint(87,182),new n.TheDrawingPoint(87,186),new n.TheDrawingPoint(88,188),new n.TheDrawingPoint(88,195),new n.TheDrawingPoint(88,198),new n.TheDrawingPoint(88,201),new n.TheDrawingPoint(88,207),new n.TheDrawingPoint(89,211),new n.TheDrawingPoint(89,213),new n.TheDrawingPoint(89,217),new n.TheDrawingPoint(89,222),new n.TheDrawingPoint(88,225),new n.TheDrawingPoint(88,229),new n.TheDrawingPoint(88,231),new n.TheDrawingPoint(88,233),new n.TheDrawingPoint(88,235),new n.TheDrawingPoint(89,237),new n.TheDrawingPoint(89,240),new n.TheDrawingPoint(89,242),new n.TheDrawingPoint(91,241),new n.TheDrawingPoint(94,241),new n.TheDrawingPoint(96,240),new n.TheDrawingPoint(98,239),new n.TheDrawingPoint(105,240),new n.TheDrawingPoint(109,240),new n.TheDrawingPoint(113,239),new n.TheDrawingPoint(116,240),new n.TheDrawingPoint(121,239),new n.TheDrawingPoint(130,240),new n.TheDrawingPoint(136,237),new n.TheDrawingPoint(139,237),new n.TheDrawingPoint(144,238),new n.TheDrawingPoint(151,237),new n.TheDrawingPoint(157,236),new n.TheDrawingPoint(159,237)]),i.Unistrokes[9]=new t(i,"right square bracket",[new n.TheDrawingPoint(112,138),new n.TheDrawingPoint(112,136),new n.TheDrawingPoint(115,136),new n.TheDrawingPoint(118,137),new n.TheDrawingPoint(120,136),new n.TheDrawingPoint(123,136),new n.TheDrawingPoint(125,136),new n.TheDrawingPoint(128,136),new n.TheDrawingPoint(131,136),new n.TheDrawingPoint(134,135),new n.TheDrawingPoint(137,135),new n.TheDrawingPoint(140,134),new n.TheDrawingPoint(143,133),new n.TheDrawingPoint(145,132),new n.TheDrawingPoint(147,132),new n.TheDrawingPoint(149,132),new n.TheDrawingPoint(152,132),new n.TheDrawingPoint(153,134),new n.TheDrawingPoint(154,137),new n.TheDrawingPoint(155,141),new n.TheDrawingPoint(156,144),new n.TheDrawingPoint(157,152),new n.TheDrawingPoint(158,161),new n.TheDrawingPoint(160,170),new n.TheDrawingPoint(162,182),new n.TheDrawingPoint(164,192),new n.TheDrawingPoint(166,200),new n.TheDrawingPoint(167,209),new n.TheDrawingPoint(168,214),new n.TheDrawingPoint(168,216),new n.TheDrawingPoint(169,221),new n.TheDrawingPoint(169,223),new n.TheDrawingPoint(169,228),new n.TheDrawingPoint(169,231),new n.TheDrawingPoint(166,233),new n.TheDrawingPoint(164,234),new n.TheDrawingPoint(161,235),new n.TheDrawingPoint(155,236),new n.TheDrawingPoint(147,235),new n.TheDrawingPoint(140,233),new n.TheDrawingPoint(131,233),new n.TheDrawingPoint(124,233),new n.TheDrawingPoint(117,235),new n.TheDrawingPoint(114,238),new n.TheDrawingPoint(112,238)]),i.Unistrokes[10]=new t(i,"v",[new n.TheDrawingPoint(89,164),new n.TheDrawingPoint(90,162),new n.TheDrawingPoint(92,162),new n.TheDrawingPoint(94,164),new n.TheDrawingPoint(95,166),new n.TheDrawingPoint(96,169),new n.TheDrawingPoint(97,171),new n.TheDrawingPoint(99,175),new n.TheDrawingPoint(101,178),new n.TheDrawingPoint(103,182),new n.TheDrawingPoint(106,189),new n.TheDrawingPoint(108,194),new n.TheDrawingPoint(111,199),new n.TheDrawingPoint(114,204),new n.TheDrawingPoint(117,209),new n.TheDrawingPoint(119,214),new n.TheDrawingPoint(122,218),new n.TheDrawingPoint(124,222),new n.TheDrawingPoint(126,225),new n.TheDrawingPoint(128,228),new n.TheDrawingPoint(130,229),new n.TheDrawingPoint(133,233),new n.TheDrawingPoint(134,236),new n.TheDrawingPoint(136,239),new n.TheDrawingPoint(138,240),new n.TheDrawingPoint(139,242),new n.TheDrawingPoint(140,244),new n.TheDrawingPoint(142,242),new n.TheDrawingPoint(142,240),new n.TheDrawingPoint(142,237),new n.TheDrawingPoint(143,235),new n.TheDrawingPoint(143,233),new n.TheDrawingPoint(145,229),new n.TheDrawingPoint(146,226),new n.TheDrawingPoint(148,217),new n.TheDrawingPoint(149,208),new n.TheDrawingPoint(149,205),new n.TheDrawingPoint(151,196),new n.TheDrawingPoint(151,193),new n.TheDrawingPoint(153,182),new n.TheDrawingPoint(155,172),new n.TheDrawingPoint(157,165),new n.TheDrawingPoint(159,160),new n.TheDrawingPoint(162,155),new n.TheDrawingPoint(164,150),new n.TheDrawingPoint(165,148),new n.TheDrawingPoint(166,146)]),i.Unistrokes[11]=new t(i,"delete",[new n.TheDrawingPoint(123,129),new n.TheDrawingPoint(123,131),new n.TheDrawingPoint(124,133),new n.TheDrawingPoint(125,136),new n.TheDrawingPoint(127,140),new n.TheDrawingPoint(129,142),new n.TheDrawingPoint(133,148),new n.TheDrawingPoint(137,154),new n.TheDrawingPoint(143,158),new n.TheDrawingPoint(145,161),new n.TheDrawingPoint(148,164),new n.TheDrawingPoint(153,170),new n.TheDrawingPoint(158,176),new n.TheDrawingPoint(160,178),new n.TheDrawingPoint(164,183),new n.TheDrawingPoint(168,188),new n.TheDrawingPoint(171,191),new n.TheDrawingPoint(175,196),new n.TheDrawingPoint(178,200),new n.TheDrawingPoint(180,202),new n.TheDrawingPoint(181,205),new n.TheDrawingPoint(184,208),new n.TheDrawingPoint(186,210),new n.TheDrawingPoint(187,213),new n.TheDrawingPoint(188,215),new n.TheDrawingPoint(186,212),new n.TheDrawingPoint(183,211),new n.TheDrawingPoint(177,208),new n.TheDrawingPoint(169,206),new n.TheDrawingPoint(162,205),new n.TheDrawingPoint(154,207),new n.TheDrawingPoint(145,209),new n.TheDrawingPoint(137,210),new n.TheDrawingPoint(129,214),new n.TheDrawingPoint(122,217),new n.TheDrawingPoint(118,218),new n.TheDrawingPoint(111,221),new n.TheDrawingPoint(109,222),new n.TheDrawingPoint(110,219),new n.TheDrawingPoint(112,217),new n.TheDrawingPoint(118,209),new n.TheDrawingPoint(120,207),new n.TheDrawingPoint(128,196),new n.TheDrawingPoint(135,187),new n.TheDrawingPoint(138,183),new n.TheDrawingPoint(148,167),new n.TheDrawingPoint(157,153),new n.TheDrawingPoint(163,145),new n.TheDrawingPoint(165,142),new n.TheDrawingPoint(172,133),new n.TheDrawingPoint(177,127),new n.TheDrawingPoint(179,127),new n.TheDrawingPoint(180,125)]),i.Unistrokes[12]=new t(i,"left curly brace",[new n.TheDrawingPoint(150,116),new n.TheDrawingPoint(147,117),new n.TheDrawingPoint(145,116),new n.TheDrawingPoint(142,116),new n.TheDrawingPoint(139,117),new n.TheDrawingPoint(136,117),new n.TheDrawingPoint(133,118),new n.TheDrawingPoint(129,121),new n.TheDrawingPoint(126,122),new n.TheDrawingPoint(123,123),new n.TheDrawingPoint(120,125),new n.TheDrawingPoint(118,127),new n.TheDrawingPoint(115,128),new n.TheDrawingPoint(113,129),new n.TheDrawingPoint(112,131),new n.TheDrawingPoint(113,134),new n.TheDrawingPoint(115,134),new n.TheDrawingPoint(117,135),new n.TheDrawingPoint(120,135),new n.TheDrawingPoint(123,137),new n.TheDrawingPoint(126,138),new n.TheDrawingPoint(129,140),new n.TheDrawingPoint(135,143),new n.TheDrawingPoint(137,144),new n.TheDrawingPoint(139,147),new n.TheDrawingPoint(141,149),new n.TheDrawingPoint(140,152),new n.TheDrawingPoint(139,155),new n.TheDrawingPoint(134,159),new n.TheDrawingPoint(131,161),new n.TheDrawingPoint(124,166),new n.TheDrawingPoint(121,166),new n.TheDrawingPoint(117,166),new n.TheDrawingPoint(114,167),new n.TheDrawingPoint(112,166),new n.TheDrawingPoint(114,164),new n.TheDrawingPoint(116,163),new n.TheDrawingPoint(118,163),new n.TheDrawingPoint(120,162),new n.TheDrawingPoint(122,163),new n.TheDrawingPoint(125,164),new n.TheDrawingPoint(127,165),new n.TheDrawingPoint(129,166),new n.TheDrawingPoint(130,168),new n.TheDrawingPoint(129,171),new n.TheDrawingPoint(127,175),new n.TheDrawingPoint(125,179),new n.TheDrawingPoint(123,184),new n.TheDrawingPoint(121,190),new n.TheDrawingPoint(120,194),new n.TheDrawingPoint(119,199),new n.TheDrawingPoint(120,202),new n.TheDrawingPoint(123,207),new n.TheDrawingPoint(127,211),new n.TheDrawingPoint(133,215),new n.TheDrawingPoint(142,219),new n.TheDrawingPoint(148,220),new n.TheDrawingPoint(151,221)]),i.Unistrokes[13]=new t(i,"right curly brace",[new n.TheDrawingPoint(117,132),new n.TheDrawingPoint(115,132),new n.TheDrawingPoint(115,129),new n.TheDrawingPoint(117,129),new n.TheDrawingPoint(119,128),new n.TheDrawingPoint(122,127),new n.TheDrawingPoint(125,127),new n.TheDrawingPoint(127,127),new n.TheDrawingPoint(130,127),new n.TheDrawingPoint(133,129),new n.TheDrawingPoint(136,129),new n.TheDrawingPoint(138,130),new n.TheDrawingPoint(140,131),new n.TheDrawingPoint(143,134),new n.TheDrawingPoint(144,136),new n.TheDrawingPoint(145,139),new n.TheDrawingPoint(145,142),new n.TheDrawingPoint(145,145),new n.TheDrawingPoint(145,147),new n.TheDrawingPoint(145,149),new n.TheDrawingPoint(144,152),new n.TheDrawingPoint(142,157),new n.TheDrawingPoint(141,160),new n.TheDrawingPoint(139,163),new n.TheDrawingPoint(137,166),new n.TheDrawingPoint(135,167),new n.TheDrawingPoint(133,169),new n.TheDrawingPoint(131,172),new n.TheDrawingPoint(128,173),new n.TheDrawingPoint(126,176),new n.TheDrawingPoint(125,178),new n.TheDrawingPoint(125,180),new n.TheDrawingPoint(125,182),new n.TheDrawingPoint(126,184),new n.TheDrawingPoint(128,187),new n.TheDrawingPoint(130,187),new n.TheDrawingPoint(132,188),new n.TheDrawingPoint(135,189),new n.TheDrawingPoint(140,189),new n.TheDrawingPoint(145,189),new n.TheDrawingPoint(150,187),new n.TheDrawingPoint(155,186),new n.TheDrawingPoint(157,185),new n.TheDrawingPoint(159,184),new n.TheDrawingPoint(156,185),new n.TheDrawingPoint(154,185),new n.TheDrawingPoint(149,185),new n.TheDrawingPoint(145,187),new n.TheDrawingPoint(141,188),new n.TheDrawingPoint(136,191),new n.TheDrawingPoint(134,191),new n.TheDrawingPoint(131,192),new n.TheDrawingPoint(129,193),new n.TheDrawingPoint(129,195),new n.TheDrawingPoint(129,197),new n.TheDrawingPoint(131,200),new n.TheDrawingPoint(133,202),new n.TheDrawingPoint(136,206),new n.TheDrawingPoint(139,211),new n.TheDrawingPoint(142,215),new n.TheDrawingPoint(145,220),new n.TheDrawingPoint(147,225),new n.TheDrawingPoint(148,231),new n.TheDrawingPoint(147,239),new n.TheDrawingPoint(144,244),new n.TheDrawingPoint(139,248),new n.TheDrawingPoint(134,250),new n.TheDrawingPoint(126,253),new n.TheDrawingPoint(119,253),new n.TheDrawingPoint(115,253)]),i.Unistrokes[14]=new t(i,"star",[new n.TheDrawingPoint(75,250),new n.TheDrawingPoint(75,247),new n.TheDrawingPoint(77,244),new n.TheDrawingPoint(78,242),new n.TheDrawingPoint(79,239),new n.TheDrawingPoint(80,237),new n.TheDrawingPoint(82,234),new n.TheDrawingPoint(82,232),new n.TheDrawingPoint(84,229),new n.TheDrawingPoint(85,225),new n.TheDrawingPoint(87,222),new n.TheDrawingPoint(88,219),new n.TheDrawingPoint(89,216),new n.TheDrawingPoint(91,212),new n.TheDrawingPoint(92,208),new n.TheDrawingPoint(94,204),new n.TheDrawingPoint(95,201),new n.TheDrawingPoint(96,196),new n.TheDrawingPoint(97,194),new n.TheDrawingPoint(98,191),new n.TheDrawingPoint(100,185),new n.TheDrawingPoint(102,178),new n.TheDrawingPoint(104,173),new n.TheDrawingPoint(104,171),new n.TheDrawingPoint(105,164),new n.TheDrawingPoint(106,158),new n.TheDrawingPoint(107,156),new n.TheDrawingPoint(107,152),new n.TheDrawingPoint(108,145),new n.TheDrawingPoint(109,141),new n.TheDrawingPoint(110,139),new n.TheDrawingPoint(112,133),new n.TheDrawingPoint(113,131),new n.TheDrawingPoint(116,127),new n.TheDrawingPoint(117,125),new n.TheDrawingPoint(119,122),new n.TheDrawingPoint(121,121),new n.TheDrawingPoint(123,120),new n.TheDrawingPoint(125,122),new n.TheDrawingPoint(125,125),new n.TheDrawingPoint(127,130),new n.TheDrawingPoint(128,133),new n.TheDrawingPoint(131,143),new n.TheDrawingPoint(136,153),new n.TheDrawingPoint(140,163),new n.TheDrawingPoint(144,172),new n.TheDrawingPoint(145,175),new n.TheDrawingPoint(151,189),new n.TheDrawingPoint(156,201),new n.TheDrawingPoint(161,213),new n.TheDrawingPoint(166,225),new n.TheDrawingPoint(169,233),new n.TheDrawingPoint(171,236),new n.TheDrawingPoint(174,243),new n.TheDrawingPoint(177,247),new n.TheDrawingPoint(178,249),new n.TheDrawingPoint(179,251),new n.TheDrawingPoint(180,253),new n.TheDrawingPoint(180,255),new n.TheDrawingPoint(179,257),new n.TheDrawingPoint(177,257),new n.TheDrawingPoint(174,255),new n.TheDrawingPoint(169,250),new n.TheDrawingPoint(164,247),new n.TheDrawingPoint(160,245),new n.TheDrawingPoint(149,238),new n.TheDrawingPoint(138,230),new n.TheDrawingPoint(127,221),new n.TheDrawingPoint(124,220),new n.TheDrawingPoint(112,212),new n.TheDrawingPoint(110,210),new n.TheDrawingPoint(96,201),new n.TheDrawingPoint(84,195),new n.TheDrawingPoint(74,190),new n.TheDrawingPoint(64,182),new n.TheDrawingPoint(55,175),new n.TheDrawingPoint(51,172),new n.TheDrawingPoint(49,170),new n.TheDrawingPoint(51,169),new n.TheDrawingPoint(56,169),new n.TheDrawingPoint(66,169),new n.TheDrawingPoint(78,168),new n.TheDrawingPoint(92,166),new n.TheDrawingPoint(107,164),new n.TheDrawingPoint(123,161),new n.TheDrawingPoint(140,162),new n.TheDrawingPoint(156,162),new n.TheDrawingPoint(171,160),new n.TheDrawingPoint(173,160),new n.TheDrawingPoint(186,160),new n.TheDrawingPoint(195,160),new n.TheDrawingPoint(198,161),new n.TheDrawingPoint(203,163),new n.TheDrawingPoint(208,163),new n.TheDrawingPoint(206,164),new n.TheDrawingPoint(200,167),new n.TheDrawingPoint(187,172),new n.TheDrawingPoint(174,179),new n.TheDrawingPoint(172,181),new n.TheDrawingPoint(153,192),new n.TheDrawingPoint(137,201),new n.TheDrawingPoint(123,211),new n.TheDrawingPoint(112,220),new n.TheDrawingPoint(99,229),new n.TheDrawingPoint(90,237),new n.TheDrawingPoint(80,244),new n.TheDrawingPoint(73,250),new n.TheDrawingPoint(69,254),new n.TheDrawingPoint(69,252)]),i.Unistrokes[15]=new t(i,"pigtail",[new n.TheDrawingPoint(81,219),new n.TheDrawingPoint(84,218),new n.TheDrawingPoint(86,220),new n.TheDrawingPoint(88,220),new n.TheDrawingPoint(90,220),new n.TheDrawingPoint(92,219),new n.TheDrawingPoint(95,220),new n.TheDrawingPoint(97,219),new n.TheDrawingPoint(99,220),new n.TheDrawingPoint(102,218),new n.TheDrawingPoint(105,217),new n.TheDrawingPoint(107,216),new n.TheDrawingPoint(110,216),new n.TheDrawingPoint(113,214),new n.TheDrawingPoint(116,212),new n.TheDrawingPoint(118,210),new n.TheDrawingPoint(121,208),new n.TheDrawingPoint(124,205),new n.TheDrawingPoint(126,202),new n.TheDrawingPoint(129,199),new n.TheDrawingPoint(132,196),new n.TheDrawingPoint(136,191),new n.TheDrawingPoint(139,187),new n.TheDrawingPoint(142,182),new n.TheDrawingPoint(144,179),new n.TheDrawingPoint(146,174),new n.TheDrawingPoint(148,170),new n.TheDrawingPoint(149,168),new n.TheDrawingPoint(151,162),new n.TheDrawingPoint(152,160),new n.TheDrawingPoint(152,157),new n.TheDrawingPoint(152,155),new n.TheDrawingPoint(152,151),new n.TheDrawingPoint(152,149),new n.TheDrawingPoint(152,146),new n.TheDrawingPoint(149,142),new n.TheDrawingPoint(148,139),new n.TheDrawingPoint(145,137),new n.TheDrawingPoint(141,135),new n.TheDrawingPoint(139,135),new n.TheDrawingPoint(134,136),new n.TheDrawingPoint(130,140),new n.TheDrawingPoint(128,142),new n.TheDrawingPoint(126,145),new n.TheDrawingPoint(122,150),new n.TheDrawingPoint(119,158),new n.TheDrawingPoint(117,163),new n.TheDrawingPoint(115,170),new n.TheDrawingPoint(114,175),new n.TheDrawingPoint(117,184),new n.TheDrawingPoint(120,190),new n.TheDrawingPoint(125,199),new n.TheDrawingPoint(129,203),new n.TheDrawingPoint(133,208),new n.TheDrawingPoint(138,213),new n.TheDrawingPoint(145,215),new n.TheDrawingPoint(155,218),new n.TheDrawingPoint(164,219),new n.TheDrawingPoint(166,219),new n.TheDrawingPoint(177,219),new n.TheDrawingPoint(182,218),new n.TheDrawingPoint(192,216),new n.TheDrawingPoint(196,213),new n.TheDrawingPoint(199,212),new n.TheDrawingPoint(201,211)]),i}return __extends(f,u),f.prototype.Recognize=function(n,t){var h=Date.now(),r=this.Resample(n,this.NumPoints),c=this.IndicativeAngle(r),u,e,s;r=this.RotateBy(r,-c);r=this.ScaleTo(r,this.SquareSize);r=this.TranslateTo(r,this.Origin);var l=this.Vectorize(r),f=+Infinity,o=-1;for(u=0;u<this.Unistrokes.length;u++)e=void 0,e=t?this.OptimalCosineDistance(this.Unistrokes[u].Vector,l):this.DistanceAtBestAngle(r,this.Unistrokes[u],-this.AngleRange,+this.AngleRange,this.AnglePrecision),e<f&&(f=e,o=u);return s=Date.now(),o===-1?new i("No match",0,s-h):new i(this.Unistrokes[o].Name,t?1/f:1-f/this.HalfDiagonal,s-h)},f.prototype.AddGesture=function(n,i){var u,r;for(this.Unistrokes[this.Unistrokes.length]=new t(this,n,i),u=0,r=0;r<this.Unistrokes.length;r++)this.Unistrokes[r].Name===n&&u++;return u},f.prototype.DeleteUserGestures=function(){return this.Unistrokes.length=this.NumUnistrokes,this.NumUnistrokes},f.prototype.Resample=function(t,i){for(var e,o=this.PathLength(t)/(i-1),f=0,u=new Array(t[0]),r=1;r<t.length;r++)if(e=this.Distance(t[r-1],t[r]),f+e>=o){var h=t[r-1].x+(o-f)/e*(t[r].x-t[r-1].x),c=t[r-1].y+(o-f)/e*(t[r].y-t[r-1].y),s=new n.TheDrawingPoint(h,c);u[u.length]=s;t.splice(r,0,s);f=0}else f+=e;return u.length===i-1&&(u[u.length]=new n.TheDrawingPoint(t[t.length-1].x,t[t.length-1].y)),u},f.prototype.IndicativeAngle=function(n){var t=this.Centroid(n);return Math.atan2(t.y-n[0].y,t.x-n[0].x)},f.prototype.RotateBy=function(t,i){for(var s,h,r=this.Centroid(t),e=Math.cos(i),o=Math.sin(i),f=[],u=0;u<t.length;u++)s=(t[u].x-r.x)*e-(t[u].y-r.y)*o+r.x,h=(t[u].x-r.x)*o+(t[u].y-r.y)*e+r.y,f[f.length]=new n.TheDrawingPoint(s,h);return f},f.prototype.ScaleTo=function(t,i){for(var e,o,f=this.BoundingBox(t),u=[],r=0;r<t.length;r++)e=t[r].x*(i/f.Width),o=t[r].x*(i/f.Height),u[u.length]=new n.TheDrawingPoint(e,o);return u},f.prototype.TranslateTo=function(t,i){for(var e,o,f=this.Centroid(t),u=[],r=0;r<t.length;r++)e=t[r].x+i.x-f.x,o=t[r].y+i.y-f.y,u[u.length]=new n.TheDrawingPoint(e,o);return u},f.prototype.Vectorize=function(n){for(var u,r=0,i=[],t=0;t<n.length;t++)i[i.length]=n[t].x,i[i.length]=n[t].y,r+=n[t].x*n[t].x+n[t].y*n[t].y;for(u=Math.sqrt(r),t=0;t<i.length;t++)i[t]/=u;return i},f.prototype.OptimalCosineDistance=function(n,t){for(var f,r=0,u=0,i=0;i<n.length;i+=2)r+=n[i]*t[i]+n[i+1]*t[i+1],u+=n[i]*t[i+1]-n[i+1]*t[i];return f=Math.atan(u/r),Math.acos(r*Math.cos(f)+u*Math.sin(f))},f.prototype.DistanceAtBestAngle=function(n,t,i,r,u){for(var f=this.Phi*i+(1-this.Phi)*r,o=this.DistanceAtAngle(n,t,f),e=(1-this.Phi)*i+this.Phi*r,s=this.DistanceAtAngle(n,t,e);Math.abs(r-i)>u;)o<s?(r=e,e=f,s=o,f=this.Phi*i+(1-this.Phi)*r,o=this.DistanceAtAngle(n,t,f)):(i=f,f=e,o=s,e=(1-this.Phi)*i+this.Phi*r,s=this.DistanceAtAngle(n,t,e));return Math.min(o,s)},f.prototype.DistanceAtAngle=function(n,t,i){var r=this.RotateBy(n,i);return this.PathDistance(r,t.Points)},f.prototype.Centroid=function(t){for(var r=0,u=0,i=0;i<t.length;i++)r+=t[i].x,u+=t[i].y;return r/=t.length,u/=t.length,new n.TheDrawingPoint(r,u)},f.prototype.BoundingBox=function(n){for(var i=+Infinity,f=-Infinity,u=+Infinity,e=-Infinity,t=0;t<n.length;t++)i=Math.min(i,n[t].x),u=Math.min(u,n[t].y),f=Math.max(f,n[t].x),e=Math.max(e,n[t].y);return new r(i,u,f-i,e-u)},f.prototype.PathDistance=function(n,t){for(var r=0,i=0;i<n.length;i++)r+=this.Distance(n[i],t[i]);return r/n.length},f.prototype.PathLength=function(n){for(var i=0,t=1;t<n.length;t++)i+=this.Distance(n[t-1],n[t]);return i},f.prototype.Distance=function(n,t){var i=t.x-n.x,r=t.y-n.y;return Math.sqrt(i*i+r*r)},f.prototype.Deg2Rad=function(n){return n*Math.PI/180},f.prototype.RecogizeShape=function(t,i,r){var f,e,u;r===void 0&&(r=!0);f=[];for(e in t.ComplexData)f.push(new n.TheDrawingPoint(t.ComplexData[e].PO.x,t.ComplexData[e].PO.y));return f.length<3?null:(u=this.Recognize(f,r),u)?u.Score>i?(cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","ShapeRecognizer","Name: "+u.Name+" Accu:"+u.Score.toFixed(2)+" Time:"+u.Time),u):null:null},f}(n.TheNMIBaseControl);n.TheShapeRecognizer=u}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.NeedRefresh=!1,i.myPicker=null,i.mFrameDiv=null,i.MyEditBox=null,i.mWidSub=20,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e,o,s;return this.MyBaseType=n.cdeControlType.ComboBox,t.prototype.InitControl.call(this,i,r,u,f),this.SetProperty("HasChoices",!1),this.mFrameDiv=document.createElement("div"),this.mFrameDiv.style.width="inherit",this.mFrameDiv.style.height="inherit",this.mFrameDiv.className="ctrlInput",this.SetElement(this.mFrameDiv),this.MyEditBox=document.createElement("input"),this.MyEditBox.style.cssFloat="left",this.MyEditBox.id="DTP"+cde.GuidToString(this.MyFieldInfo.cdeMID),cde.CBool(this.GetProperty("EnableAutoFill"))||cde.CBool(this.GetProperty("InTemplate"))||(this.MyEditBox.name="EB"+cde.GuidToString(this.MyFieldInfo.cdeMID)+"_"+Math.floor(Math.random()*1e3+1),this.MyEditBox.autocomplete="new-password"),cde.CBool(this.GetSetting("NoTE"))?(e=document.createElement("label"),e.htmlFor="cdeIMP"+cde.GuidToString(this.MyFieldInfo.cdeMID),e.className="cdeTesInput",e.appendChild(this.MyEditBox),o=document.createElement("span"),o.className="label",o.innerHTML=this.GetSetting("Title"),e.appendChild(o),s=document.createElement("span"),s.className="focus-bg",e.appendChild(s),this.mWidSub=25,this.mFrameDiv.appendChild(e)):(this.mFrameDiv.appendChild(this.MyEditBox),this.MyEditBox.className="cdeInput"),this.MyEditBox.className="cdeInput flatpickr flatpickr-input",cde.CInt(this.GetSetting("TileFactorY"))>1&&!this.MyEditBox.classList.contains("cdeSmall")&&this.MyEditBox.classList.add("cdeSmall"),this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)==0&&this.SetProperty("Disabled",!0),!0},i.prototype.ShowComboPicker=function(){this.myPicker&&this.myPicker.show()},i.prototype.ApplySkin=function(){var i=this,t={mode:"single",enableTime:!0,noCalendar:!1,time_24hr:!0,showMonths:1,dateFormat:"Y-m-d H:i",onChange:function(n,t){t&&t!==""&&i.GetProperty("Value")!==t&&(i.IsDirty=!0,i.SetProperty("Value",t))},plugins:[]};if(this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0)switch(this.MyFieldInfo.Type){case n.cdeControlType.Month:t.plugins=[new monthSelectPlugin({shorthand:!0,dateFormat:"F",altFormat:"F Y",theme:"dark"})];break;case n.cdeControlType.TimeSpan:t.mode="range";break;case n.cdeControlType.Time:t.noCalendar=!0;t.dateFormat="H:i";break;case n.cdeControlType.DateTime:cde.CBool(this.GetProperty("DateOnly"))||(t.enableTime=!1)}this.myPicker=flatpickr(this.MyEditBox,t)},i.prototype.SetProperty=function(n,i){(n==="Value"||n==="iValue")&&i!==null?(this.MyEditBox&&(this.MyEditBox.value=this.ShowFieldContent(i)),this.IsDirty=!0):n==="Disabled"&&this.MyEditBox?(this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0||(i=!0),this.MyEditBox.disabled=cde.CBool(i)):n==="Background"&&this.MyEditBox&&i?this.MyEditBox.style.background=i:n==="MainBackground"&&this.MyEditBox&&i?this.MyEditBox.parentElement.style.background=i:n==="Foreground"&&this.MyEditBox&&i?this.MyEditBox.style.color=i:n==="InnerClassName"&&this.MyEditBox&&i?this.MyEditBox.className=i:n==="InnerStyle"&&this.MyEditBox&&i?this.MyEditBox.style.cssText=i:n==="Z-Index"&&this.MyEditBox&&(this.MyEditBox.style.zIndex=i.toString());t.prototype.SetProperty.call(this,n,i)},i}(n.TheNMIBaseControl);n.ctrlDateTimePicker=t}(cdeNMI||(cdeNMI={}));cdeSortAlphabet="*!@_.()#^&%-=+01234567989abcdefghijklmnopqrstuvwxyz",function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.MyComboBox=null,i.MyComboDiv=null,i.HasGroups=!1,i.MyTableName=null,i.MyLookup=null,i.HideInput=!1,i.NeedRefresh=!1,i.WasInputCreated=!1,i.HasLoaded=!1,i.DoShow=!1,i.DontFire=!1,i.MySep=";",i.ControlText="ctrlComboBox",i.RefreshCombo='[{"V":"CDE_NOP","N":"loading...please wait"}]',i.myChoices=null,i.myChoicesOptions={delimiter:i.MySep,editItems:!1,maxItemCount:1,removeItemButton:!1,searchEnabled:!1,shouldSort:!0,searchResultLimit:100,shouldSortItems:!0,duplicateItemsAllowed:!1,position:"bottom",fuseOptions:{ignoreLocation:!0,threshold:.1,location:0,distance:1e3},sorter:function(n,t){var i=cdeSortAlphabet.indexOf(n[0]),r=cdeSortAlphabet.indexOf(t[0]);return i===r?n<t?-1:n>t?1:0:i-r}},i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this;return this.MyBaseType===n.cdeControlType.BaseControl&&(this.MyBaseType=n.cdeControlType.ComboBox),t.prototype.InitControl.call(this,i,r,u,f),this.SetProperty("HasChoices",!1),this.MyFieldInfo&&this.MyFieldInfo.DefaultValue&&!this.MyFieldInfo.Value&&(this.MyFieldInfo.Value=this.MyFieldInfo.DefaultValue),this.MyFieldInfo&&this.MyFieldInfo.HideInput&&(this.HideInput=!0),this.MyFieldInfo&&t.prototype.SetProperty.call(this,"UXID",this.MyFieldInfo.cdeMID),this.CalculateOption(null),this.RegisterEvent("OnDelete",function(){n.MyEngine.UnregisterLazyLoader(e.MyScreenID,e.MyTableName,e.HandleLazyLoad)}),!0},i.prototype.AddChoice=function(n){if(!n)return!1;var t;if(this.MyCurrentData.length>0&&(t=this.MyCurrentData.filter(function(t){return t.value===n.value})),t&&t.length!==0)t.forEach(function(t){t.label===t.value&&t.label!==n.label&&(t.label=n.label)});else return this.MyCurrentData.push(n),!0;return!1},i.prototype.SetProperty=function(i,r){var f,e,o,u;if((i==="Value"||i==="iValue")&&r!==null){if(this.myChoices){f=r.split(this.MySep);this.DontFire=!0;try{for(e=0;e<f.length;e++)o=new n.TheComboOption,o.value=f[e],o.label=f[e],this.AddChoice(o);this.MyCurrentData.length>0&&(this.myChoices.setChoices(this.MyCurrentData,"value","label",!0),this.myChoices.removeActiveItems(),this.myChoices.setChoiceByValue(f))}catch(s){}this.DontFire=!1}this.IsDirty=!0}else{if((i==="SetChoice"||i==="SetChoiceV")&&r){this.AddChoice(r);this.DontFire=!0;this.myChoices.setChoices(this.MyCurrentData,"value","label",!0);this.myChoices.setChoiceByValue(r.value);this.DontFire=!1;i==="SetChoiceV"&&t.prototype.SetProperty.call(this,"Value",r.value);return}if(i==="LiveOptions"&&r){t.prototype.SetProperty.call(this,i,r);this.ShowComboPicker();return}if(i==="ScreenFriendlyName"&&r){u=this.GetProperty("LiveOptions");u?u+=this.MySep+r:u=r;this.SetProperty("LiveOptions",u);this.MyComboBox.value=u.split(":")[0];return}i==="Background"&&this.MyComboBox&&r?this.MyComboBox.style.background=r:i==="MainBackground"&&this.MyComboDiv&&r?this.MyComboDiv.parentElement.style.background=r:i==="Foreground"&&this.MyComboBox&&r?this.MyComboBox.style.color=r:i==="InnerClassName"&&this.MyComboBox&&r?this.MyComboBox.className=r:i==="InnerStyle"&&this.MyComboBox&&r?this.MyComboBox.style.cssText=r:i==="Options"&&this.MyComboDiv?(this.MyFieldInfo.OptionsLive=r,this.myChoices?this.CreateComboOptions(r,null,!1):this.CalculateOption(r)):i==="Z-Index"&&this.MyComboBox?this.MyComboBox.style.zIndex=r.toString():i==="Separator"&&(this.MySep=r)}t.prototype.SetProperty.call(this,i,r)},i.prototype.HandleLazyLoad=function(n,t){var i=t.ComboControl;n&&(i.HasLoaded=!0);i.CreateComboFromLookup(n,t);n&&i.myChoices||(i.SetProperty("HasChoices",!0),i.NeedRefresh=!0,i.ApplySkiny())},i.prototype.CalculateOption=function(t){var r,u,o,i,f,e;if(!this.myChoices){if(this.MyFieldInfo&&(this.MyFieldInfo.OptionsLive&&(t=this.MyFieldInfo.OptionsLive),t||(t=this.MyFieldInfo.Options),t||(t="No Options Specified:CDE_NOP")),r=!1,this.MyFieldInfo){this.MyBaseType=this.MyFieldInfo.Type;switch(this.MyFieldInfo.Type){case n.cdeControlType.YesNo:t="Yes:Y;No:N";cde.CBool(this.GetProperty("IncludeNA"))&&(t+=";N/A:A");break;case n.cdeControlType.TrueFalse:t="True;False";break;case n.cdeControlType.Month:this.myChoicesOptions.searchEnabled=!0;t="January;Feburary;March;April;May;June;July;August;September;October;November;December";break;case n.cdeControlType.Country:this.myChoicesOptions.searchEnabled=!0;u=["United States","Germany","Afghanistan","Albania","Algeria","Andorra","Angola","Antarctica","Antigua and Barbuda","Argentina","Armenia","Australia","Austria","Azerbaijan","Bahamas","Bahrain","Bangladesh","Barbados","Belarus","Belgium","Belize","Benin","Bermuda","Bhutan","Bolivia","Bosnia and Herzegovina","Botswana","Brazil","Brunei","Bulgaria","Burkina Faso","Burma","Burundi","Cambodia","Cameroon","Canada","Cape Verde","Central African Republic","Chad","Chile","China","Colombia","Comoros","Congo, Democratic Republic","Congo, Republic of the","Costa Rica","Cote d'Ivoire","Croatia","Cuba","Cyprus","Czech Republic","Denmark","Djibouti","Dominica","Dominican Republic","East Timor","Ecuador","Egypt","El Salvador","Equatorial Guinea","Eritrea","Estonia","Ethiopia","Fiji","Finland","France","Gabon","Gambia","Georgia","Ghana","Greece","Greenland","Grenada","Guatemala","Guinea","Guinea-Bissau","Guyana","Haiti","Honduras","Hong Kong","Hungary","Iceland","India","Indonesia","Iran","Iraq","Ireland","Israel","Italy","Jamaica","Japan","Jordan","Kazakhstan","Kenya","Kiribati","Korea, North","Korea, South","Kuwait","Kyrgyzstan","Laos","Latvia","Lebanon","Lesotho","Liberia","Libya","Liechtenstein","Lithuania","Luxembourg","Macedonia","Madagascar","Malawi","Malaysia","Maldives","Mali","Malta","Marshall Islands","Mauritania","Mauritius","Mexico","Micronesia","Moldova","Mongolia","Morocco","Monaco","Mozambique","Namibia","Nauru","Nepal","Netherlands","New Zealand","Nicaragua","Niger","Nigeria","Norway","Oman","Pakistan","Panama","Papua New Guinea","Paraguay","Peru","Philippines","Poland","Portugal","Qatar","Romania","Russia","Rwanda","Samoa","San Marino"," Sao Tome","Saudi Arabia","Senegal","Serbia and Montenegro","Seychelles","Sierra Leone","Singapore","Slovakia","Slovenia","Solomon Islands","Somalia","South Africa","Spain","Sri Lanka","Sudan","Suriname","Swaziland","Sweden","Switzerland","Syria","Taiwan","Tajikistan","Tanzania","Thailand","Togo","Tonga","Trinidad and Tobago","Tunisia","Turkey","Turkmenistan","Uganda","Ukraine","United Arab Emirates","United Kingdom","Uruguay","Uzbekistan","Vanuatu","Venezuela","Vietnam","Yemen","Zambia","Zimbabwe"];t="";for(o in u)t.length>0&&(t+=";"),t+=u[o];break;default:this.myChoicesOptions.searchEnabled=!1;r=!0}}if(t){if(this.MyComboDiv||(this.MyComboDiv=document.createElement("div"),this.MyComboDiv.className="cdeComboBox",this.SetElement(this.MyComboDiv)),this.MyComboBox||(this.MyComboBox=document.createElement("select"),this.MyComboBox.id=cde.GuidToString(this.GetProperty("ID")),this.MyFieldInfo.Type===n.cdeControlType.ComboOption&&(this.MyComboBox.multiple=!0),this.MyComboDiv.appendChild(this.MyComboBox)),t.substr(0,6)==="LOOKUP"){if(i=t.split(":"),i.length>1)switch(i[1]){case"THINGPICKER":i="LOOKUP:b510837f-3b75-4cf2-a900-d36c19113a13:MyPropertyBag.FriendlyName.Value:cdeMID:MyPropertyBag.DeviceType.Value:FAFA22FF-96AC-42CF-B1DB-7C073053FC39".split(":");break;case"PROPERTYPICKER":this.SetProperty("UXID",this.MyFieldInfo.cdeMID);this.RegisterNMIControl();i=null;this.CreateComboOptions("Loading please wait...:CDE_NOP","CDE_NOP",!1)}if(i)if(i.length<3)this.CreateComboOptions("Lookup definition incomplete:CDE_NOP","CDE_NOP",!1);else if(f=this.MyScreenID,i.length>5&&(f=i[5]),this.MyScreenID=cde.GuidToString(f),this.MyTableName=cde.GuidToString(i[1]),e=null,i.length>4&&(e=i[4]),this.MyLookup||(this.MyLookup={ComboControl:this,Content:this.GetProperty("Value"),SrcFld:i[2],TgtID:i[3],GroupName:e}),n.MyEngine){n.MyEngine.LoadTableLazy(this.MyScreenID,this.MyTableName,this.HandleLazyLoad,this.MyLookup);return}}else this.CalPicker()||this.CreateComboOptions(t,this.GetProperty("Value"),r);this.SetProperty("HasChoices",!0);this.ApplySkiny()}}},i.prototype.ApplySkin=function(){this.ApplySkiny()},i.prototype.OnHideDropDown=function(){var n=this.GetElement().getElementsByClassName("choices__list choices__list--dropdown")[0];n&&window.innerWidth>1024&&(n.style.top=null,n.style.bottom=null,n.style.width=null)},i.prototype.OnShowDropDown=function(){var n=this.GetElement().getElementsByClassName("choices__list choices__list--dropdown is-active")[0];(n&&window.innerWidth>1024&&(window.innerHeight-(n.getBoundingClientRect().top-window.scrollY)<300?(n.style.bottom="0px",n.style.width="100%"):n.style.top=n.getBoundingClientRect().top-window.scrollY+"px"),this.myChoices.setChoices(this.MyCurrentData,"value","label",!0),this.NeedRefresh&&this.CalculateOption(null),this.HasGroups)||(cde.IsNotSet(this.GetProperty("Value"))?this.MyLookup!==null?this.myChoices.setChoiceByValue("CDE_LLL"):this.GetProperty("Options").substr("CDE_NOP")>0&&this.myChoices.setChoiceByValue("CDE_NOP"):this.myChoices.setChoiceByValue(this.GetProperty("Value")))},i.prototype.SetOptions=function(){this.MyFieldInfo.Type===n.cdeControlType.ComboOption&&(this.myChoicesOptions.editItems=!1,this.myChoicesOptions.removeItemButton=!0,this.myChoicesOptions.maxItemCount=1)},i.prototype.ApplySkiny=function(){var t=this;if(!this.myChoices||this.NeedRefresh!==!1)try{!this.myChoices&&Choices?(this.SetOptions(),cde.CBool(this.GetProperty("AllowMultiSelect"))&&(this.myChoicesOptions.maxItemCount=-1),this.GetProperty("Separator")&&(this.myChoicesOptions.delimiter=this.GetProperty("Separator"),this.MySep=this.myChoicesOptions.delimiter),this.myChoices=new Choices(this.MyComboBox,this.myChoicesOptions),this.myChoices.setChoices(this.MyCurrentData,"value","label",!0),this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0?(this.myChoices.passedElement.element.addEventListener("showDropdown",function(){t.OnShowDropDown()},!1),this.myChoices.passedElement.element.addEventListener("hideDropdown",function(){t.OnHideDropDown()},!1),this.MyFieldInfo.Type===n.cdeControlType.ComboOption&&cde.CBool(this.GetProperty("AllowNewEntry"))===!0&&this.myChoices.passedElement.element.addEventListener("search",function(i){var u=i.detail.value,r=new n.TheComboOption;r.label=u;r.value=u;t.myChoices.setChoices([r],"value","label",!0)},!1),this.myChoices.passedElement.element.addEventListener("removeItem",function(n){if(t.DontFire!==!0&&cde.CBool(t.GetProperty("AllowMultiSelect"))){var i=n.detail.value;t.ComboUpdateValue(i,!0)}},!1),this.myChoices.passedElement.element.addEventListener("choice",function(n){if(t.DontFire!==!0){var i=n.detail.choice.value;if(t.GetProperty("Value")!==i&&!t.ComboUpdateValue(i))return n.detail.choice.disabled=!0,n.preventDefault(),!1}},!1)):this.myChoices.disable()):(this.myChoices.clearChoices(),this.myChoices.setChoices(this.MyCurrentData,"value","label",!0));this.SetToDefault(!0)}catch(i){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY",this.ControlText+":ApplySkiny","Exception :"+i)}},i.prototype.SetTE=function(n){t.prototype.SetTE.call(this,n);this.MyTE&&cde.CBool(this.GetProperty("NoTE"))===!0&&(this.MyTE.DontHideLabel=!0,this.MyTE.MyTELabel.SetProperty("Visibility",!0),this.MyTE.MyTELabel.SetProperty("PixelHeight",18),this.MyTE.MyTELabel.SetProperty("LabelClassName","cdeTileEntryLabelSmall"))},i.prototype.CalPicker=function(){var i=this.GetProperty("OptionsLive"),r;return(i||(i=this.GetProperty("Options")),i&&i.startsWith("SCREENPICKER"))?(r=i.substr(13),n.MyScreenManager&&(r+=n.MyScreenManager.GetScreenList()),t.prototype.SetProperty.call(this,"OptionsLive",r),t.prototype.SetProperty.call(this,"LiveOptions",r),this.CreateComboOptions(r,this.GetProperty("Value"),!0),this.ApplySkiny(),!0):!1},i.prototype.CreateComboOptions=function(t,i,r){var f,u,e,l,s,o,h,a,c;if(t){if(this.MyCurrentData=[],this.HasGroups=!1,t.substr(0,1)==="[")for(e=JSON.parse(t),u=0;u<e.length;u++)f=new n.TheComboOption,f.value=e[u].V,l="",f.value.startsWith("CDE_")&&(l="===> "),(e[u].G||this.HasGroups)&&(e[u].G?(f.group=e[u].G,this.HasGroups=!0):f.group="No Group"),e[u].H?f.html=e[u].H:f.label=l+e[u].N.replace("_"," "),f.disabled=cde.CBool(e[u].D),this.MyCurrentData.push(f);else for(s=t.split(";:;"),s.length>1&&(this.HasGroups=!0,s.sort()),o=void 0,h=0;h<s.length;h++)for(a=s[h],this.HasGroups&&(o=s[h].split(this.MySep),o.length>1&&(a=o[1])),o=a.split(this.MySep),r&&o.sort(),u=0;u<o.length;u++)c=o[u].split(":"),f=new n.TheComboOption,f.value=c.length>1?c[1]:c[0],this.HasGroups&&(f.group=o[0]),f.label=c[0].replace("_"," "),this.MyCurrentData.push(f);this.HasGroups===!0&&this.BuildGroups()}},i.prototype.BuildGroups=function(){for(var r=1,t=[],u=function(i){var e=f.MyCurrentData[i],o=t.filter(function(n){return n.label===e.group}),u;o.length>0?o[0].choices.push(e):(u=new n.TheComboOption,u.id=r,r++,u.value=e.group,u.label=e.group,u.choices=[],u.choices.push(e),t.push(u))},f=this,i=0;i<this.MyCurrentData.length;i++)u(i);this.MyCurrentData=t},i.prototype.CreateComboFromLookup=function(t,i){var e=[],r=i.ComboControl,u,c,f,o,p,l,w,b,a,k,v;if(!t){i.GroupName?r.CreateComboOptions('[{"G":"Other Options...","V":"CDE_LLL","N":"Loading, please wait..."}]',"CDE_LLL",!1):r.CreateComboOptions('[{"V":"CDE_LLL","N":"Loading, please wait..."}]',"CDE_LLL",!1);this.myChoices||this.ComboUpdateValue("CDE_LLL");return}try{var d=this.GetProperty("GroupLookup"),h=this.GetProperty("Filter"),y=null,s=[];for(h&&h.split("=").length>1&&(y=h.split("=")[0],c=h.split("=")[1],c.substr(0,1)==="["?s=JSON.parse(c):s[0]=c),r.MyCurrentData=[],i.GroupName&&(r.HasGroups=!0),f=void 0,f=0;f<t.length;f++){if(o=t[f],o[y]&&s.length>0){for(p=!1,l=0;l<s.length;l++)if(o[y]===s[l]){p=!0;break}if(!p)continue}r.HasGroups?(w=n.GetFldContentByName(o,i.GroupName,!1),w&&w!==""&&e.push(o)):(b=n.GetFldContentByName(o,i.SrcFld,!1),b&&b!==""&&e.push(o))}for(e=r.HasGroups?n.SortArrayByProperty(e,i.GroupName,!1,!1):n.SortArrayByProperty(e,i.SrcFld,!1,!1),f=0;f<e.length;f++)u=new n.TheComboOption,r.HasGroups&&(a=n.GetFldContentByName(e[f],i.GroupName,!1),d&&(a=this.GetTextFromOptions(a,d)),u.group=a),k=n.GetFldContentByName(e[f],i.SrcFld,!1),v=k,i.TgtID&&(v=n.GetFldContentByName(e[f],i.TgtID,!1)),cde.IsNotSet(v)||(u.value=v),u.label=k,r.MyCurrentData.push(u)}catch(g){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY",this.ControlText+":CreateComboFromLookup:AssembleData",g)}if(cde.CBool(r.GetProperty("RefreshOnLoad"))!==!0&&(u=new n.TheComboOption,r.HasGroups&&(u.group="Other Options..."),u.value="CDE_LLL",u.label="--- Select to Load Lookup Table ---",r.MyCurrentData.push(u)),cde.CBool(r.GetProperty("AddEmptyEntry"))===!0&&(u=new n.TheComboOption,r.HasGroups&&(u.group="Other Options..."),u.value="CDE_NOP",u.label="- empty -",r.MyCurrentData.push(u)),(r.MyFieldInfo.Flags&2)==0&&(r.MyComboBox.disabled=!0),r.myChoices)try{r.myChoices.setChoices(r.MyCurrentData,"value","label",!0)}catch(g){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY",this.ControlText+":CreateComboFromLookup",g);r.NeedRefresh=!0;r.ApplySkiny()}},i.prototype.GetTextFromOptions=function(n,t){for(var i,u=t.split(this.MySep),r=0;r<u.length;r++)if(i=u[r].split(":"),i.length>1){if(n===i[1]||(!n||n==="")&&i[1]==="0")return i[0]}else if(n===i[0])return i[0];return n},i.prototype.ShowComboPicker=function(){if(this.MyFieldInfo&&this.MyFieldInfo.OptionsLive){var t=this.MyFieldInfo.OptionsLive,i=t.split(":");if(i.length>1)switch(i[1]){case"PROPERTYPICKER":t=this.GetProperty("LiveOptions");t?(this.CreateComboOptions(t,this.GetProperty("Value"),!0),this.NeedRefresh=!0,this.ApplySkiny()):i[2].length>0?n.MyEngine?(n.MyEngine.PublishToNMI("NMI_GET_DATA:PROPERTYPICKER:"+this.GetProperty("ID")+":"+this.GetProperty("UXID")+":"+i[2],"",this.MyFieldInfo?this.MyFieldInfo.cdeN:null),t="loading ... please wait"):t="No NMI Engine available - cannot load":t="You have to Select a Thing first"}}try{this.myChoices.showDropdown()}catch(r){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY",this.ControlText+":ShowComboPicker",r)}},i.prototype.ComboSelect=function(n){this.ComboUpdateValue(n.value)},i.prototype.ComboUpdateValue=function(t,i){var r,u;if(t==="CDE_PPP")this.SetProperty("LiveOptions",null),this.ShowComboPicker();else if(t==="CDE_LLL")this.NeedRefresh=!0,n.MyEngine&&n.MyEngine.PublishToNMI("NMI_GET_DATA:"+this.MyTableName+":CMyTable:"+this.MyTableName+":"+this.MyScreenID+":false:true","",this.MyFieldInfo?this.MyFieldInfo.cdeN:null);else if(cde.CBool(this.GetProperty("AllowMultiSelect"))?(r=this.myChoices.getValue(!0),i||r.push(t),t=r.join(this.MySep),t.length===0&&(t=null)):i===!0&&(t=null),u=this.GetProperty("Value"),u!==t)return this.SetProperty("Value",t),!0;return!1},i}(n.TheNMIBaseControl);n.ctrlComboBox=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType===n.cdeControlType.BaseControl&&(this.MyBaseType=n.cdeControlType.ComboLookup,this.ControlText="ctrlComboLookup"),t.prototype.InitControl.call(this,i,r,u,f),!0},i.prototype.CalculateOption=function(){if(!this.myChoices){if(this.MyComboDiv||(this.MyComboDiv=document.createElement("div"),this.MyComboDiv.className="cdeComboBox",this.SetElement(this.MyComboDiv)),this.MyComboBox||(this.MyComboBox=document.createElement("select"),this.MyComboBox.id=cde.GuidToString(this.GetProperty("ID")),this.MyFieldInfo.Type===n.cdeControlType.ComboOption&&(this.MyComboBox.multiple=!0),this.MyComboDiv.appendChild(this.MyComboBox)),this.GetSetting("GroupFld")&&(this.HasGroups=!0),this.MyTableName=cde.GuidToString(this.GetSetting("StorageTarget")),this.MyLookup||(this.MyLookup={ComboControl:this,Content:this.GetProperty("Value"),SrcFld:this.GetProperty("NameFld"),TgtID:this.GetSetting("ValueFld"),GroupName:this.GetSetting("GroupFld")}),n.MyEngine){var t=this.MyScreenID;this.GetSetting("ModelID")&&(t=this.GetSetting("ModelID"));this.MyScreenID=t;n.MyEngine.LoadTableLazy(t,this.MyTableName,this.HandleLazyLoad,this.MyLookup);return}this.SetProperty("HasChoices",!0);this.ApplySkiny()}},i.prototype.OnShowDropDown=function(){try{this.HasLoaded&&cde.CBool(this.GetProperty("RefreshOnLoad"))!==!0||this.ComboUpdateValue("CDE_LLL")}catch(n){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY",this.ControlText+":onBeforeShow","Exception :"+n)}},i.prototype.SetOptions=function(){this.myChoicesOptions.editItems=!0;this.myChoicesOptions.searchEnabled=!0;this.myChoicesOptions.removeItemButton=!0;this.myChoicesOptions.maxItemCount=1;this.myChoicesOptions.searchResultLimit=100},i}(n.ctrlComboBox);n.ctrlComboLookup=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType===n.cdeControlType.BaseControl&&(this.ControlText="ctrlPropertyPicker",this.RefreshCombo='[{"V":"CDE_NOP","N":"loading...please wait"}]',this.MyBaseType=n.cdeControlType.PropertyPicker),t.prototype.InitControl.call(this,i,r,u,f),!0},i.prototype.SetProperty=function(n,i){if(n==="LiveOptions"&&i){t.prototype.SetProperty.call(this,n,i);this.LoadComboContent(this.DoShow);return}t.prototype.SetProperty.call(this,n,i)},i.prototype.CalculateOption=function(){this.myChoices||(this.MyComboDiv||(this.MyComboDiv=document.createElement("div"),this.MyComboDiv.className="cdeComboBox",this.SetElement(this.MyComboDiv)),this.MyComboBox||(this.MyComboBox=document.createElement("select"),this.MyComboBox.id=cde.GuidToString(this.GetProperty("ID")),cde.CBool(this.GetProperty("AllowMultiSelect"))&&(this.MyComboBox.multiple=!0),this.MyComboDiv.appendChild(this.MyComboBox)),this.RegisterNMIControl(),this.CreateComboOptions(this.RefreshCombo,"CDE_NOP",!1),this.SetProperty("HasChoices",!0),this.ApplySkiny())},i.prototype.OnShowDropDown=function(){try{this.GetProperty("LiveOptions")&&this.GetProperty("LiveOptions").substr(0,15)!=='[{"V":"CDE_NOP"'||this.LoadComboContent(!1)}catch(n){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY",this.ControlText+":onBeforeShow","Exception :"+n)}},i.prototype.LoadComboContent=function(t){var r=this.GetProperty("LiveOptions"),i;r?(this.CreateComboOptions(r,this.GetProperty("Value"),!0),this.UpdatePicker(t)):(i=this.GetThingID(),(i===null||i===void 0?void 0:i.length)>0?n.MyEngine?(n.MyEngine.PublishToNMI("NMI_GET_DATA:PROPERTYPICKER:"+this.GetProperty("ID")+":"+this.GetProperty("UXID")+":"+i,"",this.MyFieldInfo?this.MyFieldInfo.cdeN:null),t&&this.UpdatePicker(t)):(this.DoShow=t,this.SetProperty("LiveOptions",'[{"V":"CDE_NOP","N":"No NMI Engine available - cannot load"}]')):(this.DoShow=t,this.SetProperty("LiveOptions",'[{"V":"CDE_NOP","N":"You have to Select a Thing first"}]')));this.DoShow=!1},i.prototype.UpdatePicker=function(n){this.NeedRefresh=!0;this.ApplySkiny();n&&this.ShowComboPicker()},i.prototype.ComboUpdateValue=function(n,i){if(n==="CDE_PPP")this.SetProperty("LiveOptions",null),this.LoadComboContent(!1);else return t.prototype.ComboUpdateValue.call(this,n,i);return!1},i.prototype.GetThingID=function(){var t=this.GetProperty("ThingFld"),n;return t===0?null:(this.MyTE&&this.MyTE.MyDataView?n=this.MyTE.MyDataView.GetControlByFldNo(this.MyTRF.RowNo,t):this.MyDataView&&(n=this.MyDataView.GetControlByFldNo(this.MyTRF.RowNo,t)),!n)?null:n.GetProperty("Value")},i}(n.ctrlComboLookup);n.ctrlPropertyPicker=t}(cdeNMI||(cdeNMI={})),function(n){var i=function(t){function i(n){var i=t.call(this,n)||this;return i.MyThingFriendlyName=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.RefreshCombo='[{"V":"CDE_NOP","N":"loading...please wait"}]',this.MyBaseType=n.cdeControlType.DeviceTypePicker,this.ControlText="ctrlDeviceTypePicker",t.prototype.InitControl.call(this,i,r,u,f),!0},i.prototype.LoadComboContent=function(t){var r=this.GetProperty("LiveOptions"),i,u;r?(this.CreateComboOptions(r,this.GetProperty("Value"),!0),this.UpdatePicker(t)):n.MyEngine?(i="",this.GetProperty("Filter")&&(i=n.GenerateFinalString(this.GetProperty("Filter"),null,this.MyTRF)),u=cde.CBool(this.GetProperty("IncludeRemotes")),n.MyEngine.PublishToNMI("NMI_GET_DATA:DEVICETYPEPICKER:"+this.GetProperty("ID")+":"+this.GetProperty("UXID")+";76;"+this.MyFieldInfo.FldOrder+":"+u+":"+i,"",this.MyFieldInfo?this.MyFieldInfo.cdeN:null)):(this.CreateComboOptions('[{"V":"CDE_NOP","N":"No DeviceType available - nothing to show"}]',"CDE_NOP",!1),this.UpdatePicker(t))},i}(n.ctrlPropertyPicker),t;n.ctrlDeviceTypePicker=i;t=function(t){function i(n){var i=t.call(this,n)||this;return i.MyThingFriendlyName=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.RefreshCombo='[{"G":"Other Options...","V":"CDE_PPP","N":"Please select..."}]',this.MyBaseType=n.cdeControlType.ThingPicker,this.ControlText="ctrlThingPicker",t.prototype.InitControl.call(this,i,r,u,f),!0},i.prototype.SetProperty=function(i,r){var u;(i==="Value"||i==="iValue")&&(this.GetProperty("Value")!==r&&(this.MyThingFriendlyName=null),this.GetNameFromValue(r),this.MyThingFriendlyName&&(u=new n.TheComboOption,u.value=r,u.label=this.MyThingFriendlyName,r=u,i="SetChoiceV"));i==="ThingFriendlyName"&&r&&(this.MyThingFriendlyName=r,u=new n.TheComboOption,u.value=this.GetProperty("Value"),u.label=this.GetNameFromValue(r),r=u,i="SetChoice");t.prototype.SetProperty.call(this,i,r)},i.prototype.GetNameFromValue=function(t){return!t||t.length===0?t:this.MyThingFriendlyName?this.MyThingFriendlyName:(n.MyEngine&&n.MyEngine.PublishToNMI("NMI_GET_DATA:THINGRESOLVE:"+this.GetProperty("ID")+":"+this.GetProperty("UXID")+";63;"+this.MyFieldInfo.FldOrder+":"+t,"",this.MyFieldInfo?this.MyFieldInfo.cdeN:null),t)},i.prototype.SetThingFriendlyName=function(n){var i,t;if(this.GetProperty("LiveOptions"))try{for(i=JSON.parse(this.GetProperty("LiveOptions")),t=0;t<i.length;t++)if(i[t].V===n){this.SetProperty("ThingFriendlyName",i[t].N);return}}catch(r){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","ctrlThingPicker:GetFriendlyName",r)}},i.prototype.LoadComboContent=function(t){var i=this.GetProperty("LiveOptions");if(i)this.CreateComboOptions(i,this.GetProperty("Value"),!0),this.UpdatePicker(t);else if(n.MyEngine){var u=cde.CBool(this.GetProperty("IncludeEngines")),f=cde.CBool(this.GetProperty("IncludeRemotes")),r="";this.GetProperty("Filter")&&(r=n.GenerateFinalString(this.GetProperty("Filter"),null,this.MyTRF));n.MyEngine.PublishToNMI("NMI_GET_DATA:THINGPICKER:"+this.GetProperty("ID")+":"+this.GetProperty("UXID")+";63;"+this.MyFieldInfo.FldOrder+":"+u+":"+f+":"+r,"",this.MyFieldInfo?this.MyFieldInfo.cdeN:null)}else this.CreateComboOptions('[{"G":"Other Options...","V":"CDE_NOP","N":"No NMI Engine available - cannot load"}]',"CDE_NOP",!1),this.UpdatePicker(t)},i.prototype.ComboUpdateValue=function(n,i){if(n==="CDE_PPP")this.SetProperty("LiveOptions",null),this.LoadComboContent(!1);else if(!i)return this.SetThingFriendlyName(n),t.prototype.ComboUpdateValue.call(this,n,i);return!1},i}(n.ctrlPropertyPicker);n.ctrlThingPicker=t}(cdeNMI||(cdeNMI={})),function(n){var v=function(t){function i(n){var i=t.call(this,null,n)||this;return i.divPin=null,i.rootDiv=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this;return this.MyBaseType=n.cdeControlType.PinButton,t.prototype.InitControl.call(this,i,r,u,f),this.rootDiv=document.createElement("div"),this.rootDiv.style.position="relative",this.PreventDefault=!0,this.SetElement(this.rootDiv,!0),this.divPin=document.createElement("div"),this.rootDiv.appendChild(this.divPin),this.RegisterEvent("PointerUp",function(n,t,i){e.SetProperty("Value",!e.GetProperty("Value"));e.GetProperty("OnClick")&&e.GetProperty("OnClick")(e.GetProperty("Value"),t,i)}),!0},i.prototype.SetProperty=function(n,i){if(n==="ClassName"&&this.divPin){this.divPin.className=i;return}if(n==="Top"&&this.divPin){i=cde.CInt(i);this.divPin.style.top=i+"px";return}if(n==="Foreground"&&this.divPin){this.divPin.style.color=i;return}if(n==="Right"&&this.divPin){i=cde.CInt(i);this.divPin.style.right=i+"px";return}if(n==="OnPointerDown"&&this.divPin)i&&(this.PreventManipulation=!0,this.HookEvents(!1),this.RegisterEvent("PointerDown",i));else if(n==="Content"){this.divPin.innerHTML=i;return}t.prototype.SetProperty.call(this,n,i)},i}(n.TheNMIBaseControl),i,r,u,f,e,o,s,t,h,c,l,a;n.ctrlPinButton=v;i=function(t){function i(n){var i=t.call(this,null,n)||this;return i.divTiles=null,i.CurrentControl=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType=n.cdeControlType.TouchOverlay,t.prototype.InitControl.call(this,i,r,u,f),this.CurrentControl=i,this.divTiles=document.createElement("div"),this.divTiles.className="cdeOverlay",this.SetElement(this.divTiles,!1),this.HookEvents(!1),!0},i}(n.TheNMIBaseControl);n.ctrlTouchOverlay=i;r=function(t){function i(){var n=t.call(this,null,null)||this;return n.mCtrlDIV=null,n}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return t.prototype.InitControl.call(this,i,r,u,f),cde.CBool(this.GetSetting("IsPlainHTML"))===!0&&i?this.SetElement(i.GetContainerElement()):(this.mCtrlDIV=new n.ctrlTileGroup,this.mCtrlDIV.InitControl(i),this.mCtrlDIV.MyRootElement.style.width="inherit",this.mCtrlDIV.MyRootElement.style.height="inherit",this.SetElement(this.mCtrlDIV.GetElement())),!0},i.prototype.SetProperty=function(i,r){var u=this;(t.prototype.SetProperty.call(this,i,r),this.GetContainerElement())&&(i==="HTML"?n.cdeParseHTML(this,this.MyTRF,r):i==="HTMLUrl"?n.MyEngine.cdeGetResource(r,function(t,i){i&&!i.startsWith("ERR:")&&(n.cdeParseHTML(u,u.MyTRF,i),u.FireEvent(!0,"OnIsLoaded",!0))}):i==="Background"&&(this.mCtrlDIV.GetElement().style.background=r))},i}(n.TheNMIBaseControl);n.ctrlFacePlate=r;u=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mFileList=[],i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,o;return this.MyBaseType=n.cdeControlType.DropUploader,t.prototype.InitControl.call(this,i,r,u,f),this.mContentTarget=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(i,{TRF:this.MyTRF}),this.mContentTarget.SetProperty("ClassName","ctrlDropUploader"),this.mContentTarget.SetInitialSize(0),this.mZoomImg=n.MyTCF.CreateNMIControl(n.cdeControlType.Picture).Create(this.mContentTarget),this.mZoomImg.SetProperty("Visibility",!1),this.mZoomImg.SetProperty("Style","width:100%;height:100%"),this.mInfo=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.mContentTarget,{PreInitBag:["Element=p"]}),o=this.mContentTarget.GetElement(),o.ondragover=function(){return e.mContentTarget.GetElement().className="ctrlDropUploaderHover",!1},o.ondragend=function(){return e.mContentTarget.GetElement().className="ctrlDropUploader",!1},o.ondragleave=function(){return e.mContentTarget.GetElement().className="ctrlDropUploader",!1},o.ondrop=function(n){n.stopPropagation();n.preventDefault();e.mContentTarget.GetElement().className="ctrlDropUploader";e.ProcessFiles(n.dataTransfer.files)},this.SetElement(this.mContentTarget.GetElement()),!0},i.prototype.SetProperty=function(n,i){n==="iValue"||n==="Value"?this.mZoomImg&&(i.toLowerCase().indexOf(".jpg")>0||i.toLowerCase().indexOf(".jpeg")>0||i.toLowerCase().indexOf(".png")>0)?(this.mZoomImg.SetProperty("Visibility",!0),this.mZoomImg.SetProperty("Source",i),this.mInfo.SetProperty("Visibility",!1)):(this.mInfo.SetProperty("Visibility",!0),this.mInfo.GetElement().innerHTML=i):n==="Title"?this.mInfo.SetProperty("iValue",i):n==="Foreground"&&this.mContentTarget?this.mContentTarget.SetProperty("Foreground",i):n==="Background"&&this.mContentTarget?this.mContentTarget.SetProperty("Background",i):t.prototype.SetProperty.call(this,n,i)},i.prototype.UploadNext=function(){if(this.mFileList.length){var n=this.mFileList.shift(),t=this.GetProperty("MaxFileSize");t||(t=512e3);t>5e8&&(t=5e8);n.size>=t?(this.mInfo.GetElement().innerHTML+="File "+n.name+" size "+n.size+" too big - Max: "+t,this.OnComplete(n.size)):(this.mInfo.GetElement().innerHTML="Reading: "+n.name,this.UploadFile(n,status))}else this.mContentTarget.GetElement().className="ctrlDropUploader"},i.prototype.OnComplete=function(){this.UploadNext()},i.prototype.UploadFile=function(n){var t=this,i=new FileReader;this.mInfo.GetElement().innerHTML="Uploading: "+n.name;i.onload=function(r){var f=i.result,e,u,o;t.MyEngineName&&(e=n.name,u=t.GetProperty("TargetDir"),u&&(u.substr(u.length-1,1)!=="\\"&&(u+="\\"),e=u+e),t.MyFieldInfo&&(o="CDE_FILEPUSH:"+e+":"+t.MyFieldInfo.cdeO,t.GetProperty("Cookie")&&(o+=":"+t.GetProperty("Cookie")),cde.CBool(t.GetProperty("AllowGlobalPush"))&&cde.MyBaseAssets.MyEngines[t.MyEngineName]?cdeCommCore.PublishCentral(t.MyEngineName,o,f):cdeCommCore.PublishToNode(t.MyFieldInfo.cdeN,t.MyEngineName,o,f)));t.FireEvent(!1,"OnFilePushed",r.target);t.mZoomImg&&f.indexOf("image")>0?(t.mZoomImg.SetProperty("Visibility",!0),t.mZoomImg.SetProperty("Source",f),t.mInfo.SetProperty("Visibility",!1)):(t.mInfo.SetProperty("Visibility",!0),t.mInfo.GetElement().innerHTML=n.name+" - Done")};i.readAsDataURL(n)},i.prototype.ProcessFiles=function(n){if(n&&n.length&&!this.mFileList.length){for(var t=0;t<n.length;t++)this.mFileList.push(n[t]);this.UploadNext()}},i.Create=function(n,t,r,u){var f=new i(r);return f.MyEngineName=t,f.InitControl(n,r),u&&f.SetProperty("Title",u),f},i}(n.TheNMIBaseControl);n.ctrlDropUploader=u;f=function(t){function i(n){var i=t.call(this,null,n)||this;return i.Img=null,i.imgNumber=0,i.MyZoom=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this;return this.MyBaseType=n.cdeControlType.Picture,t.prototype.InitControl.call(this,i,r,u,f),this.HostDiv=document.createElement("div"),this.Img=document.createElement("img"),this.Img.className="Blocked",this.Img.style.width="inherit",this.Img.style.height="inherit",this.Img.addEventListener("error",function(n){e.OnImgError(n)}),this.HostDiv.appendChild(this.Img),cde.CBool(this.GetSetting("EnableZoom"))===!0&&(this.MyZoom=new Zoom(this.Img,{rotate:cde.CBool(this.GetSetting("AllowRotate"))},null)),t.prototype.SetProperty.call(this,"ZoomLevel",1),this.SetElement(this.HostDiv,!0),this.RegisterEvent("Resize",function(n,t){if(t<=cde.CInt(e.GetProperty("MaxTileWidth"))&&t>=cde.CInt(e.GetProperty("MinTileWidth"))){e.MyTE.SetProperty("TileWidth",t);switch(t){case 6:e.MyTE.SetProperty("TileHeight",5);break;default:e.MyTE.SetProperty("TileHeight",t/4*3)}}}),!0},i.prototype.SetProperty=function(i,r){var u=0,s,e,h,o,f;if(i==="Name")this.Img&&(this.Img.alt=r);else if((i==="Source"||i==="Value"||i==="iValue")&&this.Img){try{r&&r.startsWith("FA")?r="<i class='fa faIcon "+(r.substr(3,1)==="S"?"fa-spin ":"")+"fa-"+r.substr(2,1)+"x'>&#x"+r.substr(4,r.length-4)+";<\/i>":r&&(r.substring(0,5)==="data:"||cde.CBool(t.prototype.GetProperty.call(this,"IsBlob"))||r.length>512)?(s=t.prototype.GetProperty.call(this,"ImgFormat"),s||(s="jpeg"),r.substr(0,5)!=="data:"&&(r="data:image/"+s+";base64,"+r),this.HostDiv.className||(this.HostDiv.className="cdeLiveImg"),this.Img.src=r):r&&(e=cde.CStr(r).split(";"),h=r,e.length>1&&(this.SetProperty("ImageOpacity",e[1]),h=e.length>2?e[0]:cde.FixupPath(e[0])),o=cde.MyBaseAssets.MyCommStatus.InitialNPA,this.Img.src=cde.FixupPath(h+(o?"?SID="+o.substr(4,o.length-(4+(o.indexOf(".ashx")>0?5:0))):"")))}catch(c){n.ShowToastMessage(r+":IMG SETP ERROR:"+c)}if(i==="Source"||!r)return}else i==="ZoomLevel"?this.OnClickFunction(this,null,null):i==="ControlTW"?(u=n.GetSizeFromTile(cde.CInt(r)),u>0&&(f=cde.CInt(this.GetProperty("TileFactorX")),f>1&&(u/=f),this.Img.width=u,this.Img.style.width=u+"px")):i==="ControlTH"?(u=n.GetSizeFromTile(cde.CInt(r)),u>0&&(f=cde.CInt(this.GetProperty("TileFactorY")),f>1&&(u/=f),this.Img.height=u,this.Img.style.height=u+"px")):i==="Width"?(u=cde.CDbl(r),u>0&&(f=cde.CInt(this.GetProperty("TileFactorX")),f>1&&(u/=f),this.Img.width=u)):i==="Height"?(u=cde.CDbl(r),u>0&&(f=cde.CInt(this.GetProperty("TileFactorY")),f>1&&(u/=f),this.Img.height=u)):i==="ImageOpacity"&&this.Img?this.Img.style.opacity=r:i==="StartSequence"?this.RequestRedraw():i==="Background"?this.HostDiv.style.backgroundColor=r:i==="EnableZoom"?(this.EnabledZoom(),this.HookEvents(!1)):i==="ClassName"?this.Img.className=r:i==="OnClick"?(this.HookEvents(!1),this.RegisterEvent("OnClick",r),this.RegisterEvent("PointerUp",this.DoFireClick),this.Img.style.cursor="pointer"):i==="AutoAdjust"&&this.MyTarget&&(this.Img.width=this.MyTarget.GetElement().clientWidth,this.Img.height=this.MyTarget.GetElement().clientHeight);t.prototype.SetProperty.call(this,i,r)},i.prototype.OnImgError=function(){if(n.MyEngine){var t=this.Img.src,i=n.GetLocation(t).pathname;n.MyEngine.cdeGetImage(i,function(n,t){var i,r,u;try{i=JSON.parse(t);r=i.ImageSource.indexOf(".");u=i.ImageSource.substr(r+1);n.SetProperty("Source","data:image/"+u+";base64,"+i.Bits)}catch(f){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","SetProperty:OnImgError","Image settting for  Inlining ("+i.ImageSource+") failed with "+f)}},this)}},i.prototype.EnabledZoom=function(){var n=this;this.HostDiv.style.width="";this.HostDiv.style.height="";this.Img.style.cursor="pointer";this.RegisterEvent("PointerUp",function(t,i,r){n.OnClickFunction(t,i,r)})},i.prototype.OnClickFunction=function(i,r,u){var e,f,o,s,h,l,a,c;if(this.Img&&(!u||!(u.PathLength()>n.MyNMISettings.DeadPathLength))){if(!this.Img||cde.CBool(this.GetProperty("Disabled"))||this.MyTRF&&this.MyTRF.FldInfo&&(this.MyTRF.FldInfo.Flags&2)==0){cde.CBool(this.GetProperty("EnableZoom"))===!0&&this.MyZoom&&(this.MyZoom.destroy(),this.MyZoom=new Zoom(this.Img,{rotate:cde.CBool(this.GetSetting("AllowRotate"))},null));return}r&&(r.cancelBubble=!0,r.stopPropagation());e=cde.CDbl(this.GetProperty("FullHeight"));e===0&&(e=this.Img.naturalHeight);e===0&&(e=n.GetSizeFromTile(1));f=cde.CDbl(this.GetProperty("FullWidth"));f===0&&(f=this.Img.naturalWidth);f===0&&(f=n.GetSizeFromTile(1));o=cde.CDbl(this.GetProperty("ControlTW"));o===0&&(o=1);s=cde.CDbl(this.GetProperty("ControlTH"));s===0&&(s=1);switch(t.prototype.GetProperty.call(this,"ZoomLevel")){case 1:if(this.Img.src.substr(0,5)!=="data:"&&this.Img.src.indexOf("_s.")>0&&(h=this.Img.src.substr(0,this.Img.src.indexOf("_s.")),h+=this.Img.src.substr(this.Img.src.lastIndexOf(".")),this.Img.src=h,f=this.Img.naturalWidth),l=n.GetSizeFromTile(3),l>f){this.ShowNaturalSize(o,s,f/e);break}t.prototype.SetProperty.call(this,"ZoomLevel",2);break;case 2:if(a=n.GetSizeFromTile(6),a>f){this.ShowNaturalSize(o,s,f/e);break}t.prototype.SetProperty.call(this,"ZoomLevel",3);break;case 3:c=n.GetSizeFromTile(12);c>f&&(c=f);t.prototype.SetProperty.call(this,"ZoomLevel",0);break;default:this.ShowNaturalSize(o,s,f/e)}}},i.prototype.ShowNaturalSize=function(){t.prototype.SetProperty.call(this,"ZoomLevel",1)},i.prototype.RedrawImage=function(){this.imgNumber>this.GetProperty("LastSeqNo")?this.GetProperty("DoLoop")===!0&&(this.imgNumber=0,this.RequestRedraw()):(this.Img.src=this.GetProperty("Value")+("00000"+(this.imgNumber++).toString()).slice(-5)+".png",this.RequestRedraw())},i.prototype.RequestRedraw=function(){var n=this,t=window;t.webkitRequestAnimationFrame?t.webkitRequestAnimationFrame(function(){n.RedrawImage()}):window.setTimeout(function(){n.RedrawImage()},Math.floor(1e3/60))},i.Create=function(n,t,r,u,f){var e=new i;return e.InitControl(n),f&&e.SetProperty("ClassName",f),u&&(u.substring(0,5)==="data:"&&(e.HostDiv.className="cdeLiveImg"),e.SetProperty("iValue",u)),t>=0&&r>=0&&e.EnabledZoom(),e.SetProperty("FullHeight",r),e.SetProperty("FullWidth",t),e},i}(n.TheNMIBaseControl);n.ctrlZoomImage=f;e=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mWidth=0,i.mHeight=0,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType=n.cdeControlType.ProgressBar,t.prototype.InitControl.call(this,i,r,u,f),this.mBaseCtrl=n.MyTCF.CreateBaseControl().Create(i,{TRF:this.MyTRF}),this.mBaseCtrl.SetElement(document.createElement("div")),this.mBaseCtrl.GetElement().className="ctrlProgressBar",this.mBaseCtrl.SetInitialSize(0),this.mContentTarget=document.createElement("progress"),this.mContentTarget.className="ctrlProgressBar",this.mBaseCtrl.GetElement().appendChild(this.mContentTarget),this.SetElement(this.mBaseCtrl.GetElement()),this.SetProperty("MaxValue",100),!0},i.prototype.SetProperty=function(n,i){t.prototype.SetProperty.call(this,n,i);n==="Background"?this.mContentTarget.style.background=i:n==="Foreground"?this.mContentTarget.style.color=i:n==="BarClassName"?this.mContentTarget.className=i:n==="MaxValue"?(i=cde.CInt(i),this.mContentTarget.max=i):(n==="Value"||n==="iValue")&&(this.mContentTarget.value=cde.CDbl(i))},i.Create=function(n,t,r,u){var f=new i(t);return f.InitControl(n,t),u&&f.SetProperty("MaxValue",u),r||(r=0),f.SetProperty("iValue",r),f},i}(n.TheNMIBaseControl);n.ctrlProgressBar=e;o=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mWidth=0,i.mHeight=0,i.mMaxValue=100,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this;return this.MyBaseType=n.cdeControlType.ProgressBar,t.prototype.InitControl.call(this,i,r,u,f),this.mBaseCtrl=n.MyTCF.CreateBaseControl().Create(i,{TRF:this.MyTRF}),this.mBaseCtrl.SetElement(document.createElement("div")),this.mBaseCtrl.GetElement().className="cdeMeter",this.mBaseCtrl.SetInitialSize(0),this.mContentTarget=document.createElement("span"),this.mBaseCtrl.GetElement().appendChild(this.mContentTarget),this.mContentTarget.style.width="0px",this.mContentTarget.style.height=this.mBaseCtrl.MyHeight-20+"px",this.SetElement(this.mBaseCtrl.GetElement()),cde.MyBaseAssets.RegisterEvent("ThemeSwitched",function(){e.GetProperty("Background")||(e.mBaseCtrl.GetElement().style.background=cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?"rgba(80, 80, 80, 0.1)":"rgba(80, 80, 80, 0.5)");e.DoRender()}),!0},i.prototype.SetProperty=function(n,i){t.prototype.SetProperty.call(this,n,i);n==="Background"?this.mContentTarget.style.background=i:n==="Foreground"?this.mContentTarget.style.color=i:n==="BarClassName"?this.mContentTarget.className=i:n==="MaxValue"?(this.mMaxValue=cde.CInt(i),this.DoRender()):(n==="Value"||n==="iValue")&&this.DoRender()},i.prototype.DoRender=function(){var n=this.GetProperty("Value"),t;n>this.mMaxValue&&(n=this.mMaxValue);t=(this.mBaseCtrl.MyWidth-20)/this.mMaxValue*n;this.mContentTarget.style.width=t+"px"},i.Create=function(n,t,r,u){var f=new i(t);return f.InitControl(n,t),u&&f.SetProperty("MaxValue",u),r||(r=0),f.SetProperty("iValue",r),f},i}(n.TheNMIBaseControl);n.ctrlProgressBarCool=o;s=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mVideo=null,i.mVideoSource=null,i.divFrame=null,i.mCamBut=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this;return this.MyBaseType=n.cdeControlType.VideoViewer,t.prototype.InitControl.call(this,i,r,u,f),this.mVideo=document.createElement("video"),this.mVideo.style.backgroundColor="black",this.mVideo.autoplay=!0,this.mVideo.style.width="inherit",this.mVideo.style.height="inherit",this.mVideo.onerror=function(){n.ShowToastMessage("Cannot play Video")},this.mVideoSource=document.createElement("source"),this.mVideo.appendChild(this.mVideoSource),this.divFrame=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup),this.divFrame.InitControl(i,this.MyTRF),this.divFrame.SetProperty("Background","gray"),this.divFrame.SetInitialSize(0),this.mCamBut=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.divFrame,{PostInitBag:["Text=MyCam","TileWidth=1","TileHeight=1"]}),this.mCamBut.SetProperty("OnClick",function(){e.ShowLiveVideo()}),this.mCamBut.SetProperty("Visibility",!1),this.divFrame.GetElement().appendChild(this.mVideo),this.SetElement(this.divFrame.GetElement()),!0},i.prototype.SetProperty=function(n,i){t.prototype.SetProperty.call(this,n,i);(n==="Source"||n==="Value"||n==="iValue")&&this.mVideo?i==="LIVE"?this.ShowLiveVideo():(this.mVideoSource.src=i,this.mVideo.play()):n==="ShowCam"?this.mCamBut.SetProperty("Visibility",!0):n==="Background"?this.mVideo.style.backgroundColor=i:n==="MainBackground"?this.divFrame.SetProperty("Background",i):n==="ClassName"&&this.mVideo?this.mVideo.className=i:n==="ShowControls"&&this.mVideo&&(cde.CBool(i)?this.mVideo.setAttribute("controls",""):this.mVideo.removeAttribute("controls"))},i.prototype.ShowLiveVideo=function(){var i=this,t=navigator;t.getUserMedia=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia;try{t.getUserMedia?(this.mVideoSource.src=null,t.getUserMedia({video:!0,audio:!0},function(n){i.mVideoSource.src=n||n;i.mVideo.play()},function(t){n.MyPopUp&&n.MyPopUp.Show("An Video-Display error occurred: [CODE "+t.code+"]",!0)})):n.MyPopUp&&n.MyPopUp.Show("Native camera is not supported in this browser!",!0)}catch(r){n.MyPopUp&&n.MyPopUp.Show("An Video-Display error occurred: "+r,!0)}},i}(n.TheNMIBaseControl);n.ctrlVideoViewer=s;t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.MyCheckBox=null,i.InnerCheck=null,i.InnerText=null,i.IsCustomCheck=!1,i}return __extends(i,t),i.CreateOLD=function(n,t,r,u,f,e,o){var s=new i(r);return s.InitControl(n,r,null,t),o&&s.SetProperty("ClassName",o),s.SetProperty("iValue",u),cde.CBool(e)&&s.SetProperty("IsOverlay",e),f&&s.SetProperty("Title",f),s},i.prototype.InitControl=function(i,r,u,f){this.MyBaseType=n.cdeControlType.SingleCheck;t.prototype.InitControl.call(this,i,r,u,f);this.MyCheckBox=document.createElement("div");this.MyCheckBox.className="ctrlCheckBox";this.MyCheckBox.style.width=n.GetSizeFromTile(1)-4+"px";this.MyCheckBox.style.height=n.GetSizeFromTile(1)-4+"px";this.InnerCheck=document.createElement("div");this.InnerCheck.className="ctrlCheckBoxInner";this.InnerCheck.style.width=n.GetSizeFromTile(1)-6+"px";this.InnerCheck.style.height=n.GetSizeFromTile(1)-6+"px";this.InnerCheck.style.pointerEvents="none";this.MyCheckBox.appendChild(this.InnerCheck);var e=this.GetSetting("Title");return e&&this.SetProperty("Title",e),this.IsCustomCheck=!0,this.SetElement(this.MyCheckBox,!0),this.SetProperty("Disabled",!this.MyFieldInfo||(this.MyFieldInfo.Flags&2)==0),cde.CBool(this.GetSetting("DefaultValue"))?this.SetProperty("iValue",!0):this.SetProperty("iValue",!1),this.EnableDisable(cde.CBool(this.GetProperty("Disabled"))),!0},i.prototype.SetProperty=function(i,r){i==="Value"||i==="iValue"?(cde.CBool(this.GetProperty("IsChecked"))!==cde.CBool(r)&&(this.IsDirty=!0),cde.CBool(r)?this.SetProperty("IsChecked",!0):this.SetProperty("IsChecked",!1),this.ShowToggle()):i==="CheckImage"?(r&&r!=="CDE_NOP"?(r.toLowerCase().indexOf(".png")<0&&r.toLowerCase().indexOf(".jpg")<0?(this.InnerText||(this.InnerText=document.createElement("span"),this.InnerCheck.appendChild(this.InnerText)),this.InnerText.className="cdeCheckIcon",this.InnerText.innerHTML=r,this.InnerText.style.color=this.GetProperty("Foreground")?this.GetProperty("Foreground"):"black",this.InnerCheck.style.backgroundImage="none"):this.InnerCheck.style.backgroundImage=r,this.IsCustomCheck=!0,this.InnerCheck.style.display=""):(this.IsCustomCheck=!1,this.InnerCheck.style.display="",this.InnerCheck.style.backgroundImage='url("../Images/cdeInnerCheck.png")',this.InnerText.className="cdeCheckText",this.InnerText.innerHTML=this.GetProperty("Title"),this.ShowToggle()),this.ShowToggle()):i==="Background"&&this.MyCheckBox?this.MyCheckBox.style.background=r:i==="Foreground"&&this.InnerText?this.InnerText.style.color=r:i==="AreYouSure"?(this.UnregisterEvent("PointerUp"),this.EnableDisable(cde.CBool(this.GetProperty("Disabled")))):i==="Disabled"?(this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0||(r=!0),this.EnableDisable(cde.CBool(r))):i==="IsOverlay"?(n.SetZIndex(this.MyCheckBox,cde.CBool(r)?1300:0),n.SetZIndex(this.InnerCheck,cde.CBool(r)?1300:0)):i==="Title"&&this.InnerCheck&&(this.InnerText||(this.InnerText=document.createElement("span"),this.InnerText.className="cdeCheckText",this.InnerCheck.appendChild(this.InnerText)),this.InnerText.innerHTML=r);t.prototype.SetProperty.call(this,i,r)},i.prototype.SetTE=function(n){t.prototype.SetTE.call(this,n);this.MyTE&&cde.CBool(this.GetProperty("NoTE"))===!0&&(this.MyTE.MyTELabel.SetProperty("Visibility",!0),this.MyTE.MyTELabel.SetProperty("PixelHeight",18),this.MyTE.MyTELabel.SetProperty("FontSize",15))},i.prototype.PostCreate=function(t){var i=this;cde.CBool(t.GetProperty("IsInTable"))||(this.SetProperty("IsHitTestDisabled",!0),this.SetProperty("NoClick",!0));(this.MyFieldInfo.Flags&2)!=0?t.MyTEContainer.SetProperty("OnClick",function(t,r){!r.AYSFired&&i.GetProperty("AreYouSure")?n.MyPopUp&&n.MyPopUp.Show(i.GetProperty("AreYouSure"),!1,null,1,function(){i.ToggleCheck(null)}):i.ToggleCheck(r)}):this.SetProperty("Disabled",!0)},i.prototype.EnableDisable=function(t){var i=this;this.UnregisterEvent("PointerUp");t||this.RegisterEvent("PointerUp",function(t,r){i.GetProperty("NoClick")!==!0&&(i.GetProperty("AreYouSure")?n.MyPopUp&&n.MyPopUp.Show(i.GetProperty("AreYouSure"),!1,null,1,function(){i.ToggleCheck(null)}):i.ToggleCheck(r))})},i.prototype.ToggleCheck=function(){cde.CBool(this.GetProperty("IsChecked"))?this.SetProperty("IsChecked",!1):this.SetProperty("IsChecked",!0);this.ShowToggle();this.GetProperty("NoClick")===!0||this.GetProperty("UpdateTable")===!0?this.SetProperty("Value",cde.CBool(this.GetProperty("IsChecked"))):this.SetProperty("iValue",cde.CBool(this.GetProperty("IsChecked")))},i.prototype.ShowToggle=function(){cde.CBool(this.GetProperty("IsChecked"))?(this.InnerCheck.style.opacity="1",this.IsCustomCheck||(this.InnerCheck.style.display="")):(this.InnerCheck.style.opacity="0.05",this.IsCustomCheck||(this.InnerCheck.style.display="none"))},i.Create=function(n,t,r,u,f,e,o){var s=new i(r);return s.InitControl(n,r,null,t),o&&s.SetProperty("ClassName",o),s.SetProperty("iValue",u),cde.CBool(e)&&s.SetProperty("IsOverlay",e),f&&s.SetProperty("Title",f),s},i}(n.TheNMIBaseControl);n.ctrlCheckBox=t;h=function(t){function i(n){var i=t.call(this,null,n)||this;return i.MyDIV=null,i.tSendButton=null,i.tInfo=null,i.BitCount=1,i}return __extends(i,t),i.CreateOLD=function(n,t,r,u,f,e){var o=new i(r);return o.InitControl(n,r,null,t),e&&o.SetProperty("ClassName",e),o.SetProperty("iValue",u),cde.CBool(f)&&o.SetProperty("IsOverlay",f),o},i.prototype.InitControl=function(i,r,u,f){var l=this,o,h,s,c,e,a;if(this.MyBaseType=n.cdeControlType.CheckField,t.prototype.InitControl.call(this,i,r,u,f),this.MyDIV=document.createElement("div"),this.MyDIV.className="ctrlCheckField",this.SetElement(this.MyDIV),o=null,h=!1,this.GetSetting("Options")?(o=this.GetSetting("Options").split(";"),h=!0):this.GetSetting("ImageList")&&(o=this.GetSetting("ImageList").split(","),h=!0),s=cde.CInt(this.GetSetting("TileFactorY")),c=n.GetControlWidth(this),c<2&&(c=2),this.MyCheckBoxes=[],this.MyLabels=[],this.MyTiles=[],this.MyFieldInfo)for(this.BitCount=cde.CInt(this.GetSetting("Bits")),this.BitCount===0&&o&&o.length>0&&(this.BitCount=o.length),h&&(this.SetProperty("TileHeight",this.BitCount),s>1&&this.SetProperty("TileFactorY",s)),e=this.BitCount-1;e>=0;e--)a=(1<<e).toString(),o&&o.length>e&&(a=o[e]),h?(this.MyTiles[e]=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup),this.MyTiles[e].InitControl(this),this.MyTiles[e].SetProperty("TileWidth",c),this.MyTiles[e].SetProperty("TileHeight",1),this.MyTiles[e].SetProperty("Display","table"),this.MyCheckBoxes[e]=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleCheck).Create(this.MyTiles[e],{ScreenID:f,TRF:new n.TheTRF("",0,new n.TheFieldInfo(n.cdeControlType.SingleCheck,1,"no TRF",this.MyFieldInfo.Flags&2))}),this.MyCheckBoxes[e].RegisterEvent("OniValueChanged",function(){l.GetCheckValue("Value")}),this.MyLabels[e]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.MyTiles[e],{PreInitBag:["Element=div"],TRF:new n.TheTRF("",0,new n.TheFieldInfo(n.cdeControlType.SmartLabel,1,"no TRF",256))}),this.MyLabels[e].SetProperty("Value",a),this.MyLabels[e].SetProperty("TileWidth",c-1),this.MyLabels[e].SetProperty("Display","table-cell"),this.MyLabels[e].SetProperty("HorizontalAlignment","left"),this.MyLabels[e].SetProperty("VerticalAlignment","middle"),s>1&&(this.MyTiles[e].SetProperty("TileFactorY",s),this.MyCheckBoxes[e].SetProperty("TileFactorY",s),this.MyLabels[e].SetProperty("TileFactorY",s))):this.MyCheckBoxes[e]=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleCheck).Create(this,{ScreenID:f,TRF:new n.TheTRF("",0,new n.TheFieldInfo(n.cdeControlType.SingleCheck,1,"no TRF",this.MyFieldInfo.Flags&2))});else this.MyCheckBoxes[0]=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleCheck).Create(this,{ScreenID:f,TRF:new n.TheTRF("",0,new n.TheFieldInfo(n.cdeControlType.SingleCheck,1,"no TRF",0))});return this.MyTRF&&this.MyTRF.FldInfo&&(this.MyTRF.FldInfo.Flags&2)!=0&&this.GetSetting("ResultLabel")&&(this.tInfo=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this,{PreInitBag:["ControlTW=2","ControlTH=1","NoTE=true"],PostInitBag:["Text="+this.GetSetting("ResultLabel"),"ClassName=cdeResultLabel"]})),this.SetProperty("Disabled",!this.MyFieldInfo||(this.MyFieldInfo.Flags&2)==0),n.MyEngine&&cde.GuidToString(this.MyFieldInfo.cdeMID)==="DD3DF621ACAC4B77985687165138B028"&&n.MyEngine.RegisterEvent("NMI_UIDACL",function(n,t){cde.GuidToString(t.OWN)===cde.GuidToString(l.MyFieldInfo.cdeMID)&&l.SetProperty("iValue",cde.CInt(t.PLS))}),!0},i.prototype.GetProperty=function(n){return(n==="iValue"||n==="Value")&&this.GetCheckValue("iValue"),t.prototype.GetProperty.call(this,n)},i.prototype.SetProperty=function(i,r){var u,o,s,f,e,h;if(i==="Value"||i==="iValue"){if(r){if(o=cde.CInt(r),this.MyFieldInfo)for(u=cde.CInt(this.MyFieldInfo.Bits)-1;u>=0;u--)(o&1<<u)!=0?this.MyCheckBoxes[u].SetProperty("iValue",!0):this.MyCheckBoxes[u].SetProperty("iValue",!1);else this.MyCheckBoxes[0].SetProperty("iValue",!1);this.tInfo&&this.tInfo.SetProperty("Text",this.GetProperty("ResultLabel")+o)}}else if(i==="ImageList"&&this.MyCheckBoxes)for(s=r.split(","),u=0;u<this.MyCheckBoxes.length;u++)u>=s.length?this.MyCheckBoxes[u].SetProperty("CheckImage",null):this.MyCheckBoxes[u].SetProperty("CheckImage",s[u]);else if(i==="IsOverlay")for(n.SetZIndex(this.MyDIV,cde.CBool(r)?1300:0),n.SetZIndex(this.tSendButton.GetElement(),cde.CBool(r)?1300:0),u=0;u<this.MyCheckBoxes.length;u++)this.MyCheckBoxes[u].SetProperty("IsOverlay",r);else if(i==="Disabled")this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0||(r=!0),this.EnableDisable(cde.CBool(r));else if(i==="FontSize")for(f=0;f<this.BitCount;f++)this.MyLabels&&this.MyLabels[f]&&this.MyLabels[f].SetProperty("FontSize",r);else if(i==="Options"&&r)for(e=r.split(";"),u=cde.CInt(this.MyFieldInfo.Bits)-1;u>=0;u--)h=(1<<u).toString(),e&&e.length>u&&(h=e[u]),this.MyCheckBoxes[u].SetProperty("Title",h);t.prototype.SetProperty.call(this,i,r)},i.prototype.PostCreate=function(){this.MyFieldInfo.IsInTable===!0&&this.SetProperty("IsOverlay",!0)},i.prototype.GetCheckValue=function(n){for(var i=0,t=this.BitCount-1;t>=0;t--)cde.CBool(this.MyCheckBoxes[t].GetProperty("IsChecked"))&&(i+=1<<t);return this.SetProperty(n,i),i},i.prototype.EnableDisable=function(n){this.tSendButton&&this.tSendButton.SetProperty("Disabled",n);for(var t=0;t<this.MyCheckBoxes.length;t++)this.MyCheckBoxes[t].SetProperty("Disabled",n)},i}(n.TheNMIBaseControl);n.ctrlCheckField=h;c=function(t){function i(n){var i=t.call(this,null,n)||this;return i.divPin=null,i.mInnerDiv=null,i.mImgControl=null,i.mMoveDiv=null,i.mlastX=0,i.mNoFire=!1,i.mInsideControls=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType=n.cdeControlType.RevealButton,t.prototype.InitControl.call(this,i,r,u,f),this.divPin=document.createElement("div"),this.divPin.style.position="relative",this.divPin.style.cssFloat="left",this.PreventDefault=!0,this.SetElement(this.divPin,!0),this.SetProperty("IsOpen",!1),!0},i.prototype.SetProperty=function(i,r){var f,u,e;if(i==="ClassName"){this.divPin.className=r;return}if(i==="TabIndex")r=cde.CInt(r),this.SetTabIndex(r);else if(i==="Image")r&&(f=this,f.mImgControl=r,f.GetElement().appendChild(r.GetElement()),f.mImgControl.SetProperty("Parent",f),f.mImgControl.GetElement().style.cssFloat="right",f.mImgControl.HookEvents(!1),f.mImgControl.RegisterEvent("PointerUp",function(t,i,r){f.SetProperty("LastX",-1);var u=t.GetProperty("Parent");!u.mNoFire&&r.PathLength()<n.MyNMISettings.DeadPathLength&&t.FireEvent(!0,"OnClick",i)}),this.GetProperty("InsideControls")>0&&this.InitInsides());else if(i==="ControlArray"&&r&&r.length>0){for(u=this,u.mInsideControls=r,u.mMoveDiv=document.createElement("div"),u.mMoveDiv.style.width="0px",u.mMoveDiv.style.height=n.GetSizeFromTile(1)+"px",u.mMoveDiv.style.cssFloat="left",u.mMoveDiv.style.overflow="hidden",u.mMoveDiv.id=u.GetProperty("ID"),u.divPin.appendChild(u.mMoveDiv),u.mInnerDiv=document.createElement("div"),u.mInnerDiv.style.height=n.GetSizeFromTile(1)+"px",u.mInnerDiv.style.display="none",u.mMoveDiv.appendChild(u.mInnerDiv),u.SetProperty("InsideControls",r.length),e=0;e<r.length;e++)u.SetProperty("InsideControl"+e,r),u.mInnerDiv.appendChild(r[e].GetElement()),r[e].GetElement().style.verticalAlign="middle",r[e].GetElement().style.display="table-cell",r[e].GetElement().tabIndex=-1;u.mInnerDiv.style.width=n.GetSizeFromTile(r.length)+1+"px";u.InitInsides();this.SetTabIndex(-1)}t.prototype.SetProperty.call(this,i,r)},i.prototype.SetTabIndex=function(n){if(this.mInsideControls)for(var t=0;t<this.mInsideControls.length;t++)this.mInsideControls[t].GetElement().tabIndex=n<0?-1:n++},i.prototype.InitInsides=function(){var t=this;return this.GetProperty("InsideControls")>0&&this.mImgControl&&(this.mImgControl.RegisterEvent("PointerDown",function(n,i,r){t.SetProperty("LastX",r.AdjPosition.x);var u=n.GetProperty("Parent");u.mNoFire=!1}),this.mImgControl.RegisterEvent("PointerMove",function(t,i,r){var u=t.GetProperty("Parent");r.Shift.x>2&&u.GetProperty("IsOpen")!==!0?(u.SetProperty("IsOpen",!0),u.SetTabIndex(cde.CInt(u.GetProperty("TabIndex"))+1),u.mInnerDiv.style.display="table",u.mInnerDiv.style.width=n.GetSizeFromTile(u.GetProperty("InsideControls"))+2+"px",u.mMoveDiv.style.width=n.GetSizeFromTile(u.GetProperty("InsideControls"))+2+"px"):r.Shift.x<-2&&u.GetProperty("IsOpen")===!0&&(u.SetProperty("IsOpen",!1),u.SetTabIndex(-1),u.mMoveDiv.style.width="0px",u.mInnerDiv.style.width="0px",u.mInnerDiv.style.display="none")})),!0},i}(n.TheNMIBaseControl);n.ctrlRevealButton=c;l=function(t){function i(){var n=t.call(this,null,null)||this;return n.myControlContainer=null,n.myPropertyBag=null,n}return __extends(i,t),i.prototype.SetProperty=function(n,i){t.prototype.SetProperty.call(this,n,i);n==="iValue"&&this.myBar.SetProperty("iValue",i)},i.prototype.InitControl=function(i,r,u,f){var s=this,e,o;return t.prototype.InitControl.call(this,i,r,u,f),u?this.myPropertyBag=u:r&&r.FldInfo&&r.FldInfo.PropertyBag&&(this.myPropertyBag=r.FldInfo.PropertyBag),this.myControlContainer=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(i),this.myControlContainer.SetInitialSize(0),e=cde.CInt(this.MyParentCtrl.GetProperty("ControlTW")),this.GetSetting("TileWidth")&&(e=cde.CInt(this.GetSetting("TileWidth"))),o=cde.CInt(this.MyParentCtrl.GetProperty("ControlTH")),this.GetSetting("TileHeight")&&(o=cde.CInt(this.GetSetting("TileHeight"))),this.SetElement(this.myControlContainer.GetElement(),!0,this.myControlContainer.GetElement()),this.AddMyControls(e,o,r),cde.MyBaseAssets.RegisterEvent("ThemeSwitched",function(){s.SetImg()}),this.SetImg(),!0},i.prototype.SetImg=function(){var n=!1;cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?this.GetProperty("LiteSource")&&(this.myImage.SetProperty("Source",this.GetProperty("LiteSource")),n=!0):this.GetProperty("DarkSource")&&(this.myImage.SetProperty("Source",this.GetProperty("DarkSource")),n=!0);!n&&this.GetProperty("Source")&&this.myImage.SetProperty("Source",this.GetProperty("Source"))},i.prototype.AddMyControls=function(t,i,r){var f=this,u;this.myGroup=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this.myControlContainer,{TRF:r});this.myGroup.SetProperty("ClassName","cIBGroup");this.myImage=n.ctrlZoomImage.Create(this.myGroup);this.myImage.SetProperty("ControlTW",t);this.myImage.SetProperty("ControlTH",i);this.myImage.SetProperty("Z-Index",50);this.myImage.SetProperty("IsAbsolute",!0);this.myImage.SetProperty("Style","pointer-events: none");u=this.GetSetting("Source");u&&this.myImage.SetProperty("Source",u);this.myBar=n.ctrlBarChart.Create(this.myGroup,r);this.myBar.SetProperty("ControlTW",t);this.myBar.SetProperty("ControlTH",i);this.myBar.SetProperty("IsAbsolute",!0);this.myBar.SetProperty("iValue",this.GetSetting("Value"));n.TheNMIBaseControl.SetPropertiesFromBag(this.myBar,this.myPropertyBag);this.myBar.RegisterEvent("OnValueChanged",function(n,t,i){f.SetProperty("Value",i[1])})},i.prototype.ApplySkin=function(){},i}(n.TheNMIBaseControl);n.ctrlImageSlider2=l;a=function(i){function r(n){var t=i.call(this,null,n)||this;return t.MyCheckBox=null,t.IsCustomCheck=!1,t.MyLabel=null,t.MyToggleSwitch=null,t.MyCheckBoxSwitch=null,t.InnerToggleDiv=null,t}return __extends(r,i),r.CreateOLD=function(n,i,r,u,f,e,o){var s=new t(r);return s.InitControl(n,r,null,i),o&&s.SetProperty("ClassName",o),s.SetProperty("iValue",u),cde.CBool(e)&&s.SetProperty("IsOverlay",e),f&&s.SetProperty("Title",f),s},r.prototype.InitControl=function(t,r,u,f){var e,o;return this.MyBaseType=n.cdeControlType.SingleCheck,i.prototype.InitControl.call(this,t,r,u,f),this.MyCheckBox=document.createElement("div"),this.MyCheckBox.className="cdeToggleSwitch",this.MyCheckBox.style.height=n.GetSizeFromTile(1)+"px",this.MyCheckBox.style.width=n.GetSizeFromTile(1)+"px",this.MyLabel=document.createElement("label"),this.MyLabel.className="cdeSwitchLabel",this.MyLabel.style.maxWidth=n.GetSizeFromTile(1)+"px",e=this.GetSetting("Label"),this.MyLabel.innerHTML=e?e:cde.CBool(this.GetSetting("IsInTable"))===!0?"":"&nbsp;",this.MyToggleSwitch=document.createElement("label"),this.MyToggleSwitch.className="cdeSwitch",this.MyCheckBoxSwitch=document.createElement("input"),this.MyCheckBoxSwitch.type="checkbox",this.MyCheckBoxSwitch.className="cdeCheckboxInput",this.MyToggleSwitch.appendChild(this.MyCheckBoxSwitch),this.MyCheckBox.appendChild(this.MyLabel),this.MyCheckBox.appendChild(this.MyToggleSwitch),this.InnerToggleDiv=document.createElement("div"),this.InnerToggleDiv.className="cdeCheckboxInnerDiv",this.MyToggleSwitch.appendChild(this.InnerToggleDiv),o=this.GetSetting("Title"),o&&this.SetProperty("Title",o),this.IsCustomCheck=!0,this.SetElement(this.MyCheckBox,!0),this.SetProperty("Disabled",!this.MyFieldInfo||(this.MyFieldInfo.Flags&2)==0),cde.CBool(this.GetSetting("DefaultValue"))?this.SetProperty("iValue",!0):this.SetProperty("iValue",!1),this.EnableDisable(cde.CBool(this.GetProperty("Disabled"))),!0},r.prototype.SetProperty=function(t,r){var u,f;t==="Value"||t==="iValue"?(cde.CBool(this.GetProperty("IsChecked"))!==cde.CBool(r)&&(this.IsDirty=!0),cde.CBool(r)?(this.SetProperty("IsChecked",!0),this.MyCheckBox.classList.add("toggleChecked")):(this.SetProperty("IsChecked",!1),this.MyCheckBox.classList.remove("toggleChecked"))):t==="Label"?this.MyLabel.textContent=r:t==="HideLabel"?this.MyLabel.style.display="none":t==="TileHeight"||r==="ControlTH"?(u=cde.CInt(this.GetProperty("TileFactorY")),u===0&&(u=1),this.MyCheckBox.style.height=n.GetSizeFromTile(cde.CInt(r))/u+"px"):t==="TileFactorY"&&(u=cde.CInt(r),u<1&&(u=1),f=cde.CInt(this.GetProperty("TileHeight")),f===0&&(f=1),this.MyCheckBox.style.height=n.GetSizeFromTile(f)/u+"px",u>1&&(this.MyLabel.style.display="none"));i.prototype.SetProperty.call(this,t,r)},r.prototype.PostCreate=function(t){var i=this;cde.CBool(t.GetProperty("IsInTable"))||(this.SetProperty("IsHitTestDisabled",!0),this.SetProperty("NoClick",!0));(this.MyFieldInfo.Flags&2)!=0?t.MyTEContainer.SetProperty("OnClick",function(t,r){!r.AYSFired&&i.GetProperty("AreYouSure")?n.MyPopUp&&n.MyPopUp.Show(i.GetProperty("AreYouSure"),!1,null,1,function(){i.ToggleCheck(null)}):i.ToggleCheck(r)}):this.SetProperty("Disabled",!0)},r.prototype.EnableDisable=function(t){var i=this;this.UnregisterEvent("PointerUp");t||this.RegisterEvent("PointerUp",function(t,r){i.GetProperty("NoClick")!==!0&&(i.GetProperty("AreYouSure")?n.MyPopUp&&n.MyPopUp.Show(i.GetProperty("AreYouSure"),!1,null,1,function(){i.ToggleCheck(null)}):i.ToggleCheck(r))})},r.prototype.ToggleCheck=function(){cde.CBool(this.GetProperty("IsChecked"))?(this.SetProperty("IsChecked",!1),this.MyCheckBox.classList.remove("toggleChecked")):(this.SetProperty("IsChecked",!0),this.MyCheckBox.classList.add("toggleChecked"));this.GetProperty("NoClick")===!0||this.GetProperty("UpdateTable")===!0?this.SetProperty("Value",cde.CBool(this.GetProperty("IsChecked"))):this.SetProperty("iValue",cde.CBool(this.GetProperty("IsChecked")))},r.Create=function(n,i,r,u,f,e,o){var s=new t(r);return s.InitControl(n,r,null,i),o&&s.SetProperty("ClassName",o),s.SetProperty("iValue",u),cde.CBool(e)&&s.SetProperty("IsOverlay",e),f&&s.SetProperty("Title",f),s},r}(n.TheNMIBaseControl);n.ctrlToggleButton2=a}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.bgcanvas=null,i.fgcanvas=null,i.bgctx=null,i.fgctx=null,i.redrawPending=!1,i.foregroundPolylines=[],i.mBaseDiv=null,i.WidthRatio=1,i.HeightRatio=1,i.MyWidth=0,i.MyHeight=0,i.tObjPointer=-1,i.tStrokePointer=0,i.tAsyncStrokes=null,i.MyFirstPoint=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e,o;return(this.MyBaseType=n.cdeControlType.CanvasDraw,t.prototype.InitControl.call(this,i,r,u,f),e=null,this.MyTarget?this.mBaseDiv=this.MyTarget.GetContainerElement():(this.mBaseDiv=document.createElement("div"),e=this.mBaseDiv),!this.DoesSupportsCanvas)?(o=document.createElement("div"),o.style.position="absolute",o.appendChild(document.createTextNode("Canvas drawing is not supported for your browser.")),this.mBaseDiv.appendChild(o),!0):(cde.CBool(this.GetSetting("NoBackBuffer"))||(this.bgcanvas=document.createElement("canvas"),this.bgcanvas.width=0,this.bgcanvas.height=0,this.bgctx=this.bgcanvas.getContext("2d"),e||(this.bgcanvas.style.position="relative"),this.bgcanvas.style.top="0px",this.bgcanvas.style.left="0px",this.mBaseDiv.appendChild(this.bgcanvas)),this.fgcanvas=document.createElement("canvas"),this.fgctx=this.fgcanvas.getContext("2d"),this.fgcanvas.width=0,this.fgcanvas.height=0,this.fgcanvas.style.position="absolute",this.fgcanvas.style.top="0px",this.fgcanvas.style.left="0px",this.SetProperty("Foreground","#000000"),this.mBaseDiv.appendChild(this.fgcanvas),this.PreventManipulation=!0,this.SetElement(e?e:this.fgcanvas),!0)},i.prototype.SetProperty=function(i,r){var f=!1,e=null,h,o,u,v;if(i==="DataContextSilent"?t.prototype.SetProperty.call(this,"DataContext",r):i==="Style"?(this.bgcanvas&&(this.bgcanvas.style.cssText+=r),this.fgcanvas&&(this.fgcanvas.style.cssText+=r)):t.prototype.SetProperty.call(this,i,r),i==="OnPointerDown")r&&(this.PreventDefault=!0,this.HookEvents(!1)),this.RegisterEvent("PointerDown",r);else if(i==="OnPointerMove")r&&(this.PreventDefault=!0,this.HookEvents(!1)),this.RegisterEvent("PointerMove",r);else if(i==="OnPointerUp")r&&(this.PreventDefault=!0,this.HookEvents(!1)),this.RegisterEvent("PointerUp",r);else if(i==="OnPointerCancel")r&&(this.PreventDefault=!0,this.HookEvents(!1)),this.RegisterEvent("PointerCancel",r);else if(i==="OnKeyDown")r&&(this.PreventDefault=!0,this.HookEvents(!1)),this.RegisterEvent("KeyDown",r);else if(i==="OnKeyUp")r&&(this.PreventDefault=!0,this.HookEvents(!1)),this.RegisterEvent("KeyUp",r);else if(i==="IsVertical")(typeof r=="undefined"||cde.CBool(r))&&(r=!0,t.prototype.SetProperty.call(this,"IsVertical",r)),this.DrawCanvasBackground();else if(i==="IsInverted")(typeof r=="undefined"||cde.CBool(r))&&(r=!0,t.prototype.SetProperty.call(this,"IsInverted",r)),this.DrawCanvasBackground();else if(i==="Background")this.DrawCanvasBackground();else if(i==="AddShape")try{e=JSON.parse(r);e&&(this.AddDrawingObject(e),f=!0)}catch(c){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:ctrlCanvasDraw","DrawCanvas-AddShape :"+c)}else if(i==="DrawShapes"&&r)try{for(h=JSON.parse(r),o=0;o<h.length;o++)this.AddDrawingObject(h[o],h[o].ID+o.toString(),o<h.length-1);f=!0}catch(c){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:ctrlCanvasDraw","DrawCanvas-DrawShapes :"+c)}else if(i==="DrawShape"&&r)try{e=JSON.parse(r);e&&(this.AddDrawingObject(e,e.ID),f=!0)}catch(c){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:ctrlCanvasDraw","DrawCanvas-DrawShape :"+c)}else if(i==="SetShape"){if(r){this.ClearPicture();try{e=JSON.parse(r);e&&(this.AddDrawingObject(e),f=!0)}catch(c){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","cdeNMI:ctrlCanvasDraw","DrawCanvas-SetShape :"+c)}}}else if(i==="TileFactorX")u=cde.CInt(r),u>1&&(r=cde.CInt(this.GetProperty("ControlTW")),r===0&&(r=1),r=n.GetSizeFromTile(r),this.SetProperty("AbsWidth",r/u));else if(i==="TileFactorY")u=cde.CInt(r),u>1&&(r=cde.CInt(this.GetProperty("ControlTH")),r===0&&(r=1),r=n.GetSizeFromTile(r),this.SetProperty("AbsHeight",r/u));else if(i==="DrawMargin"){var s=cde.CDbl(r),l=this.MyHeight-s*2,a=this.MyWidth-s*2;this.bgcanvas&&(this.bgcanvas.style.top=s.toString()+"px",this.bgcanvas.style.left=s.toString()+"px",this.bgcanvas.style.height=l+"px",this.bgcanvas.height=l,this.bgcanvas.style.width=a+"px",this.bgcanvas.width=a);this.fgcanvas&&(this.fgcanvas.style.top=s.toString()+"px",this.fgcanvas.style.left=s.toString()+"px",this.fgcanvas.style.height=l+"px",this.fgcanvas.height=l,this.fgcanvas.style.width=a+"px",this.fgcanvas.width=a)}else i==="ControlTW"?(u=cde.CInt(this.GetProperty("TileFactorX")),u===0&&(u=1),r=cde.CInt(r),r===0&&(r=1),r=n.GetSizeFromTile(r),this.SetProperty("AbsWidth",r/u)):i==="ControlTH"?(u=cde.CInt(this.GetProperty("TileFactorY")),u===0&&(u=1),r=cde.CInt(r),r===0&&(r=1),r=n.GetSizeFromTile(r),this.SetProperty("AbsHeight",r/u)):i==="CanvasHeight"?(r=cde.CInt(r),this.fgcanvas&&this.fgcanvas.height!==r&&(this.fgcanvas.height=r),this.bgcanvas&&this.bgcanvas.height!==r&&(this.bgcanvas.height=r),this.HeightRatio=cde.CDbl(r)/this.MyHeight,f=!0):i==="CanvasWidth"?(r=cde.CInt(r),this.fgcanvas&&this.fgcanvas.width!==r&&(this.fgcanvas.width=r),this.bgcanvas&&this.bgcanvas.width!==r&&(this.bgcanvas.width=r),this.WidthRatio=r/this.MyWidth,f=!0):i==="AbsHeight"?(r=cde.CInt(r),this.fgcanvas&&this.fgcanvas.height!==r&&(this.fgcanvas.style.height=r+"px",this.fgcanvas.height=r),this.bgcanvas&&this.bgcanvas.height!==r&&(this.bgcanvas.style.height=r+"px",this.bgcanvas.height=r),this.MyHeight=r,this.HeightRatio=1,f=!0):i==="AbsWidth"?(r=cde.CInt(r),this.fgcanvas&&this.fgcanvas.width!==r&&(this.fgcanvas.style.width=r+"px",this.fgcanvas.width=r),this.bgcanvas&&this.bgcanvas.width!==r&&(this.bgcanvas.style.width=r+"px",this.bgcanvas.width=r),this.MyWidth=r,this.WidthRatio=1,f=!0):i==="YRatio"&&this.fgcanvas&&(v=cde.CDbl(this.fgcanvas.style.width.substr(0,this.fgcanvas.style.width.length-2))/cde.CDbl(r),this.fgcanvas.style.height=v+"px",this.MyHeight=v);f=f||i!=="DataContextSilent"?!0:!1;f&&this.RequestRedraw()},i.prototype.ApplySkin=function(){this.ResizeCanvas()},i.prototype.ResizeCanvas=function(){this.mBaseDiv.clientWidth!==0&&this.mBaseDiv.clientHeight!==0&&(cde.CBool(this.GetProperty("AutoAdjust"))||this.MyWidth===0||this.MyHeight===0)&&(this.MyWidth!==this.mBaseDiv.clientWidth&&(this.MyWidth=this.mBaseDiv.clientWidth,this.SetProperty("AbsWidth",this.MyWidth)),this.MyHeight!==this.mBaseDiv.clientHeight&&(this.MyHeight=this.mBaseDiv.clientHeight,this.SetProperty("AbsHeight",this.MyHeight)))},i.prototype.DoesSupportsCanvas=function(){return!!document.createElement("canvas").getContext},i.prototype.GetPNG=function(){return this.bgcanvas?this.bgcanvas.toDataURL("image/png"):""},i.prototype.GetBGRenderContext=function(){return this.bgcanvas.getContext("2d")},i.prototype.AddDrawingObject=function(t,i,r){var u=this.GetProperty("DataContext");u||(u=[]);i?u[i]=t:u[n.MyNMISettings.IDCounter++]=t;this.SetProperty("DataContext",u);r||this.RequestRedraw()},i.prototype.DrawCanvasBackground=function(){var n,t;if(this.bgctx)if((this.bgctx.canvas.height===0||this.bgctx.canvas.width===0)&&this.ResizeCanvas(),this.bgctx.globalAlpha=1,this.GetProperty("ForegroundOpacity")&&(this.fgctx.globalAlpha=parseFloat(this.GetProperty("ForegroundOpacity"))),n=!1,this.GetProperty("Background")?(this.bgctx.fillStyle=i.ProcessColor(this,this.bgctx,this.GetProperty("Background")),this.GetProperty("Background").toLowerCase()==="transparent"&&(n=!0)):(this.bgctx.fillStyle="transparent",n=!0),n?this.bgctx.clearRect(0,0,this.bgctx.canvas.width,this.bgctx.canvas.height):this.bgctx.fillRect(0,0,this.bgctx.canvas.width,this.bgctx.canvas.height),this.GetProperty("Playback")===!0)this.tObjPointer=0,this.tAsyncStrokes=this.MyBackDrawObjects,this.tStrokePointer=0,this.DrawLinesAsync(this,this.bgctx);else for(t in this.MyBackDrawObjects)this.MyBackDrawObjects[t].Visibility&&this.MyBackDrawObjects[t].HasEnded&&this.DrawObject(this.bgctx,this.MyBackDrawObjects[t])},i.prototype.ClearPicture=function(){this.MyBackDrawObjects=[];this.bgctx&&this.bgctx.clearRect(0,0,this.bgctx.canvas.width,this.bgctx.canvas.height);this.fgctx&&this.fgctx.clearRect(0,0,this.fgctx.canvas.width,this.fgctx.canvas.height);this.foregroundPolylines=[];this.DrawCanvasBackground();this.SetProperty("DataContext",null)},i.prototype.RedrawForeground=function(){var t,n;this.redrawPending=!1;cde.CBool(this.GetProperty("Playback"))||cde.CBool(this.GetProperty("NoClear"))||this.fgctx.clearRect(0,0,this.fgctx.canvas.width,this.fgctx.canvas.height);t=this.GetProperty("DataContext");t||(t=[]);for(n in this.foregroundPolylines)this.foregroundPolylines[n].HasEnded?(t.push(this.foregroundPolylines[n]),delete this.foregroundPolylines[n.toString()]):this.DrawPolyline(this.fgctx,this.foregroundPolylines[n].ComplexData,this.foregroundPolylines[n].Foreground,this.foregroundPolylines[n].Fill);if(t.length>0&&this.GetProperty("Playback")===!0){for(n in t)this.MyBackDrawObjects||(this.MyBackDrawObjects=[]),t[n].IsTemp||this.MyBackDrawObjects.push(t[n]),delete t[n];this.DrawCanvasBackground()}else for(n in t)t[n].Visibility&&this.DrawObject(cde.CBool(t[n].HasEnded)&&this.bgctx?this.bgctx:this.fgctx,t[n]),(t[n].HasEnded||t[n].Type!==2)&&(this.MyBackDrawObjects||(this.MyBackDrawObjects=[]),t[n].IsTemp||this.MyBackDrawObjects.push(t[n]),delete t[n]);this.SetProperty("DataContextSilent",t)},i.prototype.DrawObject=function(n,t){switch(t.Type){case 1:n.fillStyle=i.ProcessColor(this,n,t.Fill);n.fillRect(t.Left,t.Top,t.Width,t.Height);break;case 2:this.DrawPolyline(t.HasEnded&&this.bgctx?this.bgctx:n,t.ComplexData,t.Foreground,t.Fill);break;case 3:if(!t.ComplexData)return;t.ComplexData.Font&&(n.font=t.ComplexData.Font);n.strokeStyle=i.ProcessColor(this,n,t.Fill);n.strokeText(t.ComplexData.Text,t.Left,t.Top);break;case 4:n.beginPath();n.arc(t.Left,t.Top,t.Width,0,2*Math.PI,!1);n.fillStyle=i.ProcessColor(this,n,t.Fill);n.fill();break;case 5:n.beginPath();n.arc(t.Left,t.Top,t.Width,0,2*Math.PI,!1);n.lineWidth=t.StrokeThickness;n.strokeStyle=i.ProcessColor(this,n,t.Fill);n.stroke();break;case 6:var r=document.createElement("img");r.src="data:image/jpeg;base64,"+t.ComplexData;n.drawImage(r,t.Left,t.Top);break;case 7:try{jdenticon&&(n.setTransform(1,0,0,1,t.Left,t.Top),jdenticon.drawIcon(n,t.ComplexData,t.Width))}catch(u){}}},i.prototype.RequestRedraw=function(){var n=this;this.redrawPending||(this.redrawPending=!0,window.requestAnimationFrame?window.requestAnimationFrame(function(){n.RedrawForeground()}):window.webkitRequestAnimationFrame?window.webkitRequestAnimationFrame(function(){n.RedrawForeground()}):window.setTimeout(function(){n.RedrawForeground()},Math.floor(1e3/60)))},i.prototype.DrawPolyline=function(t,i,r,u){var f,e;if(i.length===1)t.beginPath(),t.arc(i[0].PO.x,i[0].PO.y,10,0,Math.PI,!0),t.arc(i[0].PO.x,i[0].PO.y,10,Math.PI,Math.PI*2,!0),r&&(t.fillStyle=r),t.globalAlpha=.5,t.fill();else if(i.length>1){for(f=1;f<i.length;++f)t.beginPath(),t.moveTo(i[f-1].PO.x,i[f-1].PO.y),t.lineCap="round",t.strokeStyle=r,t.globalAlpha=1,t.lineTo(i[f].PO.x,i[f].PO.y),e=i[f].PO.t,e<1&&(e=1),t.lineWidth=e*n.MyNMISettings.StrokeSize,t.stroke();u&&(t.fillStyle=u,t.globalAlpha=.3,t.fill())}},i.prototype.DrawLinesAsync=function(t,i){var r,u,f;if(t.tAsyncStrokes&&!(t.tObjPointer<0)&&!(t.tAsyncStrokes.length<=t.tObjPointer)){if(r=t.tAsyncStrokes[t.tObjPointer].ComplexData,t.tStrokePointer++,t.tStrokePointer>=r.length)if(t.tAsyncStrokes[t.tObjPointer].Fill&&(i.fillStyle=t.tAsyncStrokes[t.tObjPointer].Fill,i.globalAlpha=.3,i.fill()),t.tObjPointer++,t.tObjPointer<t.tAsyncStrokes.length)r=t.tAsyncStrokes[t.tObjPointer].ComplexData,t.tStrokePointer=1;else{t.tObjPointer=-1;t.tStrokePointer=-1;t.SetProperty("Playback",!1);return}i.beginPath();i.moveTo(r[t.tStrokePointer-1].PO.x,r[t.tStrokePointer-1].PO.y);i.lineCap="round";i.strokeStyle=t.tAsyncStrokes[t.tObjPointer].Foreground;i.globalAlpha=1;i.lineTo(r[t.tStrokePointer].PO.x,r[t.tStrokePointer].PO.y);u=r[t.tStrokePointer].PO.t;u<1&&(u=1);i.lineWidth=u*n.MyNMISettings.StrokeSize;i.stroke();f=r[t.tStrokePointer].DT-r[t.tStrokePointer-1].DT;t.tStrokePointer<2&&(f=r[1].DT);setTimeout(t.DrawLinesAsync,f,t,i)}},i.prototype.BeginPolyline=function(t,i,r){var u=t,e,f;u.foregroundPolylines[r.Identifier.toString()]&&u.EndPolyline(t,i,r);e=t.GetProperty("Foreground");t.GetProperty("UseRandomColor")===!0&&(e=n.CColorToHex("rgb("+Math.floor(Math.random()*180)+","+Math.floor(Math.random()*180)+","+Math.floor(Math.random()*180)+")"));f=new n.TheStrokePoint;f.DT=Math.ceil((new Date).getTime()-new Date(2014,4,1).getTime());f.PG=r.Identifier.toString();f.PO=r.AdjPosition;u.MyFirstPoint=new n.TheDrawingPoint(r.Position.x,r.Position.y);u.MyFirstPoint.t=r.Buttons;u.foregroundPolylines[r.Identifier.toString()]={Type:2,Visibility:!0,ComplexData:[f],Foreground:e};u.RequestRedraw()},i.prototype.ExtendPolylineTo=function(t,i,r){var u=t;if(u.foregroundPolylines[r.Identifier.toString()]){var e=u.foregroundPolylines[r.Identifier.toString()],o=e.ComplexData[0],f=new n.TheStrokePoint;f.DT=Math.ceil((new Date).getTime()-new Date(2014,4,1).getTime())-o.DT;f.PG=r.Identifier.toString();f.PO=r.AdjPosition;u.foregroundPolylines[r.Identifier.toString()].ComplexData.push(f)}u.RequestRedraw()},i.prototype.EndPolyline=function(t,i,r){var u=t,h,o,s;if(u.foregroundPolylines[r.Identifier.toString()]){var f=u.foregroundPolylines[r.Identifier.toString()],c=f.ComplexData[0],e=new n.TheStrokePoint;e.DT=Math.ceil((new Date).getTime()-new Date(2014,4,1).getTime())-c.DT;e.PG=r.Identifier.toString();e.PO=r.AdjPosition;u.foregroundPolylines[r.Identifier.toString()].ComplexData.push(e);f&&(h=n.Vector2Distance(c.PO,e.PO),u.GetProperty("FillDistance")&&h<u.GetProperty("FillDistance")&&(f.Fill=f.Foreground),f.HasEnded=!0,u.RequestRedraw(),u.FireEvent(!1,"OnDrawEnd",r,f),o=n.GetControlFromPoint(u.MyFirstPoint.x,u.MyFirstPoint.y),o&&(u.MyFirstPoint.t>1&&h<5?o.FireEvent(!0,"NMI_SHAPE_RECOGNIZED","rightmouse",10):n.MyShapeRecognizer&&cde.CBool(t.GetProperty("EnableRecognizer"))&&(s=n.MyShapeRecognizer.RecogizeShape(f,0),s&&o&&o.FireEvent(!0,"NMI_SHAPE_RECOGNIZED",s.Name,s.Score))))}},i.ProcessColor=function(n,t,r){var s=r.substr(0,3),u,f,o;switch(s){case"SVG":var h=r.substr(4),c=self.URL||self.webkitURL||self,l=new Blob([h],{type:"image/svg+xml;charset=utf-8"}),a=c.createObjectURL(l),e=new Image;return e.crossOrigin="Anonymous",e.src=a,t.drawImage(e,100,100),"transparent";case"HUE":return u=null,u=n.GetProperty("IsVertical")?t.createLinearGradient(0,0,0,t.canvas.height):t.createLinearGradient(0,0,t.canvas.width,0),n.GetProperty("IsInverted")?(u.addColorStop(0,"#FF0000"),u.addColorStop(.17,"#FF00FF"),u.addColorStop(.33,"#0000FF"),u.addColorStop(.5,"#00FFFF"),u.addColorStop(.67,"#00FF00"),u.addColorStop(.83,"#FFFF00"),u.addColorStop(1,"#FF0000")):(u.addColorStop(0,"#FF0000"),u.addColorStop(.17,"#FFFF00"),u.addColorStop(.33,"#00FF00"),u.addColorStop(.5,"#00FFFF"),u.addColorStop(.67,"#0000FF"),u.addColorStop(.83,"#FF00FF"),u.addColorStop(1,"#FF0000")),u;default:if(f=void 0,r.length>9&&r.toLowerCase().substr(0,9)==="gradient(")return f=r.substr(9,r.length-10).split(","),o=1,n.GetProperty("IsVertical")&&(o=2),i.CreateGradient(t,f,o,cde.CBool(n.GetProperty("IsInverted")));if(r.length>10&&r.toLowerCase().substr(0,10)==="gradientc(")return f=r.substr(10,r.length-11).split(","),i.CreateGradient(t,f,0,cde.CBool(n.GetProperty("IsInverted")));r.toLowerCase()==="transparent"&&(r="rgba(0,0,0,0)")}return r},i.CreateGradient=function(n,t,i,r){var f,u;switch(i){default:f=n.createRadialGradient(n.canvas.width/2,n.canvas.height/2,1,n.canvas.width/2,n.canvas.height/2,n.canvas.height/2);break;case 1:f=n.createLinearGradient(0,0,n.canvas.width,0);break;case 2:f=n.createLinearGradient(0,0,0,n.canvas.height)}if(r)for(u=0;u<t.length;u++)f.addColorStop(u,t[u]);else for(u=0;u<t.length;u++)f.addColorStop(u,t[t.length-1-u]);return f},i}(n.TheNMIBaseControl),i,r,u,f,e,o,s,h;n.ctrlCanvasDraw=t;i=function(t){function i(n){var i=t.call(this,null,n)||this;return i.drawingTarget=null,i.mBaseDiv=null,i.mTextFld=null,i.mStrokes=[],i.mIsTextFldVisible=!1,i.mIsSynced=!1,i.mTextToggleButton=null,i.mSaveButton=null,i.mClearButton=null,i.mPlayButton=null,i.tBlack=null,i.tRed=null,i.tGreen=null,i.tYellow=null,i.tBlue=null,i.tPink=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,s,o,h;return this.MyBaseType=n.cdeControlType.TouchDraw,t.prototype.InitControl.call(this,i,r,u,f),this.MyFieldInfo&&(this.mIsSynced=cde.CBool(this.GetSetting("IsSynced"))),this.mBaseDiv=n.MyTCF.CreateBaseControl().Create(i,{TRF:this.MyTRF}),this.mBaseDiv.SetElement(document.createElement("div")),this.mBaseDiv.SetInitialSize(1),this.drawingTarget=n.MyTCF.CreateBaseControl().Create(this.mBaseDiv),this.drawingTarget.SetElement(document.createElement("div")),this.drawingTarget.GetElement().style.cursor="default",this.drawingTarget.GetElement().style.width="inherit",this.drawingTarget.GetElement().style.height="inherit",this.mBaseDiv.AppendChild(this.drawingTarget),s=this.mBaseDiv.GetElement(),s.ondragover=function(){return e.drawingTarget.GetElement().style.borderLeftWidth="5px",e.drawingTarget.GetElement().style.borderLeftColor="red",!1},s.ondragend=function(){return e.drawingTarget.GetElement().style.borderLeftWidth="0px",!1},s.ondragleave=function(){return e.drawingTarget.GetElement().style.borderLeftWidth="0px",!1},s.ondrop=function(n){n.stopPropagation();n.preventDefault();e.drawingTarget.GetElement().style.borderLeftWidth="0px";e.ProcessFiles(n.dataTransfer.files)},this.MyDrawingObject=n.MyTCF.CreateNMIControl(n.cdeControlType.CanvasDraw).Create(this.drawingTarget,{TRF:r}),this.MyDrawingObject.SetProperty("FillDistance",25),this.MyFieldInfo&&this.MyFieldInfo.Flags&&(!this.MyFieldInfo||(this.MyFieldInfo.Flags&2)==0)||(this.MyDrawingObject.SetProperty("OnPointerDown",this.MyDrawingObject.BeginPolyline),this.MyDrawingObject.SetProperty("OnPointerMove",this.MyDrawingObject.ExtendPolylineTo),this.MyDrawingObject.SetProperty("OnPointerUp",this.MyDrawingObject.EndPolyline),this.MyDrawingObject.SetProperty("OnPointerCancel",this.MyDrawingObject.EndPolyline),this.MyDrawingObject.RegisterEvent("OnDrawEnd",function(t,i,r){var u=i.Identifier;e.mStrokes.push(r);e.SetProperty("Value",JSON.stringify(e.mStrokes));e.mIsSynced&&e.MyTRF&&n.MyEngine&&n.MyEngine.GetBaseEngine().PublishCentral("NEWDRAWOBJECT:"+e.MyTRF.GetHash()+":REMOTE_"+u,JSON.stringify(r))}),this.mIsSynced&&this.RegisterSyncEvents(),o=0,this.mClearButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Clear","Style=position:absolute; right:0px;background-color:white; background-image:none; top:0px"]}),this.mClearButton.SetProperty("OnClick",function(){return e.ClearPicture(),e.SetProperty("Value",""),e.FireEvent(!1,"OnClearPicture"),e.mIsSynced&&e.MyTRF&&n.MyEngine&&n.MyEngine.GetBaseEngine().PublishCentral("CLEARCANVAS:"+e.MyTRF.GetHash()),!1}),this.mClearButton.SetProperty("TileTop",o++),this.mClearButton.SetProperty("Foreground","black"),cde.CBool(this.GetSetting("HideClear"))&&this.mClearButton.SetProperty("Visibility",!1),this.mSaveButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Save","Style=position:absolute; right:0px;background-color:white; background-image:none;"]}),this.mSaveButton.SetProperty("OnClick",function(t,i,r){var u,f=".PNG",o,s;return i.button===2||r>1||e.GetProperty("FileFormat")&&e.GetProperty("FileFormat").toString().length>0?(u=JSON.stringify(e.mStrokes),o=e.GetProperty("FileFormat"),o||(o="ink2me"),f="."+o,cde.MyContentEngine&&cde.MyContentEngine.SaveFile(u,n.DateToMini(new Date)+f,"image/png",!1)):(u=e.MyDrawingObject.GetPNG(),s=n.convertBase64ToBinary(u),cde.MyContentEngine&&cde.MyContentEngine.SaveFile(s,n.DateToMini(new Date)+f,"image/png",!1)),e.FireEvent(!1,"OnSavePicture",u),e.mIsSynced&&u.length>1&&(n.ShowToastMessage("Drawing sent to owner"),cde.MyContentEngine&&(e.MyFieldInfo?cde.MyContentEngine.PublishToNode(e.MyFieldInfo.cdeN,"CDE_FILEPUSH:IMG"+n.DateToMini(new Date)+f,u):cde.MyContentEngine.PublishToService("CDE_FILEPUSH:IMG"+n.DateToMini(new Date)+f,u))),!1}),this.mSaveButton.SetProperty("TileTop",o++),this.mSaveButton.SetProperty("Foreground","black"),this.mSaveButton.SetProperty("Visibility",this.mIsSynced),this.mPlayButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Play","Style=position:absolute; right:0px;background-color:white; background-image:none;"]}),this.mPlayButton.SetProperty("OnClick",function(){return e.MyDrawingObject.SetProperty("Playback",!0),e.MyDrawingObject.DrawCanvasBackground(),e.mIsSynced&&e.MyTRF&&n.MyEngine&&n.MyEngine.GetBaseEngine().PublishCentral("PLAYBOARD:"+e.MyTRF.GetHash()),!1}),this.mPlayButton.SetProperty("TileTop",o++),this.mPlayButton.SetProperty("Foreground","black"),cde.CBool(this.GetSetting("ShowPlay"))||this.mPlayButton.SetProperty("Visibility",!1),this.MyFieldInfo&&(this.MyFieldInfo.Flags&32)!=0||this.GetProperty("Value")&&this.GetProperty("Value").substring(0,2)!=="[{"?(this.ShowTextField(this.GetProperty("Value"),!1),this.mTextToggleButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.mBaseDiv,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Enter Text","Style=position:absolute; right:0px"]}),this.mTextToggleButton.SetProperty("OnClick",function(){return e.mIsTextFldVisible?(e.mIsTextFldVisible=!1,e.drawingTarget.SetProperty("Visibility",!0),e.mTextFld.SetProperty("Visibility",!1),e.mTextToggleButton.SetProperty("Text","Enter Text"),e.mSaveButton.SetProperty("Disabled",!1)):(e.mIsTextFldVisible=!0,e.drawingTarget.SetProperty("Visibility",!1),e.mTextFld.SetProperty("Visibility",!0),e.mTextToggleButton.SetProperty("Text","Draw"),e.mSaveButton.SetProperty("Disabled",!0)),!1}),this.mTextToggleButton.SetProperty("TileTop",2),this.mTextToggleButton.SetProperty("Foreground","black")):(this.tBlack=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Black","Style=position:absolute; right:0px; background-color:black; background-image:none;"]}),this.tBlack.SetProperty("OnClick",function(){return e.MyDrawingObject.SetProperty("Foreground","#000000"),!1}),this.tBlack.SetProperty("TileTop",o++),cde.CBool(this.GetSetting.ShowColors)||this.tBlack.SetProperty("Visibility",!1),this.tRed=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Red","Style=position:absolute; right:0px; background-color:#FF0000; background-image:none;"]}),this.tRed.SetProperty("OnClick",function(){return e.MyDrawingObject.SetProperty("Foreground","#FF0000"),!1}),this.tRed.SetProperty("TileTop",o++),cde.CBool(this.GetSetting.ShowColors)||this.tRed.SetProperty("Visibility",!1),this.tGreen=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Green","Style=position:absolute; right:0px; background-color:#00FF00; background-image:none;"]}),this.tGreen.SetProperty("OnClick",function(){return e.MyDrawingObject.SetProperty("Foreground","#00FF00"),!1}),this.tGreen.SetProperty("TileTop",o++),cde.CBool(this.GetSetting.ShowColors)||this.tGreen.SetProperty("Visibility",!1),this.tYellow=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Yellow","Style=position:absolute; right:0px; background-color:#FFFF00; background-image:none;"]}),this.tYellow.SetProperty("OnClick",function(){return e.MyDrawingObject.SetProperty("Foreground","#FFFF00"),!1}),this.tYellow.SetProperty("TileTop",o++),cde.CBool(this.GetSetting.ShowColors)||this.tYellow.SetProperty("Visibility",!1),this.tBlue=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Blue","Style=position:absolute; right:0px; background-color:#0000FF; background-image:none;"]}),this.tBlue.SetProperty("OnClick",function(){return e.MyDrawingObject.SetProperty("Foreground","#0000FF"),!1}),this.tBlue.SetProperty("TileTop",o++),cde.CBool(this.GetSetting.ShowColors)||this.tBlue.SetProperty("Visibility",!1),this.tPink=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.drawingTarget,{PostInitBag:["TileWidth=1","TileHeight=1","Text=Pink","Style=position:absolute; right:0px; background-color:#FF00FF; background-image:none;"]}),this.tPink.SetProperty("OnClick",function(){return e.MyDrawingObject.SetProperty("Foreground","#FF00FF"),!1}),this.tPink.SetProperty("TileTop",o++),cde.CBool(this.GetSetting.ShowColors)||this.tPink.SetProperty("Visibility",!1))),window.addEventListener&&window.addEventListener("resize",function(){e.ResizeEventHandler()},!1),this.SetElement(this.mBaseDiv.GetElement()),(!this.MyFieldInfo||this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0)&&this.PreventDefaultManipulationAndMouseEvent(null),this.MyFormID&&n.MyScreenManager&&(h=n.MyScreenManager.GetScreenByID(this.MyFormID),h&&h.RegisterEvent("OnLoaded",function(){return e.ResizeEventHandler()})),this.MyDrawingObject.ApplySkin(),i.RegisterEvent("OnLoaded",function(){e.ResizeEventHandler()}),!0},i.prototype.SetProperty=function(n,i){if(n==="iValue"){if(i===this.GetProperty("Value"))return;if(this.mStrokes=[],this.ClearPicture(),i&&i!=="")if(i.substring(0,2)==="[{"){if(this.MyDrawingObject){var r=void 0;try{r=JSON.parse(i);this.MyDrawingObject.SetProperty("DataContext",r)}catch(u){this.MyDrawingObject.SetProperty("DataContext",null)}}}else this.mTextFld?this.mTextFld.SetProperty("Value",i):this.ShowTextField(i,!0);else this.MyDrawingObject&&this.MyDrawingObject.SetProperty("DataContext",null)}else n==="IsSynced"?(i=cde.CBool(i),this.mIsSynced===!1&&i&&this.RegisterSyncEvents(),this.mIsSynced=i,this.mSaveButton&&this.mSaveButton.SetProperty("Visibility",this.mIsSynced)):n==="ShowSave"?this.mSaveButton.SetProperty("Visibility",cde.CBool(i)):n==="ShowPlay"?this.mPlayButton.SetProperty("Visibility",cde.CBool(i)):n==="ShowColors"?(this.tBlack.SetProperty("Visibility",cde.CBool(i)),this.tBlue.SetProperty("Visibility",cde.CBool(i)),this.tGreen.SetProperty("Visibility",cde.CBool(i)),this.tPink.SetProperty("Visibility",cde.CBool(i)),this.tRed.SetProperty("Visibility",cde.CBool(i)),this.tYellow.SetProperty("Visibility",cde.CBool(i))):n==="IsAbsolute"?cde.CBool(i)?(this.mBaseDiv.GetElement().style.position="absolute",this.drawingTarget.GetElement().style.position="absolute"):(this.mBaseDiv.GetElement().style.position="relative",this.drawingTarget.GetElement().style.position="relative"):n==="IsOverlay"&&(i=cde.CBool(i),this.tBlack.SetProperty(n,i),this.tYellow.SetProperty(n,i),this.tGreen.SetProperty(n,i),this.tRed.SetProperty(n,i),this.tBlue.SetProperty(n,i),this.tPink.SetProperty(n,i),this.mSaveButton.SetProperty(n,i),this.mPlayButton.SetProperty(n,i),this.mClearButton.SetProperty(n,i));this.MyDrawingObject&&n!=="Style"&&this.MyDrawingObject.SetProperty(n,i);t.prototype.SetProperty.call(this,n,i);n==="AutoAdjust"&&this.ResizeEventHandler()},i.prototype.GetProperty=function(n){return n==="Value"&&this.MyFieldInfo&&(this.MyFieldInfo.Flags&1)==0&&this.mIsTextFldVisible?this.mTextFld.GetProperty("Value"):t.prototype.GetProperty.call(this,n)},i.prototype.ProcessFiles=function(t){var r=this,i,u;t&&t.length&&(i=t[0],i.name.length>8&&i.name.substr(i.name.length-7,7)===".ink2me"&&(u=new FileReader,u.onload=function(){var t=u.result;r.SetProperty("iValue",t);r.mIsSynced&&r.MyTRF&&n.MyEngine&&n.MyEngine.GetBaseEngine().PublishCentral("SCREENSYNC:"+r.MyTRF.GetHash(),t)},u.readAsText(i)))},i.prototype.PostCreate=function(){var t=this;this.RegisterEvent("OnSavePicture",function(i,r){cde.MyContentEngine&&(t.MyFieldInfo?cde.MyContentEngine.PublishToNode(t.MyFieldInfo.cdeN,"CDE_FILEPUSH:IMG"+n.DateToMini(new Date)+".PNG",r):cde.MyContentEngine.PublishToService("CDE_FILEPUSH:IMG"+n.DateToMini(new Date)+".PNG",r))})},i.prototype.RegisterSyncEvents=function(){var t=this;this.RegisterIncomingMessage(n.eTheNMIEngine,function(n,i){var r=i.Message.TXT.split(":");if(r[1]===n.MyTRF.GetHash())switch(r[0]){case"CLEARCANVAS":n.MyDrawingObject.ClearPicture();break;case"NEWDRAWOBJECT":n.MyDrawingObject.AddDrawingObject(JSON.parse(i.Message.PLS),r[2]);break;case"PLAYBOARD":t.MyDrawingObject.SetProperty("Playback",!0);t.MyDrawingObject.DrawCanvasBackground();break;case"SCREENSYNC":t.SetProperty("iValue",i.Message.PLS)}})},i.prototype.AddDrawingObject=function(n,t){this.MyDrawingObject.AddDrawingObject(n,t)},i.prototype.SetMsgsAndTargetWidth=function(n){if(this.MyTarget){var t=n.offsetWidth,i=n.offsetHeight;t>0&&this.drawingTarget&&(this.drawingTarget.GetElement().style.width=t.toString()+"px");i>0&&this.drawingTarget&&(this.drawingTarget.GetElement().style.height=i.toString()+"px");this.MyDrawingObject.ApplySkin();this.MyDrawingObject.DrawCanvasBackground();this.MyDrawingObject.RequestRedraw()}},i.prototype.ClearPicture=function(){this.mTextFld&&this.mTextFld.SetProperty("Value","");this.MyDrawingObject&&this.MyDrawingObject.ClearPicture()},i.prototype.ResizeEventHandler=function(){this.mBaseDiv.GetElement().style.width="inherit";this.mBaseDiv.GetElement().style.height="inherit";this.MyDrawingObject.ApplySkin();this.SetMsgsAndTargetWidth(this.MyTarget.GetElement())},i.prototype.ShowTextField=function(t,i){if(this.mBaseDiv){var r=new n.TheFieldInfo(n.cdeControlType.TextArea,8,"");this.MyFieldInfo&&(r.Flags=this.MyFieldInfo.Flags,r.FormID=this.MyFieldInfo.FormID);this.mTextFld=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleEnded).Create(null,{TRF:new n.TheTRF("",0,r),PostInitBag:["iValue="+t]});this.mTextFld.SetProperty("Rows",10);this.mBaseDiv.AppendChild(this.mTextFld);i?this.drawingTarget.SetProperty("Visibility",!1):this.mTextFld.SetProperty("Visibility",!1)}},i.Create=function(t,i,r,u,f,e){var o=new n.ctrlTouchDraw(i);return o.InitControl(t,i),e&&o.SetProperty("iValue",e),o},i}(n.TheNMIBaseControl);n.ctrlTouchDraw=i;r=function(t){function i(n){var i=t.call(this,null,n)||this;return i.divTiles=null,i.mDrawCanvas=null,i.CurrentControl=null,i.WasTouchedDownOn=!1,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType=n.cdeControlType.DrawOverlay,t.prototype.InitControl.call(this,i,r,u,f),this.divTiles=document.createElement("div"),this.divTiles.style.position="absolute",this.divTiles.style.top="0px",this.divTiles.style.left="0px",i&&(this.divTiles.style.width=i.GetContainerElement().clientWidth-5+"px",this.divTiles.style.height=i.GetContainerElement().clientHeight-5+"px"),this.divTiles.id="cdeOverlay",this.divTiles.className="cdeDrawOverlay",this.SetElement(this.divTiles,!1),this.PreventDefault=!0,this.PreventManipulation=!0,this.PreventDefaultManipulationAndMouseEvent(null),this.mDrawCanvas=n.MyTCF.CreateNMIControl(n.cdeControlType.TouchDraw).Create(this,{TRF:this.MyTRF?this.MyTRF:new n.TheTRF("",0,this.MyFieldInfo)}),this.CurrentControl=this.mDrawCanvas,this.HookEvents(!1),!0},i.prototype.SetProperty=function(n,i){var r=this;n==="AutoAdjust"&&(t.prototype.SetProperty.call(this,n,i),window.addEventListener&&window.addEventListener("resize",function(){r.ResizeEventHandler()},!1),this.ResizeEventHandler());this.mDrawCanvas.SetProperty(n,i)},i.prototype.ResizeEventHandler=function(){var n=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;this.divTiles.style.width=n+"px";this.divTiles.style.height=t+"px"},i.Create=function(n,t,r){var u=new i(t);return u.InitControl(n,t),r&&u.SetProperty("ClassName",r),u},i}(n.TheNMIBaseControl);n.ctrlDrawOverlay=r;u=function(t){function i(n){return t.call(this,null,n)||this}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var o=this,e;return this.MyBaseType=n.cdeControlType.BarChart,t.prototype.InitControl.call(this,i,r,u,f),this.mBaseCtrl=n.MyTCF.CreateBaseControl().Create(i,{TRF:this.MyTRF}),this.mBaseCtrl.SetElement(document.createElement("div")),this.mBaseCtrl.SetInitialSize(1),this.mBaseCtrl.GetElement().style.position="relative",this.mCanvas=n.MyTCF.CreateNMIControl(n.cdeControlType.CanvasDraw).Create(this.mBaseCtrl,{TRF:r}),this.SetElement(this.mBaseCtrl.GetElement(),!0),this.MyFormID&&n.MyScreenManager&&(e=n.MyScreenManager.GetScreenByID(this.MyFormID),e&&e.RegisterEvent("OnLoaded",function(){return o.ApplySkin()})),!0},i.prototype.ApplySkin=function(){this.UpdateBar(this.GetProperty("Value"))},i.prototype.UpdateBar=function(t){this.mCanvas&&(this.mCanvas.ApplySkin(),this.mCanvas.MyHeight!==0&&this.mCanvas.MyWidth!==0||(this.mCanvas.ResizeCanvas(),this.mCanvas.MyHeight!==0&&this.mCanvas.MyWidth!==0))&&(this.tIcon=new n.TheDrawingObject,this.tIcon.Type=7,this.tIcon.Visibility=!0,this.tIcon.ComplexData=t,this.tIcon.Width=n.GetSizeFromTile(cde.CInt(this.GetProperty("TileWidth")))-8,this.tIcon.Left=4,this.tIcon.Top=4,this.mRectangle=[],this.mRectangle.push(this.tIcon),this.mCanvas.SetProperty("DataContext",this.mRectangle))},i.prototype.SetProperty=function(n,i){n==="iValue"||n==="Value"?this.UpdateBar(i):(n==="ControlTW"||n==="ControlTH"||n==="DrawMargin")&&this.mCanvas&&(i=cde.CInt(i),this.mCanvas.SetProperty(n,i));t.prototype.SetProperty.call(this,n,i)},i}(n.TheNMIBaseControl);n.ctrlHashIcon=u;f=function(t){function i(n){var i=t.call(this,null,n)||this;return i.wasDrawnOnce=!1,i.mBarColor="#52D0EB",i.mMaxValue=100,i.mMinValue=0,i.IsPointerDown=!1,i.PointerID=0,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,o;return this.MyBaseType=n.cdeControlType.BarChart,t.prototype.InitControl.call(this,i,r,u,f),this.mBarColor=cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?"rgba(82,208,235,0.9)":"rgba(29,163,209,0.9)",this.mBaseCtrl=n.MyTCF.CreateBaseControl().Create(i,{TRF:this.MyTRF}),this.mBaseCtrl.SetElement(document.createElement("div")),this.mBaseCtrl.SetInitialSize(1),this.mBaseCtrl.GetElement().className="ctrlBarChart",this.mBaseCtrl.GetElement().style.position="relative",this.mCanvas=n.MyTCF.CreateNMIControl(n.cdeControlType.CanvasDraw).Create(this.mBaseCtrl,{TRF:r}),this.SetElement(this.mBaseCtrl.GetElement(),!0),this.SetProperty("Disabled",!this.MyFieldInfo||(this.MyFieldInfo.Flags&2)==0),this.MyFormID&&n.MyScreenManager&&(o=n.MyScreenManager.GetScreenByID(this.MyFormID),o&&o.RegisterEvent("OnLoaded",function(){return e.ApplySkin()})),cde.MyBaseAssets.RegisterEvent("ThemeSwitched",function(){e.mBarColor=cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?"rgba(82,208,235,0.9)":"rgba(29,163,209,0.9)";e.UpdateBar(e.GetProperty("Value"))}),!0},i.prototype.SetProperty=function(n,i){var r=!1,u;n==="iValue"||n==="Value"?cde.IsNotSet(this.GetProperty("Format"))||(i=parseFloat(i).toFixed(parseInt(this.GetProperty("Format")))):n==="Disabled"&&(this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0||(i=!0),this.EnableDisable(cde.CBool(i)));t.prototype.SetProperty.call(this,n,i);n==="Foreground"?(u=document.createElement("span"),u.style.color=i,this.mBarColor=u.style.color,r=!0):n==="Value"||n==="iValue"?(this.FireEvent(!0,"BarChanged","SetProperty",i),r=!0):n==="MaxValue"?(this.mMaxValue=cde.CDbl(i),r=!0):n==="MinValue"?(this.mMinValue=cde.CDbl(i),r=!0):n==="MainBackground"?(this.mBaseCtrl.GetElement().style.backgroundColor=i,r=!0):n==="Background"?(cde.CInt(i)>0?(u=document.createElement("span"),u.style.color=i,this.mCanvas.SetProperty("Background",u.style.color)):this.mCanvas.SetProperty("Background",i),r=!0):n==="ForegroundOpacity"?(this.mCanvas.SetProperty("Opacity",i),r=!0):n==="LabelColor"?r=!0:n==="IsVertical"?(i=cde.CBool(i),i&&t.prototype.SetProperty.call(this,"IsVertical",i),this.mCanvas.SetProperty("IsVertical",i),r=!0):n==="IsInverted"?(i=cde.CBool(i),cde.CBool(i)&&t.prototype.SetProperty.call(this,"IsInverted",i),this.mCanvas.SetProperty("IsInverted",i),r=!0):(n==="ControlTW"||n==="ControlTH"||n==="DrawMargin"||n==="TileFactorX"||n==="TileFactorY")&&this.mCanvas?(i=cde.CInt(i),this.mCanvas.SetProperty(n,i),r=!0):n==="BarColorChanged"&&this.RegisterEvent(n,i);r&&this.UpdateBar(this.GetProperty("Value"))},i.prototype.ApplySkin=function(){this.UpdateBar(this.GetProperty("Value"))},i.prototype.UpdateBar=function(t){this.mCanvas&&(this.mCanvas.ApplySkin(),this.mCanvas.MyHeight!==0&&this.mCanvas.MyWidth!==0||(this.mCanvas.ResizeCanvas(),this.mCanvas.MyHeight!==0&&this.mCanvas.MyWidth!==0))&&(this.wasDrawnOnce=!0,this.tText=new n.TheDrawingObject,this.tText.Type=3,this.tText.Visibility=!0,this.tRect=new n.TheDrawingObject,this.tRect.Type=1,this.GetProperty("IsVertical")===!0?(this.tRect.Left=0,this.tText.Left=12,this.tRect.Width=this.mCanvas.MyWidth,this.GetProperty("IsInverted")===!0?(this.tRect.Top=0,this.tRect.Height=this.mCanvas.MyHeight/(this.mMaxValue-this.mMinValue)*(parseFloat(t)-this.mMinValue),this.tText.Top=this.tRect.Height+12):(this.tRect.Top=this.mCanvas.MyHeight-this.mCanvas.MyHeight/(this.mMaxValue-this.mMinValue)*(parseFloat(t)-this.mMinValue),this.tRect.Height=this.mCanvas.MyHeight,this.tText.Top=this.tRect.Top-12),this.tRect.Fill=this.mBarColor):(this.tRect.Top=0,this.tText.Top=12,this.GetProperty("IsInverted")===!0?(this.tRect.Left=this.mCanvas.MyWidth-this.mCanvas.MyWidth/(this.mMaxValue-this.mMinValue)*(cde.CDbl(t)-this.mMinValue),this.tRect.Width=this.mCanvas.MyWidth,this.tText.Left=this.tRect.Left+12):(this.tRect.Left=0,this.tRect.Width=this.mCanvas.MyWidth/(this.mMaxValue-this.mMinValue)*(cde.CDbl(t)-this.mMinValue),this.tText.Left=this.tRect.Width+12),this.tRect.Height=this.mCanvas.MyHeight,this.tRect.Fill=this.mBarColor),cde.CBool(this.GetProperty("AutoAdjust"))&&(cde.CDbl(t)>this.mMaxValue&&(this.mMaxValue=parseFloat(t)),cde.CDbl(t)<this.mMinValue&&(this.mMinValue=parseFloat(t))),this.tRect.Visibility=!0,this.tRect.IsTemp=!0,this.mRectangle=[],this.mRectangle.push(this.tRect),this.tText.ComplexData={},this.tText.ComplexData.Text=cde.CDbl(t).toFixed(0),this.tText.ComplexData.Font="8pt Roboto",this.tText.Fill=this.GetProperty("LabelColor")?this.GetProperty("LabelColor"):"black",this.tText.IsTemp=!0,this.mRectangle.push(this.tText),this.mCanvas.SetProperty("DataContext",this.mRectangle))},i.prototype.CreateClip=function(n){var t=n.getContext("2d");t.beginPath();t.moveTo(10,10);t.lineTo(100,30);t.lineTo(180,10);t.lineTo(200,60);t.arcTo(222,70,120,0,10);t.lineTo(200,180);t.lineTo(100,150);t.lineTo(70,180);t.lineTo(20,130);t.lineTo(50,70);t.closePath();t.clip()},i.prototype.EnableDisable=function(n){var t=this;n?(this.UnregisterEvent("PointerDown"),this.UnregisterEvent("PointerMove"),this.UnregisterEvent("PointerUp"),this.UnregisterEvent("PointerCancel"),this.PreventManipulation=!1,this.PreventDefault=!1):(this.RegisterEvent("PointerDown",function(n,i,r){t.sinkPointerDown(n,i,r)}),this.RegisterEvent("PointerMove",function(n,i,r){t.sinkTranslate(n,i,r)}),this.RegisterEvent("PointerUp",function(n,i,r){t.sinkPointerUp(n,i,r)}),this.RegisterEvent("PointerCancel",function(n,i,r){t.sinkPointerCancel(n,i,r)}),this.PreventManipulation=!0,this.PreventDefault=!0);this.PreventDefaultManipulationAndMouseEvent(null)},i.prototype.sinkPointerCancel=function(t,i,r){if(this.GetProperty("Disabled")!==!0){var u=t;cde.CBool(u.GetProperty("AllowSetOnCancel"))&&(r.pointerType!==n.cdeInputEventType.MOUSE||n.IsMouseDown)?u.sinkPointerUp(t,i,r):u.UpdateBar(u.GetProperty("Value"))}},i.prototype.sinkPointerUp=function(t,i,r){if(t.GetProperty("Disabled")!==!0){var u=t;u.IsPointerDown=!1;u.PointerID=0;r.pointerEvent===n.cdeInputEvent.END&&u.CalcNewPos(r.AdjPosition.x,r.AdjPosition.y,1)}},i.prototype.sinkPointerDown=function(n,t,i){if(n.GetProperty("Disabled")!==!0){var r=n;r.IsPointerDown||r.GetProperty("Disabled")===!0||(r.IsPointerDown=!0,r.PointerID=i.Identifier,r.CalcNewPos(i.AdjPosition.x,i.AdjPosition.y,0))}},i.prototype.sinkTranslate=function(n,t,i){if(n.GetProperty("Disabled")!==!0){var r=n,u=r.GetProperty("TouchPoints");u>1?r.CalcNewPos(i.AdjPosition.x,i.AdjPosition.y,2):r.CalcNewPos(i.AdjPosition.x,i.AdjPosition.y,0)}},i.prototype.CalcNewPos=function(t,i,r){var f,u,o;if(this.mCanvas&&(this.mCanvas.MyHeight!==0&&this.mCanvas.MyWidth!==0||(this.mCanvas.ResizeCanvas(),this.mCanvas.MyHeight!==0&&this.mCanvas.MyWidth!==0))&&(f=this.GetProperty("Value"),u=this.GetProperty("IsVertical")===!0?this.GetProperty("IsInverted")!==!0?(this.mCanvas.MyHeight-i)*((this.mMaxValue-this.mMinValue)/this.mCanvas.MyHeight)+this.mMinValue:i*((this.mMaxValue-this.mMinValue)/this.mCanvas.MyHeight)+this.mMinValue:this.GetProperty("IsInverted")!==!0?t*((this.mMaxValue-this.mMinValue)/this.mCanvas.MyWidth)+this.mMinValue:(this.mCanvas.MyWidth-t)*((this.mMaxValue-this.mMinValue)/this.mCanvas.MyWidth)+this.mMinValue,cde.CBool(this.GetProperty("UseFloat"))||(u=Math.round(u)),f!==u&&u!==-1))if(r>0){if((r===1||Math.abs(u-f)>10)&&(this.SetProperty("Value",u),this.FireEvent(!1,"ValueSet",{x:t,y:i}),this.MyFieldInfo&&cde.CBool(this.GetProperty("SendColor"))===!0)){var s=this.mCanvas.GetBGRenderContext(),e=s.getImageData(t,i,1,1).data,h="rgb("+e[0]+","+e[1]+","+e[2]+")";this.FireEvent(!1,"BarColorChanged",this.rgbToHex(h))}r===1&&(o=new n.TheMaterialTouch,o.ShowWave(this.GetElement(),{x:t,y:i}))}else this.FireEvent(!0,"BarChanged","CalcNewPos",u),this.UpdateBar(u)},i.prototype.hexToRgb=function(n){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(n);return"rgb("+parseInt(t[1],16)+","+parseInt(t[2],16)+","+parseInt(t[3],16)+")"},i.prototype.rgbToHex=function(n){function i(n){var t=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];return isNaN(n)?"00":t[(n-n%16)/16]+t[n%16]}var t=n.match(/\d+/g);return"#"+i(t[0])+i(t[1])+i(t[2])},i.Create=function(n,t){var r=new i(t);return r.InitControl(n,t),r},i}(n.TheNMIBaseControl);n.ctrlBarChart=f;e=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mCanvas=null,i.LastMiniValue=0,i.mBaseCtrl=null,i.mDebugLabel=null,i.mDebugLabel2=null,i.mRangeSet="",i.mAllowRollover=!1,i.mAllowOffBelowMin=!1,i.mMinVal=0,i.mMaxVal=1e3,i.mSnapper=0,i.mRoundTo=1,i.mStepFactor=10,i.mLines=15,i.mLineWidth=10,i.mLineGap=40,i.mIsVertical=!1,i.mIsInverted=!1,i.mReturnDeltaOnly=!1,i.mLineColor="black",i.Is10x=!1,i.TranslateSpeed=1,i.IsPointerDown=!1,i.LastMousePositionX=0,i.LastMousePositionY=0,i.ScrollValueTemp=0,i.mLastScrollValue=0,i.PointerID=0,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var o=this,e;return this.MyBaseType=n.cdeControlType.Slider,t.prototype.InitControl.call(this,i,r,u,f),this.mBaseCtrl=n.MyTCF.CreateBaseControl().Create(i,{TRF:this.MyTRF}),this.mBaseCtrl.SetElement(document.createElement("div")),this.mBaseCtrl.SetInitialSize(1),this.mBaseCtrl.GetElement().className="ctrlEndlessSlider",this.mBaseCtrl.GetElement().style.position="relative",this.mCanvas=n.MyTCF.CreateNMIControl(n.cdeControlType.CanvasDraw).Create(this.mBaseCtrl,{TRF:r}),this.SetProperty("iValue",0),this.CreateLines(),this.SetElement(this.mBaseCtrl.GetElement(),!0),this.SetProperty("Disabled",!this.MyFieldInfo||(this.MyFieldInfo.Flags&2)==0),this.MyFormID&&n.MyScreenManager&&(e=n.MyScreenManager.GetScreenByID(this.MyFormID),e&&e.RegisterEvent("OnLoaded",function(){return o.ApplySkin()})),!0},i.prototype.SetProperty=function(n,i){n==="Disabled"&&(this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0||(i=!0),this.EnableDisable(cde.CBool(i)));t.prototype.SetProperty.call(this,n,i);var r=!0;n==="Foreground"?this.mLineColor=i:n==="iValue"?(this.mLastScrollValue=cde.CDbl(i)/this.mStepFactor,t.prototype.SetProperty.call(this,"iValue",cde.CDbl(i)),r=!1,this.CreateLines(),this.RepositionLines()):n==="Value"?(t.prototype.SetProperty.call(this,"iValue",cde.CDbl(i)),this.ScrollValueTemp=cde.CDbl(i)/this.mStepFactor,this.internalValueChanged(this.ScrollValueTemp,!0),this.mLastScrollValue=this.ScrollValueTemp,r=!1,this.IsDirty=!0):n==="MaxValue"?(this.mMaxVal=cde.CDbl(i),r=!1):n==="MinValue"?(this.mMinVal=cde.CDbl(i),r=!1):n==="StepFactor"?(this.mStepFactor=cde.CDbl(i),r=!1):n==="AllowRollover"?(this.mAllowRollover=cde.CBool(i),r=!1):n==="IsVertical"?this.mIsVertical=cde.CBool(i):n==="Background"?(this.mCanvas.SetProperty("Background",i),this.mCanvas.RequestRedraw()):n==="MainBackground"?(this.mBaseCtrl.GetElement().style.backgroundColor=i,this.mCanvas.RequestRedraw()):n==="LineWidth"?this.mLineWidth=cde.CInt(i):n==="LineGap"?this.mLineGap=cde.CInt(i):(n==="ControlTW"||n==="ControlTH")&&this.mCanvas&&(this.mCanvas.SetProperty(n,cde.CInt(i)),r=!0);r&&this.ApplySkin()},i.prototype.ApplySkin=function(){this.CreateLines();this.RepositionLines()},i.prototype.EnableDisable=function(n){n?(this.UnregisterEvent("PointerDown"),this.UnregisterEvent("PointerMove"),this.UnregisterEvent("PointerUp"),this.PreventManipulation=!1,this.PreventDefault=!1):(this.RegisterEvent("PointerDown",this.sinkPointerDown),this.RegisterEvent("PointerMove",this.sinkTranslate),this.RegisterEvent("PointerUp",this.sinkPointerUp),this.PreventManipulation=!0,this.PreventDefault=!0);this.PreventDefaultManipulationAndMouseEvent(null)},i.prototype.sinkPointerUp=function(n){var t=n;t.IsPointerDown=!1;t.PointerID=0;t.OnJumpBack()},i.prototype.sinkPointerDown=function(n,t,i){var r=n;r.IsPointerDown||r.GetProperty("Disabled")===!0||(r.LastMousePositionX=i.AdjPosition.x,r.LastMousePositionY=i.AdjPosition.y,r.IsPointerDown=!0,r.PointerID=i.Identifier)},i.prototype.sinkTranslate=function(n,t,i){var r=n,u=r.TranslateSpeed,f=r.GetProperty("TouchPoints");r.MyFieldInfo&&(r.MyFieldInfo.Flags&2)==0||(f>1&&(u*=5*f),r.IsPointerDown&&i.Identifier===r.PointerID&&r.mCanvas&&(r.mIsVertical?r.internalValueChanged(r.mLastScrollValue+(r.LastMousePositionY-i.AdjPosition.y)*(r.Is10x?u*10:u)/r.mCanvas.MyHeight,!0):r.internalValueChanged(r.mLastScrollValue-(r.LastMousePositionX-i.AdjPosition.x)*(r.Is10x?u*10:u)/r.mCanvas.MyWidth,!0),r.mReturnDeltaOnly||(r.mLastScrollValue=r.ScrollValueTemp),r.LastMousePositionX=i.AdjPosition.x,r.LastMousePositionY=i.AdjPosition.y))},i.prototype.internalValueChanged=function(n,t){var f=this.mRoundTo,o=this.mStepFactor,u=n*o,s=this.mSnapper,r,e,h,i,c;if(this.mRangeSet)for(r=0;r<this.mRangeThreshhold.length;r++)u>this.mRangeThreshhold[r]&&(this.TranslateSpeed=this.mRangeSpeed[r],f=this.mRangeRounder[r],s=this.mRangeSnapper[r]);return s>0&&this.LastMiniValue>0&&(e=Math.floor(this.LastMiniValue*1e3),h=Math.floor(s*1e3),e%h<5&&Math.abs(n-this.ScrollValueTemp)<.003)?(this.RepositionLines(),this.LastMiniValue):(f>0&&(e=Math.floor(u/f),u=e*f),i=u,this.mAllowRollover?(c=this.mMaxVal-this.mMinVal,i=u-this.mMinVal,i%=c,i<0&&(i=this.mMaxVal+i),i>this.mMaxVal&&(i-=this.mMaxVal),i+=this.mMinVal):(i<this.mMinVal&&(i=this.mAllowOffBelowMin&&this.mLastScrollValue>=0?this.mLastScrollValue===0&&n>0?this.mMinVal:0:this.mMinVal,n=i/o,this.mLastScrollValue=n),i>this.mMaxVal&&(i=this.mMaxVal,n=i/o,this.mLastScrollValue=n)),this.LastMiniValue=i,isNaN(this.ScrollValueTemp)&&(this.ScrollValueTemp=n),this.SetProperty("iValue",i),t&&(this.FireEvent(!1,"OniValueChanged","iValChanged",i),this.FireEvent(!0,"BarChanged","iValChanged",i)),this.ScrollValueTemp=n,i)},i.prototype.OnJumpBack=function(){this.SetProperty("iValue",this.LastMiniValue);this.IsDirty=!0;this.FireEvent(!0,"OnValueChanged","OnJumpBack",this.LastMiniValue,this.MyTRF);this.mReturnDeltaOnly||(this.mLastScrollValue=this.ScrollValueTemp)},i.prototype.CreateLines=function(){var i,t;if(this.mCanvas)for(this.mCanvas.ApplySkin(),this.mLines=this.mIsVertical?this.mCanvas.MyHeight/this.mLineGap:this.mCanvas.MyWidth/this.mLineGap,this.mGripLines=[],i=0;i<this.mLines;i++)t=new n.TheDrawingObject,t.Type=1,t.StrokeThickness=0,t.Fill=this.mLineColor,t.Width=this.mLineWidth,t.Height=this.mCanvas.MyHeight,t.Left=0,t.Top=0,t.IsTemp=!0,this.mIsVertical&&(t.Width=this.mCanvas.MyWidth,t.Height=this.mLineWidth),this.mGripLines.push(t)},i.prototype.RepositionLines=function(){var t,i,r;if(this.mCanvas&&this.mGripLines){for(t=0;t<this.mGripLines.length;t++)i=void 0,i=this.mIsVertical?this.ScrollValueTemp/(this.Is10x?this.TranslateSpeed*10:this.TranslateSpeed)*this.mCanvas.MyHeight*.9%this.mLineGap+t*this.mLineGap:this.ScrollValueTemp/(this.Is10x?this.TranslateSpeed*10:this.TranslateSpeed)*this.mCanvas.MyWidth*.9%this.mLineGap+t*this.mLineGap,r=this.mCanvas.MyWidth,this.mIsVertical&&(r=this.mCanvas.MyHeight),i>=0&&i<r?(this.mIsVertical?this.mGripLines[t].Top=this.mIsInverted?i:this.mCanvas.MyHeight-i:this.mGripLines[t].Left=i,this.mGripLines[t].Visibility=!0):this.mGripLines[t].Visibility=!1;this.tText=new n.TheDrawingObject(12,12);this.tText.Type=3;this.tText.Visibility=!0;this.tText.ComplexData={};this.tText.ComplexData.Text=cde.CDbl(this.LastMiniValue).toFixed(0);this.tText.ComplexData.Font="8pt Roboto";this.tText.Fill=this.GetProperty("LabelColor")?this.GetProperty("LabelColor"):"black";this.tText.IsTemp=!0;this.mGripLines.push(this.tText);this.mCanvas.SetProperty("DataContext",this.mGripLines)}},i}(n.TheNMIBaseControl);n.ctrlEndlessSlider=e;o=function(t){function i(n){return t.call(this,null,n)||this}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,o;return this.MyBaseType=n.cdeControlType.Shape,t.prototype.InitControl.call(this,i,r,u,f),this.mBaseCtrl=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup),this.mBaseCtrl.InitControl(i,this.MyTRF),this.mBaseCtrl.SetInitialSize(1),this.mBaseCtrl.SetProperty("ClassName","ctrlShape"),this.mBaseCtrl.SetProperty("Style","position:relative;background-color:transparent"),this.mCanvas=n.MyTCF.CreateNMIControl(n.cdeControlType.CanvasDraw),this.mCanvas.SetProperty("NoBackBuffer",!0),this.mCanvas.InitControl(this.mBaseCtrl),(!this.MyFieldInfo||this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0)&&(this.mCanvas.SetProperty("OnPointerDown",function(n,t,i){e.SendPointer(n,t,i)}),cde.CBool(this.GetProperty("EnableMouseMove"))&&this.mCanvas.SetProperty("OnPointerMove",function(n,t,i){e.SendPointer(n,t,i)}),this.mCanvas.SetProperty("OnPointerUp",function(n,t,i){e.SendPointer(n,t,i)}),this.mCanvas.SetProperty("OnPointerCancel",function(n,t,i){e.SendPointer(n,t,i)}),this.mCanvas.SetProperty("OnKeyUp",function(n){e.SendKey(n)}),this.mCanvas.SetProperty("OnKeyDown",function(n){e.SendKey(n)})),this.SetElement(this.mBaseCtrl.GetElement()),this.MyFormID&&n.MyScreenManager&&(o=n.MyScreenManager.GetScreenByID(this.MyFormID),o&&o.RegisterEvent("OnLoaded",function(){return e.ApplySkin()})),!0},i.prototype.SetProperty=function(n,i){var f=this,r,u;n==="Background"?this.mCanvas.SetProperty(n,i):n==="AddShape"||n==="DrawShapes"||n==="DrawShape"||n==="AllowMoveWithoutDown"||n==="Playback"||n==="NoClear"?this.mCanvas.SetProperty(n,i):n==="SetShape"||n==="Value"||n==="iValue"?this.mCanvas.SetProperty("SetShape",i):n==="EnableMouseMove"?cde.CBool(i)?this.mCanvas.SetProperty("OnPointerMove",function(n,t,i){f.SendPointer(n,t,i)}):this.mCanvas.SetProperty("OnPointerMove",null):n==="YRatio"&&this.mBaseCtrl?(r=this.mBaseCtrl.GetElement(),r.style.width!=="inherit"&&(u=cde.CDbl(r.style.width.substr(0,r.style.width.length-2))/cde.CDbl(i),r.style.height=u+"px",r.style.maxHeight=u+"px"),this.mCanvas.SetProperty(n,i)):(n==="ControlTW"||n==="ControlTH"||n==="DataContext"||n==="CanvasWidth"||n==="CanvasHeight"||n==="TileFactorX"||n==="TileFactorY")&&this.mCanvas&&this.mCanvas.SetProperty(n,i);t.prototype.SetProperty.call(this,n,i)},i.prototype.ApplySkin=function(){this.mCanvas.ApplySkin();this.GetProperty("Value")&&this.SetProperty("iValue",this.GetProperty("Value"))},i.prototype.SendKey=function(t){var i,r;cde.CBool(this.GetProperty("SendPointer"))&&(i=n.eTheNMIEngine,this.GetProperty("EngineName")&&(i=this.GetProperty("EngineName")),r=new n.TheKey(t),cde.MyBaseAssets.MyEngines[i]&&(this.MyFieldInfo?cde.MyBaseAssets.MyEngines[i].PublishToNode(this.MyFieldInfo.cdeN,"UPDATE_KEY:"+this.GetProperty("MyThing"),JSON.stringify(r)):cde.MyBaseAssets.MyEngines[i].PublishToService("UPDATE_KEY:"+this.GetProperty("MyThing"),JSON.stringify(r))))},i.prototype.SendPointer=function(t,i,r){if(cde.CBool(this.GetProperty("SendPointer"))){this.mCanvas.GetElement().setAttribute("tabindex","0");this.mCanvas.GetElement().focus();var u=n.eTheNMIEngine;this.GetProperty("EngineName")&&(u=this.GetProperty("EngineName"));r.AdjPosition.x*=this.mCanvas.WidthRatio;r.AdjPosition.y*=this.mCanvas.HeightRatio;cde.MyBaseAssets.MyEngines[u]&&(this.MyFieldInfo?cde.MyBaseAssets.MyEngines[u].PublishToNode(this.MyFieldInfo.cdeN,"UPDATE_POINTER:"+this.GetProperty("MyThing"),JSON.stringify(r)):cde.MyBaseAssets.MyEngines[u].PublishToService("UPDATE_POINTER:"+this.GetProperty("MyThing"),JSON.stringify(r)))}},i}(n.TheNMIBaseControl);n.ctrlShape=o;s=function(i){function r(){var n=i.call(this,null,null)||this;return n.containerTileGroup=null,n.canvas=null,n.context=null,n.tempValue=0,n}return __extends(r,i),r.prototype.InitControl=function(t,r,u,f){var h=this,e,o,s;return i.prototype.InitControl.call(this,t,r,u,f),this.containerTileGroup=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(t),e=cde.CInt(this.GetProperty("MaxValue")),e===cde.CInt(this.GetProperty("MinValue"))&&(e=100),this.SetProperty("MaxValue",e),this.GetProperty("MainBackground")&&this.containerTileGroup.SetProperty("Background",this.GetProperty("MainBackground")),this.canvas=document.createElement("canvas"),this.containerTileGroup.GetElement().appendChild(this.canvas),o=cde.CInt(this.GetSetting("ControlTW")),s=cde.CInt(this.GetSetting("ControlTH")),this.canvas.width=0,this.canvas.height=0,this.context=this.canvas.getContext("2d"),o>0&&(this.containerTileGroup.SetProperty("TileWidth",o),this.canvas.width=n.GetSizeFromTile(this.containerTileGroup.GetProperty("TileWidth"))),s>0&&(this.containerTileGroup.SetProperty("TileHeight",s),this.canvas.height=n.GetSizeFromTile(this.containerTileGroup.GetProperty("TileHeight"))),cde.MyBaseAssets.RegisterEvent("ThemeSwitched",function(){h.DoRedraw()}),this.DoRedraw(),this.AnimateFrame(!0),i.prototype.SetElement.call(this,this.containerTileGroup.GetElement()),!0},r.prototype.SetProperty=function(t,r){i.prototype.SetProperty.call(this,t,r);var u=!1;if(t==="MainBackground"){if(!this.containerTileGroup)return;this.containerTileGroup.SetProperty("Background",r)}else t==="Background"?u=!0:t==="ControlTW"&&this.context?(this.containerTileGroup.SetProperty("TileWidth",r),this.canvas.width=n.GetSizeFromTile(this.containerTileGroup.GetProperty("TileWidth")),u=!0):t==="ControlTH"&&this.context?(this.containerTileGroup.SetProperty("TileHeight",r),this.canvas.height=n.GetSizeFromTile(this.containerTileGroup.GetProperty("TileHeight")),u=!0):t==="StartAngle"||t==="EndAngle"?u=!0:t==="PlotBand"&&(this.myPlotBand=JSON.parse(r),u=!0);(t==="iValue"||t==="Value")&&(this.savedInt=r,u=!0);(t==="MaxValue"||t==="MinValue"||t==="Foreground")&&(u=!0);u&&this.context&&this.AnimateFrame(!0)},r.prototype.DoRedraw=function(){var u,c,f,h,k,p,a,w,i,v,it,d,b,rt,g,ut;if(this.context&&this.canvas.width!==0&&this.canvas.height!==0){this.context.clearRect(0,0,this.canvas.width,this.canvas.height);u=this.canvas.width/7;c=this.canvas.width/2-u;this.canvas.height<this.canvas.width&&(u=this.canvas.height/7,c=this.canvas.height/2-u);this.context.beginPath();this.context.textAlign="center";this.context.strokeStyle=this.GetProperty("Foreground");var nt=cde.CInt(this.GetProperty("UpperLimit")),tt=cde.CInt(this.GetProperty("LowerLimit")),y=cde.CInt(this.GetProperty("MaxValue")),l=cde.CInt(this.GetProperty("MinValue")),o=this.canvas.width/2,s=this.canvas.height/2,e=cde.CBool(this.GetProperty("IsInverted")),r=cde.CInt(this.GetProperty("StartAngle"))-90;if(r<0&&(r+=360),f=360,this.GetProperty("EndAngle")&&(f=cde.CInt(this.GetProperty("EndAngle"))),e?(h=f-r,h<0&&(h+=360)):(h=f+r,h>360&&(h-=360)),k=n.cdeMinMax(this.tempValue,l,y,f,0),p=Math.PI/180*r,this.context.beginPath(),this.context.arc(o,s,c,p,h*(Math.PI/180),e),this.context.lineWidth=u,this.context.strokeStyle=this.GetProperty("Background")?t.ProcessColor(this,this.context,this.GetProperty("Background")):cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?"rgba(80, 80, 80, 0.1)":"rgba(80, 80, 80, 0.5)",this.context.stroke(),a=0,a=e?Math.PI/180*(k+r):Math.PI/180*(f-k+r),w=this.GetProperty("Foreground")?t.ProcessColor(this,this.context,this.GetProperty("Foreground")):cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?"rgba(82,208,235,0.9)":"rgba(29,163,209,0.9)",this.context.beginPath(),this.context.arc(o,s,c,p,a,e),this.context.lineWidth=u,this.context.strokeStyle=w,this.context.stroke(),i=this.context,v=i.createLinearGradient(o,s,this.canvas.width,this.canvas.height/2),v.addColorStop(.2,"rgba(255,50,50,0.302)"),v.addColorStop(.6,"rgba(255,0,0,.549)"),v.addColorStop(.6,"rgba(255,0,0,1.0)"),nt>l&&(it=n.cdeMinMax(nt,y,l,f,0),i.beginPath(),i.lineWidth=u,i.strokeStyle=v,i.arc(o,s,c,(it+r)*(Math.PI/180),h*(Math.PI/180),e),i.stroke()),tt>l&&(d=n.cdeMinMax(tt,y,l,f,0),i.beginPath(),i.lineWidth=u,i.strokeStyle=v,a=e?Math.PI/180*(f-d+r):Math.PI/180*(d+r),i.arc(o,s,c,p,a,e),i.stroke()),this.myPlotBand)for(b in this.myPlotBand)rt=n.cdeMinMax(this.myPlotBand[b].from,y,l,f,0),g=n.cdeMinMax(this.myPlotBand[b].to,y,l,f,0),i.beginPath(),i.lineWidth=u*.4,i.strokeStyle=this.myPlotBand[b].color,a=e?Math.PI/180*(f-g+r):Math.PI/180*(g+r),i.arc(o,s,c*.88,Math.PI/180*(rt+r),a,e),i.stroke();this.context.font=u+"pt Roboto";this.context.fillStyle=this.GetProperty("Foreground")?this.GetProperty("Foreground"):w;ut=cde.CBool(this.GetProperty("DontAnimate"))===!1?this.GetProperty("Format")?this.tempValue.toFixed(cde.CInt(this.GetProperty("Format"))):Math.floor(this.tempValue).toString():this.GetProperty("Format")?cde.CDbl(this.GetProperty("Value")).toFixed(cde.CInt(this.GetProperty("Format"))):Math.floor(cde.CDbl(this.GetProperty("Value"))).toString();this.context.fillText(ut,o,s+u/2);this.GetProperty("SubTitle")&&(i.font="16pt Roboto",i.fillStyle=w,i.fillText(this.GetProperty("SubTitle"),o,s+u*2))}},r.prototype.AnimateFrame=function(n){var i=this,t;if(this.myframe=requestAnimationFrame(function(){i.AnimateFrame(!1)}),cde.CBool(this.GetProperty("DontAnimate"))===!0){cancelAnimationFrame(this.myframe);this.tempValue=cde.CDbl(this.GetProperty("Value"));this.DoRedraw();return}cde.CDbl(this.GetProperty("Value"))<this.tempValue?(t=(this.tempValue-cde.CDbl(this.GetProperty("Value")))/20,this.tempValue-=t,!n&&(cde.CDbl(this.GetProperty("Value"))>this.tempValue||Math.abs(t)<.001)&&(cancelAnimationFrame(this.myframe),this.tempValue=cde.CDbl(this.GetProperty("Value")))):(t=(cde.CDbl(this.GetProperty("Value"))-this.tempValue)/20,this.tempValue+=t,!n&&(cde.CDbl(this.GetProperty("Value"))<this.tempValue||Math.abs(t)<.001)&&(cancelAnimationFrame(this.myframe),this.tempValue=cde.CDbl(this.GetProperty("Value"))));this.DoRedraw()},r}(n.TheNMIBaseControl);n.ctrlCircularGauge2=s;h=function(i){function r(){var n=i.call(this,null,null)||this;return n.GaugeShell=null,n.tempValue=0,n.whiteRGBA="rgba(255,255,255,0.5)",n.blackRGBA="rgba(0,0,0,0.5)",n.darkslategrayRGBA="rgba(47,79,79,.5)",n.mBackground="rgba(80,80,80,0.5)",n.mycanvas=null,n.mycontext=null,n.startAngle=0,n.endAngle=0,n.counterClockwise=!1,n.mWidth=0,n.mHeight=0,n}return __extends(r,i),r.prototype.InitControl=function(t,r,u,f){var o=this,e;return i.prototype.InitControl.call(this,t,r,u,f),this.GaugeShell=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(t),this.GaugeShell.GetElement().style.width="inherit",this.GaugeShell.GetElement().style.height="inherit",this.mycanvas=document.createElement("Canvas"),this.GaugeShell.GetElement().appendChild(this.mycanvas),this.mycontext=this.mycanvas.getContext("2d"),cde.CInt(this.GetProperty("MaxValue"))===0&&this.SetProperty("MaxValue",100),this.startAngle=1*Math.PI,this.endAngle=0*Math.PI,this.counterClockwise=!1,this.SetElement(this.GaugeShell.GetElement()),this.AnimateFrame(!0),n.MyScreenManager&&(e=n.MyScreenManager.GetScreenByID(this.MyFieldInfo.FormID),e&&e.RegisterEvent("OnLoaded",function(){return o.ApplySkin()})),cde.MyBaseAssets.RegisterEvent("ThemeSwitched",function(){o.DoRender()}),!0},r.prototype.SetProperty=function(n,t){i.prototype.SetProperty.call(this,n,t);var r=!1;n==="Value"||n==="iValue"||n==="Foreground"||n==="Title"||n==="SubTitle"?r=!0:n==="MainBackground"&&this.GaugeShell?this.GaugeShell.SetProperty("Background",t):n==="Background"&&this.GaugeShell?(this.mBackground=t,this.IsDirty=!0):n==="Title"?r=!0:(n==="SubTitle"||n==="LowerLimit"||n==="UpperLimit")&&(r=!0);r&&this.AnimateFrame(!0)},r.prototype.ApplySkin=function(){this.GaugeShell.GetElement()&&(this.mWidth=this.GaugeShell.GetElement().clientWidth,this.mycanvas.width=this.mWidth,this.mHeight=this.GaugeShell.GetElement().clientHeight,this.mycanvas.height=this.mHeight,this.mHeight>0&&this.mWidth>0&&this.AnimateFrame(!0))},r.prototype.DoRender=function(){var p,s,o,h,v,w,b,k,d,y;if(this.mycanvas&&this.mWidth!==0&&this.mHeight!==0){var i=this.mycontext,c=this.mycanvas,u=this.mycanvas.width/2,r=this.mycanvas.height-16,e=u-r*.2;i.clearRect(0,0,c.width,c.height);this.GetProperty("Background")||(this.mBackground=cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?"rgba(80, 80, 80, 0.1)":"rgba(80, 80, 80, 0.5)");i.beginPath();i.arc(u,r,e,this.startAngle,this.endAngle,this.counterClockwise);i.lineWidth=r*.01;i.strokeStyle=this.mBackground;i.fillStyle=this.mBackground;i.stroke();p=this.GetProperty("Foreground");p||(p=cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?"rgba(82,208,235,0.9)":"rgba(29,163,209,0.9)");var l=cde.CInt(this.GetProperty("UpperLimit")),a=cde.CInt(this.GetProperty("LowerLimit")),f=cde.CDbl(this.tempValue);cde.CBool(this.GetProperty("UseFloat"))||(f=Math.floor(f));s=cde.CInt(this.GetProperty("MaxValue"));o=cde.CInt(this.GetProperty("MinValue"));f>s&&(f=s);i.clearRect(0,c.height-12,c.width,12);h=n.cdeMinMax(f,s,o,180,0);h<0&&(h=0);i.beginPath();i.arc(u,r,e,this.startAngle,this.startAngle+h*(Math.PI/180),this.counterClockwise);i.lineWidth=r*.15;i.strokeStyle=p;i.stroke();v=i.createLinearGradient(u,r,c.width,c.height/2);v.addColorStop(.2,"rgba(255,50,50,0.302)");v.addColorStop(.6,"rgba(255,0,0,.549)");v.addColorStop(.6,"rgba(255,0,0,1.0)");w=this.GetProperty("LabelForeground")?t.ProcessColor(this,i,this.GetProperty("LabelForeground")):cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme?"rgba(29,163,209,0.9)":"rgba(82,208,235,0.9)";this.GetProperty("Title")&&cde.CBool(this.GetProperty("NoTE"))&&(i.font="16pt Roboto",i.fillStyle=w,i.fillText(this.GetProperty("Title"),u-i.measureText(this.GetProperty("Title")).width/2,18));this.GetProperty("SubTitle")&&(i.font="16pt Roboto",i.fillStyle=w,i.fillText(this.GetProperty("SubTitle"),u-i.measureText(this.GetProperty("SubTitle")).width/2,r+10));l>o&&(b=n.cdeMinMax(l,s,o,180,0),f>l&&(i.beginPath(),i.lineWidth=10,i.strokeStyle=v,i.arc(u,r,e*.9,this.startAngle+b*(Math.PI/180),this.startAngle+h*(Math.PI/180),this.counterClockwise),i.stroke()),i.font="10pt Roboto",i.fillStyle="rgb(255,192,0)",i.fillText(l.toString(),u*1.2,r*.95),i.beginPath(),i.arc(u,r,e-3,this.startAngle+(b-1)*(Math.PI/180),this.startAngle+(b+1)*(Math.PI/180),this.counterClockwise),i.lineWidth=r*.2,i.strokeStyle="rgba(255,192,0,.8)",i.stroke());a>o&&(k=n.cdeMinMax(a,s,o,180,0),f<a&&(i.beginPath(),i.lineWidth=10,i.strokeStyle=v,i.arc(u,r,e*.9,this.startAngle+h*(Math.PI/180),this.startAngle+k*(Math.PI/180),this.counterClockwise),i.stroke()),i.font="10pt Roboto",i.fillStyle="rgb(255,192,0)",i.fillText(a.toString(),u*.7,r*.95),i.beginPath(),i.arc(u,r,e-3,this.startAngle+(k-1)*(Math.PI/180),this.startAngle+(k+1)*(Math.PI/180),this.counterClockwise),i.lineWidth=r*.2,i.strokeStyle="rgba(255,192,0,.8)",i.stroke());i.strokeStyle=this.mBackground;i.lineWidth=1;i.beginPath();i.arc(u,r,e,this.startAngle,this.startAngle+h*(Math.PI/180),this.counterClockwise);i.stroke();d=cde.CDbl(this.GetProperty("LabelFontSize"));d===0&&(d=this.mycanvas.height*.25);i.font=d+"pt Roboto";y=this.GetProperty("LabelColor");y||(y=w);i.fillStyle=f<a&&a>o?"red":f>l&&l>o?"red":y;cde.CBool(this.GetProperty("AnimateValue"))?i.fillText(f.toString(),u-i.measureText(f.toString()).width/2,r*.85):i.fillText(cde.CDbl(this.GetProperty("Value")).toString(),u-i.measureText(cde.CDbl(this.GetProperty("Value")).toString()).width/2,r*.85);i.fillStyle=y;i.font="10pt Roboto";i.fillText(o.toString(),u-e,r+11);i.font="10pt Roboto";i.fillText(s.toString(),u+e-e*.15,r+11)}},r.prototype.AnimateFrame=function(n){var i=this,t;this.myframe=requestAnimationFrame(function(){i.AnimateFrame(!1)});cde.CDbl(this.GetProperty("Value"))<this.tempValue?(t=(this.tempValue-cde.CDbl(this.GetProperty("Value")))/20,this.tempValue-=t,!n&&(cde.CDbl(this.GetProperty("Value"))>this.tempValue||Math.abs(t)<.001)&&(cancelAnimationFrame(this.myframe),this.tempValue=cde.CDbl(this.GetProperty("Value")))):(t=(cde.CDbl(this.GetProperty("Value"))-this.tempValue)/20,this.tempValue+=t,!n&&(cde.CDbl(this.GetProperty("Value"))<this.tempValue||Math.abs(t)<.001)&&(cancelAnimationFrame(this.myframe),this.tempValue=cde.CDbl(this.GetProperty("Value"))));this.DoRender()},r}(n.TheNMIBaseControl);n.ctrlSmartGauge2=h}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.MyEditBox=null,i.MyConfirmBox=null,i.MyCombo=null,i.EnterButton=null,i.DropButton=null,i.MyMotLockButton=null,i.MyMotLockButton2=null,i.MyTextArea=null,i.mFrameDiv=null,i.mMotLoc=null,i.mMotLoc2=null,i.mUpdButton=null,i.mBackDiv=null,i.JustIn=!1,i.JustInC=!1,i.RequiresUpdateButton=!1,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,s,h,c,l,o,a;if(this.MyBaseType=n.cdeControlType.SingleEnded,t.prototype.InitControl.call(this,i,r,u,f),this.RequiresUpdateButton=cde.CBool(this.GetProperty("RequireUpdateButton")),this.mFrameDiv=document.createElement("div"),this.mFrameDiv.style.width="inherit",this.mFrameDiv.style.height="inherit",this.mFrameDiv.className="ctrlInput",this.SetElement(this.mFrameDiv),this.MyFieldInfo&&this.MyFieldInfo.Type===n.cdeControlType.TextArea)this.MyTextArea=document.createElement("textarea"),this.MyTextArea.className="ctrlTextArea",this.MyTextArea.style.cssFloat="left",this.mFrameDiv.appendChild(this.MyTextArea),this.MyTextArea.onblur=function(){return e.EditElement("13",e.MyTextArea)};else{if(this.MyFieldInfo&&this.MyFieldInfo.Type===n.cdeControlType.ComboOption&&cde.CInt(this.GetProperty("MultiLines"))>1?(this.MyTextArea=document.createElement("textarea"),this.MyTextArea.className="ctrlTextArea",this.MyTextArea.style.cssFloat="left",this.mFrameDiv.appendChild(this.MyTextArea),s=cde.CInt(this.GetProperty("MultiLines")),s<2&&(s=2),cde.CInt(this.GetSetting("TileFactorY"))>1&&!this.MyTextArea.classList.contains("cdeSmall")&&this.MyTextArea.classList.add("cdeSmall"),this.MyTextArea.rows=s):(this.MyEditBox=document.createElement("input"),this.MyEditBox.style.cssFloat="left",cde.CBool(this.GetProperty("EnableAutoFill"))||cde.CBool(this.GetProperty("InTemplate"))||(this.MyEditBox.name="EB"+cde.GuidToString(this.MyFieldInfo.cdeMID)+"_"+Math.floor(Math.random()*1e3+1),this.MyEditBox.autocomplete="new-password"),this.mFrameDiv.appendChild(this.MyEditBox),this.MyEditBox.className=this.MyFieldInfo&&this.MyFieldInfo.Type===12?"cdeInputNumber":"cdeInput",cde.CInt(this.GetSetting("TileFactorY"))>1&&!this.MyEditBox.classList.contains("cdeSmall")&&this.MyEditBox.classList.add("cdeSmall")),h=!1,this.MyFieldInfo)switch(this.MyFieldInfo.Type){case n.cdeControlType.Password:h=!1;this.MyBaseType=n.cdeControlType.Password;this.MyEditBox.type="password";this.MyEditBox.addEventListener("focusin",function(){e.JustIn=!0});cde.CBool(this.GetProperty("HideMTL"))||(this.mMotLoc=n.MyTCF.CreateNMIControl(n.cdeControlType.MuTLock).Create(this,{ScreenID:f,TRF:this.MyTRF}),this.mMotLoc.SetProperty("PassField",this),this.mMotLoc.SetProperty("Visibility",cde.CBool(this.GetProperty("AutoShowMTL"))),this.mMotLoc.SetProperty("Style","position:fixed;margin-top:"+n.GetSizeFromTile(1)+"px"),this.MyMotLockButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa fa-2x'>&#xf00A;<\/span>","ClassName=cdeMTL"]}),this.MyMotLockButton.SetProperty("Cookie",this),this.MyMotLockButton.SetProperty("OnClick",function(t,i){var r=t.GetProperty("Cookie");n.StopPointerEvents(i);r.mMotLoc.Visibility?(r.mMotLoc.SetProperty("Visibility",!1),r.MyEditBox.value.length>0&&n.Key13Event&&n.Key13Event(i)):(r.mMotLoc.SetProperty("Visibility",!0),r.ShowHideMTL(!0))}),this.SetProperty("ShowOverflow",!0),this.ShowHideMTL(cde.CBool(this.GetProperty("AutoShowMTL"))));cde.CBool(this.GetProperty("EnforceAndConfirm"))&&(this.MyConfirmBox=document.createElement("input"),this.MyConfirmBox.style.cssFloat="left",this.MyConfirmBox.className="cdeInput",this.MyConfirmBox.type="password",cde.CBool(this.GetProperty("EnableAutoFill"))||cde.CBool(this.GetProperty("InTemplate"))||(this.MyConfirmBox.name="EB"+cde.GuidToString(this.MyFieldInfo.cdeMID)+"_"+Math.floor(Math.random()*1e3+1),this.MyConfirmBox.autocomplete="new-password"),this.MyConfirmBox.addEventListener("focusin",function(){e.JustInC=!0}),this.mFrameDiv.appendChild(this.MyConfirmBox),cde.CBool(this.GetProperty("HideMTL"))||(this.mMotLoc2=n.MyTCF.CreateNMIControl(n.cdeControlType.MuTLock).Create(this,{ScreenID:f,TRF:this.MyTRF}),this.mMotLoc2.SetProperty("PassField",this),this.mMotLoc2.SetProperty("Visibility",!1),this.mMotLoc2.SetProperty("Style","position:fixed;margin-top:"+n.GetSizeFromTile(2)+"px"),this.MyMotLockButton2=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa fa-2x'>&#xf00A;<\/span>","ClassName=cdeMTL"]}),this.MyMotLockButton2.SetProperty("Cookie",this),this.MyMotLockButton2.SetProperty("OnClick",function(t,i){var r=t.GetProperty("Cookie");n.StopPointerEvents(i);r.mMotLoc2.Visibility?(r.mMotLoc2.SetProperty("Visibility",!1),r.MyConfirmBox.value.length>0&&n.Key13Event&&n.Key13Event(i)):(r.mMotLoc2.SetProperty("Visibility",!0),r.ShowHideMTL(!0,!0))}),this.SetProperty("ShowOverflow",!0)),this.RequiresUpdateButton===!0&&(this.mUpdButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this,{PreInitBag:["ControlTW=3","ControlTH=1"],PostInitBag:["Title=Set Password","ClassName=cdePWDUpdateButton"]}),this.mUpdButton.SetProperty("Cookie",this),this.mUpdButton.SetProperty("OnClick",function(t,i){var r=t.GetProperty("Cookie");n.StopPointerEvents(i);r.CheckAndWriteValue(r.MyEditBox,!1)})));break;case n.cdeControlType.Number:this.MyEditBox.type="number";this.MyBaseType=n.cdeControlType.Number;break;case n.cdeControlType.URL:this.MyEditBox.type="url";this.MyBaseType=n.cdeControlType.URL;break;case n.cdeControlType.eMail:this.MyEditBox.type="email";this.MyBaseType=n.cdeControlType.eMail;break;case n.cdeControlType.ComboOption:this.MyBaseType=n.cdeControlType.ComboOption;c=this.MyFieldInfo.Options;(this.MyTRF.ModelID||c&&c.indexOf("PROPERTYPICKER")<0)&&(l=n.MyTCF.CreateBaseControl().Create(this,{TRF:r}),o=document.createElement("div"),o.style.width="inherit",o.style.height="0",o.id=cde.GuidToString(this.MyTRF.FldInfo.cdeMID)+"_CBODIV",l.SetElement(o),this.DropButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa fa-3x'>&#xf03a;<\/span>"]}),cde.CInt(this.GetProperty("TileFactorY"))>1&&this.DropButton.SetProperty("TileFactorY",cde.CInt(this.GetProperty("TileFactorY"))),this.DropButton.SetProperty("OnClick",function(t,i){n.StopPointerEvents(i);try{e.MyFieldInfo.OptionsLive=n.GenerateFinalString(e.MyFieldInfo.Options,n.MyNMIModels[e.MyTRF.ModelID].MyStorageMirror[e.MyTRF.TableName][e.MyTRF.RowNo])}catch(r){}e.MyCombo.ShowComboPicker()}),this.MyTRF.FldInfo.HideInput=!0,this.MyCombo=n.MyTCF.CreateNMIControl(n.cdeControlType.ComboBox).Create(l,{ScreenID:f,TRF:this.MyTRF,PostInitBag:["ClassName=cdeInvisible","iValue="+this.GetProperty("Value")]}),this.MyCombo.RegisterEvent("OnValueChanged",function(n,t,i){i!==""&&i!=="CDE_NOP"&&e.SetProperty("Value",i)}),this.SetProperty("OnValueChanged",function(n,t,i){i&&e.MyCombo.SetProperty("iValue",i)}),cde.CBool(this.MyFieldInfo.IsOverlay)||cde.CBool(this.MyFieldInfo.IsInTable)||(this.MyTextArea?this.MyTextArea.onblur=function(){return e.EditElement("13",e.MyTextArea)}:this.MyEditBox.onblur=function(){return e.EditElement("13",e.MyEditBox)}));break;default:(this.MyFieldInfo.Flags&1)!=0?(this.MyEditBox.type="password",this.MyEditBox.addEventListener("focusin",function(){e.MyEditBox.value=""})):this.MyEditBox.type="text"}h&&(this.EnterButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa fa-3x'>&#xf058;<\/span>"]}),this.EnterButton.SetProperty("OnClick",function(t,i){n.StopPointerEvents(i);e.CheckAndWriteValue(e.MyEditBox,!1)}),this.EnterButton.SetProperty("Visibility",!1));this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)==0||(this.MyTextArea?(this.MyTextArea.onkeypress=function(n){return e.EditElement(n,e.MyEditBox)},this.MyTextArea.onfocus=function(){n.DisableKey36Event=!0}):(this.MyEditBox.onkeypress=function(n){return e.EditElement(n,e.MyEditBox)},this.MyEditBox.onfocus=function(){n.DisableKey36Event=!0}),this.MyConfirmBox&&(this.MyConfirmBox.onkeypress=function(n){return e.EditElement(n,e.MyConfirmBox)},this.MyConfirmBox.onfocus=function(){n.DisableKey36Event=!0}))}return this.SetProperty("iValue",t.prototype.GetProperty.call(this,"Value")),this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)==0&&this.SetProperty("Disabled",!0),this.SetProperty("IsOverlay",cde.CBool(this.MyFieldInfo.IsOverlay)||cde.CBool(this.MyFieldInfo.IsInTable)||cde.CBool(this.GetProperty("AutoShowMTL"))),this.MyFormID&&n.MyScreenManager&&(a=n.MyScreenManager.GetScreenByID(this.MyFormID),a&&a.RegisterEvent("OnLoaded",function(){return e.ApplySkin()})),!0},i.prototype.OnUnload=function(){this.SetProperty("Disabled",!0);t.prototype.OnUnload.call(this)},i.prototype.OnLoad=function(){var r=this.mFrameDiv.clientWidth,i=!1,u;r>0&&(r-=this.GetProperty("TileFactorX")?20/cde.CInt(this.GetProperty("TileFactorX")):20,i=this.MyBaseType!==n.cdeControlType.ComboOption,i!==!0||cde.CBool(this.GetProperty("HideMTL"))||this.MyBaseType!==n.cdeControlType.Password||(i=!1));u=!(!this.MyTRF||!this.MyTRF.FldInfo||(this.MyTRF.FldInfo.Flags&2)!=0);this.SetProperty("Disabled",u);this.MyEditBox&&i&&(this.MyEditBox.style.width=r+"px");this.MyConfirmBox&&i&&(this.MyConfirmBox.style.width=r+"px");this.MyTextArea&&i&&(this.MyTextArea.style.width=r+"px");t.prototype.OnLoad.call(this)},i.prototype.SetProperty=function(i,r){var u=this,f;(i==="Value"||i==="iValue")&&(this.MyEditBox||this.MyTextArea)?(this.MyFieldInfo&&(!r||r===""||r==="-")&&(r=this.MyFieldInfo.Type===31&&this.MyFieldInfo.DefaultValue===""?"http://":this.MyFieldInfo.DefaultValue?this.MyFieldInfo.DefaultValue:this.MyFieldInfo.Type===n.cdeControlType.Number?0:"",this.MyEditBox&&n.HasPlaceholderSupport&&(f=this.MyFieldInfo.HelpText,f||(f=this.MyFieldInfo.EditPlaceholder),f&&(this.MyEditBox.placeholder=f))),this.MyCombo&&this.MyCombo.SetProperty("iValue",r),this.MyTextArea?this.MyTextArea.value=r:(this.MyEditBox.value=r,this.MyConfirmBox&&(this.MyConfirmBox.value=r))):i==="EditPlaceholder"&&this.MyEditBox?this.MyEditBox.placeholder=r:i==="Disabled"&&this.MyEditBox?(this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0||(r=!0),this.MyEditBox.disabled=cde.CBool(r),this.MyConfirmBox&&(this.MyConfirmBox.disabled=cde.CBool(r))):i==="Disabled"&&this.MyTextArea?(this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)!=0||(r=!0),this.MyTextArea.disabled=cde.CBool(r)):i==="Rows"&&this.MyTextArea?(r=cde.CInt(r),this.MyTextArea.rows=r):i==="Background"?(this.MyTextArea&&(this.MyTextArea.style.background=r),this.MyEditBox&&(this.MyEditBox.style.background=r),this.MyConfirmBox&&(this.MyConfirmBox.style.background=r)):i==="Foreground"?(this.MyTextArea&&(this.MyTextArea.style.color=r),this.MyEditBox&&(this.MyEditBox.style.color=r),this.MyConfirmBox&&(this.MyConfirmBox.style.color=r)):i==="ControlTW"?this.MyFieldInfo&&(this.MyFieldInfo.Type===n.cdeControlType.Password&&!cde.CBool(this.GetProperty("HideMTL"))||this.MyFieldInfo.Type===n.cdeControlType.ComboOption)&&(this.MyTextArea&&(this.MyTextArea.style.width=n.GetSizeFromTile(r-1)-6+"px"),this.MyEditBox&&(this.MyEditBox.style.width=n.GetSizeFromTile(r-1)-6+"px"),this.MyConfirmBox&&(this.MyConfirmBox.style.width=n.GetSizeFromTile(r-1)-6+"px")):i==="TileFactorY"&&this.MyEditBox?(this.MyEditBox.style.height=50/cde.CInt(r)+"px",cde.CInt(r)>1&&(this.MyEditBox&&!this.MyEditBox.classList.contains("cdeSmall")&&this.MyEditBox.classList.add("cdeSmall"),this.MyTextArea&&!this.MyTextArea.classList.contains("cdeSmall")&&this.MyTextArea.classList.add("cdeSmall"))):i==="Z-Index"&&this.MyCombo?(r=cde.CInt(r),this.MyCombo.SetProperty("Z-Index",r),this.DropButton.SetProperty("Z-Index",r)):i==="IsOverlay"?(this.MyTextArea&&n.SetZIndex(this.MyTextArea,cde.CBool(r)?1300:0),this.MyEditBox&&n.SetZIndex(this.MyEditBox,cde.CBool(r)?1300:0),this.MyConfirmBox&&n.SetZIndex(this.MyConfirmBox,cde.CBool(r)?1300:0),this.mMotLoc&&this.ShowHideMTL(r),this.mMotLoc2&&this.ShowHideMTL(r,!0),this.DropButton&&n.SetZIndex(this.DropButton.GetElement(),cde.CBool(r)?1300:0),this.MyCombo&&n.SetZIndex(this.MyCombo.GetElement(),cde.CBool(r)?1300:0),cde.CBool(r)?(this.EnterButton&&this.EnterButton.SetProperty("Visibility",!0),this.MyEditBox&&(n.Key27Event=function(n){return u.EditRestore(n,u.MyEditBox)},n.Key13Event=function(n){return u.EditElement(n,u.MyEditBox)},n.MyTouchOverlay&&this.MyEditBox.focus()),this.MyTextArea&&(n.Key27Event=function(n){return u.EditRestore(n,u.MyTextArea)},n.Key13Event=function(n){return u.EditElement(n,u.MyTextArea)},n.MyTouchOverlay&&this.MyTextArea.focus()),this.MyConfirmBox&&(n.Key27Event=function(n){return u.EditRestore(n,u.MyConfirmBox)},n.Key13Event=function(n){return u.EditElement(n,u.MyConfirmBox)})):this.MyFieldInfo&&(cde.CBool(this.MyFieldInfo.InTemplate)||this.MyFieldInfo.Type===n.cdeControlType.ComboOption)||(this.MyEditBox&&(this.MyEditBox.onchange=function(){return u.EditElement("13",u.MyEditBox)}),this.MyConfirmBox&&(this.MyConfirmBox.onchange=function(){return u.EditElement("13",u.MyConfirmBox)}),this.MyTextArea&&(this.MyTextArea.onchange=function(){return u.EditElement("13",u.MyTextArea)})),this.EnterButton&&n.SetZIndex(this.EnterButton.GetElement(),cde.CBool(r)?1300:0)):i==="InnerClassName"?(this.MyEditBox&&(this.MyEditBox.className=r),this.MyConfirmBox&&(this.MyConfirmBox.className=r),this.MyTextArea&&(this.MyTextArea.className=r)):i==="InnerStyle"?(this.MyEditBox&&(this.MyEditBox.style.cssText=r),this.MyConfirmBox&&(this.MyConfirmBox.style.cssText=r),this.MyTextArea&&(this.MyTextArea.style.cssText=r)):i==="TabIndex"?(this.MyEditBox&&(this.MyEditBox.tabIndex=r),this.MyConfirmBox&&(this.MyConfirmBox.tabIndex=r),this.MyTextArea&&(this.MyTextArea.tabIndex=r)):i==="LiveOptions"&&this.MyCombo&&this.MyCombo.SetProperty(i,r);t.prototype.SetProperty.call(this,i,r)},i.prototype.ShowHideMTL=function(t,i){i===void 0&&(i=!1);cde.CBool(i)===!0?this.MyMotLockButton2&&(n.SetZIndex(this.MyMotLockButton2.GetElement(),cde.CBool(t)?1300:0),this.mMotLoc2.SetProperty("IsOverlay",t)):(n.SetZIndex(this.MyMotLockButton.GetElement(),cde.CBool(t)?1300:0),this.mMotLoc.SetProperty("IsOverlay",t))},i.prototype.SetTE=function(n){t.prototype.SetTE.call(this,n);this.MyCombo&&this.MyCombo.SetTE(n)},i.prototype.EditRestore=function(t){var i=n.MyNMIModels[this.MyScreenID],r;n.ResetKeyCorder();this.MyTRF&&this.MyTRF.TableName&&this.MyTRF.TableName!==""&&i&&(r=n.GetFldContent(i.MyStorageMirror[this.MyTRF.TableName][this.MyTRF.RowNo],this.MyFieldInfo,!1,!1),this.FireEvent(!1,"OnValueChanged",t,r,this.MyTRF))},i.prototype.EditElement=function(t,i){var r;r=typeof t=="string"?cde.CInt(t):"keyCode"in t?t.keyCode:t.charCode;r===13?(n.StopPointerEvents(t),this.CheckAndWriteValue(i,this.RequiresUpdateButton),n.ResetKeyCorder()):r===27?this.EditRestore(t,i):this.JustIn&&i===this.MyEditBox?(this.JustIn=!1,this.MyEditBox.value=""):this.JustInC&&i===this.MyConfirmBox&&(this.JustInC=!1,this.MyConfirmBox.value="")},i.prototype.CheckAndWriteValue=function(i,r){var f,u;r===void 0&&(r=!1);switch(this.MyFieldInfo.Type){case n.cdeControlType.Number:if(cde.CInt(this.GetProperty("MaxValue"))>0&&cde.CInt(i.value)>cde.CInt(this.GetProperty("MaxValue"))){n.ShowToastMessage("Entry is too High. Max Value="+cde.CInt(this.GetProperty("MaxValue")));this.SetProperty("iValue",t.prototype.GetProperty.call(this,"Value"));return}if(cde.CInt(i.value)<cde.CInt(this.GetProperty("MinValue"))){n.ShowToastMessage("Entry is too low. Min Value="+cde.CInt(this.GetProperty("MaxValue")));this.SetProperty("iValue",t.prototype.GetProperty.call(this,"Value"));return}break;case n.cdeControlType.eMail:if(!n.Check4ValidEmail(i.value)){n.ShowToastMessage("Entry is not a valid Email Address");this.SetProperty("AddClassName","cdeValidateError");return}this.SetProperty("RemoveClassName","cdeValidateError");break;case n.cdeControlType.IPAddress:if(!n.ValidateIPaddress(i.value)){n.ShowToastMessage("Entry is not a valid IP-Address");this.SetProperty("AddClassName","cdeValidateError");return}this.SetProperty("RemoveClassName","cdeValidateError");break;case n.cdeControlType.Password:if(this.MyConfirmBox){if(n.IsSamePassword(this.MyEditBox.value,this.MyConfirmBox.value,!0)){if(!n.Check4ValidPassword(this.MyEditBox.value)){this.SetProperty("AddClassName","cdeValidateError");n.MyToast&&n.MyToast.ShowToastMessage("Password is too short or is not strong enough. Must be at least 8 characters");return}}else{this.SetProperty("AddClassName","cdeValidateError");n.MyToast&&n.MyToast.ShowToastMessage("Passwords are not matching, please update");return}this.SetProperty("RemoveClassName","cdeValidateError")}break;default:if(!i.value||i.value.length===0||!this.GetProperty("Validator"))break;if(f=new RegExp(this.GetProperty("Validator")),!i.value.match(f)){u=this.GetProperty("ValidateErrorText");u||(u="Entry does not validate. Please verify your entry");n.ShowToastMessage(u);this.SetProperty("AddClassName","cdeValidateError");return}this.SetProperty("RemoveClassName","cdeValidateError")}r!==!0&&(this.MyFieldInfo.Type===n.cdeControlType.Password&&n.MyToast&&(this.GetProperty("ReturnClicked")?this.GetProperty("ReturnClicked")():n.MyToast.ShowToastMessage("Password was set successfully")),this.IsDirty=!0,this.FireEvent(!1,"OnValueChanged","CheckAndWriteValue",i.value,this.MyTRF),this.FireEvent(!1,"OnPropertyChanged","CheckAndWriteValue",i.value,"Value"))},i.prototype.ApplySkin=function(){this.MyFieldInfo&&(this.MyFieldInfo.Type===n.cdeControlType.Password&&!cde.CBool(this.GetProperty("HideMTL"))||this.MyFieldInfo.Type===n.cdeControlType.ComboOption)&&(this.MyTextArea&&this.MyTextArea.parentElement&&this.MyTextArea.parentElement.clientWidth>0&&(this.MyTextArea.style.width=this.MyTextArea.parentElement.clientWidth-(n.GetSizeFromTile(1)+6)+"px"),this.MyEditBox&&this.MyEditBox.parentElement&&this.MyEditBox.parentElement.clientWidth>0&&(this.MyEditBox.style.width=this.MyEditBox.parentElement.clientWidth-(n.GetSizeFromTile(1)+6)+"px"),this.MyConfirmBox&&(this.MyConfirmBox.style.width=this.MyConfirmBox.parentElement.clientWidth-(n.GetSizeFromTile(1)+6)+"px"))},i.prototype.GetProperty=function(n){if(n==="Value"){if(this.MyEditBox)return this.MyEditBox.value;if(this.MyTextArea)return this.MyTextArea.value}return t.prototype.GetProperty.call(this,n)},i.Create=function(n,t,r,u,f,e){var o=new i(r);return o.InitControl(n,r,null,t),u&&o.SetProperty("iValue",u),cde.CBool(f)?o.SetProperty("IsOverlay",!0):o.SetProperty("IsOverlay",!1),e&&o.SetProperty("InnerClassName",e),o},i}(n.TheNMIBaseControl);n.ctrlEditBox=t}(cdeNMI||(cdeNMI={})),function(n){var i=function(t){function i(n){var i=t.call(this,null,n)||this;return i.divTiles=null,i.divDragContent=null,i.h1Title=null,i}return __extends(i,t),i.Create=function(n,t,r,u,f,e){var o=new i(t);return o.InitControl(n,t,r,u),f&&o.SetProperty("Label",f),e&&o.SetProperty("ClassName",f),o},i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType=n.cdeControlType.TileGroup,t.prototype.InitControl.call(this,i,r,u,f),this.divTiles=document.createElement("div"),this.divTiles.className="cdeTiles",this.divTiles.style.cssFloat="left",r&&r.FldInfo&&this.divTiles.setAttribute("cdefo",cde.CStr(r.FldInfo.FldOrder)),cde.CBool(this.GetSetting("AllowDrag"))?(this.divDragContent=document.createElement("div"),this.divDragContent.style.position="absolute",this.divDragContent.style.overflow="hidden",this.divTiles.style.position="relative",this.divTiles.appendChild(this.divDragContent),this.SetElement(this.divTiles,!1,this.divDragContent)):this.SetElement(this.divTiles),!0},i.prototype.SetProperty=function(i,r){var o=this,f,u,e;if(t.prototype.SetProperty.call(this,i,r),i==="Caption"||i==="Label"||i==="Title"||i==="Value"||i==="iValue")if(r)u=r,(i==="Caption"||i==="Label"||i==="Title")&&(u=n.TL.T(r)),this.GetProperty("Format")&&(i==="Value"||i==="iValue")&&(u=this.GetProperty("Format").format(r)),this.MyBaseType!==n.cdeControlType.CollapsibleGroup&&cde.CBool(this.GetProperty("IsDivOnly"))?(u&&u.startsWith("FA")&&u.length===8&&(u="<i class='fa faIcon "+(u.substr(3,1)==="S"?"fa-spin ":"")+"fa-"+u.substr(2,1)+"x'>&#x"+u.substr(4,u.length-4)+";<\/i>"),this.divTiles.innerHTML=u,this.divTiles.style.cssFloat="none"):cde.CBool(this.GetProperty("HideCaption"))||(this.h1Title||(e="h1",this.GetProperty("LabelElement")&&(e=this.GetProperty("LabelElement")),this.h1Title=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(null,{PreInitBag:["Element="+e]}),this.GetProperty("LabelClassName")?this.h1Title.SetProperty("ClassName",this.GetProperty("LabelClassName")):cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==5&&(this.GetProperty("IsSmall")||cde.CInt(this.GetProperty("TileFactorY"))>1)?this.h1Title.SetProperty("ClassName","cdeTileGroupHeaderSmall"):this.h1Title.SetProperty("ClassName","cdeTileGroupHeader"),this.h1Title.GetElement().style.cssFloat=null,this.divTiles.appendChild(this.h1Title.GetElement())),this.h1Title.SetProperty("iValue",u));else{this.h1Title&&(this.h1Title.GetElement().parentElement.removeChild(this.h1Title.GetElement()),this.h1Title=null);return}else i==="HideCaption"&&this.h1Title&&cde.CBool(r)?(this.h1Title.GetElement().parentElement.removeChild(this.h1Title.GetElement()),this.h1Title=null):i==="OnClick"&&r?(this.PreventManipulation=!0,this.HookEvents(!1),this.RegisterEvent("OnClick",r),this.RegisterEvent("PointerUp",this.DoFireClick)):i==="OnHover"&&r?(this.GetElement().addEventListener("mouseenter",function(n){return o.onHover(n)}),this.RegisterEvent("OnHover",r)):(i==="TileWidth"||i==="TileFactorX")&&this.MyRootElement?(r=this.GetProperty("TileWidth"),r||(r=1),cde.CInt(r)>0?(f=this.SetWidth(this.divTiles,cde.CInt(r),0),this.divTiles.style.maxWidth=f+"px",this.divDragContent&&(this.divDragContent.style.width=f+"px",this.divDragContent.style.maxWidth=f+"px")):this.divDragContent?(this.divTiles.style.width=this.divDragContent.clientWidth+"px",this.divTiles.style.maxWidth=this.divDragContent.clientWidth+"px"):(this.divTiles.style.width="inherit",this.divTiles.style.maxWidth="inherit"),this.SetProperty("ControlTW",r)):(i==="TileHeight"||i==="TileFactorY")&&this.MyRootElement?(r=this.GetProperty("TileHeight"),r||(r=1),cde.CInt(r)>0?(f=this.SetHeight(this.divTiles,cde.CInt(r),0),this.divTiles.style.maxHeight=f+"px",this.divDragContent&&(this.divDragContent.style.height=f+"px")):this.divDragContent?(this.divTiles.style.height=this.divDragContent.clientHeight+"px",this.divTiles.style.maxHeight=this.divDragContent.clientHeight+"px"):(this.divTiles.style.height="inherit",this.divTiles.style.maxHeight="inherit"),this.SetProperty("ControlTH",r)):i==="MaxTileHeight"&&this.MyRootElement?cde.CInt(r)>0?(f=n.GetSizeFromTile(cde.CInt(r)),cde.CInt(this.GetProperty("TileFactorY"))>1&&(f/=cde.CInt(this.GetProperty("TileFactorY"))),this.divTiles.style.maxHeight=f+"px"):this.divTiles.style.maxHeight="inherit":i==="Background"&&this.MyRootElement&&this.MyBaseType!==n.cdeControlType.CollapsibleGroup?this.divTiles.style.background=r:i==="GroupBackground"&&this.MyRootElement?this.divTiles.style.background=r:i==="IsVScrollable"&&this.MyRootElement?this.MyRootElement.style.overflowY="auto":i==="IsHScrollable"&&this.MyRootElement?this.MyRootElement.style.overflowX="auto":i==="Overflow"&&this.MyRootElement?this.MyRootElement.style.overflow=r:i==="LabelClassName"&&this.h1Title?this.h1Title.SetProperty("ClassName",r):i==="CaptionBackground"&&this.h1Title?this.h1Title.SetProperty("Background",r):i==="LabelForeground"&&this.h1Title?this.h1Title.SetProperty("Foreground",r):i==="LabelFontSize"&&this.h1Title?this.h1Title.SetProperty("FontSize",r):i==="PixelHeight"?(t.prototype.SetProperty.call(this,"PixelHeight",r),this.divDragContent&&(this.divDragContent.style.height=r.toString().endsWith("px")||r.toString().endsWith("%")||r==="auto"?r:r+"px",this.divTiles.style.height=this.divDragContent.clientHeight+"px")):i==="LabelFormat"&&(this.SetProperty("Format",r),this.SetProperty("iValue",this.GetProperty("Value")))},i.prototype.onHover=function(n){this.FireEvent(!0,"OnHover",n)},i.prototype.ApplySkin=function(){this.divDragContent&&(this.divTiles.style.height=this.divDragContent.clientHeight+"px")},i.prototype.AppendChild=function(n){try{this.MyChildren.push(n);n.GetElement()&&(this.GetContainerElement()!==n.GetElement()&&this.GetContainerElement().appendChild(n.GetElement()),this.ApplySkin())}catch(t){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TileGroup:AppendChild",t.message+":"+t.stack)}},i.prototype.AppendElement=function(n){this.GetContainerElement().appendChild(n);this.ApplySkin()},i}(n.TheNMIBaseControl),t;n.ctrlTileGroup=i;t=function(t){function i(n){var i=t.call(this,n)||this;return i.mHideOpenButton=null,i.mExpandLeftButton=null,i.mExpandRightButton=null,i.mDragButton=null,i.pos1=0,i.pos2=0,i.pos3=0,i.pos4=0,i.oldz="",i.oldBC="",i.IsDragging=!1,i.mDefaultSize=6,i.IsTesla=!1,i.colOpen=function(n){n&&n.target.removeEventListener("transitionend",i.colOpen);i.mTitleGroup.GetElement().classList.contains("cdeCollapsibleOpen")&&i.mTitleGroup.GetElement().classList.remove("cdeCollapsibleOpen");i.mTitleGroup.GetElement().classList.contains("cdeCollapsibleOpen")||i.mTitleGroup.GetElement().classList.add("cdeCollapsibleClosed");i.mHideOpenButton&&i.mHideOpenButton.SetProperty("Title","<span class='fa fa-lg cdeFormPin'>&#xF078;<span>");i.OnUnload()},i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,c,o,s,h;return this.SetTRF(r,u),t.prototype.InitControl.call(this,i,null,null,f),this.MyBaseType=n.cdeControlType.CollapsibleGroup,t.prototype.SetProperty.call(this,"ClassName","cdeCollapsibleGroup"),!this.GetSetting("TileWidth")&&this.GetSetting("MinTileWidth")&&this.SetProperty("TileWidth",this.GetSetting("MinTileWidth")),this.IsTesla=!1,this.mTitleGroup=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup),c=new n.TheFieldInfo(n.cdeControlType.TileGroup,r&&r.FldInfo?r.FldInfo.Flags:2,null),c.FldOrder=r&&r.FldInfo?r.FldInfo.FldOrder:0,this.mTitleGroup.InitControl(this,new n.TheTRF(null,0,c)),this.mTitleGroup.GetElement().style.width="100%",this.mTitleGroup.GetElement().style.maxWidth="100%",this.mTitleGroup.GetElement().style.cssFloat=null,this.mTitleGroup.SetProperty("TileHeight",1),this.SetGroupHeaderSize(),this.mTitleGroup.HookEvents(!1),this.RegisterEvent("Resize",function(t,i){var r=e.GetElement().clientWidth/n.GetSizeFromTile(1);(r=Math.floor(r/6)*e.mDefaultSize,cde.CBool(e.GetSetting("AllowHorizontalExpand"))||i===cde.CInt(e.GetProperty("TileWidth")))&&(r>i?(!e.GetSetting("MinTileWidth")||i>=cde.CInt(e.GetSetting("MinTileWidth")))&&(e.SetProperty("TileWidth",i),e.FireResize(i)):r<i&&(!e.GetSetting("MaxTileWidth")||i<=cde.CInt(e.GetSetting("MaxTileWidth")))&&(e.SetProperty("TileWidth",i),e.FireResize(i)))}),o=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup),o.InitControl(this),o.SetProperty("ClassName","cdeInsideCollapsible"),o.GetElement().style.width="inherit",s=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup),s.InitControl(this),s.GetElement().style.height=n.GetSizeFromTile(1)/4+"px",s.SetProperty("ClassName","cdeCloseGroup"),this.SetElement(this.GetElement(),!1,o.GetElement()),this.mTitleGroup.RegisterEvent("PointerUp",function(n,t){t.type==="mousedown"||e.IsDragging||e.MyFieldInfo&&(e.MyFieldInfo.Flags&2)!=0&&e.ToggleDrop(!cde.CBool(cde.CBool(e.GetProperty("IsOpen"))),!1)}),h="2x",!this.IsTesla&&cde.CBool(this.GetSetting("IsSmall"))&&(h="lg"),cde.CBool(this.GetSetting("AllowHorizontalExpand"))===!0&&cde.CBool(this.GetSetting("HidePins"))!==!0&&this.GetSetting("MaxTileWidth")&&(this.mExpandLeftButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.mTitleGroup,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["iValue=<span class='fa fa-"+h+" cdeFormPin'>&#xF0A9;<span>"]}),this.mExpandLeftButton.SetProperty("OnClick",function(t,i){var r=e.MyRootElement.clientWidth/n.GetSizeFromTile(1);r=Math.floor(r/6)*e.mDefaultSize;(!e.GetProperty("MaxTileWidth")||r<=cde.CInt(e.GetProperty("MaxTileWidth"))-e.mDefaultSize&&n.MyScreenManager&&e.SetWidth(null,r+e.mDefaultSize,0,!0)<n.MyScreenManager.DocumentWidth&&n.MyScreenManager.DocumentWidth>0)&&(r+=e.mDefaultSize,e.SetNewWidth(r),e.ResizeParentsUp(e,r),e.FireResize(r));i.stopPropagation()}),this.mExpandLeftButton.SetProperty("Float","right"),!this.IsTesla&&cde.CBool(this.GetSetting("IsSmall"))&&(this.mExpandLeftButton.SetProperty("TileFactorX",2),this.mExpandLeftButton.SetProperty("TileFactorY",2)),this.mExpandRightButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.mTitleGroup,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["iValue=<span class='fa fa-"+h+" cdeFormPin'>&#xF0A8;<span>"]}),this.mExpandRightButton.SetProperty("OnClick",function(t,i){var r=e.MyRootElement.clientWidth/n.GetSizeFromTile(1);r=Math.floor(r/6)*e.mDefaultSize;r>e.mDefaultSize&&(!e.GetProperty("MinTileWidth")||r>=cde.CInt(e.GetProperty("MinTileWidth"))+e.mDefaultSize)&&!e.IsAChildBigger(r-e.mDefaultSize)&&(r-=e.mDefaultSize,e.SetNewWidth(r),e.ResizeChildrenDown(e,r),e.FireResize(r));i.stopPropagation()}),this.mExpandRightButton.SetProperty("Float","right"),!this.IsTesla&&cde.CBool(this.GetSetting("IsSmall"))&&(this.mExpandRightButton.SetProperty("TileFactorX",2),this.mExpandRightButton.SetProperty("TileFactorY",2))),cde.CBool(this.GetSetting("HidePins"))===!0||this.MyFieldInfo&&this.MyFieldInfo.Flags!==undefined&&(this.MyFieldInfo.Flags&2)==0||(this.mHideOpenButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.mTitleGroup,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["iValue=<span class='fa fa-lg cdeFormPin'>&#xF078;<span>"]}),this.mHideOpenButton.SetProperty("Float","left"),!this.IsTesla&&cde.CBool(this.GetSetting("IsSmall"))&&(this.mHideOpenButton.SetProperty("TileFactorX",2),this.mHideOpenButton.SetProperty("TileFactorY",2))),cde.CBool(this.GetSetting("AllowDrag"))?(this.mDragButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.mTitleGroup,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["iValue=<span class='fa fa-lg cdeFormPin'>&#xF0b2;<span>"]}),this.mDragButton.SetProperty("Float","right"),this.mDragButton.SetProperty("HoverClassName","cdeDragButton"),!this.IsTesla&&cde.CBool(this.GetSetting("IsSmall"))&&(this.mDragButton.SetProperty("TileFactorX",2),this.mDragButton.SetProperty("TileFactorY",2)),this.mDragButton.SetProperty("OnPointerDown",function(n,t){if(e.IsDragging){e.closeDragElement(t);return}t=t||window.event;t.preventDefault();e.pos3=t.clientX;e.pos4=t.clientY;e.IsDragging=!0;document.onpointerup=function(n){e.closeDragElement(n)};e.oldz=e.MyRootElement.style.zIndex;e.MyRootElement.style.zIndex="4000";e.oldBC=e.GetElement().style.backgroundColor;e.GetElement().style.backgroundColor="rgba(0,0,0,.4)";document.onpointermove=function(n){e.elementDrag(n)}})):this.SetProperty("Overflow","hidden"),this.ApplySkin(),this.ToggleDrop(!cde.CBool(cde.CBool(this.GetProperty("DoClose"))),!0),!0},i.prototype.SetProperty=function(i,r){var u,f;if(i==="UseMargin"&&cde.MyBaseAssets.MyServiceHostInfo.WebPlatform!==1){cde.CBool(r)===!0?t.prototype.SetProperty.call(this,"Margin",n.GetSizeFromTile(1)/4):t.prototype.SetProperty.call(this,"Margin",0);return}if(i==="Caption"||i==="Label"||i==="Title"||i==="Value"||i==="iValue"){u=r;u=this.GetProperty("Format")&&(i==="Value"||i==="iValue")?this.GetProperty("Format").format(r):n.TL.T(u);this.mTitleGroup.SetProperty(i,u);cde.CBool(this.GetProperty("HideCaption"))||cde.CBool(this.GetProperty("HidePins"))&&cde.IsNotSet(r)?this.mTitleGroup.SetProperty("Visibility",!1):this.mTitleGroup.SetProperty("Visibility",!0);return}if(i==="HideCaption"&&this.mTitleGroup&&cde.CBool(r))this.mTitleGroup.SetProperty("Visibility",!1);else if(i==="CaptionBackground")this.mTitleGroup.SetProperty("Background",r);else if(i==="LabelForeground")this.mTitleGroup.SetProperty(i,r),this.mExpandLeftButton&&this.mExpandLeftButton.SetProperty("Foreground",r),this.mExpandRightButton&&this.mExpandRightButton.SetProperty("Foreground",r);else{if(i==="LabelClassName"){this.mTitleGroup.SetProperty("LabelClassName",r);this.mTitleGroup.SetProperty("ClassName",r);this.ToggleDrop(!cde.CBool(cde.CBool(this.GetProperty("DoClose"))),!0);return}if(i==="DoClose")this.ToggleDrop(!cde.CBool(r),!0);else{if(i==="Background"||i==="GroupBackground"||i==="IsVScrollable"||i==="IsHScrollable"){t.prototype.SetProperty.call(this,i,r);return}i==="HidePins"&&(f=i==="HidePins"?!cde.CBool(r):!1,this.mHideOpenButton&&(!f||this.MyFieldInfo&&(this.MyFieldInfo.Flags&2)==0)&&this.mHideOpenButton.SetProperty("Visibility",f),cde.CBool(r)&&cde.IsNotSet(this.mTitleGroup.GetProperty("Value"))?this.mTitleGroup.SetProperty("Visibility",!1):this.mTitleGroup.SetProperty("Visibility",!0))}}t.prototype.SetProperty.call(this,i,r);i==="TileHeight"&&cde.CBool(cde.CBool(this.GetProperty("DoClose")))?this.ToggleDrop(!cde.CBool(cde.CBool(this.GetProperty("DoClose"))),!0):!this.IsTesla&&i==="IsSmall"&&this.mTitleGroup&&this.SetGroupHeaderSize()},i.prototype.closeDragElement=function(n){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","closedrag","closed");n.stopPropagation();n.preventDefault();this.IsDragging=!1;document.onpointermove=null;document.onpointerup=null;this.MyRootElement.style.zIndex=this.oldz;this.MyRootElement.style.top="0px";this.MyRootElement.style.left="0px";this.GetElement().style.backgroundColor=this.oldBC;this.ApplySkin()},i.prototype.elementDrag=function(n){if(n=n||window.event,n.preventDefault(),this.pos1=this.pos3-n.clientX,this.pos2=this.pos4-n.clientY,this.pos3=n.clientX,this.pos4=n.clientY,this.pos1===0&&this.pos2===0){this.closeDragElement(n);return}this.IsDragging=!0;cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","ElemetDrag",this.pos1+","+this.pos2+","+this.pos3+","+this.pos4);this.MyRootElement.style.top=this.MyRootElement.offsetTop-this.pos2+"px";this.MyRootElement.style.left=this.MyRootElement.offsetLeft-this.pos1+"px"},i.prototype.SetNewWidth=function(n){n>0&&(cde.CBool(this.GetSetting("AllowHorizontalExpand"))||n===cde.CInt(this.GetProperty("TileWidth"))||(n=cde.CInt(this.GetProperty("TileWidth"))),this.SetProperty("TileWidth",n))},i.prototype.ResizeParentsUp=function(t,i){t.MyTarget&&t.MyTarget.MyBaseType===n.cdeControlType.CollapsibleGroup&&cde.CBool(t.MyTarget.GetProperty("AllowHorizontalExpand"))===!0&&cde.CInt(t.MyTarget.GetProperty("TileWidth"))<i&&(t.MyTarget.FireEvent(!0,"Resize",i),this.ResizeParentsUp(t.MyTarget,i))},i.prototype.ResizeChildrenDown=function(t,i){var u,r;for(u in t.MyChildren)r=t.MyChildren[u],r.MyBaseType===n.cdeControlType.CollapsibleGroup&&cde.CBool(r.GetProperty("AllowHorizontalExpand"))===!0&&(!r.GetProperty("TileWidth")||i<cde.CInt(r.GetProperty("TileWidth"))&&(!r.GetProperty("MinTileWidth")||i>=cde.CInt(r.GetProperty("MinTileWidth"))))&&(r.FireEvent(!0,"Resize",i),this.ResizeChildrenDown(r,i))},i.prototype.IsAChildSmaller=function(n,t){for(var i in n.MyChildren)if(n.MyChildren[i]&&cde.CInt(n.MyChildren[i].GetProperty("TileWidth"))<t)return!0;return!1},i.prototype.FireResize=function(n){for(var t in this.MyChildren)this.MyChildren[t].FireEvent(!0,"Resize",n)},i.prototype.SetGroupHeaderSize=function(){this.mTitleGroup&&(!this.IsTesla&&(this.GetProperty("IsSmall")||cde.CInt(this.GetProperty("TileFactorY"))>1)?(this.mTitleGroup.GetElement().style.height=n.GetSizeFromTile(1)/2+"px",this.mTitleGroup.SetProperty("ClassName","cdeTileGroupHeaderSmall"),this.mTitleGroup.SetProperty("LabelClassName","cdeTileGroupHeaderSmall")):this.mTitleGroup.SetProperty("ClassName","cdeTileGroupHeader"),this.ToggleDrop(!cde.CBool(this.GetProperty("DoClose")),!0))},i.prototype.ToggleDrop=function(i,r){var u;(r||!cde.CBool(this.GetProperty("HidePins")))&&(i?(this.SetProperty("IsOpen",!0),this.mTitleGroup.GetElement().classList.contains("cdeCollapsibleClosed")&&this.mTitleGroup.GetElement().classList.remove("cdeCollapsibleClosed"),this.mTitleGroup.GetElement().classList.add("cdeCollapsibleOpen"),this.mHideOpenButton&&this.mHideOpenButton.SetProperty("Title","<span class='fa fa-lg cdeFormPin'>&#xF077;<span>"),n.GetSizeFromTile(t.prototype.GetProperty.call(this,"TileHeight"))>0?(u=n.GetSizeFromTile(t.prototype.GetProperty.call(this,"TileHeight")),!this.IsTesla&&this.GetProperty("IsSmall")&&(u/=2),t.prototype.SetProperty.call(this,"Style","max-height:"+u+"px;")):t.prototype.SetProperty.call(this,"Style","max-height:3840px;"),this.OnLoad()):(this.SetProperty("IsOpen",!1),u=n.GetSizeFromTile(1),!this.IsTesla&&this.GetProperty("IsSmall")&&(u/=2),t.prototype.SetProperty.call(this,"Style","max-height:"+u+"px;"),r?(this.colOpen(null),this.OnUnload()):t.prototype.GetElement.call(this).addEventListener("transitionend",this.colOpen,!1)))},i}(n.ctrlTileGroup);n.ctrlCollapsibleGroup=t}(cdeNMI||(cdeNMI={})),function(n){var u=function(t){function i(n){var i=t.call(this,n,null)||this;return i.elePopupButtonContent=null,i.tileButOkButton=null,i.tileButYesButton=null,i.tileButNoButton=null,i.mTouchOverlay=null,i}return __extends(i,t),i.prototype.InitControl=function(){var t=this,i,r;return this.MyBaseType=n.cdeControlType.Popup,i="margin:0 auto;",this.tileButOkButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=2","ControlTH=1"],PostInitBag:["Title=OK","ClassName=cdeOkButton","Style="+i]}),this.tileButOkButton.SetProperty("OnClick",function(){return t.DoOk()}),this.tileButYesButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=2","ControlTH=1"],PostInitBag:["Title=Yes","ClassName=cdeYesButton","Style="+i]}),this.tileButYesButton.SetProperty("OnClick",function(n,i,r,u,f){return t.DoYes(f,u)}),this.tileButNoButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{PreInitBag:["ControlTW=2","ControlTH=1"],PostInitBag:["Title=No","ClassName=cdeNoButton","Style="+i]}),this.tileButNoButton.SetProperty("OnClick",function(){return t.DoNo()}),this.gridPopups=document.getElementById("gridPopups"),this.gridPopups||(this.gridPopups=document.createElement("div"),this.gridPopups.id="gridPopups",this.gridPopups.className="cdeScreenPopup",this.gridPopups.style.display="none",this.gridPopups.style.height="0px",this.gridPopups.innerHTML='<div class="cdeCenteredPopup" id="gridPopupsInner"><div class="cdePopupContent41" id="cdePopupQuestion">'+n.TL.T("Are you sure?")+'<\/div><table class="MyFullTable"><tr><td id="popupButtonContainer" class="cdeFlexRow"><\/td><\/tr><\/table><\/div>',r=document.getElementsByTagName("body"),r?r[0].appendChild(this.gridPopups):document.appendChild(document.createElement("body")).appendChild(this.gridPopups)),this.gridPopups.addEventListener("animationend",function(){return t.EndHide()}),this.gridPopupsInner=document.getElementById("gridPopupsInner"),this.gridPopupsInner.style.width=n.GetSizeFromTile(6)+"px",this.cdePopupQuestion=document.getElementById("cdePopupQuestion"),this.elePopupButtonContent=document.getElementById("popupButtonContainer"),this.SetElement(this.elePopupButtonContent),!0},i.prototype.SetProperty=function(n,i){t.prototype.SetProperty.call(this,n,i);n==="YesLabel"&&this.tileButYesButton.SetProperty("Text",i);n==="NoLabel"&&this.tileButNoButton.SetProperty("Text",i);n==="OkLabel"&&this.tileButOkButton.SetProperty("Text",i)},i.prototype.AddControl=function(n){n&&this.cdePopupQuestion.appendChild(n.GetElement())},i.prototype.DoYes=function(n,t){this.Hide(!0);this.cdeEventYes&&this.cdeEventYes(this,n,t);this.cdeEventYes=null;this.cdeEventNo=null},i.prototype.DoNo=function(){this.Hide(!0);this.cdeEventNo&&this.cdeEventNo(this);this.cdeEventYes=null;this.cdeEventNo=null},i.prototype.DoOk=function(){this.Hide(!0);this.cdeEventYes&&this.cdeEventYes(this);this.cdeEventYes=null;this.cdeEventNo=null},i.prototype.Hide=function(t){cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===2&&n.MyScreenManager&&n.MyScreenManager.ShowHeader(!1);this.gridPopups.classList.remove("cde-animate-popup");t?this.gridPopups.classList.add("cde-animate-fadeout"):this.EndHide()},i.prototype.EndHide=function(){!this.gridPopups.classList.contains("cde-animate-popup")&&this.gridPopups.classList.contains("cde-animate-fadeout")&&(this.gridPopups.classList.remove("cde-animate-fadeout"),this.gridPopups.style.display="none",n.MyNMIPortal&&n.MyNMIPortal.DeleteControl(this.mTouchOverlay),this.mTouchOverlay=null)},i.prototype.Show=function(t,i,r,u,f,e,o,s){if(this.Hide(!1),this.mTouchOverlay&&(n.MyNMIPortal&&n.MyNMIPortal.DeleteControl(this.mTouchOverlay),this.mTouchOverlay=null),cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===2&&n.MyScreenManager&&n.MyScreenManager.ShowHeader(!0),!this.gridPopups)return null;this.cdeEventYes=null;this.cdeEventNo=null;t!==""&&(this.cdePopupQuestion.innerHTML=n.TL.T(t));this.elePopupButtonContent.innerHTML="";n.MyNMIPortal||(n.MyNMIPortal=n.MyTCF.CreateBaseControl(),n.MyNMIPortal.SetElement(document.getElementById("MyNMIPortal")));this.mTouchOverlay=n.MyTCF.CreateNMIControl(n.cdeControlType.TouchOverlay).Create(n.MyNMIPortal);this.mTouchOverlay.SetProperty("Z-Index",90);i?(this.elePopupButtonContent.appendChild(this.tileButOkButton.GetElement()),typeof f!="undefined"&&(this.cdeEventYes=f)):(o&&(this.tileButYesButton.SetProperty("Cookie",o),this.tileButYesButton.SetProperty("Parent",s)),this.elePopupButtonContent.appendChild(this.tileButNoButton.GetElement()),this.elePopupButtonContent.appendChild(this.tileButYesButton.GetElement()),typeof f!="undefined"&&(this.cdeEventYes=f),typeof e!="undefined"&&(this.cdeEventNo=e));this.SetProperty("YesLabel","Yes");this.SetProperty("NoLabel","No");this.SetProperty("OkLabel","OK");switch(u){case 1:this.gridPopupsInner.className="cdeCenteredPopup cdePopupBackAlarm";break;default:this.gridPopupsInner.className="cdeCenteredPopup cdePopupBackInfo"}return this.AddControl(r),this.gridPopups.classList.add("cde-animate-popup"),this.gridPopups.style.display="block",this.gridPopups.style.height=this.gridPopupsInner.clientHeight+"px",this},i.Show=function(t,i,r,u,f,e,o,s){return n.MyPopUp?n.MyPopUp.Show(t,i,r,u,f,e,o,s):null},i}(n.TheNMIBaseControl),t,i,r;n.ThePopup=u;t=function(t){function i(n){var i=t.call(this,n,null)||this;return i.mToastTopic=null,i.mToastText=null,i.mToastDebug=null,i.mToastGroup=null,i.mBaseCtrl=null,i.IsAlert=!1,i.mRowElement=null,i}return __extends(i,t),i.prototype.InitControl=function(){var t=this,i;return this.MyBaseType=n.cdeControlType.Toast,this.mBaseCtrl=n.MyTCF.CreateBaseControl(),this.mRowElement=document.getElementById("cdeMessageToast"),this.mRowElement||(this.mRowElement=document.createElement("div"),this.mRowElement.className="cdeBrowserBottom",this.mRowElement.id="cdeMessageToast",this.mRowElement.style.display="none",this.mRowElement.style.width="inherit",i=document.getElementsByTagName("body"),i?i[0].appendChild(this.mRowElement):document.appendChild(document.createElement("body")).appendChild(this.mRowElement)),this.mBaseCtrl.SetElement(this.mRowElement),this.mBaseCtrl.SetProperty("Z-Index",5e3),this.mBaseCtrl.GetElement().addEventListener("animationend",function(){return t.EndHide()}),this.SetElement(this.mBaseCtrl.GetElement()),this.mToastGroup=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this),this.mToastGroup.SetProperty("ClassName","cdeToast"),this.mToastGroup.SetProperty("OnClick",function(){t.HideToast();t.IsAlert=!1;t.mBaseCtrl.GetElement().style.display="none";t.SetProperty("Visibility",!1)}),this.mToastTopic=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.mToastGroup,{PreInitBag:["Element=div"],PostInitBag:["ClassName=cdeTextCrop ToastTopic"]}),this.mToastText=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.mToastGroup,{PreInitBag:["Element=div"],PostInitBag:["ClassName=cdeTextCrop ToastText"]}),this.mToastDebug=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.mToastGroup,{PreInitBag:["Element=div"],PostInitBag:["ClassName=cdeTextCrop ToastDebug"]}),this.SetProperty("Visibility",!1),n.MyEngine&&n.MyEngine.RegisterEvent("NMI_TOAST",this.ShowToastMessage),!0},i.prototype.SetProperty=function(n,i){this.mToastGroup&&(n==="Visibility"||this.GetProperty("Visibility")===!0)&&(t.prototype.SetProperty.call(this,n,i),n==="Text"||n==="Value"||n==="iValue"?this.mToastTopic.SetProperty("Text",i):n==="LongText"&&this.mToastText.SetProperty("Value",i))},i.prototype.ShowHideToast=function(){this.mToastGroup&&(this.mBaseCtrl.GetElement().style.display==="none"?(this.mBaseCtrl.GetElement().style.display="",this.mBaseCtrl.GetElement().style.height=this.mToastGroup.GetElement().style.height,this.SetProperty("Visibility",!0)):(this.mBaseCtrl.GetElement().style.display="none",this.mBaseCtrl.GetElement().style.height="0px",this.ClearDebug(),this.SetProperty("Visibility",!1)))},i.prototype.ShowToastMessage=function(n,t,i){var u=this,r;this.mToastGroup&&(this.IsAlert||(n==="ALERT"?this.IsAlert=!0:this.mToastTopic.SetProperty("Text",n),t?this.mToastText.SetProperty("Text",t):this.mToastText.SetProperty("Text",""),this.GetProperty("Visibility")!==!0&&(this.SetProperty("Visibility",!0),this.mBaseCtrl.GetElement().classList.add("cde-animate-bottom"),this.mBaseCtrl.GetElement().style.display="",r=2e3,i&&i>500&&(r=i),setTimeout(function(){u.HideToast()},r),cde.MyBaseAssets.MyCommStatus.UserPref&&cde.MyBaseAssets.MyCommStatus.UserPref.SpeakToasts&&cdeSpeech.talk(n))))},i.prototype.HideToast=function(){this.mBaseCtrl.GetElement().classList.remove("cde-animate-bottom");this.mBaseCtrl.GetElement().classList.add("cde-animate-fadeout")},i.prototype.EndHide=function(){this.mBaseCtrl.GetElement().classList.contains("cde-animate-bottom")||(this.mBaseCtrl.GetElement().classList.remove("cde-animate-fadeout"),this.mBaseCtrl.GetElement().style.display="none",this.SetProperty("Visibility",!1),this.IsAlert=!1)},i.prototype.ShowDebug=function(n){this.mToastDebug&&this.mToastDebug.SetProperty("Value",n)},i.prototype.ClearDebug=function(){this.mToastDebug&&this.mToastDebug.SetProperty("Value","")},i}(n.TheNMIBaseControl);n.TheToast=t;i=function(t){function i(n){return t.call(this,n,null)||this}return __extends(i,t),i.prototype.InitControl=function(){return this.MyBaseType=n.cdeControlType.ToolTip,!0},i.prototype.Hide=function(){},i.prototype.Show=function(){},i}(n.TheNMIBaseControl);n.ctrlToolTip=i;r=function(t){function i(n){return t.call(this,n,null)||this}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){this.MyBaseType=n.cdeControlType.UserMenu;t.prototype.InitControl.call(this,i,r,u,f);var e=cde.CInt(this.GetSetting("TileFactorY")),o="5x";return e===0?e=1:o="3x",this.mOuterGroup=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(i,{PreInitBag:["ControlTW=2","ControlTH=1","TileFactorX="+e,"TileFactorY="+e]}),cde.MyBaseAssets.MyServiceHostInfo.IsUserLoggedIn===!0&&(this.mAccountButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.mOuterGroup,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX="+e,"TileFactorY="+e],PostInitBag:["Title=<span class='fa fa-"+o+"'>&#xf2bd;<\/span>","ClassName=MyHeaderButton"]}),this.mAccountButton.SetProperty("OnClick",function(){n.MyScreenManager.TransitToScreen("E15AE1F2-69F3-42DC-97E8-B0CC2A8526A6",!0)})),this.mLogoutButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this.mOuterGroup,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorX="+e,"TileFactorY="+e],PostInitBag:["Title=<span class='fa fa-"+o+"'>&#xf011;<\/span>","ClassName=MyHeaderButton"]}),this.mLogoutButton.SetProperty("OnClick",function(t,i){i.button===2&&cde.MyBaseAssets.MyServiceHostInfo.WasPortalRequested===!0?n.MyScreenManager.TransitToScreen(cde.MyBaseAssets.MyServiceHostInfo.PortalScreen):n.ResetBrowserToPortal()}),this.SetElement(this.mOuterGroup.GetElement()),!0},i}(n.TheNMIBaseControl);n.ctrlUserMenu=r}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.MyLabelDiv=null,i.MyLabelTextDiv=null,i.MyEditControl=null,i.MyAnchor=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var o,e;return this.MyBaseType=n.cdeControlType.SmartLabel,t.prototype.InitControl.call(this,i,r,u,f),this.MyFieldInfo&&(this.SetProperty("Format",this.GetSetting("Format")),this.SetProperty("IsInTable",this.GetSetting("IsInTable"))),o=!1,this.MyFieldInfo?this.GetSetting("Element")?this.MyLabelDiv=document.createElement(this.GetSetting("Element")):(this.MyLabelDiv=document.createElement("div"),this.MyLabelDiv.style.width="100%"):this.MyLabelDiv=this.GetSetting("Element")?document.createElement(this.GetSetting("Element")):document.createElement("span"),e=this.GetSetting("ValueTitle"),e&&(this.MyLabelTextDiv=document.createElement("div"),this.MyLabelTextDiv.style.width="100%",this.MyLabelTextDiv.innerHTML=e,this.GetSetting("ValueTitleColor")&&(this.MyLabelTextDiv.style.color=this.GetSetting("ValueTitleColor")),this.GetSetting("ValueTitleSize")&&(this.MyLabelTextDiv.style.fontSize=this.GetSetting("ValueTitleSize")+"px")),this.MyLabelDiv.innerHTML="&nbsp;",this.SetElement(this.MyLabelDiv,o),this.MyLabelTextDiv&&this.MyLabelDiv.parentElement.insertBefore(this.MyLabelTextDiv,this.MyLabelDiv),!0},i.prototype.SetProperty=function(i,r){if(!cde.CBool(t.prototype.GetProperty.call(this,"IsInTable"))||i!=="TileHeight"&&i!=="TileWidth"&&i!=="TileLeft"&&i!=="TileTop")if(t.prototype.SetProperty.call(this,i,r),i==="Value"||i==="Text"||i==="iValue")i==="Text"&&(r=n.TL.T(r)),r=n.GenerateFinalString(r,this.GetProperty("Cookie")),this.MyLabelDiv&&(this.GetProperty("ThingFriendlyName")?this.MyLabelDiv.innerHTML=this.GetProperty("ThingFriendlyName"):cde.CBool(t.prototype.GetProperty.call(this,"IsInTable"))?this.GetToolTip(this.MyLabelDiv,this.ShowFieldContent(cde.IsNotSet(r)?"":r.toString(),this.MyFieldInfo,this.MyScreenID)):this.MyLabelDiv.innerHTML=this.ShowFieldContent(cde.IsNotSet(r)?"":r.toString(),this.MyFieldInfo,this.MyScreenID)),this.MyEditControl&&this.MyEditControl.SetProperty(i,r);else if(i==="Format"){if(this.MyLabelDiv){var u=t.prototype.GetProperty.call(this,"Value");cde.CBool(t.prototype.GetProperty.call(this,"IsInTable"))?this.GetToolTip(this.MyLabelDiv,this.ShowFieldContent(cde.IsNotSet(u)?"":u.toString(),this.MyFieldInfo,this.MyScreenID)):this.MyLabelDiv.innerHTML=this.ShowFieldContent(cde.IsNotSet(r)?"":r.toString(),this.MyFieldInfo,this.MyScreenID)}}else i==="UXID"&&this.MyFieldInfo.Type===n.cdeControlType.ThingPicker?n.MyEngine&&n.MyEngine.PublishToNMI("NMI_GET_DATA:THINGRESOLVE:"+this.GetProperty("ID")+":"+this.GetProperty("UXID")+";20:"+this.GetProperty("Value"),"",this.MyFieldInfo?this.MyFieldInfo.cdeN:null):i==="ThingFriendlyName"?this.MyLabelDiv.innerHTML=r:i==="ID"?this.MyLabelDiv&&(this.MyLabelDiv.id=r):i==="MainBackground"||i==="MainClassName"||i==="ContainerClassName"?this.MyTE&&this.MyTE.SetProperty(i,r):i==="Background"?this.MyTE?this.MyTE.SetProperty("MainBackground",r):this.MyLabelDiv&&(this.MyLabelDiv.style.background=r):i==="Foreground"?this.MyLabelDiv&&(this.MyLabelDiv.style.color=r):i==="TileWidth"?this.MyLabelDiv&&(this.MyLabelDiv.style.width=n.GetSizeFromTile(this.GetProperty("TileWidth")).toString()+"px",cde.CBool(this.GetProperty("Truncate"))&&(this.MyLabelDiv.style.maxWidth=n.GetSizeFromTile(this.GetProperty("TileWidth")).toString()+"px")):i==="TileHeight"?this.MyLabelDiv&&(this.MyLabelDiv.style.height=n.GetSizeFromTile(this.GetProperty("TileHeight")).toString()+"px"):i==="Disabled"?this.MyEditControl&&this.MyEditControl.SetProperty(i,r):i==="Truncate"&&cde.CBool(r)===!0&&this.MyLabelDiv&&(this.MyLabelDiv.style.textOverflow="ellipsis",this.MyLabelDiv.style.overflow="hidden",this.MyLabelDiv.style.maxWidth=n.GetSizeFromTile(this.GetProperty("TileWidth")).toString()+"px")},i.prototype.GetToolTip=function(t,i){var r=this,u;if(!n.MyToolTip||!i||i.length===0||!cde.MyBaseAssets.MyCommStatus.UserPref||cde.MyBaseAssets.MyCommStatus.UserPref.ShowToolTipsInTable===!1){t.innerHTML=i;return}i.length>cde.CInt(this.GetSetting("FldWidth"))*7&&i.indexOf("-")<0&&i.indexOf(" ")<0?(t.innerHTML="",this.MyAnchor||(u="a_"+this.GetProperty("ID"),this.MyAnchor=document.createElement("a"),this.MyAnchor.id=u,this.MyAnchor.innerHTML="<i class='fa'>&#xf103;<\/i>",this.MyAnchor.addEventListener("mouseenter",function(){n.MyToolTip&&n.MyToolTip.Show(u,r.GetProperty("ToolTip")?r.GetProperty("ToolTip"):r.GetProperty("Text")?r.GetProperty("Text"):r.GetProperty("Value"))},!1)),t.appendChild(this.MyAnchor),t.insertAdjacentHTML("beforeend",i)):t.innerHTML=i},i.prototype.sinkValueChanged=function(t,i){t.MyBaseType===n.cdeControlType.ThingPicker&&this.SetProperty("ThingFriendlyName",t.GetProperty("ThingFriendlyName"));this.restoreValue(t,i);this.SetProperty("Value",i)},i.prototype.restoreValue=function(i,r){n.ResetKeyCorder();n.MyTouchOverlay&&(n.MyTouchOverlay.UnregisterEvent("Touched",null),this.DeleteControl(n.MyTouchOverlay),n.MyTouchOverlay=null);this.MyEditControl&&(this.DeleteControl(this.MyEditControl),this.MyEditControl=null);this.SetProperty("IsUnhooked",!1);var u=i.ShowFieldContent(r,this.MyFieldInfo);try{cde.CBool(t.prototype.GetProperty.call(this,"IsInTable"))?this.GetToolTip(this.MyLabelDiv,u):this.MyLabelDiv.innerHTML=u}catch(f){}},i.prototype.EditControl=function(t,i){var r=this,u;if(this.MyFieldInfo.Type===n.cdeControlType.SingleCheck){if(cde.CBool(this.GetSetting("IsReadOnly"))||this.IsDisabled)return;i.IsOnObject&&(n.StopPointerEvents(t),n.MyTouchOverlay||(this.MyLabelDiv.innerHTML="",n.MyTouchOverlay=n.MyTCF.CreateNMIControl(n.cdeControlType.TouchOverlay).Create(this),n.MyTouchOverlay.RegisterEvent("Touched",function(){return r.restoreValue(r,cde.CStr(r.GetProperty("Value")))}),this.MyEditControl=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleCheck).Create(this,{ScreenID:this.MyScreenID,TRF:this.MyTRF}),n.MyTouchOverlay.CurrentControl=this,this.MyEditControl.SetProperty("UpdateTable",!0),this.MyEditControl.SetProperty("OnValueChanged",function(n,t,i){return r.sinkValueChanged(n,i)})))}else if((this.MyFieldInfo.Flags&2)!=0&&this.MyFieldInfo.Type!==n.cdeControlType.SmartLabel){if(this.GetSetting("IsReadOnly")===!0||this.IsDisabled||cde.CBool(this.GetSetting("WriteOnce"))===!0&&cde.CStr(this.GetProperty("Value")))return;if(!n.MyTouchOverlay){if(n.StopPointerEvents(t),this.MyFieldInfo.Type===n.cdeControlType.TileButton){this.FireEvent(!1,"OnClick");return}this.SetProperty("IsUnhooked",!0);this.MyLabelDiv.innerHTML="";n.MyTouchOverlay=n.MyTCF.CreateNMIControl(n.cdeControlType.TouchOverlay).Create(this);n.MyTouchOverlay.RegisterEvent("Touched",function(){return r.restoreValue(r,cde.CStr(r.GetProperty("Value")))});n.MyTouchOverlay.SetProperty("PreventDefault",!0);u=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry);this.MyTRF.FldInfo.IsInTable=this.GetSetting("IsInTable");u.MyDataView=this.MyDataView;u.InitControl(this,this.MyTRF,null,this.MyScreenID);u.SetProperty("Z-Index",1300);u.SetProperty("NoTE",!0);switch(this.MyTRF.FldInfo.Type){case n.cdeControlType.CheckField:u.SetProperty("TileWidth",this.MyTRF.FldInfo.Bits);break;case n.cdeControlType.ComboOption:u.SetProperty("TileWidth",cde.CInt(this.MyTRF.FldInfo.FldWidth)-1);break;default:u.SetProperty("TileWidth",this.MyTRF.FldInfo.FldWidth)}u.CreateControl("inTableClick",function(t){t.SetProperty("UXID",t.MyFieldInfo.cdeMID);t.SetProperty("Z-Index",1300);t.SetProperty("OnValueChanged",function(t,i,u){n.MyTouchOverlay&&(r.SetProperty("LiveOptions",t.GetProperty("LiveOptions")),r.MyNMIControl&&r.MyNMIControl.SetProperty("Value",u),r.sinkValueChanged(t,u))})});this.MyEditControl=u}}},i.Create=function(n,t,r,u,f,e,o,s,h,c){var l=new i(r);return f&&l.SetProperty("Element",f),l.SetProperty("IsInTable",cde.CBool(c)),l.InitControl(n,r,null,t),cde.CBool(e)&&l.SetProperty("IsReadOnly",e),h&&l.SetProperty("Parent",h),s&&l.SetProperty("Cookie",s),u&&l.SetProperty("iValue",u),o&&l.SetProperty("ClassName",o),l},i}(n.TheNMIBaseControl);n.ctrlSmartLabel=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.s2=null,i.divTitle=null,i.divOuter=null,i.divInner=null,i.divControl=null,i.IsDIV=!1,i.mFormat=null,i.IsTesla=!1,i.mHoverAdd="cdeButtonHover2",i}return __extends(i,t),i.Create=function(n,t,r,u,f,e,o,s,h,c){var l=new i;return u&&l.SetProperty("ControlTW",u),f&&l.SetProperty("ControlTH",f),l.InitControl(n),r&&l.SetProperty("Title",r),s&&l.SetProperty("Cookie",s),h&&l.SetProperty("Parent",h),e&&l.SetProperty("ClassName",e),o&&l.SetProperty("Style",o),t&&l.SetProperty("OnClick",t),c&&l.SetProperty("PreventDefault",c),l},i.prototype.InitControl=function(i,r,u,f){var e=this;return this.MyBaseType=n.cdeControlType.TileButton,t.prototype.InitControl.call(this,i,r,u,f),this.IsTesla=cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===5,this.IsTesla&&(this.mHoverAdd="cdeTesButton"),this.s2=document.createElement("button"),this.s2.type="button",this.SetProperty("ButtonStyle",0),this.SetTileStyle(),this.RegisterEvent("PointerDown",function(n,t,i){return e.eventTileDown(n,t,i)}),this.RegisterEvent("PointerUp",function(n,t,i){return e.eventTileExit(n,t,i)}),this.SetElement(this.s2,!1),this.SetProperty("Disabled",this.MyFieldInfo&&typeof this.MyFieldInfo.Flags!="undefined"&&(this.MyFieldInfo.Flags&2)==0),this.CreateTileButtonContent(),this.MyContainerElement=this.divInner,!0},i.prototype.SetProperty=function(i,r){var u=this,o,f,e;i==="TileWidth"&&(i="ControlTW");i==="TileHeight"&&(i="ControlTH");t.prototype.SetProperty.call(this,i,r);i==="HTML"?n.cdeParseHTML(this,this.MyTRF,r):i==="StaticHTMLUrl"?n.MyEngine&&n.MyEngine.cdeGetResource(r,function(t,i){var r,f,e;if(i&&!i.startsWith("ERR:")){for(;;){if(r=n.ReturnStringSegment(i,"<%P:","%>"),r===null)break;f=new n.TheControlBlock;f.TargetID="CNMIC"+n.MyNMISettings.IDCounter++;u.SetProperty(r.Inner+"_TCB",f);e=u.GetProperty(r.Inner);e||(e="");i=i.replace(r.Outer,"<span ID="+f.TargetID+">"+e+"<\/span>")}u.GetContainerElement().innerHTML=n.GenerateFinalString(i,!1,u.MyTRF)}}):i==="HTMLUrl"?n.MyEngine&&n.MyEngine.cdeGetResource(r,function(t,i){i&&!i.startsWith("ERR:")&&n.cdeParseHTML(u,u.MyTRF,i)}):i==="Background"?this.s2&&(this.s2.style.backgroundColor=r):i==="BackgroundImage"?this.s2&&(this.s2.style.backgroundImage=r):i==="Foreground"?this.divTitle&&(this.divTitle.style.color=r):i==="FontSize"?this.divTitle&&(this.divTitle.style.fontSize=r+"px"):i==="TabIndex"?this.s2&&(r=cde.CInt(r),this.s2.tabIndex=cde.CInt(r)):i==="Format"?(o=!1,this.mFormat||(o=!0),this.mFormat=r,o&&(this.SetProperty("RTitle",this.divTitle.innerHTML),this.SetTileTitle("Text",this.divTitle.innerHTML))):(i==="Title"||i==="Caption"||i==="Text"||i==="Value"||i==="iValue")&&r?(this.SetProperty("RTitle",r),this.SetTileTitle(i,r)):i==="OnPointerDown"&&this.s2?r&&(this.PreventManipulation=!0,this.HookEvents(!1),this.RegisterEvent("PointerDown",r)):i==="OnClick"&&this.s2?(r&&(this.PreventManipulation=!0,this.HookEvents(!1),this.SetHoverStyle(cde.CBool(this.GetProperty("Disabled"))),this.RegisterEvent("FireOnClick",this.FireClick)),this.RegisterEvent("OnClick",r),this.s2.onkeyup=function(t){t.keyCode===13||t.keyCode===32?(u.WasClicked=!1,u.FireClick(u,t)):t.keyCode===36&&n.MyScreenManager&&n.MyScreenManager.GotoStationHome(!1)}):i==="OnTileDown"?(this.RegisterEvent("OnTileDown",r),r&&(this.PreventManipulation=!0,this.HookEvents(!1))):i==="EnableTap"?(this.PreventManipulation=!0,this.HookEvents(!1),this.SetHoverStyle(cde.CBool(this.GetProperty("Disabled")),!0)):(i==="Disabled"||i==="DisableClick")&&this.s2?(this.SetHoverStyle(cde.CBool(r)),this.IsDIV||(this.s2.disabled=cde.CBool(r),cde.CBool(r)&&(this.s2.style.outlineStyle="none")),i==="Disabled"&&this.MyNMIControl&&this.MyNMIControl.SetProperty(i,r)):this.MyNMIControl&&i.substr(0,1)==="."?this.MyNMIControl&&this.MyNMIControl.SetProperty(i.substr(1),r):i==="ControlTW"||i==="TileFactorX"?(this.SetTileStyle(),this.SetSizes()):i==="ControlTH"||i==="TileFactorY"?(this.SetTileStyle(),this.SetSizes()):i==="ClassName"&&this.SetSizes();i==="InnerControl"&&r&&this.SetInnerControl(r);i==="SubTitle"&&r?this.SetTileTitle("Title",this.GetProperty("RTitle")):i.toLowerCase()==="thumbnail"&&(f=r.split(";"),f[0].startsWith("FA")?this.SetTileTitle("Title",this.GetProperty("RTitle")):(e=n.MyTCF.CreateNMIControl(n.cdeControlType.Picture).Create(null,{PostInitBag:["iValue="+f[0],"FullWidth=-1","FullHeight=-1"]}),f.length>1?(e.SetProperty("Opacity",f[1]),f.length>2&&e.SetProperty("ClassName",f[2])):e.SetProperty("Opacity",.2),this.SetInnerControl(e)))},i.prototype.SetHoverStyle=function(n,i){this.s2&&(n?(this.s2.classList.contains(this.mHoverAdd)&&this.s2.classList.remove(this.mHoverAdd),this.SetProperty("TabIndex",-1)):t.prototype.GetProperty.call(this,"OnClick")||i===!0?this.s2.classList.contains(this.mHoverAdd)||this.s2.classList.add(this.mHoverAdd):this.s2.classList.contains(this.mHoverAdd)&&this.s2.classList.remove(this.mHoverAdd))},i.prototype.SetTileStyle=function(){var n=cde.CInt(this.GetProperty("ControlTW")),t=cde.CInt(this.GetProperty("ControlTH"));n<2?(!this.GetProperty("ClassName")&&this.s2&&(this.s2.className="cdeLiveTileSmall"),this.SetProperty("ButtonStyle",1)):t<n?n>6?(!this.GetProperty("ClassName")&&this.s2&&(this.s2.className="cdeLiveTileVeryLong"),this.SetProperty("ButtonStyle",4)):(!this.GetProperty("ClassName")&&this.s2&&(this.s2.className="cdeLiveTileLong"),this.SetProperty("ButtonStyle",3)):(!this.GetProperty("ClassName")&&this.s2&&(this.s2.className="cdeLiveTile"),this.SetProperty("ButtonStyle",2));this.SetHoverStyle(cde.CBool(this.GetProperty("Disabled")))},i.prototype.SetTileTitle=function(t,i){var r,u;this.mFormat&&(i=this.mFormat.format(i));this.MyNMIControl&&this.MyNMIControl.MyBaseType!==n.cdeControlType.Picture&&t!=="Title"&&t!=="Text"?cde.CInt(this.MyNMIControl.MyBaseType)!==cde.CInt(n.cdeControlType.Picture)&&this.MyNMIControl.SetProperty(t,i):(r=this.GetProperty("Thumbnail"),this.divTitle&&(i||r)&&(i&&(i=n.IconShim(i)),r&&r.startsWith("FA")&&(i="<i class='fa faIcon "+(r.substr(3,1)==="S"?"fa-spin ":"")+"fa-"+r.substr(2,1)+"x'>&#x"+r.substr(4,r.length-4)+";<\/i><\/br>"+(i?i:"")),u=this.GetProperty("SubTitle"),u&&(i+="<\/br><span style='font-size:10px'>"+u+"<\/span>"),this.divTitle.innerHTML=t==="Text"||t==="Title"?n.TL.T(i):n.IconFAShim(i),this.divInner.style.display=""))},i.prototype.CreateTileButtonContent=function(){this.s2&&(this.s2.innerHTML="",this.SetTileStyle(),this.divOuter=document.createElement("div"),this.divOuter.style.overflow="hidden",this.divOuter.style.pointerEvents="none",this.divOuter.style.position="relative",this.divInner=document.createElement("div"),this.divInner.style.zoom=cde.MyBaseAssets.MyServiceHostInfo.TileScale.toString(),this.divTitle=document.createElement("div"),this.GetProperty("Value")?this.divTitle.innerHTML=this.GetProperty("Value"):this.GetProperty("Title")&&(this.divTitle.innerHTML=this.GetProperty("Title")),this.divInner.appendChild(this.divTitle),this.divOuter.appendChild(this.divInner),this.SetSizes(),this.s2.appendChild(this.divOuter))},i.prototype.SetSizes=function(){var t,i,n;if(this.divOuter){if(this.SetInitialSize(),this.divOuter.style.width="inherit",this.divOuter.style.height="inherit",this.divInner.style.width="inherit",this.divInner.style.zIndex="10",this.divOuter.className="cdeFlexRow cdeFlexCenter",this.divInner.className="cdeFlexO0",this.GetProperty("ClassName")&&(this.s2.className=this.GetProperty("ClassName")),this.divTitle)if(this.GetProperty("ClassName")){for(t=this.GetProperty("ClassName").split(" "),i="",n=0;n<t.length;n++)i+=t[n]+"inner ";this.divTitle.className=i}else this.GetProperty("ButtonStyle")==="2"?this.SetButtonStyle2():this.divTitle.className=this.GetProperty("ButtonStyle")==="1"?"cdeTileTextSmall":"cdeTileTextNoImg";this.SetHoverStyle(cde.CBool(this.GetProperty("Disabled")))}},i.prototype.SetButtonStyle2=function(){this.divTitle.className="cdeTileText";this.divInner.className="cdeFlexO2";this.divOuter.className="cdeFlexRow cdeFlexCenter cdeFlexStart"},i.prototype.SetInnerControl=function(n){this.divTitle&&n&&(this.MyNMIControl=n,this.divControl=document.createElement("div"),this.divControl.className="cdeFlexRow cdeFlexCenter",this.divControl.style.width="inherit",this.divControl.style.position="absolute",this.divControl.style.left="0",this.divControl.style.top="0",this.divTitle.innerHTML!==""&&(this.divInner.style.alignSelf="flex-end",this.divInner.style.marginBottom="5px"),this.divControl.appendChild(this.MyNMIControl.GetElement()),this.divOuter.appendChild(this.divControl))},i.prototype.eventHoverIn=function(n){this.ShowHoverIn(n.target)},i.prototype.ShowHoverIn=function(n){if(n instanceof HTMLButtonElement){var t=this.GetProperty("HoverClassName");t||(t="cdeButtonHover2");t&&n.classList.add(t)}},i.prototype.eventHoverOut=function(n){this.ShowHoverOut(n.target)},i.prototype.ShowHoverOut=function(n){if(n instanceof HTMLButtonElement){var t=this.GetProperty("HoverClassName");t||(t="cdeButtonHover2");t&&n.classList.contains(t)&&n.classList.remove(t)}},i.prototype.eventTileDown=function(n,t,i){this.GetProperty("Disabled")||(i.IsOnObject||cde.CBool(this.GetProperty("IgnoreHitTarget")))&&(this.WasClicked=!1,this.SetProperty("IsDown",!0),this.ShowHoverIn(this.s2),this.FireEvent(!0,"OnTileDown",t,i))},i.prototype.eventTileExit=function(t,i,r){this.GetProperty("Disabled")||(this.SetProperty("IsDown",!1),this.ShowHoverOut(this.s2),(r.IsOnObject||cde.CBool(this.GetProperty("IgnoreHitTarget")))&&r.PathLength()<n.MyNMISettings.DeadPathLength&&this.FireClick(this,i))},i.prototype.FireClick=function(t,i){var r=this;this.HasEvent("OnClick")&&!this.WasClicked&&(this.GetProperty("AreYouSure")?n.MyPopUp&&n.MyPopUp.Show(this.GetProperty("AreYouSure"),!1,null,1,function(){i.AYSFired=!0;r.DoFireClick(r,i)}):this.DoFireClick(this,i))},i.prototype.OnNUITag=function(){this.WasClicked=!1;this.FireClick(null)},i}(n.TheNMIBaseControl),i;n.ctrlTileButton=t;i=function(t){function i(n){var i=t.call(this,n)||this;return i.MyLogoParts=Array(),i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e,o;return this.MyBaseType=n.cdeControlType.LogoButton,t.prototype.InitControl.call(this,i,r,u,f),this.tLogoGroup=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(null),this.tLogoGroup.SetProperty("IsDivOnly",!0),e=cde.CInt(this.GetSetting("TileFactorY")),e<1&&(e=1),o=cde.CInt(this.GetSetting("TileHeight")),o<1&&(o=1),this.tLogoGroup.SetProperty("Style","font-size:"+n.GetSizeFromTile(o)/e+"px"),this.MyLogoParts[0]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-B cdeButtonHover2"]}),this.MyLogoParts[0].SetProperty("Foreground","#1DA3D1"),this.MyLogoParts[1]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-C cdeButtonHover2"]}),this.MyLogoParts[1].SetProperty("Foreground","#1DA3D1"),this.MyLogoParts[2]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-D cdeButtonHover2"]}),this.MyLogoParts[2].SetProperty("Foreground","#1DA3D1"),this.MyLogoParts[3]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-E cdeButtonHover2"]}),this.MyLogoParts[3].SetProperty("Foreground","#CCCCCC"),this.MyLogoParts[4]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-F cdeButtonHover2"]}),this.MyLogoParts[4].SetProperty("Foreground","#52D0EB"),this.MyLogoParts[5]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-G cdeButtonHover2"]}),this.MyLogoParts[5].SetProperty("Foreground","#CCCCCC"),this.MyLogoParts[6]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-H cdeButtonHover2"]}),this.MyLogoParts[6].SetProperty("Foreground","#52D0EB"),this.MyLogoParts[7]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-I cdeButtonHover2"]}),this.MyLogoParts[7].SetProperty("Foreground","#52D0EB"),this.MyLogoParts[8]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-J cdeButtonHover2"]}),this.MyLogoParts[8].SetProperty("Foreground","#CCCCCC"),this.MyLogoParts[9]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.tLogoGroup,{PreInitBag:["Element=span"],PostInitBag:["ClassName=cl cl-K cdeButtonHover2"]}),this.MyLogoParts[9].SetProperty("Foreground","#1DA3D1"),this.SetProperty("InnerControl",this.tLogoGroup),!0},i.prototype.SetProperty=function(n,i){var r;if(n!=="Value"&&n!=="iValue"){if(n==="FontSize")this.tLogoGroup.SetProperty("Style","font-size:"+cde.CInt(i)+"px");else if(n==="Relay")this.MyLogoParts[9].SetProperty("Foreground",this.GetState(cde.CInt(i)));else if(n==="LogoState")for(r=0;r<10;r++)this.MyLogoParts[r].SetProperty("Foreground",this.GetState(cde.CInt(i)));else if(n==="LogoColor")for(r=0;r<10;r++)this.MyLogoParts[r].SetProperty("Foreground",i);else n==="Reset"&&(this.MyLogoParts[0].SetProperty("Foreground","#1DA3D1"),this.MyLogoParts[1].SetProperty("Foreground","#1DA3D1"),this.MyLogoParts[2].SetProperty("Foreground","#1DA3D1"),this.MyLogoParts[3].SetProperty("Foreground","#CCCCCC"),this.MyLogoParts[4].SetProperty("Foreground","#52D0EB"),this.MyLogoParts[5].SetProperty("Foreground","#CCCCCC"),this.MyLogoParts[6].SetProperty("Foreground","#52D0EB"),this.MyLogoParts[7].SetProperty("Foreground","#52D0EB"),this.MyLogoParts[8].SetProperty("Foreground","#CCCCCC"),this.MyLogoParts[9].SetProperty("Foreground","#1DA3D1"));t.prototype.SetProperty.call(this,n,i)}},i.prototype.GetState=function(n){switch(n){case 1:return"green";case 2:return"yellow";case 3:return"red";case 4:return"blue";case 5:return"brown";case 6:return"purple";case 7:return"black"}return"#ccc"},i}(t);n.ctrlLogoButton=i}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.MyControlTypeName=null,i.MyTEContainer=null,i.MyTEContent=null,i.mOldClassName=null,i.MyTELabel=null,i.mTEContentOuter=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var s=this,e,h,c,o;if(this.MyBaseType=n.cdeControlType.TileEntry,t.prototype.InitControl.call(this,i,r,u,f),this.MyTEContainer=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(i,{ScreenID:f}),this.MyTEContainer.SetProperty("ClassName","cdeFlexRow cdeFlexCenter cdeTileContainer"),r&&r.FldInfo&&(this.MyTEContainer.GetElement().setAttribute("cdefo",cde.CStr(r.FldInfo.FldOrder)),this.MyTEContainer.GetElement().setAttribute("cdemid",cde.GuidToString(r.FldInfo.cdeMID))),this.MyTELabel=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this.MyTEContainer,{ScreenID:f}),this.MyTELabel.SetProperty("LabelElement","span"),this.MyTELabel.SetProperty("LabelClassName","cdeTileEntryLabel"),this.MyTELabel.SetProperty("ClassName","cdeFlexLabel"),this.mTEContentOuter=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this.MyTEContainer,{ScreenID:f}),this.mTEContentOuter.SetProperty("ClassName","cdeFlexRow cdeFlexCenter cdeFlexStart cdeControlContainer"),this.MyTEContent=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this.mTEContentOuter,{ScreenID:f}),this.MyTEContent.SetProperty("ClassName","cdeTileEntryText"),this.SetElement(this.MyTEContainer.GetElement(),!1,this.MyTEContent.GetElement(),!0),r.FldInfo.RenderTarget&&this.SetProperty("Visibility",!1),e=cde.CInt(this.GetSetting("TileWidth")),e<=0&&(cde.CBool(this.GetSetting("InheritWidth"))?e=i.GetProperty("ControlTW")?i.GetProperty("ControlTW"):Math.round(i.GetElement().clientWidth/n.GetSizeFromTile(1)):e===0&&(e=6)),this.SetProperty("TileWidth",e),h=1,cde.CInt(this.GetSetting("TileHeight"))>0&&(h=this.GetSetting("TileHeight")),cde.CInt(this.GetSetting("TileHeight"))>=0&&this.SetProperty("TileHeight",h),this.MyControlTypeName=r.FldInfo.ControlType,this.MyControlTypeName&&(c=n.MyTCF.GetControlByName(this.MyControlTypeName),c&&(o=c.split(":"),this.MyControlTypeName=o[0],o.length>1&&(this.MyEngineName=o[1]))),cde.CInt(this.MyControlTypeName)>0&&(this.MyControlTypeName=n.MyTCF.GetControlType(r.FldInfo.Type)),this.MyEngineName||(this.MyEngineName=r.FldInfo.EngineName),r.FldInfo.Type!==n.cdeControlType.UserControl&&(this.MyEngineName=n.eTheNMIEngine,this.MyControlTypeName=n.MyTCF.GetControlType(r.FldInfo.Type),this.MyControlTypeName||(this.MyControlTypeName="cdeNMI.ctrlEditBox")),this.MyControlTypeName&&this.MyControlTypeName!==""||(this.MyControlTypeName=r.FldInfo.DefaultValue),!this.MyControlTypeName)return this.SetProperty("PlaceHolder","Missing Type for UserControl"),!0;r.FldInfo.RenderTarget||r.FldInfo.PlaceHolder?r.FldInfo.PlaceHolder||this.SetProperty("PlaceHolder",r.FldInfo.PlaceHolder):this.SetProperty("PlaceHolder","(Waiting for control #"+r.FldInfo.FldOrder+": "+this.MyControlTypeName+")");switch(r.FldInfo.Type){case n.cdeControlType.Table:cde.IsNotSet(r.FldInfo.ClassName)&&(r.FldInfo.ClassName="CMyTable")}return i.RegisterEvent("OnLoaded",function(){s.MyTEContent.FireEvent(!0,"OnLoaded")}),this.RegisterEvent("Resize",function(n,t){s.MyNMIControl&&s.MyNMIControl.FireEvent(!0,"Resize",t)}),!0},i.prototype.SetProperty=function(n,i){if(n==="IsOwnerDown")if(i===!0){if(this.GetProperty(n)===!0)return;this.mOldClassName=this.MyTEContainer.GetElement().className;this.MyTEContainer.GetElement().className+=" cdeNodeGone"}else{if(this.GetProperty(n)!==!0)return;this.MyTEContainer.GetElement().className=this.mOldClassName}if(n==="IsInTable"){t.prototype.SetProperty.call(this,n,i);return}if(n==="Visibility"){this.MyTEContainer.SetProperty(n,i);return}if(n==="MinTileWidth"&&cde.CInt(i)>0?(t.prototype.SetProperty.call(this,n,i),n="TileWidth"):n==="MinTileHeight"&&i&&(t.prototype.SetProperty.call(this,n,i),n="TileHeight"),n==="NoTE"||n==="TileWidth"||n==="TileHeight"?t.prototype.SetProperty.call(this,n,i):n==="Z-Index"&&this.MyTEContent&&(i=cde.CInt(i),this.MyTEContent.SetProperty("Z-Index",i)),n==="IsAbsolute"||n==="Top"||n==="Left"||n==="TileTop"||n==="TileLeft"){if(cde.CBool(this.GetProperty("IsInTable")))return;t.prototype.SetProperty.call(this,n,i);return}if(n==="TileWidth"||n==="NoTE"){if(cde.CInt(this.GetProperty("TileWidth"))<cde.CInt(this.GetProperty("MinTileWidth")))return;var r=1;cde.CInt(this.GetProperty("TileFactorX"))>1&&(r=cde.CInt(this.GetProperty("TileFactorX")));cde.CBool(this.GetProperty("NoTE"))||cde.CInt(this.GetProperty("TileWidth"))<3*r?(this.DontHideLabel||this.MyTELabel.SetProperty("Visibility",!1),this.MyTEContainer.SetProperty("TileWidth",cde.CInt(this.GetProperty("TileWidth"))),this.mTEContentOuter.SetProperty("TileWidth",cde.CInt(this.GetProperty("TileWidth"))),t.prototype.SetProperty.call(this,"ControlTW",cde.CInt(this.GetProperty("TileWidth")))):(this.MyTELabel.SetProperty("Visibility",!0),this.MyTELabel.SetProperty("TileWidth",2),this.mTEContentOuter.SetProperty("TileWidth",cde.CInt(this.GetProperty("TileWidth"))-2),t.prototype.SetProperty.call(this,"ControlTW",cde.CInt(this.GetProperty("TileWidth"))-2));this.MyNMIControl&&this.MyNMIControl.SetProperty("ControlTW",cde.CInt(this.GetProperty("ControlTW")));return}if(n==="TileHeight"){if(cde.CInt(i)<cde.CInt(this.GetProperty("MinTileHeight")))return;this.MyTEContainer.SetProperty("TileHeight",cde.CInt(i));this.mTEContentOuter.SetProperty("TileHeight",cde.CInt(i));this.MyTELabel.SetProperty("TileHeight",cde.CInt(i));t.prototype.SetProperty.call(this,"ControlTH",cde.CInt(this.GetProperty("TileHeight")));this.MyNMIControl&&this.MyNMIControl.SetProperty("ControlTH",cde.CInt(this.GetProperty("ControlTH")));return}if(n==="TileFactorX")this.MyTEContainer.SetProperty("TileFactorX",cde.CInt(i)),this.mTEContentOuter.SetProperty("TileFactorX",cde.CInt(i)),this.MyTELabel.SetProperty("TileFactorX",cde.CInt(i));else if(n==="TileFactorY")this.MyTEContainer.SetProperty("TileFactorY",cde.CInt(i)),this.mTEContentOuter.SetProperty("TileFactorY",cde.CInt(i)),this.MyTELabel.SetProperty("TileFactorY",cde.CInt(i));else if(n==="ContainerStyle"&&this.MyTELabel)this.MyTEContainer.SetProperty("Style",i);else{if(n==="ContainerClassName"&&this.MyTEContainer){this.MyTEContainer.SetProperty("ClassName",i);return}if(n==="LabelClassName"&&this.MyTELabel){this.MyTELabel.SetProperty("ClassName",i);this.MyTELabel.SetProperty("LabelClassName",i);return}if(n==="LabelForeground"&&this.MyTELabel){this.MyTELabel.SetProperty("LabelForeground",i);return}if(n==="LabelFontSize"&&this.MyTELabel){this.MyTELabel.SetProperty("LabelFontSize",i);return}if((n==="LabelBackground"||n==="CaptionBackground")&&this.MyTELabel){this.MyTELabel.SetProperty("CaptionBackground",i);return}if(n==="ContentOuterClassName"&&this.mTEContentOuter){this.mTEContentOuter.SetProperty("ClassName",i);return}if(n==="MainClassName"&&this.MyTEContent){this.MyTEContent.SetProperty("ClassName",i);return}if(n==="MainBackground"&&this.MyTEContent){this.MyTEContent.SetProperty("Background",i);return}if(n==="VerticalAlignment"&&this.MyTEContent&&i){this.MyTEContent.GetElement().className="cdeTileEntryText cdeFlexRow";switch(i.toString().toLowerCase()){case"top":this.MyTEContent.GetElement().style.alignItems="flex-start";break;case"bottom":this.MyTEContent.GetElement().style.alignItems="flex-end";break;default:this.MyTEContent.GetElement().style.alignItems="center"}return}if((n==="Label"||n==="Title")&&this.MyTELabel){if(this.MyTELabel.SetProperty("Label",i),!cde.CBool(this.GetProperty("NoTE")))return}else if(n==="PlaceHolder"&&this.MyTEContent){this.MyTEContent.SetProperty("Label",i);return}}this.MyNMIControl&&this.MyNMIControl.SetProperty(n,i)},i.prototype.OnLoad=function(n){this.MyNMIControl&&this.MyNMIControl.OnLoad(n);t.prototype.OnLoad.call(this,n)},i.prototype.OnUnload=function(){this.MyNMIControl&&this.MyNMIControl.OnUnload();t.prototype.OnUnload.call(this)},i.prototype.GetProperty=function(n){return(n==="DataItem"||n==="iValue"||n==="Value")&&this.MyNMIControl?this.MyNMIControl.GetProperty(n):t.prototype.GetProperty.call(this,n)},i.prototype.CreateControl=function(t,i){var r=this;return n.MyTCF?n.MyTCF.CreateControlLazy(this,this.MyEngineName,this.MyControlTypeName,function(t,u,f){if(u.InitControl(t,r.MyTRF,null,r.MyScreenID))try{u.SetTE(r);n.MyTCF.SetControlEssentials(r,u);r.SetProperty("PlaceHolder",null);n.AddFieldComment(r.MyTEContent.GetElement(),r.MyFieldInfo);u.PostCreate(r);i&&i(u,f)}catch(e){r.SetProperty("PlaceHolder",e)}},t):(cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","TileEntry:CreateControl","MyTCF not initialized!"),null)},i.prototype.ApplySkin=function(){this.MyNMIControl&&this.MyNMIControl.ApplySkin()},i.Create=function(t,r,u,f){var e=new i(r);return r&&r.FldInfo&&(!r.FldInfo.Type||r.FldInfo.Type===0)&&(r.FldInfo.Type=n.cdeControlType.SingleEnded),e.InitControl(t,r,u,f),e},i}(n.TheNMIBaseControl);n.ctrlTileEntry=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(){var n=t.call(this,null,null)||this;return n.bIsOn=!1,n}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var l=this,e,h;t.prototype.InitControl.call(this,i,r,u,f);this.statusLightHolder=new n.ctrlTileGroup(r);this.statusLightHolder.InitControl(i);this.statusLightHolder.SetProperty("ClassName","cdeFlexRow cdeFlexCenter");this.statusLightHolder.MyRootElement.style.width="inherit";this.statusLightHolder.MyRootElement.style.height="inherit";var o=cde.CInt(this.GetSetting("TileWidth")),s=cde.CInt(this.GetSetting("TileHeight")),c=!1;return r&&r.FldInfo&&(r.FldInfo.ControlTW&&(o=r.FldInfo.ControlTW,this.statusLightHolder.SetProperty("TileWidth",o)),r.FldInfo.ControlTH&&(s=r.FldInfo.ControlTH,this.statusLightHolder.SetProperty("TileHeight",s)),c=cde.CBool(r.FldInfo.IsInTable)),c||(this.statusLightTitle=new n.ctrlSmartLabel,this.statusLightTitle.InitControl(this.statusLightHolder),this.statusLightTitle.SetProperty("Visibility",!1)),this.mShape=new n.ctrlShape,this.mShape.MyFieldInfo=new n.TheFieldInfo(n.cdeControlType.StatusLight,o,null,0),this.mShape.SetProperty("AutoAdjust",!0),this.mShape.InitControl(this.statusLightHolder),o&&this.mShape.SetProperty("ControlTW",o),s&&this.mShape.SetProperty("ControlTH",s),e=cde.CInt(this.GetSetting("TileFactorX")),e>1&&this.mShape.SetProperty("TileFactorX",e),e=cde.CInt(this.GetSetting("TileFactorY")),e>1&&this.mShape.SetProperty("TileFactorY",e),this.SetProperty("iValue",0),this.SetElement(this.statusLightHolder.GetElement()),this.MyFormID&&n.MyScreenManager&&(h=n.MyScreenManager.GetScreenByID(this.MyFormID),h&&h.RegisterEvent("OnLoaded",function(){return l.ApplySkin()})),!0},i.prototype.SetProperty=function(n,i){var o=this,s=!1,r,u,f,e,h;if(n==="Value"||n==="iValue"||n==="LightColor"?s=!0:n==="SubTitle"&&this.statusLightTitle?(this.statusLightTitle.SetProperty("Text",i),this.statusLightTitle.SetProperty("Visibility",!0)):n==="Foreground"&&this.statusLightTitle?this.statusLightTitle.SetProperty(n,i):n==="IsBlinking"&&cde.CInt(i)>0?this.Blinker||(this.Blinker=setInterval(function(){if(cde.CInt(o.GetProperty("IsBlinking"))===0){clearInterval(o.Blinker);o.Blinker=null;return}o.bIsOn?o.SetProperty("Opacity","0.1"):o.SetProperty("Opacity","1");o.bIsOn=!o.bIsOn},cde.CInt(i))):(n==="ControlTW"||n==="ControlTH"||n==="TileWidth"||n==="TileHeight"||n==="TileFactorX"||n==="TileFactorY")&&this.mShape&&this.mShape&&(i=cde.CInt(i),this.mShape.SetProperty(n,i),s=!0),t.prototype.SetProperty.call(this,n,i),s&&this.mShape&&this.mShape.mCanvas){if(r=this.mShape.mCanvas.MyWidth,u=this.mShape.mCanvas.MyHeight,r===0||u===0)return;if(f=r,u<r&&(f=u),e=5,this.GetProperty("SubTitle")&&(e=20),h=this.GetProperty("LightColor"),h)this.myShapeDraw=[{Type:4,Fill:h,Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}];else switch(cde.CInt(this.GetProperty("Value"))%8){default:this.myShapeDraw=[{Type:4,Fill:"gradientc(#808080, #FFFFFF)",Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}];break;case 1:this.myShapeDraw=[{Type:4,Fill:"gradientc(#008000, #00FF00)",Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}];break;case 2:this.myShapeDraw=[{Type:4,Fill:"gradientc(#808000, #FFFF00)",Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}];break;case 3:this.myShapeDraw=[{Type:4,Fill:"gradientc(#800000, #FF0000)",Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}];break;case 4:this.myShapeDraw=[{Type:4,Fill:"gradientc(#000080, #0000FF)",Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}];break;case 5:this.myShapeDraw=[{Type:4,Fill:"gradientc(#000000, #6f4200)",Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}];break;case 6:this.myShapeDraw=[{Type:4,Fill:"gradientc(#400080, #8000FF)",Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}];break;case 7:this.myShapeDraw=[{Type:4,Fill:"gradientc(#000000, #808080)",Width:f/2-e,Top:u/2,Left:r/2,Visibility:!0,IsTemp:!0}]}this.mShape&&this.mShape.SetProperty("DataContext",this.myShapeDraw)}},i.prototype.OnLoad=function(){this.ApplySkin()},i.prototype.ApplySkin=function(){this.mShape.ApplySkin();this.SetProperty("iValue",this.GetProperty("Value"))},i}(n.TheNMIBaseControl),i,r,u;n.ctrlStatusLight=t;i=function(i){function r(){return i.call(this,null,null)||this}return __extends(r,i),r.prototype.InitControl=function(r,u,f,e){var o=this,s,h;return i.prototype.InitControl.call(this,r,u,f,e),this.SetProperty("NoTE",!0),this.SetProperty("MinTileHeight",-1),this.SetProperty("MinTileWidth",6),this.aboutButtonContainer=new n.ctrlTileGroup(u),this.aboutButtonContainer.InitControl(r),this.aboutButtonContainer.SetProperty("TileWidth",6),this.aboutButtonContainer.SetProperty("Background","rgba(128,128,128,.1)"),this.aboutButtonContainer.SetProperty("ClassName","cdeFlexCol cdeAboutBox"),this.topName=new n.ctrlTileGroup,this.topName.InitControl(this.aboutButtonContainer),this.topName.SetProperty("TileWidth",6),this.topName.SetProperty("TileHeight",2),this.topName.SetProperty("ClassName","cdeFlexRow cdeFlexCenter"),this.topName.HookEvents(!0),this.topName.RegisterEvent("PointerUp",function(){o.GetProperty("TargetLink")&&n.MyScreenManager&&n.MyScreenManager.TransitToScreen(o.GetProperty("TargetLink"))}),this.statusShape=new t,this.statusShape.InitControl(this.topName),this.statusShape.SetProperty("TileWidth",2),this.statusShape.SetProperty("TileHeight",2),this.leftTopGroup=new n.ctrlTileGroup,this.leftTopGroup.InitControl(this.topName),this.leftTopGroup.SetProperty("TileWidth",4),this.leftTopGroup.SetProperty("ClassName","cdeFlexCol"),this.pluginName=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.leftTopGroup,{ScreenID:e,PreInitBag:["Element=div"]}),this.pluginName.SetProperty("TileWidth",4),this.pluginName.SetProperty("TileHeight",1),this.pluginName.SetProperty("Style","font-size:30px;"),this.serviceName=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.leftTopGroup,{ScreenID:e,PreInitBag:["Element=div"]}),this.serviceName.SetProperty("TileWidth",4),this.serviceName.SetProperty("TileHeight",1),this.serviceName.SetProperty("Style","overflow-y:auto;overflow-x:hidden;font-size:16px;"),this.collaBox=new n.ctrlCollapsibleGroup,s=new n.TheFieldInfo(n.cdeControlType.CollapsibleGroup,0,null,2),s.PropertyBag=["IsSmall=true"],this.collaBox.InitControl(this.aboutButtonContainer,new n.TheTRF("NONE",0,s)),this.collaBox.SetProperty("TileWidth",6),this.collaBox.SetProperty("Title","About..."),this.collaBox.SetProperty("IsSmall",!0),this.collaBox.SetProperty("DoClose",!0),this.middleBox=new n.ctrlTileGroup,this.middleBox.InitControl(this.collaBox),this.middleBox.SetProperty("TileWidth",6),this.middleBox.SetProperty("TileHeight",1),this.middleBox.SetProperty("ClassName","cdeFlexRow"),this.mdlSquare=new n.ctrlTileGroup,this.mdlSquare.InitControl(this.middleBox),this.mdlSquare.SetProperty("TileWidth",5),this.mdlSquare.SetProperty("TileHeight",1),this.mdlSquare.SetProperty("ClassName","cdeFlexRow cdeFlexCenter"),this.mdlText=new n.ctrlSmartLabel,this.mdlText.InitControl(this.mdlSquare),this.leftSquare=new n.ctrlTileGroup,this.leftSquare.InitControl(this.middleBox),this.leftSquare.SetProperty("TileWidth",1),this.leftSquare.SetProperty("TileHeight",1),this.leftSquare.SetProperty("ClassName","cdeFlexRow cdeFlexCenter"),this.iconImage=new n.ctrlZoomImage,this.iconImage.InitControl(this.leftSquare),this.iconImage.SetProperty("TileWidth",1),this.iconImage.SetProperty("TileHeight",1),this.iconImage.SetProperty("Visibility",!1),this.iconText=new n.ctrlSmartLabel,this.iconText.InitControl(this.leftSquare),this.iconText.SetProperty("TileWidth",1),this.iconText.SetProperty("Visibility",!1),this.rightSquare=new n.ctrlTileGroup,this.rightSquare.InitControl(this.collaBox),this.rightSquare.SetProperty("TileWidth",6),this.rightSquare.SetProperty("TileHeight",1),this.rightSquare.SetProperty("ClassName","cdeFlexRow cdeFlexCenter"),this.rightSquare.SetProperty("Style","-webkit-align-content: flex-start; -ms-flex-line-pack: start; align-content:flex-start;"),this.versionText=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.rightSquare,{ScreenID:e,TRF:n.TheTRF.SetFlagsOnly(256),PreInitBag:["Element=div"]}),this.versionText.SetProperty("TileWidth",3),this.copyrightText=new n.ctrlSmartLabel,this.copyrightText.InitControl(this.rightSquare),this.copyrightText.SetProperty("TileWidth",3),this.adTile=new n.ctrlTileGroup,this.adTile.InitControl(this.collaBox),this.adTile.SetProperty("TileWidth",6),this.adTile.SetProperty("TileHeight",1),this.adTile.SetProperty("ClassName","cdeFlexRow cdeFlexCenter"),this.advertise=new n.ctrlSmartLabel,this.advertise.InitControl(this.adTile),this.SetElement(this.aboutButtonContainer.GetElement()),this.MyFormID&&n.MyScreenManager&&(h=n.MyScreenManager.GetScreenByID(this.MyFormID),h&&h.RegisterEvent("OnLoaded",function(){return o.ApplySkin()})),!0},r.prototype.SetProperty=function(n,t){(i.prototype.SetProperty.call(this,n,t),this.aboutButtonContainer)&&(n==="Title"?this.pluginName.SetProperty("iValue",t):n==="SubTitle"?this.serviceName.SetProperty("iValue",t):n==="Background"?(this.aboutButtonContainer.SetProperty(n,t),t==="black"&&(this.mdlText.SetProperty("Foreground","white"),this.pluginName.SetProperty("Foreground","white"),this.mdlText.SetProperty("Foreground","white"),this.copyrightText.SetProperty("Foreground","white"),this.versionText.SetProperty("Foreground","white"),this.advertise.SetProperty("Foreground","white"),this.statusShape.SetProperty("Foreground","white"),this.iconText.SetProperty("Foreground","white"))):n==="Foreground"?(this.aboutButtonContainer.SetProperty(n,t),this.mdlText.SetProperty("Foreground",t),this.pluginName.SetProperty("Foreground",t),this.mdlText.SetProperty("Foreground",t),this.copyrightText.SetProperty("Foreground",t),this.versionText.SetProperty("Foreground",t),this.advertise.SetProperty("Foreground",t),this.statusShape.SetProperty("Foreground",t),this.iconText.SetProperty("Foreground",t)):n==="Value"||n==="iValue"?this.statusShape.SetProperty("iValue",t):n==="Description"?this.mdlText.SetProperty("Text",t):n==="Copyright"?this.copyrightText.SetProperty("Text",t+"<BR>"+this.GetProperty("Author")):n==="Author"?this.copyrightText.SetProperty("Text",this.GetProperty("Copyright")+"<BR>"+t):n==="Version"||n==="NodeText"?this.versionText.SetProperty("Text","Current Version: "+this.GetProperty("Version")+"<\/br><span style='font-size:10px'>"+this.GetProperty("NodeText")+"<\/span>"):n==="Icon"?(this.iconImage.SetProperty("iValue",t),this.iconImage.SetProperty("Visibility",!0)):n==="IconText"?(this.iconText.SetProperty("Text",t),this.iconText.SetProperty("Visibility",!0)):n==="AdText"?this.advertise.SetProperty("Text","To learn more visit<\/br><a href="+t+" target='_blank'>"+t+"<\/a>"):n==="StatusText"?this.statusShape.SetProperty("Title",t):n==="LastMessage"&&this.serviceName.SetProperty("Text",t))},r.prototype.ApplySkin=function(){this.statusShape.ApplySkin()},r}(n.TheNMIBaseControl);n.ctrlAboutButton=i;r=function(t){function i(n){var i=t.call(this,null,n)||this;return i.divMoTLock=null,i.hControl=null,i.mMoTLockCode="",i.mMoTLockDigits="",i.mShowOverlay=!1,i.mTouched=0,i.mPassField=null,i.k1=null,i.k2=null,i.k3=null,i.k4=null,i.k5=null,i.k6=null,i.k7=null,i.k8=null,i.k9=null,i.k0=null,i.kreset=null,i.kenter=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,o;return this.MyBaseType=n.cdeControlType.MuTLock,t.prototype.InitControl.call(this,i,r,u,f),o="Enter Pin",this.divMoTLock=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(i,{TRF:r}),this.divMoTLock.SetProperty("LabelClassName","cdeMutLock"),this.divMoTLock.SetProperty("Label",o),this.divMoTLock.GetElement().style.marginLeft="0px",this.divMoTLock.GetElement().style.position="fixed",this.divMoTLock.GetElement().style.zIndex="50",this.divMoTLock.GetElement().style.backgroundColor="black",this.divMoTLock.SetProperty("TileWidth",3),this.divMoTLock.SetProperty("OnClick",function(){e.mPassField===null&&e.MyTE!==null&&(e.MyTE.MyTEContainer.GetContainerElement().style.overflow=e.MyTE.MyTEContainer.GetContainerElement().style.overflow==="initial"?"hidden":"initial")}),this.k7=n.ctrlTileButton.Create(this.divMoTLock,null,"7",1,1),this.k7.PreventManipulation=!0,this.k7.PreventDefault=!0,this.k7.SetProperty("OnTileDown",function(){return e.SetDigit(7)}),this.k7.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k7.SetProperty("ClassName","cdeMutButton"),this.k7.SetProperty("FontSize",42),this.k8=n.ctrlTileButton.Create(this.divMoTLock,null,"8",1,1),this.k8.PreventManipulation=!0,this.k8.PreventDefault=!0,this.k8.SetProperty("OnTileDown",function(){return e.SetDigit(8)}),this.k8.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k8.SetProperty("ClassName","cdeMutButton"),this.k8.SetProperty("FontSize",42),this.k9=n.ctrlTileButton.Create(this.divMoTLock,null,"9",1,1),this.k9.PreventManipulation=!0,this.k9.PreventDefault=!0,this.k9.SetProperty("OnTileDown",function(){return e.SetDigit(9)}),this.k9.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k9.SetProperty("ClassName","cdeMutButton"),this.k9.SetProperty("FontSize",42),this.k4=n.ctrlTileButton.Create(this.divMoTLock,null,"4",1,1),this.k4.PreventManipulation=!0,this.k4.PreventDefault=!0,this.k4.SetProperty("OnTileDown",function(){return e.SetDigit(4)}),this.k4.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k4.SetProperty("ClassName","cdeMutButton"),this.k4.SetProperty("FontSize",42),this.k5=n.ctrlTileButton.Create(this.divMoTLock,null,"5",1,1),this.k5.PreventManipulation=!0,this.k5.PreventDefault=!0,this.k5.SetProperty("OnTileDown",function(){return e.SetDigit(5)}),this.k5.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k5.SetProperty("ClassName","cdeMutButton"),this.k5.SetProperty("FontSize",42),this.k6=n.ctrlTileButton.Create(this.divMoTLock,null,"6",1,1),this.k6.PreventManipulation=!0,this.k6.PreventDefault=!0,this.k6.SetProperty("OnTileDown",function(){return e.SetDigit(6)}),this.k6.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k6.SetProperty("ClassName","cdeMutButton"),this.k6.SetProperty("FontSize",42),this.k1=n.ctrlTileButton.Create(this.divMoTLock,null,"1",1,1),this.k1.PreventManipulation=!0,this.k1.PreventDefault=!0,this.k1.SetProperty("OnTileDown",function(){return e.SetDigit(1)}),this.k1.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k1.SetProperty("ClassName","cdeMutButton"),this.k1.SetProperty("FontSize",42),this.k2=n.ctrlTileButton.Create(this.divMoTLock,null,"2",1,1),this.k2.PreventManipulation=!0,this.k2.PreventDefault=!0,this.k2.SetProperty("OnTileDown",function(){return e.SetDigit(2)}),this.k2.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k2.SetProperty("ClassName","cdeMutButton"),this.k2.SetProperty("FontSize",42),this.k3=n.ctrlTileButton.Create(this.divMoTLock,null,"3",1,1),this.k3.PreventManipulation=!0,this.k3.PreventDefault=!0,this.k3.SetProperty("OnTileDown",function(){return e.SetDigit(3)}),this.k3.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k3.SetProperty("ClassName","cdeMutButton"),this.k3.SetProperty("FontSize",42),this.k0=n.ctrlTileButton.Create(this.divMoTLock,null,"0",1,1),this.k0.PreventManipulation=!0,this.k0.PreventDefault=!0,this.k0.SetProperty("OnTileDown",function(){return e.SetDigit(0)}),this.k0.SetProperty("OnClick",function(n,t){return e.CombiDone(t)}),this.k0.SetProperty("ClassName","cdeMutButton"),this.k0.SetProperty("FontSize",42),this.kreset=n.ctrlTileButton.Create(this.divMoTLock,null,"Reset",2,1),this.kreset.PreventManipulation=!0,this.kreset.PreventDefault=!0,this.kreset.SetProperty("ClassName","cdeMutButton"),this.kreset.SetProperty("OnClick",function(t,i,r){r>0&&(n.StopPointerEvents(i),e.mMoTLockCode="",e.mTouched=0,e.mMoTLockDigits="",e.mPassField?e.mShowOverlay?e.mPassField.SetProperty("iValue",e.mMoTLockCode):e.mPassField.SetProperty("Value",e.mMoTLockCode):e.SetProperty("Value",e.mMoTLockCode))}),this.kenter=n.ctrlTileButton.Create(this.divMoTLock,null,"Enter",3,1),this.kenter.PreventManipulation=!0,this.kenter.PreventDefault=!0,this.kenter.SetProperty("Visibility",!1),this.kenter.SetProperty("ClassName","cdeMutButton"),this.kenter.SetProperty("OnClick",function(n,t){e.mPassField?(e.mPassField.IsDirty=!0,e.mPassField.FireEvent(!1,"OnValueChanged",t,e.mMoTLockCode)):e.SetProperty("Value",e.mMoTLockCode)}),this.PreventManipulation=!0,this.SetElement(this.divMoTLock.GetElement()),!0},i.prototype.SetProperty=function(i,r){t.prototype.SetProperty.call(this,i,r);i==="PassField"?(this.mPassField=r,this.divMoTLock.GetElement().style.position="fixed"):i==="Background"?this.divMoTLock&&(this.divMoTLock.GetElement().style.backgroundColor=r):i==="IsOverlay"&&(this.mShowOverlay=cde.CBool(r),this.divMoTLock.GetElement().style.zIndex=(cde.CBool(this.mShowOverlay)?1300:0).toString(),n.SetZIndex(this.k7.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k8.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k9.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k4.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k5.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k6.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k1.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k2.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k3.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.k0.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),n.SetZIndex(this.kreset.GetElement(),cde.CBool(this.mShowOverlay)?1300:0),this.kenter.SetProperty("Visibility",this.mShowOverlay),n.SetZIndex(this.kenter.GetElement(),cde.CBool(this.mShowOverlay)?1300:0))},i.prototype.SetDigit=function(n){this.mTouched++;this.mMoTLockDigits+=n.toString()},i.prototype.CombiDone=function(t){this.mTouched>0&&(this.mTouched=0,this.mMoTLockCode.length>0&&(this.mMoTLockCode+=";"),this.mMoTLockCode+=this.mMoTLockDigits,this.mMoTLockDigits="",n.StopPointerEvents(t),this.mPassField&&(this.mShowOverlay?this.mPassField.SetProperty("iValue",this.mMoTLockCode):this.mPassField.SetProperty("Value",this.mMoTLockCode)))},i.Create=function(n,t,r,u,f){var e=new i(t);return r&&e.SetProperty("PassField",r),e.InitControl(n,t),cde.CBool(f)&&e.SetProperty("IsOverlay",f),u&&e.SetProperty("TileWidth",u),e},i}(n.TheNMIBaseControl);n.ctrlMoTLock=r;u=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mPickerGroup=null,i.mMeshList=null,i.mNodesFld=null,i.MyMeshes=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var h=this,e,s,o;return this.MyBaseType=n.cdeControlType.MuTLock,t.prototype.InitControl.call(this,i,r,u,f),this.mPickerGroup=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this,{PostInitBag:["TileWidth=12","ClassName=cdeLoginBlock"]}),n.TheControlFactory.AddAdHocSmartControl(this.mPickerGroup,"HEADER",n.cdeControlType.SmartLabel,"",0,["NoTE=true","TileHeight=1","TileWidth=12","iValue=Please choose a mesh","FontSize=36"]),e=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this.mPickerGroup,{PostInitBag:["TileWidth=6","TileHeight=6"]}),s=n.TheControlFactory.AddAdHocSmartControl(e,"SEARCH",n.cdeControlType.SingleEnded,"Search for Mesh",2,["TileHeight=1","TileFactorY=2","TileWidth=5"]),s.MyNMIControl.RegisterEvent("OnValueChanged",function(n,t,i){h.SetProperty("Filter",i)}),this.mMeshList=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(e,{PostInitBag:["TileWidth=6","TileHeight=5","Style=overflow-y: auto;"]}),o=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this.mPickerGroup,{PostInitBag:["TileWidth=6","TileHeight=6"]}),n.TheControlFactory.AddAdHocSmartControl(o,"NIM",n.cdeControlType.SmartLabel,"",0,["NoTE=true","TileHeight=1","TileFactorY=2","TileWidth=6","iValue=Nodes in the Mesh"]),this.mNodesFld=n.TheControlFactory.AddAdHocSmartControl(o,"NODES",n.cdeControlType.SmartLabel,"",256,["NoTE=true","TileHeight=5"]),this.SetElement(this.mPickerGroup.GetElement()),!0},i.prototype.SetMesh=function(n){var i,t;if((n&&(this.MyMeshes=n),this.MyMeshes)&&this.mMeshList)for(this.mMeshList.GetElement().innerHTML=null,this.mNodesFld.SetProperty("iValue",""),i=cde.CStr(this.GetProperty("Filter")),t=0;t<this.MyMeshes.length;t++)(this.MyMeshes[t].HomeNode||(this.MyMeshes[t].HomeNode=""),i&&this.MyMeshes[t].MeshHash.indexOf(i)<0&&this.MyMeshes[t].HomeNode.indexOf(i)<0&&this.MyMeshes[t].NodeNames.join().indexOf(i)<0)||this.CreateMeshButton(t)},i.prototype.SetProperty=function(n,i){if(n==="SetMesh"){this.SetMesh(i);return}t.prototype.SetProperty.call(this,n,i);n==="Filter"&&this.SetMesh(null)},i.prototype.CreateMeshButton=function(t){var r=this,i=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this.mMeshList,{PostInitBag:["TileHeight=3","TileFactorY=2","TileWidth=11","TileFactorX=2","Style=box-shadow: rgba(0,0,0,.3) 0 1px 1px;"]});i.SetProperty("Mesh",this.MyMeshes[t]);i.SetProperty("OnClick",function(t){var i=t.GetProperty("Mesh");r.mNodesFld.SetProperty("FontSize","36");r.mNodesFld.SetProperty("iValue","Loading Mesh ("+i.MeshHash+")...");n.MyEngine&&n.MyEngine.SelectMesh(i.cdeMID)});i.SetProperty("OnHover",function(n){var u=n.GetProperty("Mesh"),t,i;if(u){for(t="<bl style='font-size:24px;'>",i=0;i<u.NodeNames.length;i++)t+="<li>"+u.NodeNames[i]+"<\/li>";t+="<\/bl>";r.mNodesFld.SetProperty("iValue",t)}});n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(i,{PostInitBag:["TileWidth=5","TileHeight=1","TileFactorY=4"]});n.TheControlFactory.AddAdHocSmartControl(i,"ICON"+t,n.cdeControlType.HashIcon,"",0,["NoTE=true","TileHeight=1","TileWidth=1","iValue="+this.MyMeshes[t].MeshHash]);n.TheControlFactory.AddAdHocSmartControl(i,"LABEL"+t,n.cdeControlType.SmartLabel,"",256,["NoTE=true","TileHeight=1","TileWidth=4","iValue="+this.MyMeshes[t].HomeNode+"<br>("+this.MyMeshes[t].MeshHash+")","ClassName=cdePickerLabel"])},i}(n.TheNMIBaseControl);n.ctrlMeshPicker=u}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(){var n=t.call(this,null,null)||this;return n.MyTableControls=[],n.MyFormControls=[],n.MyTableName=null,n.MyStorageName=null,n.MyAdderRow=null,n}return __extends(i,t),i.prototype.GetControlByFldNo=function(t,i){return this.MyTRF?this.MyAdderRow?this.MyAdderRow[this.MyTRF.TableName+"_"+i]:this.MyBaseType===n.cdeControlType.FormView?this.MyTRF.FldInfo.TableReference?this.MyFormControls[this.MyTRF.FldInfo.TableReference+"_"+t+"_"+i]:this.MyFormControls[this.MyTRF.TableName+"_"+t+"_"+i]:this.MyTableControls[t][this.MyTRF.TableName+"_"+t+"_"+i]:null},i.prototype.ValidateRules=function(t,i,r,u,f,e,o){var l=n.MyNMIModels[t],d,a,ut,w,g,nt,tt,it,y,rt,p,v;if(i||(i=this.MyTableName),!l.MyStorageMeta[i]||l.MyStorageMeta[i].AreRulesRunning===!0)return!1;l.MyStorageMeta[i].AreRulesRunning=!0;try{var ft=!1,b="",c=null,h=null,k="",st=[],s=null;for(l.MyStorageMirror[r]&&(s=l.MyStorageMirror[r][u]),s||(s={}),s.cdeMID&&(b=s.cdeMID),s.hasOwnProperty("SecToken")&&(s.SecToken="CDE!"),s.nmiTableName=r,s.nmiScreenID=t,d=n.MyScreenManager.GetScreenByID(i),d&&d.GetProperty("MyOwnerTable")&&(s.nmiOwner=d.GetProperty("MyOwnerTable")),a=void 0,a=0;a<l.MyStorageMeta[i].FormFields.length;a++)try{if(c=l.MyStorageMeta[i].FormFields[a],!c)continue;if(h=f[r+"_"+u+"_"+c.FldOrder],ut=!1,h&&c.Type!==n.cdeControlType.CollapsibleGroup&&c.Type!==n.cdeControlType.TileGroup){if(h.MyNMIControl&&h.MyNMIControl.MyBaseType!==27&&(h=h.MyNMIControl),!e&&c&&c.DataItem&&((c.Flags&2)!=0&&!cde.CBool(c.WriteOnce)||o)&&(w=h.GetProperty("Value"),!h.IsDirty&&c.DefaultValue&&(cde.IsNotSet(w)||w===c.DefaultValue)&&(w=c.DefaultValue,h.IsDirty=!0),h.IsDirty&&(h.IsDirty=!1,n.UpdFldContent(s,c,w,st)&&(ft=!0,ut=!0))),h)for(g in h.MyDataItems)h.MyDataItems.hasOwnProperty(g)&&(nt=h.MyDataItems[g],tt=n.GenerateFinalString(nt,s),tt===nt&&(tt=n.GenerateFinalString(nt,f)),h.SetProperty(g,tt));k+=o||(c.Flags&2)!=0&&!cde.CBool(c.WriteOnce)||ut?"1":"0"}else k+="0"}catch(et){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","Validator:Error:"+et,et.stack)}for((ft||o)&&((!e||o)&&(s.hasOwnProperty("SecToken")&&cde.MyContentEngine&&(s.SecToken=s.SecToken===""?cde.MyContentEngine.RSAEncrypt("CDE!"):cde.MyContentEngine.RSAEncrypt(s.SecToken)),n.MyEngine&&(b===""?n.MyEngine.PublishToNMI("NMI_INS_DATA:"+r+":"+t+":"+i,JSON.stringify(s),l.cdeN):n.MyEngine.PublishToNMI("NMI_UPD_DATA:"+r+":"+b+":"+t+":"+k,JSON.stringify(s),s.cdeN))),n.MyEngine&&b!==""&&n.MyEngine.FireEvent(!1,"RecordUpdated_"+r+"_"+u,cde.GuidToString(l.cdeMID),r,u,k)),a=0;a<l.MyStorageMeta[i].FormFields.length;a++){if(c=l.MyStorageMeta[i].FormFields[a],h=f[r+"_"+u+"_"+c.FldOrder],it=!1,y=c.HideCondition,y&&y!==""){v="";try{v=n.GenerateFinalString(y,s);it=cde.cdeEval(v)}catch(ot){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","Validating Hide-Condition Error:"+ot,"in: ("+y+") resolved to<br/>"+v);it=!0}}if(rt=!1,p=c.GreyCondition,p&&p!==""){v="";try{v=n.GenerateFinalString(p,s);rt=cde.cdeEval(v)}catch(ot){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","Validating Gray-Condition Error:"+ot,"in: ("+p+") resolved to<br/>"+v);rt=!0}}h&&(y&&y!==""&&h.SetProperty("Visibility",!it),p&&p!==""&&h.SetProperty("Disabled",rt))}}catch(ht){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","Validator:Error",ht)}return l.MyStorageMeta[i].AreRulesRunning=!1,!0},i.prototype.SortTableByProperty=function(t,i,r,u){return t?t.sort(function(t,f){var e,o;return(i.indexOf(".")>0?(e=n.GetFldContentByName(t,i,!1),o=n.GetFldContentByName(f,i,!1)):(e=r?cde.CDbl(t[i]):cde.CStr(t[i]),o=r?cde.CDbl(f[i]):cde.CStr(f[i])),e===o)?0:u?o>e?1:-1:o<e?1:-1}):[]},i.prototype.ReplaceMarcos=function(t,i){var r=t,f,u,e,o;for(f in i)if(u=i[f],u&&u.MyBaseType===n.cdeControlType.TileEntry&&u.MyNMIControl.MyFieldInfo&&u.MyNMIControl.MyFieldInfo.DataItem){e=u.MyNMIControl.MyFieldInfo.DataItem;do t=r,r=r.replace("<%"+e+"%>",u.GetProperty("Value"));while(t!==r)}while(r.indexOf("<%")>=0)if(r.indexOf("%>")>0)o=r.substr(0,r.indexOf("<%")),r=o+r.substr(r.indexOf("%>")+2);else break;return r},i.prototype.CreateFormInfo=function(t,i,r,u){var c="",e,f,o,s,h;for(e in t)if(!(e.length>3)||e.substring(0,3)!=="cde"||(e==="cdeMID"||e==="cdeA")&&i===""){if(f=e,i!==""&&(f=i+"."+f),c=f,typeof t[e]=="object"){u=this.CreateFormInfo(t[e],c,r,u);continue}if(!(f.length>13)||f.substr(0,13)!=="MyPropertyBag"||f.substr(f.length-6,6)!==".Value"){if(o=f,f.substr(0,13)==="MyPropertyBag"&&(s=f.split("."),o=s[1],s.length>3))for(h=2;h<s.length-1;h++)o+="."+s[h];r.FormFields[u]=t[f]&&typeof t[f]=="string"&&t[f].substring(0,5)==="/Date"?new n.TheFieldInfo(21,2,o):t[f]&&typeof t[f]=="string"&&t[f].length>1e3?new n.TheFieldInfo(29,0,o):e==="cdeA"?new n.TheFieldInfo(24,1,o):new n.TheFieldInfo(1,1,o);r.FormFields[u].FormID=cde.GuidToString(r.cdeMID);r.FormFields[u].DataItem=f;r.FormFields[u].FldOrder=u;f.substr(0,13)==="MyPropertyBag"&&f.substr(f.length-5,5)===".Name"&&(r.FormFields[u].Title=o,r.FormFields[u].DataItem=f.substr(0,f.length-5)+".Value");r.FormFields[u++].Flags=0}}return i===""&&(r.FormFields[u]=new n.TheFieldInfo(n.cdeControlType.FormButton,1,"Details",2,cde.GuidToString(r.cdeMID)),r.FormFields[u].FldOrder=1e3,r.FormFields[u].DataItem="CDE_DETAILS",r.FormFields[u].PropertyBag=["ClassName=cdeTableButton","Value=<span class='fa fa-3x'>&#xf044;<\/span>"]),u},i.prototype.RemoveTableHooks=function(){if(this.MyTableControls)for(var n=0;n<this.MyTableControls.length;n++)this.RemoveFormHooks(this.MyTableControls[n])},i.prototype.RemoveFormHooks=function(t){var i,r,u;for(i in t)t.hasOwnProperty(i)&&(r=t[i].GetProperty("ID"),r&&r.length>0&&(u="TABLES",t[i].MyNMIControl&&t[i].MyNMIControl.FireEvent(!1,"OnDelete"),t[i].MyNMIControl&&t[i].MyNMIControl.MyTRF&&t[i].MyNMIControl.MyTRF.FldInfo&&t[i].MyNMIControl.MyTRF.FldInfo.cdeMID&&(u=cde.GuidToString(t[i].MyNMIControl.MyTRF.FldInfo.cdeMID)),n.MyTCF.UnregisterControl(u,r)))},i.prototype.DeleteRecord=function(){},i.prototype.OnLoaded=function(){},i}(n.TheNMIBaseControl);n.TheDataViewBase=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mDashboardScreen=null,i.mScreenIDs=null,i.mTileCount=0,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType=n.cdeControlType.Dashboard,t.prototype.InitControl.call(this,i,r,u,f),this.SetupDashboard(this.GetSetting("ScreenGuid")),!0},i.prototype.SetupDashboard=function(t){var v=this,f=n.MyNMIModels[this.MyScreenID],h,r,s,a;if(f&&f.MyDashboard&&(n.ThePB.ConvertPropertiesFromBag(f.MyDashboard),h=!1,t||(t=f.MyDashboard.cdeMID),this.mDashboardScreen=n.MyScreenManager?n.MyScreenManager.GetScreenByID(t):null,this.mDashboardScreen||(this.mDashboardScreen=new n.TheNMIScreen,this.mDashboardScreen.InitControl(null,null,f.MyDashboard.PropertyBag,cde.GuidToString(f.MyDashboard.cdeMID)),this.mDashboardScreen.SetProperty("MyDashboard",this),h=!0,this.mDashboardScreen.SetProperty("Visibility",!1)),this.mDashboardScreen.SetProperty("IsDashboard",!0),!(this.mTileCount>0)||f.MyDashboard.InitialState!=="error")){this.mDashboardScreen.Clear(!1);this.mScreenIDs=[];this.SetElement(this.mDashboardScreen.GetElement());!f.MyDashboard.Title&&f.MyDashboard.DashboardTitle&&(f.MyDashboard.Title=f.MyDashboard.DashboardTitle);f.MyDashboard.Title&&f.MyDashboard.Title.length>0&&this.mDashboardScreen.SetProperty("Title",f.MyDashboard.Title);try{for(s=0;s<f.MyDashPanels.length;s++)f.MyDashPanels[s].Category=n.ThePB.GetValueFromBagByName(f.MyDashPanels[s].PropertyBag,"Category",!0),f.MyDashPanels[s].PanelTitle=n.ThePB.GetValueFromBagByName(f.MyDashPanels[s].PropertyBag,"Caption");r=n.SortArrayEx(f.MyDashPanels,"Category,FldOrder,PanelTitle",!1,!1)}catch(p){r=f.MyDashPanels}for(var c="",o=null,l=0,y=function(){var y=r[u].Category,h,g,k,nt,a,b,tt,it,d,s;if(u===0||c!==y&&n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"Visibility")!=="false"){if(h="",y===" NA"||cde.IsNotSet(y)||(h=y),h.substr(h.length-5,5)==="-HIDE"&&(h=" "),o=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(null),o.SetProperty("LabelElement","h1"),o.SetProperty("LabelClassName","cdeDashCategory"),o.SetProperty("ClassName","cdeDashCategory cdeTiles"),h.substr(h.length-5,5)!=="-NONE"){for(g=0,k=0;k<h.length;k++){if(h[k]!==".")break;g++}h=h.substr(g);o.SetProperty("Caption",h)}e.mDashboardScreen.AppendChild(o);c=y}nt=n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"CategoryLabelClassName");nt&&o.SetProperty("LabelClassName",nt);a=[];r[u].ControlClass?a=r[u].ControlClass.split(":"):a[0]="";var rt=n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"CategoryClassName"),ot=cde.CBool(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"HideFromSideBar")),st=cde.CBool(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"RSB"));rt&&o.SetProperty("ClassName",rt);var p=null,ut="",ft=!1,w=!1,et=!1,t=null,v=n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"Caption");v||(v="");switch(a[0]){case"cdeUpdater":p=function(){n.RequestUpdate()};ut="background-color: green; color: white;";break;case"jsAction":if(a.length<2)return"continue";p=r[u].ControlClass;break;case"CMyInfo":break;case"CMyNavigator":a.length>1&&(p=function(){n.MyScreenManager&&n.MyScreenManager.TransitToScreen(a[1])},e.mScreenIDs.push(a[1]));break;default:if(t=n.MyScreenManager?n.MyScreenManager.GetScreenByID(r[u].cdeMID):null,b=cde.CBool(cde.CBool(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"ForceLoad"))||v.substr(v.length-5,5)!=="-HIDE"&&(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"HTMLUrl")!==null||n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"HTML")!==null)),n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"RenderTarget")&&(et=!0,w=cde.CBool(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"NeverHide")),b||(b=w)),tt=b,it=!1,t)it=!0;else{if(t=n.MyTCF.CreateNMIControl(n.cdeControlType.Screen,!0),!t)return"continue";t.MyHostNode=r[u].cdeN;t.InitControl(et?null:n.MyScreenManager,null,r[u].PropertyBag,cde.GuidToString(r[u].cdeMID));cde.CBool(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"IsPinned"))||w||t.SetProperty("Visibility",!1);r[u].HtmlContent?t.AppendContent(r[u].HtmlContent):(t.SetProperty("ClassName",a[0]),t.AppendContent("<h1 class='cdeHeadline'>Loading...please wait<\/h1><progress>loading...<\/progress>"));tt=!0;e.mDashboardScreen.MyChildren[cde.GuidToString(r[u].cdeMID)]=t}(tt||st||f.ForceReload||r[u].ControlClass==="CMyLiveScreen")&&(n.MyEngine?a.length>1&&a[1]!==""&&!n.MyEngine.HasDataToFetch(cde.GuidToString(r[u].cdeMID)+":"+r[u].ControlClass)&&(n.MyEngine.AddDataToFetch(cde.GuidToString(r[u].cdeMID)+":"+r[u].ControlClass+":"+cde.GuidToString(e.MyScreenID)+":true"),b&&n.MyEngine.CheckDataToFetch(cde.GuidToString(r[u].cdeMID))):e.FireEvent(!0,"FetchData",cde.GuidToString(r[u].cdeMID)+":"+r[u].ControlClass+":"+cde.GuidToString(e.MyScreenID)+":true"));r[u].Flags&&(r[u].Flags&8)!=0&&t.SetProperty("NoShowAll",!0);a[0]==="CMyDashboard"&&t.SetProperty("IsDashboard",!0);t.SetProperty("ControlClass",r[u].ControlClass);t.SetProperty("DashID",e.MyScreenID);d=n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"ScreenTitle");d||(d=n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"Title"));t.SetProperty("ScreenTitle",d);(v.substr(v.length-5,5)==="-HIDE"||ot===!0)&&t.SetProperty("HideFromSideBar",!0);t.SetProperty("Description",n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"Description"));t.SetProperty("HidePins",cde.CBool(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"HidePins")));t.SetProperty("HidePinPins",cde.CBool(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"HidePinPins")));t.SetProperty("IsPopup",cde.CBool(n.ThePB.GetValueFromBagByName(r[u].PropertyBag,"IsPopup")));p=function(t){n.MyScreenManager&&n.MyScreenManager.TransitToScreen(t.GetProperty("cdeMID"))};e.mScreenIDs.push(r[u].cdeMID);n.MyScreenManager&&!w&&(n.MyScreenManager.RegisterScreen(t.MyScreenID,t,!0),it||n.MyScreenManager.TransitToWaitingScreen(cde.GuidToString(r[u].cdeMID)));l++;ft=!0}v.substr(v.length-5,5)==="-HIDE"||w?t&&t.SetProperty("IsHidden",!0):(s=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(o,{PreInitBag:[],PostInitBag:["ControlTW=2","ControlTH=2","Title="+v,"Style="+ut]}),s.SetProperty("OnClick",p),s.SetProperty("TabIndex",r[u].FldOrder+101),ft?(s.MyTRF=new n.TheTRF(cde.GuidToString(r[u].cdeO),0,new n.TheFieldInfo(n.cdeControlType.TileButton,2,v,2)),s.MyTRF.ModelID=e.MyScreenID,s.MyFieldInfo=s.MyTRF.FldInfo,s.MyFieldInfo.FldOrder=r[u].FldOrder,s.MyFieldInfo.cdeO=r[u].cdeO,s.MyFieldInfo.cdeN=r[u].cdeN,s.MyFieldInfo.cdeMID=r[u].cdeMID):s.SetProperty("UXID",cde.GuidToString(r[u].cdeMID)),s.SetProperty("ID","DASH_"+cde.GuidToString(r[u].cdeMID)),s.RegisterNMIControl(),e.mDashboardScreen.MyChildren[cde.GuidToString(r[u].cdeMID)]=s,s.SetProperty("cdeMID",r[u].cdeMID),r[u].PropertyBag&&(n.ThePB.SetPropertiesFromBag(s,r[u].PropertyBag,r),s.GetProperty("IsRefresh")&&(e.mDashboardScreen.MyRefreshButton=s)),n.MyEngine&&n.MyEngine.IsNodeDown(r[u].cdeN)&&s.SetProperty("IsOwnerDown",!0),t&&(t.MyRC=e.mTileCount,t.GetProperty("NUITags")||t.SetProperty("NUITags","Screen "+i.AllTileCount++),t.MyNMIControl&&t.MyNMIControl.FireEvent(!0,"RRT")),e.mTileCount++)},e=this,u=0;u<r.length;u++)y();l>1&&cde.CBool(f.MyDashboard.HideShowAll)===!1&&(a=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(o,{PreInitBag:["ControlTW=2","ControlTH=2"],PostInitBag:["Title=<span class='fa fa-5x'>&#xf067;<\/span><\/br>Show All"]}),a.SetProperty("OnClick",function(){v.ShowAllScreens()}));this.mDashboardScreen.SetInitialized(!0);h&&(cde.MyBaseAssets.MyServiceHostInfo.WasInitialScreenVisible||(cde.MyBaseAssets.MyCommStatus.LastStartScreen?n.MyEngine.GetScene(cde.MyBaseAssets.MyCommStatus.LastStartScreen):cde.MyBaseAssets.MyServiceHostInfo.StartScreen!==""&&f.MyDashboard.InitialState!=="error"?n.MyScreenManager.GotoStationHome(!1):f.MyDashboard.InitialState&&f.MyDashboard.InitialState!=="error"?n.MyScreenManager.TransitToScreen(f.MyDashboard.InitialState):n.MyScreenManager.GotoStationHome(!1)),n.MyScreenManager&&(n.MyScreenManager.RegisterScreen(this.mDashboardScreen.MyScreenID,this.mDashboardScreen,!1),n.MyScreenManager.TransitToWaitingScreen(this.mDashboardScreen.MyScreenID)))}},i.prototype.ShowAllScreens=function(){var i=this.mScreenIDs,r,t,u;for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(t=n.MyScreenManager?n.MyScreenManager.GetScreenByID(i[r]):null,t&&!cde.CBool(t.GetProperty("NoShowAll"))&&(t.SetProperty("IsPinned",!0),n.MyEngine&&n.MyEngine.CheckDataToFetch(i[r]),u=t.GetProperty("Visibility")?!1:!0,t.SetProperty("Visibility",u),t.ShowPin()))},i.AllTileCount=0,i}(n.TheNMIBaseControl);n.TheDashboard=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,n)||this;return i.MyScreenInfo=null,i.MyFormInfo=null,i.mBaseDiv=null,i.formMain=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var e=this,k,l,v,h,s,c,y,p,d,w,a;if(this.MyBaseType=n.cdeControlType.FormView,t.prototype.InitControl.call(this,i,r,u,f),!this.MyTRF)return!1;if(this.MyTableName=cde.GuidToString(this.MyTRF.TableName),this.MyStorageName=this.GetSetting("TableReference"),this.MyStorageName||(this.MyStorageName=this.MyTableName),this.MyScreenInfo=n.MyNMIModels[this.MyScreenID],k="CMyForm",l=null,l||(l="Inline_"+cde.GuidToString(this.MyTableName)),v=document.getElementById(l),v&&(this.mBaseDiv=v),this.mBaseDiv||i||!this.MyScreenInfo.MyStorageMeta[this.MyTableName]||(this.mBaseDiv=document.getElementById("Content_"+cde.GuidToString(this.MyScreenInfo.MyStorageMeta[this.MyTableName].TargetElement))),this.mBaseDiv?(h=n.MyTCF.GetRegisteredControl("TABLES",this.MyTableName),h&&h.RemoveFormHooks(h.MyFormControls),this.mBaseDiv.innerHTML=""):(this.mBaseDiv=document.createElement("div"),this.mBaseDiv.className=k,this.MyTarget&&(h=n.MyTCF.GetRegisteredControl("TABLES",this.MyTableName),h&&h.RemoveFormHooks(h.MyFormControls),this.MyTarget.GetElement().innerHTML="")),this.mBaseDiv.style.width="inherit",this.mBaseDiv.style.height="inherit",this.mBaseDiv.style.margin="auto",this.SetElement(this.mBaseDiv),s=cde.CInt(this.MyTRF.RowNo),this.MyFieldInfo&&cde.CBool(this.MyFieldInfo.ILF)&&!this.MyScreenInfo.IsLiveForm&&(this.MyScreenInfo.IsLiveForm=!0),this.MyScreenInfo.IsLiveForm||this.MyScreenInfo.MyStorageMirror[this.MyStorageName]||this.MyScreenInfo.MyStorageMeta[this.MyTableName])if((this.MyScreenInfo.IsLiveForm||this.MyScreenInfo.MyStorageMirror[this.MyStorageName])&&s>=0&&(n.MyEngine.RegisterEvent("RecordUpdated_"+this.MyStorageName+"_"+s,function(t,i,r,u){var o,f,h,s;if(i&&i!==""&&!e.GetSetting("TableReference")){o=n.MyNMIModels[i];for(f in e.MyFormControls)h=e.MyFormControls[f].GetProperty("DataItem"),h&&(Object.prototype.hasOwnProperty.call(o.MyStorageMirror[r][u],"SecToken")||(s=n.GetFldContent(o.MyStorageMirror[r][u],e.MyFormControls[f].MyFieldInfo,e.MyScreenInfo.IsGenerated,!1),e.MyFormControls[f].GetProperty("Value")!==s&&e.MyFormControls[f].SetProperty("iValue",s)));e.ValidateRules(i,null,r,u,e.MyFormControls,!0,!1)}}),this.MyScreenInfo.IsLiveForm||(this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s]&&this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s].cdeM&&this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s].cdeM!==""?this.MyScreenInfo.MyStorageMeta[this.MyTableName]=JSON.parse(this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s].cdeM):this.MyScreenInfo.MyStorageMeta[this.MyTableName]&&this.MyScreenInfo.MyStorageMeta[this.MyTableName].FormFields.length!==0||(this.MyScreenInfo.MyStorageMeta[this.MyTableName]||(this.MyScreenInfo.MyStorageMeta[this.MyTableName]=new n.TheFormInfo,this.MyScreenInfo.MyStorageMeta[this.MyTableName].FormTitle=this.MyTableName,this.MyScreenInfo.MyStorageMeta[this.MyTableName].FormFields=[]),this.CreateFormInfo(this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s],"",this.MyScreenInfo.MyStorageMeta[this.MyTableName],0),this.MyScreenInfo.IsGenerated=!0))),this.MyScreenInfo.MyStorageMeta[this.MyTableName]&&this.MyScreenInfo.MyStorageMeta[this.MyTableName].FormFields.length!==0){this.MyFormInfo=this.MyScreenInfo.MyStorageMeta[this.MyTableName];c=this;this.MyFormInfo.IsUsingAbsolute&&(c=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this),c.SetProperty("ClassName","cdeRelativeDiv"));this.formMain=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(c);this.formMain.cdeMID=this.MyScreenInfo.cdeMID;this.MyFieldInfo&&this.MyFieldInfo.TitleClassName?this.formMain.SetProperty("LabelClassName",this.MyFieldInfo.TitleClassName):this.formMain.SetProperty("LabelClassName","cdeFormTitle");this.formMain.SetProperty("IsSmall",!0);this.formMain.SetProperty("Float","none");this.formMain.SetProperty("HidePins",!0);this.MyFormInfo.IsUsingAbsolute?this.formMain.SetProperty("ClassName","CMyCanvas"):this.formMain.SetProperty("ClassName","cdeInnerForm");y=n.ThePB.GetValueFromBagByName(this.MyFormInfo.PropertyBag,"Caption");y&&n.MyScreenManager&&(p=n.MyScreenManager.GetScreenByID(this.MyTableName),p&&p.SetProperty("Caption",y),n.ThePB.RemoveProperty(this.MyFormInfo.PropertyBag,"Caption"));d=cde.CBool(n.ThePB.GetValueFromBagByName(this.MyFormInfo.PropertyBag,"UseMargin"));n.ThePB.SetPropertiesFromBag(this.formMain,this.MyFormInfo.PropertyBag);this.MyFormInfo.IsUsingAbsolute?(c.SetProperty("TileWidth",this.formMain.GetProperty("TileWidth")),c.SetProperty("TileHeight",this.formMain.GetProperty("TileHeight"))):(this.formMain.GetElement().style.width="fit-content",this.formMain.GetElement().style.maxWidth="unset");w=null;this.MyScreenInfo.MyStorageMirror[this.MyStorageName]&&s>=0&&(this.MyDataRow=this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s],this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s]&&this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s].cdeMID&&(w=this.MyScreenInfo.MyStorageMirror[this.MyStorageName][s].cdeMID));var b=n.SortArrayByProperty(this.MyFormInfo.FormFields,"FldOrder",!0,!1),g=function(t){var i=b[t],r,h,c,f,u;if(i&&(i.Flags&16)!=0)return"continue";if(r=o.MyStorageName+"_"+s+"_"+i.FldOrder,n.ThePB.ConvertPropertiesFromBag(i),h=o.formMain,c=cde.CInt(i.ParentFld),c>0&&c<i.FldOrder)if(o.MyFormControls[o.MyStorageName+"_"+s+"_"+c])h=o.MyFormControls[o.MyStorageName+"_"+s+"_"+c];else return"continue";f=new n.TheTRF(o.MyStorageName,s,i);f.RowID=w;f.ModelID=o.MyScreenID;i.IsInTable=!1;switch(i.Type){default:return u=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(h,{ScreenID:o.MyScreenID,TRF:f}),o.MyFormControls[r]=u,u.MyDataView=o,u.CreateControl(r,function(t){t.SetProperty("OnValueChanged",function(t){var i=e.MyFormInfo.IsPostingOnSubmit;e.MyScreenInfo.IsLiveForm&&n.MyEngine&&(n.MyEngine.PublishToNMI("SETP",t.MyFieldInfo.DataItem+"="+t.GetProperty("Value"),t.MyFieldInfo.cdeO,!0),i=!0);e.ValidateRules(e.MyScreenID,e.MyTableName,e.MyStorageName,t.MyTRF?t.MyTRF.RowNo:0,e.MyFormControls,i,!1)});t.MyBaseType===n.cdeControlType.TileButton&&cde.CBool(t.GetProperty("IsSubmit"))===!0&&t.SetProperty("OnClick",function(t){var i,r,u;e.ValidateRules(e.MyScreenID,e.MyTableName,e.MyStorageName,t.MyTRF?t.MyTRF.RowNo:0,e.MyFormControls,!1,!0);e.PropertyBag.FinishPage||e.PropertyBag.ProcessingPage||(e.PropertyBag.FinishScreenID?(i=e.PropertyBag.FinishScreenID,i==="CLOSE"?(r=n.MyScreenManager.GetCurrentScreen(),r&&(u=r.GetProperty("OldScreen"),u&&n.MyScreenManager.TransitToScreen(u))):n.MyScreenManager.TransitToScreen(i)):e.MyTRF.FldInfo.TableReference&&n.MyScreenManager.TransitToScreen(e.MyTRF.FldInfo.TableReference))})}),"continue";case n.cdeControlType.Table:return u=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(h,{ScreenID:o.MyScreenID,TRF:f,PostInitBag:["ContentOuterClassName=cdeTableInline","ContainerClassName=cdeTableTEContainer"]}),o.MyFormControls[r]=u,n.MyTCF&&n.MyTCF.RegisterControl(cde.GuidToString(i.cdeMID),"TE",u),u.MyDataView=o,u.CreateControl(r,function(){}),i&&i.PropertyBag&&i.PropertyBag.length>0&&n.ThePB.SetPropertiesFromBag(u,i.PropertyBag,null,!1,!1),"continue";case n.cdeControlType.CollapsibleGroup:o.MyFormControls[r]=n.MyTCF.CreateNMIControl(n.cdeControlType.CollapsibleGroup).Create(h,{TRF:f});d===!0&&o.MyFormControls[r].SetProperty("UseMargin",!0);break;case n.cdeControlType.TileGroup:o.MyFormControls[r]=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(h,{TRF:f});o.MyFormControls[r].SetProperty("ClassName","cdeTileGroup");break;case n.cdeControlType.FormButton:switch(b[t].DataItem){case"CDE_DELETE":i.TableReference&&(o.MyFormControls[r]=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(h,{PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa fa-3x'>&#xf1f8;<\/span>","ClassName=cdeBadActionButton cdeDeleteButton"]}),o.MyFormControls[r].SetProperty("OnClick",function(t,r){var u=t;r.shiftKey?(u.DeleteRecord(u.MyDataRow),n.MyScreenManager.TransitToScreen(i.TableReference)):n.MyPopUp&&n.MyPopUp.Show("Are you sure you want to delete this record? ",!1,null,1,function(){u.DeleteRecord(u.MyDataRow);n.MyScreenManager.TransitToScreen(i.TableReference)},null,u.MyDataRow,u)}),o.MyDataRow||o.MyFormControls[r].SetProperty("Disabled",!0))}}n.MyTCF.SetControlEssentials(o.MyFormControls[r],o.MyFormControls[r],f)},o=this;for(a=0;a<b.length;a++)g(a)}else this.formMain=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this),n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.formMain,{PreInitBag:["Element=h1"],PostInitBag:["iValue=This form does not contain any controls, yet"]});else this.formMain=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this),n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(this.formMain,{PreInitBag:["Element=h1"],PostInitBag:["iValue=Neither meta-data nor storage data defined"]});return this.ValidateRules(this.MyScreenID,this.MyTableName,this.MyStorageName,s,this.MyFormControls,!0,!1),n.TheFlashCache.FlushCache(),this.RegisterEvent("RRT",function(){e.RenderRenderTargets()}),this.SetProperty("ID","FORM_"+this.MyTableName),this.RegisterNMIControl(),!0},i.prototype.OnLoad=function(i){if(this.GetProperty("TTSCookie")&&n.MyScreenManager){var r=this.GetProperty("TTSCookie");this.SetProperty("TTSCookie",null);n.MyScreenManager.CreateDataViewScreen(this.MyScreenInfo,null,this.MyTableName,this.GetProperty("ExtraInfo"),this.MyTableName,!1,r);return}this.MyFieldInfo&&this.MyFieldInfo.TableReference&&this.MyFormInfo.IsAlwaysEmpty===!0&&n.MyScreenManager.CreateDataViewScreen(this.MyScreenInfo,null,this.MyTableName,this.GetProperty("ExtraInfo"),this.MyTableName,!0);this.GetProperty("StartGroup")&&this.SetProperty("SetGroup","GRP:"+this.GetProperty("StartGroup"));t.prototype.OnLoad.call(this,i)},i.prototype.OnLoaded=function(){t.prototype.OnLoad.call(this)},i.prototype.SetProperty=function(i,r){i==="TileWidth"&&cde.CBool(this.GetProperty("UseMargin"))&&(r=cde.CInt(r)+1);t.prototype.SetProperty.call(this,i,r);i==="SetGroup"&&n.MyTCF.ToggleGroup(this.MyTableName,r.substr(4))},i.prototype.ResetData=function(){var i,t;for(i in this.MyFormControls)t=this.MyFormControls[i],t.MyBaseType===n.cdeControlType.TileEntry&&t.MyNMIControl.SetToDefault(!1);return!1},i.prototype.ReloadData=function(){var i,t;for(i in this.MyFormControls)if(t=this.MyFormControls[i],cde.CBool(t.GetProperty("IsRefresh")))return t.MyBaseType===n.cdeControlType.TileEntry?t.DoFireClick(t.MyNMIControl):t.DoFireClick(t),!0;return!1},i.prototype.RenderRenderTargets=function(){var r,i,t,e,o;if(this.MyFormInfo)for(r=n.SortArrayByProperty(this.MyFormInfo.FormFields,"FldOrder",!0,!1),i=0;i<r.length;i++)if((t=r[i],!t||(t.Flags&16)==0)&&t.RenderTarget){var u=cde.CInt(this.MyTRF.RowNo),s=this.MyTableName+"_"+u+"_"+t.FldOrder,f=new n.TheTRF(this.MyTableName,u,t);f.ModelID=this.MyScreenID;e=n.GenerateFinalString(t.RenderTarget,!1,f);o=this.MyFormControls[s];o.FindRenderTarget(e)}},i.prototype.DeleteRecord=function(t){n.MyEngine&&n.MyEngine.PublishToNMI("NMI_DEL_ID:"+this.MyTableName+":"+t.cdeMID,t.cdeN)},i}(n.TheDataViewBase);n.ctrlFormView=t}(cdeNMI||(cdeNMI={})),function(n){var i=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mRow=null,i}return __extends(i,t),i.Create=function(n,t,r,u,f){var e=new i(t);return r&&(e.mRow=r),e.InitControl(n,t),f&&e.SetProperty("ClassName",f),e},i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType=n.cdeControlType.TableRow,t.prototype.InitControl.call(this,i,r,u,f),this.MyTRF=r,this.mRow||(this.mRow=document.createElement("tr")),this.SetElement(this.mRow),null},i.prototype.SetProperty=function(n,i){t.prototype.SetProperty.call(this,n,i);n==="ClassName"&&this.mRow&&(this.mRow.className=i)},i.prototype.AppendChild=function(n){this.mRow.appendChild(n.GetElement())},i}(n.TheNMIBaseControl),t,r;n.ctrlTableRow=i;t=function(t){function i(n){var i=t.call(this,null,n)||this;return i.mCell=null,i.mRow=null,i}return __extends(i,t),i.Create=function(n,t,r,u,f,e){var o=new i(t),s=[];return e&&s.push("IsHeader=true"),u&&s.push("ColumnIndex="+u),r&&(o.mRow=r),o.InitControl(n,t,s),f&&o.SetProperty("ClassName",f),o},i.prototype.InitControl=function(i,r,u,f){this.MyBaseType=n.cdeControlType.TableCell;r||(r=new n.TheTRF(null,0,new n.TheFieldInfo(this.MyBaseType,0,null)));t.prototype.InitControl.call(this,i,r,u,f);this.mCell=this.mRow&&this.MyFieldInfo?this.mRow.insertCell(cde.CInt(this.MyFieldInfo.ColumnIndex)):this.MyFieldInfo&&cde.CBool(this.MyFieldInfo.IsHeader)?document.createElement("th"):document.createElement("td");this.mCell.className="cdeTabEntry";var e=(r.FldInfo.Flags&2)!=0;return this.SetElement(this.mCell,e),!0},i.prototype.SetProperty=function(n,i){t.prototype.SetProperty.call(this,n,i);n==="ClassName"&&this.mCell&&(this.mCell.className=i);n==="CellStyle"&&this.mCell&&(this.mCell.style.cssText=i)},i.prototype.AppendChild=function(n){this.MyChildren.push(n);this.mCell.appendChild(n.GetElement())},i}(n.TheNMIBaseControl);n.ctrlTableCell=t;r=function(r){function u(n){var t=r.call(this,n)||this;return t.MyScreenInfo=null,t.MyFormInfo=null,t.MyTableTitle=null,t.btnAdder=null,t.inputFilter=null,t.InfoText=null,t.mBaseDiv=null,t.IsPropertyTable=!1,t.IsNMIOnly=!1,t.mSortFldID=-1,t.mColHeader=null,t.rowAdder=null,t.tableMain=null,t.tableContainer=null,t.tableBody=null,t.mTableRows=[],t.mCurrentFormFieldsInfo=null,t.MyMetaData=null,t.IsInEdit=!1,t.mFileList=[],t}return __extends(u,r),u.prototype.InitControl=function(u,f,e,o){var a=this,g,v,c,nt,tt,it,h,rt,ut,b,ft,p,k,s,y,d,w,et,l,ot;if(this.MyBaseType=n.cdeControlType.Table,r.prototype.InitControl.call(this,u,f,e,o),g=this.GetSetting("ExtraInfo"),g&&(v=g.split(":"),v.length>4&&this.SetProperty("PageSize",cde.CInt(v[4])),v.length>5&&this.SetProperty("CurrentPage",cde.CInt(v[5])),v.length>7&&this.SetProperty("CurrentFilter",v[7])),!this.MyTRF)return console.log("pTRF HAS to be specified!"),!1;if(this.MyScreenInfo=n.MyNMIModels[this.MyScreenID],this.SetProperty("NoTE",!0),this.RegisterNMIControl(),c=this.MyTRF.TableName,this.MyFieldInfo&&this.MyFieldInfo.Type===n.cdeControlType.Table&&this.MyFieldInfo.DataItem&&(c=this.MyFieldInfo.DataItem),c.substr(0,13).toLowerCase()==="mypropertybag"){if(!this.MyTRF||!this.MyFieldInfo||!this.MyScreenInfo.MyStorageMirror[this.MyTRF.TableName]||!this.MyScreenInfo.MyStorageMirror[this.MyTRF.TableName][this.MyTRF.RowNo]||!this.MyScreenInfo.MyStorageMirror[this.MyTRF.TableName][this.MyTRF.RowNo].MyPropertyBag)return u&&(u.GetElement().innerHTML="Not a Thing or No Properties found"),!1;for(nt=c.split(";"),this.IsNMIOnly=nt.length>1&&nt[1]==="1",c=cde.GuidToString("PB"+this.MyTRF.RowID),this.RefreshPropTable(c),this.MyMetaData=new n.TheFormInfo,this.MyMetaData.FormFields=[],this.MyMetaData.IsReadOnly=(this.MyFieldInfo.Flags&2)==0,this.MyMetaData.IsGenerated=!1,this.MyMetaData.TargetElement=c,this.MyMetaData.PropertyBag=["Caption="+(cde.IsNotSet(this.MyFieldInfo.Caption)?"":this.MyFieldInfo.Caption)],tt=3,cde.CInt(this.MyFieldInfo.TileWidth)<3&&(tt=1),it=3,cde.CInt(this.MyFieldInfo.TileWidth)>3&&(it=cde.CInt(this.MyFieldInfo.TileWidth)-3),h=0;h<(this.IsNMIOnly?2:3);h++)switch(h){case 0:this.MyMetaData.FormFields[h]=new n.TheFieldInfo(1,tt,"Name");this.MyMetaData.FormFields[h].FldOrder=1;this.MyMetaData.FormFields[h].DataItem="Name";this.MyMetaData.FormFields[h].Flags=0;break;case 1:this.MyMetaData.FormFields[h]=new n.TheFieldInfo(1,it,"Value");this.MyMetaData.FormFields[h].FldOrder=2;this.MyMetaData.FormFields[h].DataItem="Value";this.MyMetaData.FormFields[h].Flags=2;this.MyMetaData.FormFields[h].FormID="PROPTABLEInline";break;case 2:this.MyMetaData.FormFields[h]=new n.TheFieldInfo(21,8,"Time");this.MyMetaData.FormFields[h].FldOrder=3;this.MyMetaData.FormFields[h].DataItem="cdeCTIM";this.MyMetaData.FormFields[h].Flags=0}this.IsPropertyTable=!0}if(this.MyTableName=cde.GuidToString(c),this.IsPropertyTable?(this.mBaseDiv=document.createElement("div"),this.MyFieldInfo&&cde.CInt(this.MyFieldInfo.TileHeight)>0?this.mBaseDiv.className="cdeTableContainer":this.mBaseDiv.style.height="inherit"):(rt=document.getElementById("Inline_"+this.MyTableName),rt&&(this.mBaseDiv=rt),this.mBaseDiv||u||!this.MyScreenInfo.MyStorageMeta[this.MyTableName]||(this.mBaseDiv=document.getElementById("Content_"+cde.GuidToString(this.MyScreenInfo.MyStorageMeta[this.MyTableName].TargetElement))),this.mBaseDiv?(this.RemoveTableHooks(),this.mBaseDiv.innerHTML=""):this.MyTarget&&(this.mBaseDiv=this.MyTarget.GetContainerElement(),this.mBaseDiv&&!this.mBaseDiv.id&&this.MyFieldInfo&&(this.mBaseDiv.id="Content_"+cde.GuidToString(this.MyTarget.MyFieldInfo.cdeMID)),this.RemoveTableHooks(),this.MyTarget.GetContainerElement().innerHTML="")),ut="CMyTable",this.MyFieldInfo&&this.MyFieldInfo.TableClassName&&(ut=this.MyFieldInfo.TableClassName),this.SetElement(this.mBaseDiv),this.MyMetaData?this.MyScreenInfo.MyStorageMeta[this.MyTableName]=this.MyMetaData:this.MyScreenInfo.MyStorageMirror[this.MyTableName]&&this.MyScreenInfo.MyStorageMirror[this.MyTableName][0]&&this.MyScreenInfo.MyStorageMirror[this.MyTableName][0].cdeM&&(this.MyScreenInfo.MyStorageMeta[this.MyTableName]=JSON.parse(this.MyScreenInfo.MyStorageMirror[this.MyTableName][0].cdeM)),this.MyFormInfo=new n.TheFormInfo,this.MyScreenInfo.MyStorageMeta[this.MyTableName]!==undefined&&this.MyScreenInfo.MyStorageMeta[this.MyTableName].IsGenerated===!0&&(this.MyScreenInfo.MyStorageMeta[this.MyTableName]=null),!this.MyScreenInfo.MyStorageMeta[this.MyTableName]||!this.MyScreenInfo.MyStorageMeta[this.MyTableName].FormFields||this.MyScreenInfo.MyStorageMeta[this.MyTableName].FormFields.length===0){if(!this.MyScreenInfo.MyStorageMirror[this.MyTableName])return this.DisplayHeader(this.mBaseDiv,"No Data Available, yet",this.GetSetting("IsLiveData")),n.MyEngine&&this.MyTarget&&this.MyTarget.MyFieldInfo&&n.MyEngine.PublishToNMI("NMI_GET_DATA:"+cde.GuidToString(this.MyTarget.MyFieldInfo.cdeMID)+":CMyTable:"+this.MyTableName+":"+this.MyScreenID+":true:true","",this.MyFieldInfo?this.MyFieldInfo.cdeN:null),!1;this.MyFormInfo.AssociatedClassName=this.MyTableName;this.MyFormInfo.FormFields=[];this.CreateFormInfo(this.MyScreenInfo.MyStorageMirror[this.MyTableName][0],"",this.MyFormInfo,0);this.MyFormInfo.IsReadOnly=!0;this.MyFormInfo.IsGenerated=!0;this.MyFormInfo.TargetElement=this.MyTableName;this.MyScreenInfo.MyStorageMeta[this.MyTableName]=this.MyFormInfo}for(this.MyFormInfo=this.MyScreenInfo.MyStorageMeta[this.MyTableName],this.MyFormInfo&&(this.MyFieldInfo?n.ThePB.ConvertPropertiesFromBag(this.MyFieldInfo,this.MyFormInfo.PropertyBag):(this.MyFieldInfo=new n.TheFieldInfo(n.cdeControlType.Table,0,""),this.MyFieldInfo.PropertyBag=this.MyFormInfo.PropertyBag,n.ThePB.ConvertPropertiesFromBag(this.MyFieldInfo))),this.mBaseDiv.style.width=cde.CInt(this.MyFieldInfo.TileWidth)>0?n.GetSizeFromTile(this.MyFieldInfo.TileWidth)+"px":"inherit",this.MyFieldInfo&&cde.CInt(this.MyFieldInfo.TileHeight)>0&&(this.mBaseDiv.style.height="initial"),this.DisplayHeader(this.mBaseDiv,this.MyFieldInfo.Caption,this.MyFormInfo.IsLiveData),this.tableContainer=document.createElement("div"),this.tableContainer.className=this.MyFieldInfo.TableContainerClassName?this.MyFieldInfo.TableContainerClassName:"cdeTableContainer",this.tableContainer.style.width=cde.CInt(this.MyFieldInfo.TileWidth)>0?n.GetSizeFromTile(this.MyFieldInfo.TileWidth)+"px":"inherit",this.mBaseDiv.appendChild(this.tableContainer),this.tableMain=document.createElement("table"),this.tableMain.className=ut,this.tableContainer.appendChild(this.tableMain),b=document.createElement("THEAD"),b.className=this.MyFieldInfo.HeaderClassName?this.MyFieldInfo.HeaderClassName:"cdeFixedHeader",this.tableMain.appendChild(b),ft=i.Create(null,null,null,null,"cdeHeaderRow"),b.appendChild(ft.GetElement()),this.mCurrentFormFieldsInfo=null,this.mCurrentFormFieldsInfo=this.MyFormInfo.IsGenerated?this.MyFormInfo.FormFields:n.SortArrayByProperty(this.MyFormInfo.FormFields,"FldOrder",!0,!1),this.mColHeader=[],k=!1,this.MyFormInfo.OrderBy&&(p=this.MyFormInfo.OrderBy.split(" "),p.length>1&&p[1].toLocaleLowerCase()==="desc"&&(k=!0)),s=0;s<this.mCurrentFormFieldsInfo.length;s++)this.mCurrentFormFieldsInfo[s]&&(this.mCurrentFormFieldsInfo[s].Flags&8)==0&&this.mCurrentFormFieldsInfo[s].Type!==n.cdeControlType.FacePlate&&(n.ThePB.ConvertPropertiesFromBag(this.mCurrentFormFieldsInfo[s]),y=t.Create(null,null,null,0,"cdeTH",!0),y.HookEvents(!1),this.mCurrentFormFieldsInfo[s].THClassName&&y.SetProperty("ClassName",this.mCurrentFormFieldsInfo[s].THClassName),d=1,cde.CInt(this.mCurrentFormFieldsInfo[s].FldWidth)>0&&(d=cde.CInt(this.mCurrentFormFieldsInfo[s].FldWidth)),y.SetProperty("TileWidth",d),y.GetElement().style.height=n.GetSizeFromTile(1)/2+"px",w=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(y),w.SetProperty("ClassName","cdeTHCell"),w.SetProperty("TileWidth",d),this.mCurrentFormFieldsInfo[s].Type===22?(l="&nbsp;",this.mCurrentFormFieldsInfo[s].TableHeader&&(l=this.mCurrentFormFieldsInfo[s].TableHeader),w.GetElement().innerHTML=l):(et=new n.TheFieldInfo(22,0,"",2),et.FldOrder=s,l=this.mCurrentFormFieldsInfo[s].Title,this.mCurrentFormFieldsInfo[s].TableHeader&&(l=this.mCurrentFormFieldsInfo[s].TableHeader),this.mColHeader[s]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(w,{ScreenID:this.MyScreenID,TRF:new n.TheTRF(l,0,et),PostInitBag:[l?"iValue="+l:""]}),this.mColHeader[s].SetProperty("Cookie",this),this.mColHeader[s].HookEvents(!0),this.mColHeader[s].RegisterEvent("PointerUp",function(t){var i,r;a.rowAdder||(i=t.GetProperty("Cookie"),i.mSortFldID>=0&&i.mSortFldID!==t.MyFieldInfo.FldOrder&&i.mColHeader[i.mSortFldID].SetProperty("ClassName",""),i.mSortFldID=t.MyFieldInfo.FldOrder,r=!1,t.GetProperty("ClassName")&&t.GetProperty("ClassName")!=="cdeTHsortdn"?t.SetProperty("ClassName","cdeTHsortdn"):(t.SetProperty("ClassName","cdeTHsortup"),r=!0),a.SortTableByProperty(i.MyScreenInfo.MyStorageMirror[i.MyTableName],i.mCurrentFormFieldsInfo[t.MyFieldInfo.FldOrder].DataItem,n.MyTCF.IsTypeNumeric(i.mCurrentFormFieldsInfo[t.MyFieldInfo.FldOrder].Type),r),a.MyTableTitle&&a.MyTableTitle.SetProperty("Visibility",!1),a.InfoText&&(a.InfoText.SetProperty("Text","Sorting...<i class='fa fa-spinner fa-pulse'><\/i>"),a.InfoText.SetProperty("Visibility",!0)),window.setTimeout(function(){i.UpdateBody(!1)},100))})),this.MyFormInfo.OrderBy&&this.mCurrentFormFieldsInfo[s].DataItem===p[0]&&(k?this.mColHeader[s].SetProperty("ClassName","cdeTHsortup"):this.mColHeader[s].SetProperty("ClassName","cdeTHsortdn")),ft.AppendChild(y));if(!this.MyScreenInfo.MyStorageMirror[this.MyTableName])return!1;if(this.MyFormInfo.OrderBy)for(s=0;s<this.mCurrentFormFieldsInfo.length;s++)if(this.mCurrentFormFieldsInfo[s]&&this.mCurrentFormFieldsInfo[s].DataItem===p[0]){this.SortTableByProperty(this.MyScreenInfo.MyStorageMirror[this.MyTableName],this.mCurrentFormFieldsInfo[s].DataItem,n.MyTCF.IsTypeNumeric(this.mCurrentFormFieldsInfo[s].Type),k);break}return this.tableBody=document.createElement("TBODY"),this.tableBody.className="cdeScrollBody",ot=cde.CInt(this.GetProperty("TileHeight")),ot>0&&(this.tableBody.style.height=n.GetSizeFromTile(ot-1)+"px"),this.tableMain.appendChild(this.tableBody),this.UpdateBody(!0),!0},u.prototype.LaterApplySkin=function(){var n=cde.CInt(this.GetProperty("TileHeight"));n>0&&this.MyTarget&&(this.tableBody.style.height=this.MyTarget.GetContainerElement().style.height)},u.prototype.SetTE=function(n){var t=this;cde.CInt(n.MyTarget.GetProperty("TileWidth"))!==0&&this.SetProperty("TileWidth",cde.CInt(n.MyTarget.GetProperty("TileWidth")));n.MyFieldInfo.MaxFileSize&&this.SetProperty("MaxFileSize",n.MyFieldInfo.MaxFileSize);n.MyFieldInfo.IsDropTarget&&this.SetProperty("IsDropTarget",n.MyFieldInfo.IsDropTarget);n.MyFieldInfo.AllowGlobalPush&&this.SetProperty("AllowGlobalPush",n.MyFieldInfo.AllowGlobalPush);n.MyFieldInfo.EngineName&&this.SetProperty("EngineName",n.MyFieldInfo.EngineName);this.MyFieldInfo.cdeO=n.MyFieldInfo.cdeO;n.RegisterEvent("Resize",function(n,i){t.SetProperty("TileWidth",i)})},u.prototype.SetProperty=function(t,i){var u=this;t!=="MID"&&r.prototype.SetProperty.call(this,t,i);t==="Reload"?(n.ResetKeyCorder(),this.MyScreenInfo&&(this.MyScreenInfo.MyStorageMirror[this.MyTableName]=null),this.RefreshData(this.MyTableName,cde.CInt(this.GetProperty("CurrentPage")))):(t==="TileWidth"||t==="TileWidth")&&this.mBaseDiv?(i=cde.CInt(i),i>0&&(this.mBaseDiv.style.width=n.GetSizeFromTile(i).toString()+"px"),this.mBaseDiv.style.overflowX="auto"):(t==="TileHeight"||t==="TileHeight")&&this.mBaseDiv?(i=cde.CInt(i),this.tableBody&&cde.CInt(i)>1&&(this.tableBody.style.height=n.GetSizeFromTile(cde.CInt(i)-1).toString()+"px",this.mBaseDiv.style.height="initial"),this.mBaseDiv.style.overflowY="auto"):t==="Style"&&this.mBaseDiv?this.mBaseDiv.style.cssText=i:t==="InnerClassName"&&this.tableMain?this.tableMain.className=i:t==="Title"&&this.MyTableTitle?this.MyTableTitle.SetProperty("Text",i):t==="IsDropTarget"&&this.mBaseDiv&&cde.CBool(i)===!0&&(this.mBaseDiv.ondragover=function(){return u.mBaseDiv.classList.add("ctrlDropUploaderHover"),!1},this.mBaseDiv.ondragend=function(){return u.mBaseDiv.classList.remove("ctrlDropUploaderHover"),!1},this.mBaseDiv.ondragleave=function(){return u.mBaseDiv.classList.remove("ctrlDropUploaderHover"),!1},this.mBaseDiv.ondrop=function(n){n.stopPropagation();n.preventDefault();u.mBaseDiv.classList.remove("ctrlDropUploaderHover");u.ProcessFiles(n.dataTransfer.files)})},u.prototype.DisplayHeader=function(t,i,r){var u=this,f=document.createElement("div"),e,o,s,h,c,l,a,y,p,w,b,v;if(f.className="cdeMainTableHeader",f.style.height=n.GetSizeFromTile(1)/2+"px",t.appendChild(f),e=!0,cde.IsNotSet(i)?(i="&nbsp;",e=!1):e=!0,e&&(o=n.MyScreenManager.GetScreenByID(this.MyTableName),o&&cde.CBool(o.GetProperty("HidePins"))===!1?(o.SetProperty("Caption",i),e=!1):(this.MyTableTitle=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(null,{PreInitBag:["Element=h1"],PostInitBag:["iValue="+n.GenerateFinalString(i),"ClassName=cdeTableHeader"]}),this.MyFieldInfo&&this.MyFieldInfo.TNClassName&&this.MyTableTitle.SetProperty("ClassName",this.MyFieldInfo.TNClassName))),!r){if(this.IsPropertyTable||(e&&(s=n.ctrlTileButton.Create(null,function(t){n.ResetKeyCorder();u.MyScreenInfo.MyStorageMirror[u.MyTableName]=null;u.RefreshData(u.MyTableName,cde.CInt(u.GetProperty("CurrentPage")),t.button===2)},"<span class='fa cdeTableHeaderIcon'>&#xf021;<\/span>",1,1),s.SetProperty("TileFactorX",2),s.SetProperty("TileFactorY",2),f.appendChild(s.GetElement())),cde.CInt(this.GetProperty("PageSize"))>0&&(h=n.ctrlTileButton.Create(null,function(){!u.rowAdder&&cde.CInt(u.GetProperty("CurrentPage"))>0&&(n.ResetKeyCorder(),u.MyScreenInfo.MyStorageMirror[u.MyTableName]=null,u.RefreshData(u.MyTableName,0))},"<span class='fa cdeTableHeaderIcon'>&#xf049;<\/span>",1,1),h.SetProperty("TileFactorX",2),h.SetProperty("TileFactorY",2),f.appendChild(h.GetElement()),c=n.ctrlTileButton.Create(null,function(){!u.rowAdder&&cde.CInt(u.GetProperty("CurrentPage"))>0&&(n.ResetKeyCorder(),u.MyScreenInfo.MyStorageMirror[u.MyTableName]=null,u.RefreshData(u.MyTableName,cde.CInt(u.GetProperty("CurrentPage"))-1))},"<span class='fa cdeTableHeaderIcon'>&#xf048;<\/span>",1,1),c.SetProperty("TileFactorX",2),c.SetProperty("TileFactorY",2),f.appendChild(c.GetElement()),l=n.ctrlTileButton.Create(null,function(){u.rowAdder||(n.ResetKeyCorder(),u.MyScreenInfo.MyStorageMirror[u.MyTableName]=null,u.RefreshData(u.MyTableName,cde.CInt(u.GetProperty("CurrentPage"))+1))},"<span class='fa cdeTableHeaderIcon'>&#xf051;<\/span>",1,1),l.SetProperty("TileFactorX",2),l.SetProperty("TileFactorY",2),f.appendChild(l.GetElement()),a=n.ctrlTileButton.Create(null,function(){u.rowAdder||(n.ResetKeyCorder(),u.MyScreenInfo.MyStorageMirror[u.MyTableName]=null,u.RefreshData(u.MyTableName,-1))},"<span class='fa cdeTableHeaderIcon'>&#xf050;<\/span>",1,1),a.SetProperty("TileFactorX",2),a.SetProperty("TileFactorY",2),f.appendChild(a.GetElement()))),this.MyFormInfo&&this.MyFormInfo.FormFields){if(!this.MyFormInfo.IsReadOnly&&this.MyFieldInfo.AddButtonText){for(y=this.MyFormInfo.FormFields.length,p=!1;y--;)if(this.MyFormInfo.FormFields[y].DataItem==="CDE_DELETE"){p=!0;break}p&&(this.btnAdder=n.ctrlTileButton.Create(null,function(){return u.AddRecord(u.MyScreenID)},this.MyFieldInfo.AddButtonText,2,1),this.btnAdder.SetProperty("TileFactorY",2),this.MyFieldInfo.AddButtonClassName?this.btnAdder.SetProperty("ClassName",this.MyFieldInfo.AddButtonClassName):this.btnAdder.SetProperty("ClassName","cdeAddButton"),f.appendChild(this.btnAdder.GetElement()))}cde.CBool(this.MyFieldInfo.ShowFilterField)&&(w=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(null,{PostInitBag:["ClassName=cdeFilterInputIcon","TileWidth=1","TileFactorX=2","Style=float:left;","Text=<i class='fa fa-2x'>&#xf002;<\/i>"]}),f.appendChild(w.GetElement()),b=new n.TheFieldInfo(n.cdeControlType.SingleEnded,3,"Filter:",2),v=this.GetProperty("CurrentFilter"),v||(v=""),this.inputFilter=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleEnded).Create(null,{TRF:new n.TheTRF(this.MyTableName,1,b),PostInitBag:["ClassName=cdeInput cdeFilterInput","TileWidth=2","iValue="+v]}),this.inputFilter.SetProperty("TileFactorY",2),this.inputFilter.RegisterEvent("OnValueChanged",function(n,t,i){u.GetProperty("CurrentFilter")!==i&&(u.SetProperty("CurrentFilter",i),u.RefreshData(u.MyTableName,cde.CInt(u.GetProperty("CurrentPage")),!0))}),f.appendChild(this.inputFilter.GetElement()))}this.InfoText=n.ctrlSmartLabel.Create(null,null,null,"","span",!0);this.InfoText.SetProperty("TileFactorY",2);this.InfoText.SetProperty("ClassName","cdeRefresher");this.InfoText.SetProperty("Visibility",!1);f.appendChild(this.InfoText.GetElement())}e&&f.appendChild(this.MyTableTitle.GetElement())},u.prototype.UpdateBody=function(r){var h=this,f,a,c,l,o,u,e,s,y,v,b,p,w;if(r||this.RemoveTableHooks(),this.MyTableControls=[],this.mTableRows=[],this.tableBody){for(this.tableBody.innerHTML="",f=0;f<this.MyScreenInfo.MyStorageMirror[this.MyTableName].length;f++){for(a=i.Create(null,this.MyTRF),this.MyTableControls[f]=[],a.SetProperty("ClassName",f%2==0?"cdeRowEven":"cdeRowOdd"),this.tableBody.appendChild(a.GetElement()),c=this.MyScreenInfo.MyStorageMirror[this.MyTableName][f],this.mTableRows[c.cdeMID]=a,l=0;l<this.mCurrentFormFieldsInfo.length;l++)if(this.mCurrentFormFieldsInfo[l]&&(this.mCurrentFormFieldsInfo[l].Flags&8)==0&&this.mCurrentFormFieldsInfo[l].Type!==n.cdeControlType.FacePlate)if(o=t.Create(null,null),a.AppendChild(o),u=this.mCurrentFormFieldsInfo[l],u.FldOrder||(u.FldOrder=(l+1)*10),e=this.MyTableName+"_"+f+"_"+u.FldOrder,(u.Flags&2)!=0&&o.HookEvents(!1),this.MyFormInfo.IsReadOnly||u.DataItem!=="CDE_DELETE")if(u.DataItem==="CDE_DETAILS")o.SetProperty("ClassName","cdeTH"),o.SetProperty("TileWidth",1),this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{TRF:new n.TheTRF(this.MyTableName,f,u),PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa fa-3x'>&#xf044;<\/span>","ClassName=cdeTransitButton cdeDetailButton"]}),this.MyTableControls[f][e].SetProperty("Cookie",f),this.MyTableControls[f][e].SetProperty("OnClick",function(t){if(!h.rowAdder)if(n.TogglePortalFull(!1),h.GetProperty("TemplateID")&&n.MyScreenManager){var i=h.MyScreenInfo.MyStorageMirror[h.MyTableName][cde.CInt(t.GetProperty("Cookie"))].cdeMID,r=cde.GuidToString(h.GetProperty("TemplateID"));n.MyScreenManager.TransitToScreen(r,!0,!1,i)}else n.MyTCF.CreateNMIControl(n.cdeControlType.FormView).Create(h.MyTarget,{ScreenID:h.MyScreenID,TRF:new n.TheTRF(h.MyTableName,t.GetProperty("Cookie"),null)})}),o.AppendChild(this.MyTableControls[f][e]);else{s="";u.DataItem&&(s=n.GetFldContent(c,u,this.MyFormInfo.IsGenerated,!1));u.TCClassName?o.SetProperty("ClassName",u.TCClassName):o.SetProperty("ClassName","cdeTabEntry");y=1;cde.CInt(u.FldWidth)>0&&(y=cde.CInt(u.FldWidth));o.SetProperty("TileWidth",y);u.HorizontalAlignment&&o.SetProperty("HorizontalAlignment",u.HorizontalAlignment);v=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(o);v.SetProperty("ClassName","cdeTDCell");v.SetProperty("TileWidth",y);b=!0;u.IsInTable=!0;switch(u.Type){case n.cdeControlType.Picture:s&&(s.length>512||cde.CBool(n.ThePB.GetSetting(u,"IsBlob")))&&(s="data:image/jpeg;base64,"+s);this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.Picture).Create(null,{PostInitBag:["iValue="+s]});cde.CInt(u.FldWidth)>0&&(this.MyTableControls[f][e].SetProperty("ControlTW",cde.CInt(u.FldWidth)),this.MyTableControls[f][e].SetProperty("ControlTH",1));break;case n.cdeControlType.Table:this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.Table).Create(null,{ScreenID:this.MyScreenID,TRF:new n.TheTRF(this.MyTableName,f,u),PostInitBag:["InnerClassName=cdeInlineTable"]});break;case n.cdeControlType.TouchDraw:this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.TouchDraw).Create(null,{TRF:new n.TheTRF(this.MyTableName,f,u),PostInitBag:["iValue="+s]});break;case n.cdeControlType.FormButton:case n.cdeControlType.TileButton:u.OnClick=n.GenerateFinalString(u.OnClick,c);p="";p=u.DataItem?n.GenerateFinalString("%"+u.DataItem+"%",c):n.GenerateFinalString(u.Title,c);this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(this,{ScreenID:this.MyScreenID,TRF:new n.TheTRF(this.MyTableName,f,u),PostInitBag:["iValue="+(p?p:"")]});break;case n.cdeControlType.SingleCheck:this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.SingleCheck).Create(this,{ScreenID:this.MyScreenID,TRF:new n.TheTRF(this.MyTableName,f,u),PreInitBag:["IsInTable=true"],PostInitBag:["iValue="+cde.CBool(s)]});this.MyTableControls[f][e].SetProperty("UpdateTable",!0);break;case n.cdeControlType.CircularGauge:u.ControlTW=cde.CInt(u.FldWidth)>0?cde.CInt(u.FldWidth):1;u.ControlTH=1;this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.CircularGauge).Create(this,{ScreenID:this.MyScreenID,TRF:new n.TheTRF(this.MyTableName,f,u),PreInitBag:["IsInTable=true"],PostInitBag:["iValue="+cde.CDbl(s)]});break;case n.cdeControlType.BarChart:u.ControlTW=cde.CInt(u.FldWidth)>0?cde.CInt(u.FldWidth):1;u.ControlTH=1;this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.BarChart).Create(this,{ScreenID:this.MyScreenID,TRF:new n.TheTRF(this.MyTableName,f,u),PreInitBag:["IsInTable=true"],PostInitBag:["iValue="+cde.CDbl(s)]});break;case n.cdeControlType.StatusLight:w=new n.ctrlStatusLight;u.ControlTW=cde.CInt(u.FldWidth)>0?cde.CInt(u.FldWidth):1;u.ControlTH=1;w.InitControl(null,new n.TheTRF(this.MyTableName,f,u),null,this.MyScreenID);w.SetProperty("iValue",s);this.MyTableControls[f][e]=w;break;case n.cdeControlType.CollapsibleGroup:case n.cdeControlType.TileGroup:this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(null,{TRF:new n.TheTRF(this.MyTableName,f,u)});this.MyTableControls[f][e].SetProperty("ClassName","cdeTileGroup");this.MyTableControls[f][e].SetProperty("IsDivOnly",u.IsDivOnly);this.MyTableControls[f][e].SetProperty("iValue",s);break;case n.cdeControlType.UserControl:u.ControlTW=cde.CInt(u.FldWidth)>0?cde.CInt(u.FldWidth):1;u.ControlTH=1;u.IsInTable=!0;u.DataRow=c;u.FldID=e;u.iValue=s;n.MyTCF.CreateControlLazy(v,u.EngineName,u.ControlType,function(n,t,i){h.MyTableControls[i.RowNo][i.FldInfo.FldID]=t;t.InitControl(n,i);t.SetProperty("iValue",i.FldInfo.iValue);h.FinishControlSetup(i.RowNo,i.FldInfo.FldID,i.FldInfo,i.FldInfo.DataRow,!0,n)},new n.TheTRF(this.MyTableName,f,u));continue;default:this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.SmartLabel).Create(null,{ScreenID:this.MyScreenID,TRF:new n.TheTRF(this.MyTableName,f,u),PreInitBag:["Element=div","IsReadOnly="+this.MyFormInfo.IsReadOnly,"IsInTable=true"],PostInitBag:["iValue="+s],Cookie:c});(u.Flags&2)!=0&&u.Type!==n.cdeControlType.SmartLabel&&(o.MyNMIControl=this.MyTableControls[f][e],this.MyTableControls[f][e].MyNMIControl=o,o.MyNMIControl.MyDataView=this,o.RegisterEvent("PointerUp",function(t,i,r){n.StopPointerEvents(i);t.MyNMIControl.EditControl(i,r,t)}))}this.FinishControlSetup(f,e,u,c,b,v)}else o.SetProperty("ClassName","cdeTH"),o.SetProperty("TileWidth",1),this.MyTableControls[f][e]=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(null,{TRF:new n.TheTRF(this.MyTableName,f,u),PreInitBag:["ControlTW=1","ControlTH=1"],PostInitBag:["Title=<span class='fa fa-3x'>&#xf1f8;<\/span>","ClassName=cdeBadActionButton cdeDeleteButton"]}),this.MyTableControls[f][e].SetProperty("Cookie",this),this.MyTableControls[f][e].SetProperty("Cookie2",c),this.MyTableControls[f][e].SetProperty("OnClick",function(t,i){var r=t.GetProperty("Cookie");i.shiftKey?r.DeleteRecord(t.GetProperty("Cookie2")):n.MyPopUp&&n.MyPopUp.Show("Are you sure you want to delete this record? ",!1,null,1,function(n,t,i){t.DeleteRecord(i)},null,t.GetProperty("Cookie2"),r)}),o.AppendChild(this.MyTableControls[f][e]);n.MyEngine.UnregisterEvent("RecordUpdated_"+this.MyTableName+"_"+f,this.UpdateRecord);n.MyEngine.RegisterEvent("RecordUpdated_"+this.MyTableName+"_"+f,this.UpdateRecord);this.ValidateRules(this.MyScreenID,this.MyTableName,this.MyTableName,f,this.MyTableControls[f],!0,!1)}n.TheFlashCache.FlushCache();this.InfoText.SetProperty("Text","");this.InfoText.SetProperty("Visibility",!1);this.MyTableTitle&&this.MyTableTitle.SetProperty("Visibility",!0)}},u.prototype.FinishControlSetup=function(t,i,r,u,f,e){var o=this;this.MyTableControls[t][i].MyTRF||(this.MyTableControls[t][i].MyTRF=new n.TheTRF(this.MyTableName,t,r));this.MyScreenInfo.MyStorageMirror[this.MyTableName]&&u&&u.cdeMID&&(this.MyTableControls[t][i].MyTRF.RowID=u.cdeMID);this.MyTableControls[t][i].MyTRF.ModelID=this.MyScreenID;this.MyTableControls[t][i].MyDataView=this;f&&this.MyTableControls[t][i].SetProperty("OnValueChanged",function(n,t,i,r){r&&o.ValidateRules(o.MyScreenID,o.MyTableName,o.MyTableName,r.RowNo,o.MyTableControls[r.RowNo],!1,!1)});r.PropertyBag&&r.PropertyBag.length>0&&n.ThePB.SetPropertiesFromBag(this.MyTableControls[t][i],r.PropertyBag,this.MyScreenInfo.MyStorageMirror[this.MyTableName]?u:null,!1,!0);r.DataItem&&this.MyTableControls[t][i].SetProperty("DataItem",r.DataItem);((r.Flags&64)!=0||r.Type===n.cdeControlType.ThingPicker)&&(this.MyTableControls[t][i].SetProperty("TID",u.cdeMID),this.MyTableControls[t][i].SetProperty("UXID",r.cdeMID),this.MyTableControls[t][i].RegisterNMIControl());e.AppendChild(this.MyTableControls[t][i])},u.prototype.UpdateRecord=function(t,i,r,u,f){var e,s,o,h;if(this.MyTableName&&this.MyTableName===r&&(e=n.MyNMIModels[i],e)){s=0;for(o in this.MyTableControls[u])h=this.MyTableControls[u][o].GetProperty("DataItem"),h&&(!f||f.substr(s,1)==="1")&&(Object.prototype.hasOwnProperty.call(e.MyStorageMirror[r][u],"SecToken")||this.MyTableControls[u][o].SetProperty("iValue",n.GetFldContent(e.MyStorageMirror[r][u],this.MyTableControls[u][o].MyFieldInfo,this.MyFormInfo.IsGenerated,!1))),s++;this.ValidateRules(i,r,r,u,this.MyTableControls[u],!0,!1)}},u.prototype.ReloadData=function(){return this.MyScreenInfo.MyStorageMirror[this.MyTableName]=null,this.RefreshData(this.MyTableName,cde.CInt(this.GetProperty("CurrentPage")),!1),!0},u.prototype.RefreshData=function(t,i,r){var f,u;r===void 0&&(r=!1);this.IsPropertyTable?(this.RefreshPropTable(t),this.UpdateBody(!0)):(f="auto",this.MyTarget&&(this.MyTarget.MyNMIControl&&this.MyTarget.MyNMIControl.MyBaseType===n.cdeControlType.Table?f=cde.GuidToString(this.MyTarget.MyFieldInfo.cdeMID):this.MyTarget.MyScreenID&&(f=this.MyTarget.MyScreenID)),n.MyEngine&&(u=this.GetProperty("CurrentFilter"),u||(u=""),n.MyEngine.PublishToNMI("NMI_GET_DATA:"+f+":CMyTable:"+t+":"+this.MyScreenID+(r===!0?":false:true":""),i.toString()+(u.length>0?":;:"+u:""),this.MyTRF?this.MyTRF.GetNodeID():null)),this.MyTableTitle&&this.MyTableTitle.SetProperty("Visibility",!1),this.InfoText&&(this.InfoText.SetProperty("Text","Refreshing...<i class='fa fa-spinner fa-pulse'><\/i>"),this.InfoText.SetProperty("Visibility",!0)),n.MyToast&&n.MyToast.ShowToastMessage("Table Refresh request sent to Relay"))},u.prototype.RefreshPropTable=function(n){this.MyScreenInfo.MyStorageMirror[n]=[];for(var t in this.MyScreenInfo.MyStorageMirror[this.MyTRF.TableName][this.MyTRF.RowNo].MyPropertyBag)this.IsNMIOnly&&(this.MyScreenInfo.MyStorageMirror[this.MyTRF.TableName][this.MyTRF.RowNo].MyPropertyBag[t].cdeE&64)==0||this.MyScreenInfo.MyStorageMirror[n].push(this.MyScreenInfo.MyStorageMirror[this.MyTRF.TableName][this.MyTRF.RowNo].MyPropertyBag[t]);this.SortTableByProperty(this.MyScreenInfo.MyStorageMirror[n],"Name",!1,!1)},u.prototype.TableHighlightRow=function(){var r,t,i,n;if(document.getElementById&&document.createTextNode)for(r=document.getElementsByTagName("table"),t=0;t<r.length;t++)if(r[t].className==="cdeHilite")for(i=r[t].getElementsByTagName("tr"),n=0;n<i.length;n++)i[n].parentNode.nodeName==="TBODY"&&(i[n].onmouseover=function(n){var t=n.target||n.srcElement;return t.setAttribute("oldClass",t.className),t.className="cdeHilightRow",!1},i[n].onmouseout=function(n){var t=n.target||n.srcElement;return t.className=t.attributes.oldClass.nodeValue,!1})},u.prototype.DeleteRecord=function(t){var i=t.cdeMID;n.MyEngine&&n.MyEngine.PublishToNMI("NMI_DEL_ID:"+this.MyTableName+":"+i,"",t.cdeN);this.mTableRows[i].SetProperty("ClassName","rowDeleted")},u.prototype.CancelAddRecord=function(){this.IsInEdit=!1;n.ResetKeyCorder();this.rowAdder&&(this.tableMain.deleteRow(1),this.rowAdder=null);this.btnAdder&&this.btnAdder.SetProperty("Visibility",!0)},u.prototype.SaveRecord=function(){var r,u,t,i,f,e;for(this.IsInEdit=!1,n.ResetKeyCorder(),r=[],r[0]=this.MyScreenInfo.MyStorageMirror[this.MyTableName]&&this.MyScreenInfo.MyStorageMirror[this.MyTableName][0]?this.MyScreenInfo.MyStorageMirror[this.MyTableName][0].constructor():{},u=0;u<this.mCurrentFormFieldsInfo.length;u++)if((t=this.mCurrentFormFieldsInfo[u],t)&&(i=this.MyTableName+"_"+t.FldOrder,this.MyAdderRow[i]&&this.MyAdderRow[i].MyNMIControl)&&t.DataItem!=="CDE_DELETE"&&(t.Flags&2)!=0&&this.MyAdderRow[i]){f=void 0;switch(t.Type){case 4:f=cde.CBool(this.MyAdderRow[i].MyNMIControl.GetProperty("IsChecked"));break;default:f=this.MyAdderRow[i].MyNMIControl.GetProperty("Value")}n.UpdFldContent(r[0],t,f,null)}this.rowAdder&&(this.tableMain.deleteRow(1),this.rowAdder=null,this.MyAdderRow=null,this.btnAdder.SetProperty("Visibility",!0));n.MyEngine?(e="auto",this.MyTarget&&(this.MyTarget.MyNMIControl&&this.MyTarget.MyNMIControl.MyBaseType===n.cdeControlType.Table?e=cde.GuidToString(this.MyTarget.MyFieldInfo.cdeMID):this.MyTarget.MyScreenID&&(e=this.MyTarget.MyScreenID)),n.MyEngine.PublishToNMI("NMI_INS_DATA:"+this.MyTableName+":"+this.MyScreenID+":"+e,JSON.stringify(r[0]),this.MyFormInfo.cdeN),n.ShowToastMessage("New Record was sent to owner")):n.ShowToastMessage("No Engine Found")},u.prototype.AddRecord=function(i){var o=this,s,e,r,f,h,c,u;if(this.GetSetting("AddTemplateType")&&n.MyScreenManager){n.MyScreenManager.TransitToScreen(this.GetSetting("AddTemplateType"),!0,!1,null,this.MyTableName);return}if(this.tableMain&&!this.rowAdder){for(this.rowAdder=this.tableMain.insertRow(1),this.MyAdderRow=[],s=0,e=0;e<this.mCurrentFormFieldsInfo.length;e++)r=this.mCurrentFormFieldsInfo[e],this.rowAdder.className="cdeHilightRow",f=t.Create(null,new n.TheTRF(this.MyTableName,0,r),this.rowAdder,s),(this.mCurrentFormFieldsInfo[e].Flags&8)!=0&&f.SetProperty("Visibility",!1),r.DataItem==="CDE_DELETE"?(f.SetProperty("TileWidth",1),f.SetProperty("ClassName","cdeTH"),n.Key13Event=function(){o.SaveRecord()},h=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(f,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorY=2"],PostInitBag:["Title=<span class='fa fa-2x'>&#xf058;<\/span>"]}),h.SetProperty("OnClick",function(){o.SaveRecord()}),n.Key27Event=function(){o.CancelAddRecord()},c=n.MyTCF.CreateNMIControl(n.cdeControlType.TileButton).Create(f,{PreInitBag:["ControlTW=1","ControlTH=1","TileFactorY=2"],PostInitBag:["Title=<span class='fa fa-2x'>&#xf057;<\/span>"]}),c.SetProperty("OnClick",function(){o.CancelAddRecord()})):r.DataItem!=="CDE_DETAILS"&&r.Type!==29&&r.Type!==11&&r.Type!==27&&r.Type!==22&&r.Type!==23&&r.Type!==33&&(r.Flags&2)!=0&&(r.Value=r.DefaultValue,u=new n.ctrlTileEntry,u.InitControl(f,new n.TheTRF(this.MyTableName,0,r),["IsInTable=true"],i),u.SetProperty("NoTE",!0),u.MyDataView=this,r.Type===n.cdeControlType.CheckField?u.SetProperty("TileWidth",r.Bits):u.SetProperty("TileWidth",r.FldWidth),u.CreateControl("Id"+e,null),u.SetProperty("UXID",r.cdeMID),this.MyAdderRow[this.MyTableName+"_"+r.FldOrder]=u),f.MyRootElement.style.verticalAlign="top",s++;this.btnAdder.SetProperty("Visibility",!1);this.IsInEdit=!0}},u.prototype.UploadNext=function(){if(this.mFileList.length){var t=this.mFileList.shift(),i=this.GetProperty("MaxFileSize");i||(i=512e3);i>5e8&&(i=5e8);t.size>=i?(n.MyToast.ShowToastMessage("File "+t.name+" size "+t.size+" too big - Max: "+i),this.OnComplete(t.size)):(n.MyToast.ShowToastMessage("Reading: "+t.name),this.UploadFile(t,status))}else this.mBaseDiv.classList.remove("ctrlDropUploaderHover")},u.prototype.OnComplete=function(){this.UploadNext()},u.prototype.UploadFile=function(n){var t=this,i=new FileReader;i.onload=function(r){var o=i.result,f,u,e;t.MyEngineName&&(f=n.name,u=t.GetProperty("TargetDir"),u&&(u.substr(u.length-1,1)!=="\\"&&(u+="\\"),f=u+f),t.MyFieldInfo&&(e="CDE_FILEPUSH:"+f+":"+t.MyFieldInfo.cdeO,t.GetProperty("Cookie")&&(e+=":"+t.GetProperty("Cookie")),cde.CBool(t.GetProperty("AllowGlobalPush"))&&cde.MyBaseAssets.MyEngines[t.MyEngineName]?cdeCommCore.PublishCentral(t.MyEngineName,e,o):cdeCommCore.PublishToNode(t.MyFieldInfo.cdeN,t.MyEngineName,e,o)));t.FireEvent(!1,"OnFilePushed",r.target)};i.readAsDataURL(n)},u.prototype.ProcessFiles=function(n){if(n&&n.length&&!this.mFileList.length){for(var t=0;t<n.length;t++)this.mFileList.push(n[t]);this.UploadNext()}},u.Create=function(n,t,i,r,f,e,o){var s=new u(i),h;return o&&(s.MyMetaData=o),cdeCommonUtils.CBool(f)?s.SetProperty("IsLiveData",!0):s.SetProperty("IsLiveData",!1),r&&(h=r.split(":"),h.length>4&&s.SetProperty("PageSize",cdeCommonUtils.CInt(h[4])),h.length>5&&s.SetProperty("CurrentPage",cdeCommonUtils.CInt(h[5]))),s.InitControl(n,i,null,t),e&&s.SetProperty("InnerClassName",e),s},u}(n.TheDataViewBase);n.ctrlTableView=r}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,n)||this;return i.MyScreenInfo=null,i.MyFormInfo=null,i.MyTableName=null,i.mBaseDiv=null,i.mDivDashboardContent=null,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){var s=this,e,o;return this.MyBaseType=n.cdeControlType.FormView,t.prototype.InitControl.call(this,i,r,u,f),this.MyTableName=cde.GuidToString(this.MyTRF.TableName),this.MyScreenInfo=n.MyNMIModels[this.MyScreenID],this.MyTRF&&(this.MyTRF.ModelID=this.MyScreenID),e=document.getElementById("Inline_"+cde.GuidToString(this.MyTableName)),e&&(this.mBaseDiv=e),this.mBaseDiv||i||!this.MyScreenInfo.MyStorageMeta[this.MyTableName]||(this.mBaseDiv=document.getElementById("Content_"+cde.GuidToString(this.MyScreenInfo.MyStorageMeta[this.MyTableName].TargetElement))),o="CMyForm",this.mBaseDiv?this.mBaseDiv.innerHTML="":(this.mBaseDiv=document.createElement("div"),this.mBaseDiv.className=o,this.MyTarget&&(this.MyTarget.GetElement().innerHTML="")),this.mBaseDiv.style.width="inherit",this.mBaseDiv.style.height=window.innerHeight-n.GetSizeFromTile(1)+"px",this.mDivDashboardContent=document.createElement("iframe"),this.mDivDashboardContent.className="cdeDashboardIFrame",this.mDivDashboardContent.style.width="inherit",this.mDivDashboardContent.style.height="inherit",this.mDivDashboardContent.onload=function(n){s.FireEvent(!0,"OnIFrameLoaded",n)},this.mDivDashboardContent.id="cdeIFrame_"+this.MyScreenID,this.mBaseDiv.appendChild(this.mDivDashboardContent),this.SetElement(this.mBaseDiv,!1,this.mDivDashboardContent),this.SetProperty("ID","FORM_"+this.MyTableName),this.RegisterNMIControl(),!0},i.prototype.SetProperty=function(i,r){var u=this,f,e;i==="ClassName"&&this.mDivDashboardContent?this.mDivDashboardContent.className=r:t.prototype.SetProperty.call(this,i,r);i==="Source"?this.GetProperty("AddHeader")&&cde.MyCommChannel?cde.MyCommChannel.GetGlobalResource(r,this.GetProperty("AddHeader"),function(n){u.MyContainerElement.src="data:text/html;charset=utf-8,"+escape(n)}):this.MyContainerElement.src=r:i==="OnIFrameLoaded"?typeof r=="string"&&r.substr(0,4)==="NOWN"?(f=r.split(":"),this.RegisterEvent("OnIFrameLoaded",function(){n.MyEngine&&u.MyTRF&&n.MyEngine.GetBaseEngine().PublishToOwner(u.MyTRF.GetOwner(),"OnLoaded:"+u.MyTRF.GetMID()+(f.length>1?":"+f[1]:""),u.GetProperty("Source"),u.MyTRF.GetNodeID(),null,u.MyTRF.GetMID())})):this.RegisterEvent("OnIFrameLoaded",r):i==="Caption"||i==="Title"?n.MyScreenManager&&(e=n.MyScreenManager.GetScreenByID(this.MyTableName),e&&e.SetProperty(i,r)):i==="TileHeight"?this.mDivDashboardContent.style.height=cde.CBool(this.GetSetting("HidePins"))?"inherit":this.GetElement().clientHeight-44+"px":i==="TileWidth"?this.ApplySkin():i==="AllowScrolling"&&(this.mDivDashboardContent.style.overflow="auto",this.ApplySkin())},i}(n.TheDataViewBase);n.ctrlIFrameView=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){var i=t.call(this,n)||this;return i.mUID=null,i.mPWD=null,i.mPWD2=null,i.mRelay=null,i.mScope=null,i.mLoginButton=null,i.mHeader=null,i.mHeaderHelp=null,i.mStatusMsg=null,i.tLoginGroup=null,i.mMeshPicker=null,i.bFinishCalled=!1,i.bLoginFired=!1,i}return __extends(i,t),i.prototype.InitControl=function(i,r,u){var f=this,l,s,a,e,v,h,c,y,p,o,w,b,k,d;return this.MyBaseType=n.cdeControlType.LoginScreen,u||(u=[]),u.push("HidePins=true"),u.push("ScreenTitle=Login Screen"),u.push("DashBoardID=LOGIN"),t.prototype.InitControl.call(this,i,r,u,"CDELOGINSCREEN"),this.SetProperty("ScreenClassName","cde-animate-login cdeLoginScreen"),this.SetProperty("ClassName","cdeLoginContent"),this.tLoginGroup=n.MyTCF.CreateNMIControl(n.cdeControlType.TileGroup).Create(this,{PostInitBag:["TileWidth=6","ClassName=cdeLoginBlock"]}),l=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.LogoButton,4,"",0,"",["TileWidth=2","TileHeight=2","ClassName=cdeLogo cdeLoginItemAnim","Style=outline-style:none;"])),s=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:l}),s.CreateControl("LOGO"),s.SetProperty("OnClick",function(){cde.MyBaseAssets.MyServiceHostInfo.PortalReset?cde.MyBaseAssets.MyServiceHostInfo.PortalReset():location.reload(!0)}),a=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.SmartLabel,4,"",2,"",["NoTE=true","TileFactorY=2","TileHeight=1","TileWidth=4","ClassName=cdeDlgTitleBar","ContainerStyle=margin-top: 34px;","iValue=Welcome to your NMI Portal"])),this.mHeader=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:a}),this.mHeader.CreateControl("HEADER"),e="Please login with your credentials",cde.MyBaseAssets.MyServiceHostInfo.LoginDisallowed?e=this.GetProperty("ReasonText")?this.GetProperty("ReasonText"):"This Node is locked. NMI Access is disallowed":cde.MyBaseAssets.HasAutoLogin===!0&&(e="Autologin...please wait"),v=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.SmartLabel,4,"",258,"",["NoTE=true","TileHeight=1","TileWidth=4","iValue="+e])),this.mHeaderHelp=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:v}),this.mHeaderHelp.CreateControl("HEADERHELP"),h="Waiting...",c="cdeEngineStatusYellow",cde.MyBaseAssets.MyServiceHostInfo.LoginDisallowed?(h=this.GetProperty("StatusText")?this.GetProperty("StatusText"):"Node locked!",c="cdeEngineStatusRed"):(cde.MyBaseAssets.MyServiceHostInfo.AutoConnectRelay&&cde.MyBaseAssets.MyServiceHostInfo.AutoConnectRelay!==""||(y=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.ComboOption,4,"Select Relay",2,"",["EditPlaceholder=Select or enter a relay","Options="+cde.MyBaseAssets.MyServiceHostInfo.KnownRelays])),this.mRelay=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:y}),this.mRelay.CreateControl("UID")),cde.MyBaseAssets.HasAutoLogin===!1&&(cde.MyBaseAssets.MyServiceHostInfo.EnablePinLogin?(o=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.Password,4,"PIN",3,"",["EditPlaceholder=Enter Pin","InTemplate=true","AutoShowMTL=true"])),this.mPWD=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:o}),this.mPWD.CreateControl("PWD"),this.mPWD.MyNMIControl.RegisterEvent("OnValueChanged",function(){f.LoginClick()})):(p=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.eMail,4,"Username",2,"",["EditPlaceholder=Enter email","InTemplate=true"])),this.mUID=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:p}),this.mUID.CreateControl("UID"),o=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.Password,4,"Password",3,"",["EditPlaceholder=Enter Password","InTemplate=true"])),this.mPWD=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:o}),this.mPWD.CreateControl("PWD"),w=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.Password,4,"Repeat Password",3,"",["EditPlaceholder=Repeat Password","InTemplate=true"])),this.mPWD2=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:w}),this.mPWD2.CreateControl("PWD2"),cde.MyBaseAssets.MyServiceHostInfo.AllowSetScopeWithSetAdmin&&(b=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.Password,4,"Security ID",3,"",["EditPlaceholder=Security ID","Visibility=false","InTemplate=true"])),this.mScope=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:b}),this.mScope.CreateControl("SCOPE")),k=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.TileButton,4,"Login",2,"",["NoTE=true"])),this.mLoginButton=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:k}),this.mLoginButton.CreateControl("LOGBUT"),this.mLoginButton.MyNMIControl.SetProperty("OnClick",function(){f.LoginClick()}),this.mPWD.SetProperty("ReturnClicked",function(){f.LoginClick()})))),d=new n.TheTRF("NOTABLE",0,new n.TheFieldInfo(n.cdeControlType.SmartLabel,4,"Status...",2,"",["NoTE=true","TileFactorY=2","TileHeight=1","TileWidth=6","ClassName="+c,"iValue="+h])),this.mStatusMsg=n.MyTCF.CreateNMIControl(n.cdeControlType.TileEntry).Create(this.tLoginGroup,{TRF:d}),this.mStatusMsg.CreateControl("LOGSTATUS"),n.MyEngine&&!cde.MyBaseAssets.MyServiceHostInfo.LoginDisallowed&&(n.MyEngine.RegisterEvent("CDE_LOGIN_EVENT",function(n,t,i,r){f.FinishLogin(t,i,r)}),n.MyEngine.RegisterEvent("CDE_SETSTATUSMSG",function(n,t,i){f.SetStatusMsg(t,i)}),n.MyEngine.RegisterEvent("CDE_SELECT_MESH",function(n,t){f.ShowMeshSelect(t)}),n.MyEngine.RequestEngineStatus()),this.ResetDialog(),!0},i.prototype.SetProperty=function(i,r){t.prototype.SetProperty.call(this,i,r);i==="Text"||i==="Value"||i==="iValue"?this.mHeaderHelp.SetProperty("Text",r):i==="Visibility"&&(cde.CBool(r)?n.MyScreenManager&&n.MyScreenManager.ShowHeader(!1):n.MyScreenManager&&n.MyScreenManager.ShowHeader(!0))},i.prototype.LoginClick=function(){var r,t,i,u,f;if(cde.MyBaseAssets.MyServiceHostInfo.AdminPWMustBeSet)n.Check4ValidPassword(this.mPWD.MyNMIControl.GetProperty("Value"))?n.IsSamePassword(this.mPWD.MyNMIControl.GetProperty("Value"),this.mPWD2.MyNMIControl.GetProperty("Value"),!0)?n.Check4ValidEmail(this.mUID.MyNMIControl.GetProperty("Value"))?(n.Key13Event=null,this.SetProperty("Text","...updating Admin credentials..."),this.mUID.MyNMIControl.SetProperty("Disabled",!0),this.mPWD.MyNMIControl.SetProperty("Disabled",!0),this.mPWD2.MyNMIControl.SetProperty("Disabled",!0),this.mScope&&this.mScope.MyNMIControl.SetProperty("Disabled",!0),this.mLoginButton.MyNMIControl.SetProperty("Disabled",!0),r=this.mUID.GetProperty("Value")+";:;"+this.mPWD.GetProperty("Value"),this.mScope&&cde.MyBaseAssets.MyServiceHostInfo.AllowSetScopeWithSetAdmin&&(r+=";:;"+this.mScope.GetProperty("Value")),t=r,cde.MyContentEngine&&(t=cde.MyContentEngine.RSAEncrypt(t),cde.MyContentEngine.PublishToFirstNode("CDE_UPD_ADMIN:"+cde.MyBaseAssets.MyServiceHostInfo.AdminRole,t))):this.ShakeNError("Please enter a valid email address."):this.ShakeNError("Passwords do not match, please try again"):this.ShakeNError("Passwords must be at least 8 characters, please try again");else if(i=null,cde.MyBaseAssets.MyServiceHostInfo.AutoConnectRelay||(i=this.mRelay.GetProperty("Value"),this.mRelay.SetProperty("Disabled",!0)),!cde.MyBaseAssets.MyServiceHostInfo.IsUsingUserMapper||cde.MyBaseAssets.MyServiceHostInfo.EnablePinLogin)n.Key13Event=null,cde.MyBaseAssets.MyServiceHostInfo.EnablePinLogin===!0?this.SetProperty("Text","...login with PIN..."):this.SetProperty("Text","...setting scope..."),u=this.mPWD.GetProperty("Value"),this.mUID&&this.mUID.SetProperty("Disabled",!0),this.mPWD.SetProperty("Disabled",!0),this.mPWD2&&this.mPWD2.SetProperty("Disabled",!0),this.mLoginButton&&this.mLoginButton.SetProperty("Disabled",!0),n.MyEngine?n.MyEngine.Login(i,u):this.HasEvent("OnLogin")?this.FireEvent(!0,"OnLogin",u):n.MyPopUp&&n.MyPopUp.Show("NMI requires login but no login provider found. Access is denied.",!0,null,null,function(){n.ResetBrowserToPortal()});else{if(n.MyEngine&&(f=n.MyEngine.ValidateUID(this.mUID.MyNMIControl.GetProperty("Value")),f)){this.ShakeNError(f);return}n.Key13Event=null;this.SetProperty("Text","...verifying credentials...");this.mUID.SetProperty("Disabled",!0);this.mPWD.SetProperty("Disabled",!0);this.mPWD2.SetProperty("Disabled",!0);this.mLoginButton.SetProperty("Disabled",!0);n.MyEngine?n.MyEngine.Login(i,this.mUID.GetProperty("Value"),this.mPWD.GetProperty("Value")):this.HasEvent("OnLogin")?this.FireEvent(!0,"OnLogin",this.mUID.GetProperty("Value"),this.mPWD.GetProperty("Value")):n.MyPopUp&&n.MyPopUp.Show("NMI requires login but no login provider found. Access is denied.",!0,null,null,function(){n.ResetBrowserToPortal()})}},i.prototype.ShakeNError=function(n){var t=this;this.tLoginGroup.GetElement().addEventListener("animationend",function(){t.tLoginGroup.GetElement().classList.remove("cde-animate-shake");t.ResetDialog()});this.tLoginGroup.GetElement().classList.add("cde-animate-shake");this.mStatusMsg.SetProperty("Text",n);this.mStatusMsg.SetProperty("ClassName","cdeEngineStatusRed")},i.prototype.ShowMeshSelect=function(t){this.tLoginGroup.SetProperty("Visibility",!1);this.mMeshPicker=n.MyTCF.CreateNMIControl(n.cdeControlType.MeshPicker).Create(this);this.mMeshPicker.SetProperty("SetMesh",t)},i.prototype.FinishLogin=function(t,i,r){var u=this;this.bFinishCalled||this.bLoginFired||(t?(this.bFinishCalled=!0,n.TL.RegisterEvent("OnLCIDChanged",function(){u.bLoginFired||(u.bLoginFired=!0,u.tLoginGroup.GetProperty("Visibility")===!1?(u.mMeshPicker.GetElement().addEventListener("animationend",function(){u.SetProperty("Visibility",!1);u.mMeshPicker.GetElement().classList.remove("cdeLogin-animate-zoom");u.FireEvent(!1,"OnLogin",t,r)}),u.mMeshPicker.GetElement().classList.add("cdeLogin-animate-zoom")):(u.tLoginGroup.GetElement().addEventListener("animationend",function(){u.SetProperty("Visibility",!1);u.tLoginGroup.GetElement().classList.remove("cdeLogin-animate-zoom");u.FireEvent(!1,"OnLogin",t,r)}),u.tLoginGroup.GetElement().classList.add("cdeLogin-animate-zoom"),u.mStatusMsg.SetProperty("ClassName","cdeEngineStatusGreen"),u.mStatusMsg.SetProperty("Text","Done...Requesting Portal...please wait")))}),this.mStatusMsg.SetProperty("Text","Login successful! Loading language...please wait"),this.mStatusMsg.SetProperty("ClassName","cdeEngineStatusYellow"),n.TL.SetLCID(cde.MyBaseAssets.MyServiceHostInfo.CurrentLCID)):this.ShakeNError(i))},i.prototype.ResetDialog=function(){var t=this;cde.MyBaseAssets.HasAutoLogin!==!0&&(cde.MyBaseAssets.MyServiceHostInfo.LoginDisallowed||(n.Key13Event=function(){t.LoginClick()},this.mUID.SetProperty("Disabled",!1),this.mPWD.SetProperty("Disabled",!1),this.mPWD2.SetProperty("Disabled",!1),this.mLoginButton.SetProperty("Disabled",!1),this.mUID.SetProperty("Value",""),this.mPWD.SetProperty("Value",""),this.mScope&&(this.mScope.SetProperty("Visibility",!1),this.mScope.SetProperty("Disabled",!1)),this.mPWD2.SetProperty("Value",""),this.mScope&&this.mScope.SetProperty("Value",""),this.mPWD.SetProperty("Label","Password"),this.mPWD.SetProperty("EditPlaceholder","Enter Password"),cde.MyBaseAssets.MyServiceHostInfo.AdminPWMustBeSet?(this.mLoginButton.MyNMIControl.SetProperty("Text","Set Password"),this.mScope&&this.mScope.SetProperty("Visibility",!0),this.mUID.SetProperty("Visibility",!0),this.mPWD2.SetProperty("Visibility",!0),this.mPWD2.SetProperty("ReturnClicked",function(){t.LoginClick()}),cde.MyBaseAssets.MyServiceHostInfo.AllowSetScopeWithSetAdmin&&this.mScope.SetProperty("Visibility",!0),this.mHeaderHelp.MyNMIControl.SetProperty("Text","The Administrator password and email are not set, yet. Please enter a strong password to ensure maximum security.")):cde.MyBaseAssets.MyServiceHostInfo.IsUsingUserMapper?(this.mLoginButton.MyNMIControl.SetProperty("Text","Login"),this.mUID.SetProperty("Visibility",!0),this.mPWD2.SetProperty("Visibility",!1),this.mHeaderHelp.MyNMIControl.SetProperty("Text","Please login with your credentials")):(this.mLoginButton.MyNMIControl.SetProperty("Text","Set Security ID"),this.mUID.SetProperty("Visibility",!1),this.mPWD.SetProperty("Label","Security ID"),this.mPWD.SetProperty("EditPlaceholder","Enter Security ID"),this.mPWD2.SetProperty("Visibility",!1),this.mHeaderHelp.MyNMIControl.SetProperty("Text","Please enter your Security ID"))))},i.prototype.SetStatusMsg=function(n,t){var i="cdeEngineStatusGreen";switch(t){case 2:i="cdeEngineStatusYellow";break;case 3:i="cdeEngineStatusRed"}this.mStatusMsg.SetProperty("Text",n);this.mStatusMsg.SetProperty("ClassName",i)},i}(n.TheNMIScreen);n.TheLoginScreen=t}(cdeNMI||(cdeNMI={})),function(n){var t=function(t){function i(n){return t.call(this,n)||this}return __extends(i,t),i.prototype.InitControl=function(i,r,u,f){return this.MyBaseType=n.cdeControlType.CertPicker,this.ControlText="ctrlCertPicker",this.RefreshCombo='[{"V":"CDE_NOP","N":"click to see certificate-thumb and list"}]',t.prototype.InitControl.call(this,i,r,u,f),!0},i.prototype.LoadComboContent=function(t){var i=this.GetProperty("LiveOptions");i?(this.CreateComboOptions(i,this.GetProperty("Value"),!0),this.UpdatePicker(t)):n.MyEngine?(n.MyEngine.PublishToNMI("NMI_GET_DATA:CERTPICKER:"+this.GetProperty("ID")+":"+this.GetProperty("UXID"),"",this.MyFieldInfo?this.MyFieldInfo.cdeN:null),t&&this.UpdatePicker(t)):(this.DoShow=t,this.SetProperty("LiveOptions",'[{"V":"CDE_NOP","N":"No NMI Engine available - cannot load"}]'));this.DoShow=!1},i}(n.ctrlPropertyPicker);n.ctrlCertPicker=t}(cdeNMI||(cdeNMI={})),function(n){function i(n,t){for(var r,u=[],i=2;i<arguments.length;i++)u[i-2]=arguments[i];(r=cde.MyBaseAssets).FireEvent.apply(r,__spreadArrays([n,t],u))}function r(n,t){cde.MyBaseAssets.RegisterEvent(n,function(){for(var i=[],n=1;n<arguments.length;n++)i[n-1]=arguments[n];t.apply(void 0,i)})}function u(n,t){cde.AddCSSToHeader(n,t)}var t=function(){function t(){}return t.SetHoloLens=function(){return n.MyScreenManager&&n.MyScreenManager.SetHoloLens(),""},t.GotoStationHome=function(t){n.MyScreenManager&&n.MyScreenManager.GotoStationHome(t)},t.ClearAndGoHome=function(){n.MyScreenManager&&n.MyScreenManager.ClearAndGoHome()},t.GetDeepLink=function(){return n.MyScreenManager?n.MyScreenManager.GetDeepLink():""},t.TransitToScreen=function(t,i,r){if(n.MyScreenManager)return n.MyScreenManager.TransitToScreen(t,i,r)},t}();n.TheMainPage=t;n.FireEvent=i;n.RegisterEvent=r;n.AddCSSToHeader=u}(cdeNMI||(cdeNMI={})),function(n){function t(n){return cde.FixupPath(n)}function i(n){return cde.DateToString(n)}function r(n){return cde.IsNotSet(n)}function u(n){return cde.CStr(n)}function f(n){return cde.CInt(n)}function e(n){return cde.CBool(n)}function o(n){return cde.CDbl(n)}function s(n){return cde.GuidToString(n)}function h(n){cde.MyEventLogger.FireEvent(!0,"CDE_NEW_LOGENTRY","BackCompat:cdeLogEvent",n)}function c(n,t,i,r,u){return cdeNMI.cdeMinMax(n,t,i,r,u)}function l(n){return cdeNMI.toRadians(n)}n.FixupPath=t;n.DateToString=i;n.IsNotSet=r;n.CStr=u;n.CInt=f;n.CBool=e;n.CDbl=o;n.GuidToString=s;n.cdeLogEvent=h;n.cdeMinMax=c;n.toRadians=l}(cdeCommonUtils||(cdeCommonUtils={})),function(n){function t(){if(cde.MyBaseAssets.MyServiceHostInfo.DebugLevel>3,document.getElementById("cdeLogView")&&cde.MyEventLogger.RegisterEvent("CDE_NEW_LOGENTRY",function(t,i,r){var u=document.getElementById("cdeLogView");u&&(u.innerHTML=n.FormatDateNow("YYYY-MM-DD HH:mm:ss")+": "+i+":"+r+"<\/br>"+u.innerHTML)}),cde.MyBaseAssets.MyServiceHostInfo.ShowLogInConsole===!0&&cde.MyEventLogger.RegisterEvent("CDE_NEW_LOGENTRY",function(t,i,r){var u=n.FormatDateNow("YYYY-MM-DD HH:mm:ss")+": "+i+":"+r;typeof Debug!="undefined"?Debug.writeln(u):console.log(u)}),cde.MyBaseAssets.MyServiceHostInfo.ShowClassic?n.MyTCF.RegisterControlType(n.cdeControlType.ScreenManager,"cdeNMI.TheScreenManagerClassic"):cde.MyBaseAssets.MyServiceHostInfo.ScreenManagerClass?n.MyTCF.RegisterControlType(n.cdeControlType.ScreenManager,cde.MyBaseAssets.MyServiceHostInfo.ScreenManagerClass):n.MyTCF.RegisterControlType(n.cdeControlType.ScreenManager,"cdeNMI.TheScreenManagerModern"),n.MyTCF.RegisterControlType(n.cdeControlType.ProgressBar,"cdeNMI.ctrlProgressBarCool"),n.MyTCF.RegisterControlType(n.cdeControlType.SingleCheck,"cdeNMI.ctrlToggleButton2"),cde.MyCommChannel=window.SharedWorker&&!cde.MyBaseAssets.MyServiceHostInfo.DisableWebWorker?new cdeWEB.cdeWebWorkerComm:new cdeWEB.cdeWebComm,cde.StartEngineHost(),n.TheNMIService.StartEngine(),cde.MyBaseAssets.MyServiceHostInfo.AutoConnectRelay&&cde.MyCommChannel){var t=new cde.TheCommConfig(cde.MyBaseAssets.MyServiceHostInfo.WsTimeOut);t.DisableRSA=cde.CBool(cde.MyBaseAssets.MyServiceHostInfo.DisableRSA);cde.MyBaseAssets.MyServiceHostInfo.AutoConnectRelay==="INCDE"?(t.RequestPath="<%=ISBPATH%>",t.RequestPath.substr(0,3)==="<%="&&(t.RequestPath=null),t.uri=cde.MyBaseAssets.MyCommStatus.MyServiceUrl,t.wsuri=cde.MyBaseAssets.MyServiceHostInfo.MyWSServiceUrl,cde.MyBaseAssets.MyServiceHostInfo.UToken&&(t.Creds=new cde.TheCDECredentials,t.Creds.QToken=cde.MyBaseAssets.MyServiceHostInfo.UToken),t.NoISB=!0):t.uri=cde.MyBaseAssets.MyServiceHostInfo.AutoConnectRelay;cde.MyCommChannel.RegisterEvent("CDE_CONN_CHANGED",function(t,i){i?n.CreatePortalControls():n.ShowMessage("Connection Failed","A connection could not be established. Please verify your settings.")});cde.MyCommChannel.RegisterEvent("CDE_SESSION_ENDED",function(t,i){if(cde.MyBaseAssets.MyServiceHostInfo.PortalReset)cde.MyBaseAssets.MyServiceHostInfo.PortalReset();else{cde.MyBaseAssets.MyServiceHostInfo.LoginDisallowed=!0;cde.MyBaseAssets.MyCommStatus&&(cde.MyBaseAssets.MyCommStatus.UserPref=null,cde.MyBaseAssets.MyCommStatus.IsConnected=!1);cde.MyCommChannel&&(cde.MyCommChannel.ForceDisconnect=!0);n.RemoveCookies();var r=document.getElementById("cdeLogView");document.body.innerHTML="";r&&document.body.appendChild(r);n.ShowMessage(i,"Please refresh this page to login again")}});cde.MyCommChannel.RegisterEvent("CDE_NO_CONNECT",function(t,i){n.ShowMessage("Connection Failed",i)});cde.MyCommChannel.StartCommunication(t)}else n.CreatePortalControls()}function i(t,i){cde.MyBaseAssets.MyServiceHostInfo.LoginDisallowed=!0;n.MyLoginScreen=n.MyTCF.CreateNMIControl(n.cdeControlType.LoginScreen,!0);n.MyLoginScreen&&(n.MyLoginScreen.SetProperty("StatusText",t),n.MyLoginScreen.SetProperty("ReasonText",i),n.MyLoginScreen.Create(null))}function r(){n.MyToast=n.MyTCF.CreateNMIControl(n.cdeControlType.Toast,!0).Create(null);n.MyPopUp=n.MyTCF.CreateNMIControl(n.cdeControlType.Popup,!0).Create(null);n.MyToolTip=n.MyTCF.CreateNMIControl(n.cdeControlType.ToolTip,!0).Create(null);n.MyShapeRecognizer=n.MyTCF.CreateNMIControl(n.cdeControlType.ShapeRecognizer,!0);n.TL.RegisterEvent("OnLCIDChanged",function(){if(!n.MyScreenManager&&!n.MyLoginScreen)if(cde.MyBaseAssets.MyCommStatus.IsUserLoggedIn||cde.MyBaseAssets.MyServiceHostInfo.DoAllowAnonymous){try{cde.MyBaseAssets.MyCommStatus.UserPref||(cde.MyBaseAssets.MyCommStatus.UserPref=JSON.parse(cde.MyBaseAssets.MyServiceHostInfo.InitUserPref))}catch(t){}n.DoLoginSuccess(cde.MyBaseAssets.MyCommStatus.UserPref)}else n.MyLoginScreen=n.MyTCF.CreateNMIControl(n.cdeControlType.LoginScreen,!0),n.MyLoginScreen&&(n.MyLoginScreen.RegisterEvent("OnLogin",function(t,i,r){if(i){if(r.Transforms){var u=document.createElement("script");u.type="text/javascript";u.text=r.Transforms;document.head.appendChild(u)}n.DoLoginSuccess(r)}}),n.MyLoginScreen.Create(null))});n.TL.SetLCID(cde.MyBaseAssets.MyServiceHostInfo.CurrentLCID)}function u(t){(t&&(t.ShowClassic===!0||cde.MyBaseAssets.MyServiceHostInfo.WebPlatform===5?n.MyTCF.RegisterControlType(n.cdeControlType.ScreenManager,"cdeNMI.TheScreenManagerClassic"):cde.MyBaseAssets.MyServiceHostInfo.ScreenManagerClass?n.MyTCF.RegisterControlType(n.cdeControlType.ScreenManager,cde.MyBaseAssets.MyServiceHostInfo.ScreenManagerClass):n.MyTCF.RegisterControlType(n.cdeControlType.ScreenManager,"cdeNMI.TheScreenManagerModern"),t.ThemeName==="Lite"?(cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme=!0,n.ApplyTheme()):t.ThemeName==="Dark"&&(cde.MyBaseAssets.MyServiceHostInfo.IsLiteTheme=!1,n.ApplyTheme())),n.MyScreenManager)||(n.MyScreenManager=n.MyTCF.CreateNMIControl(n.cdeControlType.ScreenManager),n.MyScreenManager.RegisterEvent("OnIsLoaded",function(){cde.MyBaseAssets.MyServiceHostInfo.RedPill===!0&&n.MyDemoScreens&&n.MyDemoScreens.Show()}),cde.MyBaseAssets.MyServiceHostInfo.RequestGeoLocation===!0&&navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(t){cde.MyCommChannel.SendQueued(null,n.eTheNMIEngine,n.eTheNMIEngine,"NMI_MY_LOCATION",t.coords.longitude+";"+t.coords.latitude+";"+t.coords.accuracy,0,3,0,null)}),window.addEventListener("scroll",function(){n.MyNMISettings.IsScrolling=!0}),n.MyScreenManager.Create(null),n.MyScreenManager.CreateLoginButtonOnly(),cde.MyBaseAssets.MyServiceHostInfo.DoAllowAnonymous&&!n.MyEngine&&n.MyScreenManager.GotoStationHome(!1))}n.StartupNMI=t;n.ShowMessage=i;n.CreatePortalControls=r;n.DoLoginSuccess=u}(cdeNMI||(cdeNMI={}));var scmult=function(n,t){return[n*t[0],n*t[1]]},vcadd=function(n,t){return[n[0]+t[0],n[1]+t[1]]},minus=function(n,t){return[n[0]-t[0],n[1]-t[1]]},dot=function(n,t){return n[0]*t[0]+n[1]*t[1]},wedge=function(n,t){return n[0]*t[1]-n[1]*t[0]},apply=function(n,t){return vcadd(scmult(t[0],n[0]),scmult(t[1],n[1]))},mult=function(n,t){return[apply(n,t[0]),apply(n,t[1])]};Transform.prototype.css=function(){var n=this.A,t=this.b;return"matrix("+n[0][0]+","+n[0][1]+","+n[1][0]+","+n[1][1]+","+t[0]+","+t[1]+")"};var cascade=function(n,t){return new Transform(mult(n.A,t.A),vcadd(apply(n.A,t.b),n.b))},rotate=function(n,t){return[[n,t],[-t,n]]},rotscale=function(n,t){var i=dot(n,n),r=dot(n,t),u=wedge(n,t);return rotate(r/i,u/i)},justscale=function(n,t){var i=Math.sqrt(dot(n,n)),r=Math.sqrt(dot(t,t)),u=r/i;return rotate(u,0)},zoom=function(n,t,i){var r=minus(n[1],n[0]),u=minus(t[1],t[0]),f=i?rotscale(r,u):justscale(r,u),e=apply(f,n[0]),o=minus(t[0],e);return new Transform(f,o)},avgVector=function(n,t,i){var r=scmult(1-i,n),u=scmult(i,t);return vcadd(r,u)},avgMatrix=function(n,t,i){return[avgVector(n[0],t[0],i),avgVector(n[1],t[1],i)]};Transform.avg=function(n,t,i){return new Transform(avgMatrix(n.A,t.A,i),avgVector(n.b,t.b,i))};var identity=new Transform([[1,0],[0,1]],[0,0]),defaults=function(n,t){return n===undefined?t:n},defaultConfig=function(n,t){var i=defaults(n,{});for(var r in t)i[r]=defaults(i[r],t[r]);return i};Zoom.prototype.destroy=function(){this.elemParent.removeEventListener("touchstart",this._handleTouchStart);this.elemParent.removeEventListener("touchstart",this._handleZoom);this.elemParent.removeEventListener("touchmove",this._handleZoom);this.elemParent.removeEventListener("touchend",this._handleZoom);this.elem.style["will-change"]=null;this.elem.style["transform-origin"]=null;this.elem.style.transform=null};Zoom.prototype.previewZoom=function(){var n=zoom(this.srcCoords,this.destCoords,this.config.rotate);this.resultantZoom=cascade(n,this.activeZoom);this.repaint()};Zoom.prototype.setZoom=function(n){this.resultantZoom=n;this.repaint()};Zoom.prototype.finalize=function(){this.activeZoom=this.resultantZoom};Zoom.prototype.repaint=function(){this.elem.style.transform=this.resultantZoom.css()};Zoom.prototype.reset=function(){if(this.wnd.requestAnimationFrame){this.isAnimationRunning=!0;var r=this.activeZoom,t=null,n=this,i=function(u){t||(t=u);var f=(u-t)/100;f>=1?(n.setZoom(identity),n.isAnimationRunning=!1):(n.setZoom(Transform.avg(r,identity,f)),n.wnd.requestAnimationFrame(i))};this.wnd.requestAnimationFrame(i)}else this.setZoom(identity)};